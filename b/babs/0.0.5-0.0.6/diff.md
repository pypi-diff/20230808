# Comparing `tmp/babs-0.0.5.tar.gz` & `tmp/babs-0.0.6.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "babs-0.0.5.tar", last modified: Tue Jul 25 18:24:23 2023, max compression
+gzip compressed data, was "babs-0.0.6.tar", last modified: Tue Aug  8 15:32:26 2023, max compression
```

## Comparing `babs-0.0.5.tar` & `babs-0.0.6.tar`

### file list

```diff
@@ -1,29 +1,29 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-25 18:24:23.195767 babs-0.0.5/
--rw-r--r--   0 root         (0) root         (0)     1102 2023-07-25 18:24:16.000000 babs-0.0.5/LICENSE
--rw-r--r--   0 root         (0) root         (0)      201 2023-07-25 18:24:16.000000 babs-0.0.5/MANIFEST.in
--rw-r--r--   0 root         (0) root         (0)      761 2023-07-25 18:24:23.195767 babs-0.0.5/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)     1419 2023-07-25 18:24:16.000000 babs-0.0.5/README.rst
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-25 18:24:23.195767 babs-0.0.5/babs/
--rw-r--r--   0 root         (0) root         (0)      201 2023-07-25 18:24:16.000000 babs-0.0.5/babs/__init__.py
--rw-r--r--   0 root         (0) root         (0)      497 2023-07-25 18:24:23.195767 babs-0.0.5/babs/_version.py
--rw-r--r--   0 root         (0) root         (0)   142367 2023-07-25 18:24:16.000000 babs-0.0.5/babs/babs.py
--rw-r--r--   0 root         (0) root         (0)    38574 2023-07-25 18:24:16.000000 babs-0.0.5/babs/cli.py
--rw-r--r--   0 root         (0) root         (0)      439 2023-07-25 18:24:16.000000 babs-0.0.5/babs/constants.py
--rw-r--r--   0 root         (0) root         (0)     1222 2023-07-25 18:24:16.000000 babs-0.0.5/babs/dict_cluster_systems.yaml
--rw-r--r--   0 root         (0) root         (0)     2637 2023-07-25 18:24:16.000000 babs-0.0.5/babs/template_test_job.py
--rw-r--r--   0 root         (0) root         (0)   103977 2023-07-25 18:24:16.000000 babs-0.0.5/babs/utils.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-25 18:24:23.195767 babs-0.0.5/babs.egg-info/
--rw-r--r--   0 root         (0) root         (0)      761 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      471 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)      260 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)      299 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)        5 2023-07-25 18:24:23.000000 babs-0.0.5/babs.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)      182 2023-07-25 18:24:16.000000 babs-0.0.5/pyproject.toml
--rw-r--r--   0 root         (0) root         (0)     1917 2023-07-25 18:24:23.195767 babs-0.0.5/setup.cfg
--rwxr-xr-x   0 root         (0) root         (0)      671 2023-07-25 18:24:16.000000 babs-0.0.5/setup.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-25 18:24:23.195767 babs-0.0.5/tests/
--rw-r--r--   0 root         (0) root         (0)     5776 2023-07-25 18:24:16.000000 babs-0.0.5/tests/test_babs_check_setup.py
--rw-r--r--   0 root         (0) root         (0)    11716 2023-07-25 18:24:16.000000 babs-0.0.5/tests/test_babs_init.py
--rw-r--r--   0 root         (0) root         (0)       34 2023-07-25 18:24:16.000000 babs-0.0.5/tests/test_utils.py
--rw-r--r--   0 root         (0) root         (0)    68611 2023-07-25 18:24:16.000000 babs-0.0.5/versioneer.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-08 15:32:26.506125 babs-0.0.6/
+-rw-r--r--   0 root         (0) root         (0)     1102 2023-08-08 15:32:18.000000 babs-0.0.6/LICENSE
+-rw-r--r--   0 root         (0) root         (0)      201 2023-08-08 15:32:18.000000 babs-0.0.6/MANIFEST.in
+-rw-r--r--   0 root         (0) root         (0)      761 2023-08-08 15:32:26.506125 babs-0.0.6/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)     1539 2023-08-08 15:32:18.000000 babs-0.0.6/README.rst
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-08 15:32:26.506125 babs-0.0.6/babs/
+-rw-r--r--   0 root         (0) root         (0)      201 2023-08-08 15:32:18.000000 babs-0.0.6/babs/__init__.py
+-rw-r--r--   0 root         (0) root         (0)      497 2023-08-08 15:32:26.506125 babs-0.0.6/babs/_version.py
+-rw-r--r--   0 root         (0) root         (0)   142787 2023-08-08 15:32:18.000000 babs-0.0.6/babs/babs.py
+-rw-r--r--   0 root         (0) root         (0)    38574 2023-08-08 15:32:18.000000 babs-0.0.6/babs/cli.py
+-rw-r--r--   0 root         (0) root         (0)      439 2023-08-08 15:32:18.000000 babs-0.0.6/babs/constants.py
+-rw-r--r--   0 root         (0) root         (0)     1222 2023-08-08 15:32:18.000000 babs-0.0.6/babs/dict_cluster_systems.yaml
+-rw-r--r--   0 root         (0) root         (0)     2637 2023-08-08 15:32:18.000000 babs-0.0.6/babs/template_test_job.py
+-rw-r--r--   0 root         (0) root         (0)   104844 2023-08-08 15:32:18.000000 babs-0.0.6/babs/utils.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-08 15:32:26.506125 babs-0.0.6/babs.egg-info/
+-rw-r--r--   0 root         (0) root         (0)      761 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)      471 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)      260 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/entry_points.txt
+-rw-r--r--   0 root         (0) root         (0)      299 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)        5 2023-08-08 15:32:26.000000 babs-0.0.6/babs.egg-info/top_level.txt
+-rw-r--r--   0 root         (0) root         (0)      182 2023-08-08 15:32:18.000000 babs-0.0.6/pyproject.toml
+-rw-r--r--   0 root         (0) root         (0)     1917 2023-08-08 15:32:26.506125 babs-0.0.6/setup.cfg
+-rwxr-xr-x   0 root         (0) root         (0)      671 2023-08-08 15:32:18.000000 babs-0.0.6/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-08 15:32:26.506125 babs-0.0.6/tests/
+-rw-r--r--   0 root         (0) root         (0)     5776 2023-08-08 15:32:18.000000 babs-0.0.6/tests/test_babs_check_setup.py
+-rw-r--r--   0 root         (0) root         (0)    11716 2023-08-08 15:32:18.000000 babs-0.0.6/tests/test_babs_init.py
+-rw-r--r--   0 root         (0) root         (0)       34 2023-08-08 15:32:18.000000 babs-0.0.6/tests/test_utils.py
+-rw-r--r--   0 root         (0) root         (0)    68611 2023-08-08 15:32:18.000000 babs-0.0.6/versioneer.py
```

### Comparing `babs-0.0.5/LICENSE` & `babs-0.0.6/LICENSE`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/PKG-INFO` & `babs-0.0.6/PKG-INFO`

 * *Files 14% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: babs
-Version: 0.0.5
+Version: 0.0.6
 Summary: BIDS App Bootstrap (BABS) is a reproducible, generalizable, and scalable Python package for BIDS App analysis of large datasets. It uses DataLad and adopts FAIRly big framework.
 Home-page: https://github.com/PennLINC/babs
 Author: The PennLINC developers
 Author-email: chenyzh@seas.upenn.edu
 Maintainer: Chenying Zhao, Sydney Covitz, Matt Cieslak
 Maintainer-email: chenyzh@seas.upenn.edu
 License: MIT
```

### Comparing `babs-0.0.5/README.rst` & `babs-0.0.6/README.rst`

 * *Files 8% similar despite different names*

```diff
@@ -3,14 +3,17 @@
 ===============================
 
 .. image:: https://readthedocs.org/projects/pennlinc-babs/badge/?version=latest
   :target: http://pennlinc-babs.readthedocs.io/en/latest/?badge=latest
   :alt: Documentation Status
 .. image:: https://circleci.com/gh/PennLINC/babs/tree/main.svg?style=svg
   :target: https://circleci.com/gh/PennLINC/babs/tree/main
+.. image:: https://zenodo.org/badge/456981533.svg
+   :target: https://zenodo.org/badge/latestdoi/456981533
+   :alt: DOI
 
 Full documentation at https://pennlinc-babs.readthedocs.io
 
 About
 ---------
 BIDS App Bootstrap (BABS) is a reproducible, generalizable, and
 scalable Python package for BIDS App analysis of large datasets.
```

### Comparing `babs-0.0.5/babs/babs.py` & `babs-0.0.6/babs/babs.py`

 * *Files 1% similar despite different names*

```diff
@@ -119,8780 +119,8807 @@
 00000760: 675f 6669 6c65 732c 0a20 2020 2020 2020  g_files,.       
 00000770: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000780: 2067 6574 5f75 7365 726e 616d 652c 0a20   get_username,. 
 00000790: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000007a0: 2020 2020 2020 2063 6865 636b 5f6a 6f62         check_job
 000007b0: 5f61 6363 6f75 6e74 2c0a 2020 2020 2020  _account,.      
 000007c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000007d0: 2020 7072 696e 745f 7665 7273 696f 6e73    print_versions
-000007e0: 5f66 726f 6d5f 7961 6d6c 2c0a 2020 2020  _from_yaml,.    
-000007f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000800: 2020 2020 6765 745f 6769 745f 7368 6f77      get_git_show
-00000810: 5f72 6566 5f73 6861 7375 6d2c 0a20 2020  _ref_shasum,.   
+000007d0: 2020 6765 745f 636d 645f 6361 6e63 656c    get_cmd_cancel
+000007e0: 5f6a 6f62 2c0a 2020 2020 2020 2020 2020  _job,.          
+000007f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00000800: 696e 745f 7665 7273 696f 6e73 5f66 726f  int_versions_fro
+00000810: 6d5f 7961 6d6c 2c0a 2020 2020 2020 2020  m_yaml,.        
 00000820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000830: 2020 2020 2063 6569 6c64 6976 290a 0a0a       ceildiv)...
-00000840: 2320 4062 7569 6c64 5f64 6f63 0a63 6c61  # @build_doc.cla
-00000850: 7373 2042 4142 5328 293a 0a20 2020 2022  ss BABS():.    "
-00000860: 2222 5468 6520 4241 4253 2063 6c61 7373  ""The BABS class
-00000870: 2069 7320 666f 7220 6261 6273 2070 726f   is for babs pro
-00000880: 6a65 6374 7320 6f66 2042 4944 5320 4170  jects of BIDS Ap
-00000890: 7073 2222 220a 0a20 2020 2064 6566 205f  ps"""..    def _
-000008a0: 5f69 6e69 745f 5f28 7365 6c66 2c20 7072  _init__(self, pr
-000008b0: 6f6a 6563 745f 726f 6f74 2c20 7479 7065  oject_root, type
-000008c0: 5f73 6573 7369 6f6e 2c20 7479 7065 5f73  _session, type_s
-000008d0: 7973 7465 6d29 3a0a 2020 2020 2020 2020  ystem):.        
-000008e0: 2727 270a 2020 2020 2020 2020 5061 7261  '''.        Para
-000008f0: 6d65 7465 7273 3a0a 2020 2020 2020 2020  meters:.        
-00000900: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-00000910: 2020 2020 2070 726f 6a65 6374 5f72 6f6f       project_roo
-00000920: 743a 2073 7472 0a20 2020 2020 2020 2020  t: str.         
-00000930: 2020 2061 6273 6f6c 7574 6520 7061 7468     absolute path
-00000940: 2074 6f20 7468 6520 726f 6f74 206f 6620   to the root of 
-00000950: 7468 6973 2062 6162 7320 7072 6f6a 6563  this babs projec
-00000960: 740a 2020 2020 2020 2020 7479 7065 5f73  t.        type_s
-00000970: 6573 7369 6f6e 3a20 7374 720a 2020 2020  ession: str.    
-00000980: 2020 2020 2020 2020 7768 6574 6865 7220          whether 
-00000990: 7468 6520 696e 7075 7420 6461 7461 7365  the input datase
-000009a0: 7420 6973 2022 6d75 6c74 692d 7365 7322  t is "multi-ses"
-000009b0: 206f 7220 2273 696e 676c 652d 7365 7322   or "single-ses"
-000009c0: 0a20 2020 2020 2020 2074 7970 655f 7379  .        type_sy
-000009d0: 7374 656d 3a20 7374 720a 2020 2020 2020  stem: str.      
-000009e0: 2020 2020 2020 7468 6520 7479 7065 206f        the type o
-000009f0: 6620 6a6f 6220 7363 6865 6475 6c69 6e67  f job scheduling
-00000a00: 2073 7973 7465 6d2c 2022 7367 6522 206f   system, "sge" o
-00000a10: 7220 2273 6c75 726d 220a 0a20 2020 2020  r "slurm"..     
-00000a20: 2020 2041 7474 7269 6275 7465 733a 0a20     Attributes:. 
-00000a30: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00000a40: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
-00000a50: 726f 6a65 6374 5f72 6f6f 743a 2073 7472  roject_root: str
-00000a60: 0a20 2020 2020 2020 2020 2020 2061 6273  .            abs
-00000a70: 6f6c 7574 6520 7061 7468 2074 6f20 7468  olute path to th
-00000a80: 6520 726f 6f74 206f 6620 7468 6973 2062  e root of this b
-00000a90: 6162 7320 7072 6f6a 6563 740a 2020 2020  abs project.    
-00000aa0: 2020 2020 7479 7065 5f73 6573 7369 6f6e      type_session
-00000ab0: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-00000ac0: 2020 7768 6574 6865 7220 7468 6520 696e    whether the in
-00000ad0: 7075 7420 6461 7461 7365 7420 6973 2022  put dataset is "
-00000ae0: 6d75 6c74 692d 7365 7322 206f 7220 2273  multi-ses" or "s
-00000af0: 696e 676c 652d 7365 7322 0a20 2020 2020  ingle-ses".     
-00000b00: 2020 2074 7970 655f 7379 7374 656d 3a20     type_system: 
-00000b10: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00000b20: 7468 6520 7479 7065 206f 6620 6a6f 6220  the type of job 
-00000b30: 7363 6865 6475 6c69 6e67 2073 7973 7465  scheduling syste
-00000b40: 6d2c 2022 7367 6522 206f 7220 2273 6c75  m, "sge" or "slu
-00000b50: 726d 220a 2020 2020 2020 2020 636f 6e66  rm".        conf
-00000b60: 6967 5f70 6174 683a 2073 7472 0a20 2020  ig_path: str.   
-00000b70: 2020 2020 2020 2020 2070 6174 6820 746f           path to
-00000b80: 2074 6865 2063 6f6e 6669 6720 7961 6d6c   the config yaml
-00000b90: 2066 696c 650a 2020 2020 2020 2020 616e   file.        an
-00000ba0: 616c 7973 6973 5f70 6174 683a 2073 7472  alysis_path: str
-00000bb0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00000bc0: 6820 746f 2074 6865 2060 616e 616c 7973  h to the `analys
-00000bd0: 6973 6020 666f 6c64 6572 2e0a 2020 2020  is` folder..    
-00000be0: 2020 2020 616e 616c 7973 6973 5f64 6174      analysis_dat
-00000bf0: 616c 6164 5f68 616e 646c 653a 2064 6174  alad_handle: dat
-00000c00: 616c 6164 2064 6174 6173 6574 0a20 2020  alad dataset.   
-00000c10: 2020 2020 2020 2020 2074 6865 2060 616e           the `an
-00000c20: 616c 7973 6973 6020 6461 7461 6c61 6420  alysis` datalad 
-00000c30: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-00000c40: 696e 7075 745f 7269 615f 7061 7468 3a20  input_ria_path: 
-00000c50: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-00000c60: 5061 7468 2074 6f20 7468 6520 696e 7075  Path to the inpu
-00000c70: 7420 5249 4120 7374 6f72 652c 2074 6865  t RIA store, the
-00000c80: 2073 6962 6c69 6e67 206f 6620 6061 6e61   sibling of `ana
-00000c90: 6c79 7369 7360 2e0a 2020 2020 2020 2020  lysis`..        
-00000ca0: 2020 2020 5468 6520 636f 6d70 7574 6174      The computat
-00000cb0: 696f 6e20 6f66 2065 6163 6820 6a6f 6220  ion of each job 
-00000cc0: 7769 6c6c 2073 7461 7274 2077 6974 6820  will start with 
-00000cd0: 6120 636c 6f6e 6520 6672 6f6d 2074 6869  a clone from thi
-00000ce0: 7320 696e 7075 7420 5249 4120 7374 6f72  s input RIA stor
-00000cf0: 652e 0a20 2020 2020 2020 206f 7574 7075  e..        outpu
-00000d00: 745f 7269 615f 7061 7468 3a20 7374 720a  t_ria_path: str.
-00000d10: 2020 2020 2020 2020 2020 2020 5061 7468              Path
-00000d20: 2074 6f20 7468 6520 6f75 7470 7574 2052   to the output R
-00000d30: 4941 2073 746f 7265 2c20 7468 6520 7369  IA store, the si
-00000d40: 626c 696e 6720 6f66 2060 616e 616c 7973  bling of `analys
-00000d50: 6973 602e 0a20 2020 2020 2020 2020 2020  is`..           
-00000d60: 2054 6865 2072 6573 756c 7473 206f 6620   The results of 
-00000d70: 6a6f 6273 2077 696c 6c20 6265 2070 7573  jobs will be pus
-00000d80: 6865 6420 746f 2074 6869 7320 6f75 7470  hed to this outp
-00000d90: 7574 2052 4941 2073 746f 7265 2e0a 2020  ut RIA store..  
-00000da0: 2020 2020 2020 696e 7075 745f 7269 615f        input_ria_
-00000db0: 7572 6c3a 2073 7472 0a20 2020 2020 2020  url: str.       
-00000dc0: 2020 2020 2055 524c 206f 6620 696e 7075       URL of inpu
-00000dd0: 7420 5249 4120 7374 6f72 652c 2073 7461  t RIA store, sta
-00000de0: 7274 696e 6720 7769 7468 2022 7269 612b  rting with "ria+
-00000df0: 6669 6c65 3a2f 2f22 2e0a 2020 2020 2020  file://"..      
-00000e00: 2020 6f75 7470 7574 5f72 6961 5f75 726c    output_ria_url
-00000e10: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-00000e20: 2020 5552 4c20 6f66 206f 7574 7075 7420    URL of output 
-00000e30: 5249 4120 7374 6f72 652c 2073 7461 7274  RIA store, start
-00000e40: 696e 6720 7769 7468 2022 7269 612b 6669  ing with "ria+fi
-00000e50: 6c65 3a2f 2f22 2e0a 2020 2020 2020 2020  le://"..        
-00000e60: 6f75 7470 7574 5f72 6961 5f64 6174 615f  output_ria_data_
-00000e70: 6469 723a 2073 7472 0a20 2020 2020 2020  dir: str.       
-00000e80: 2020 2020 2050 6174 6820 746f 2074 6865       Path to the
-00000e90: 206f 7574 7075 7420 5249 4127 7320 6461   output RIA's da
-00000ea0: 7461 2064 6972 6563 746f 7279 2e0a 2020  ta directory..  
-00000eb0: 2020 2020 2020 2020 2020 4578 616d 706c            Exampl
-00000ec0: 653a 202f 6675 6c6c 2f70 6174 682f 746f  e: /full/path/to
-00000ed0: 2f70 726f 6a65 6374 5f72 6f6f 742f 6f75  /project_root/ou
-00000ee0: 7470 7574 5f72 6961 2f32 3338 2f64 6132  tput_ria/238/da2
-00000ef0: 6632 2d32 6663 342d 3462 3838 2d61 3263  f2-2fc4-4b88-a2c
-00000f00: 352d 6161 3665 3735 3462 3564 3062 0a20  5-aa6e754b5d0b. 
-00000f10: 2020 2020 2020 2061 6e61 6c79 7369 735f         analysis_
-00000f20: 6461 7461 7365 745f 6964 3a20 7374 720a  dataset_id: str.
-00000f30: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-00000f40: 4944 206f 6620 4461 7461 4c61 6420 6461  ID of DataLad da
-00000f50: 7461 7365 7420 6061 6e61 6c79 7369 7360  taset `analysis`
-00000f60: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
-00000f70: 6973 2077 696c 6c20 6265 2075 7365 6420  is will be used 
-00000f80: 746f 2067 6574 2074 6865 2066 756c 6c20  to get the full 
-00000f90: 7061 7468 2074 6f20 7468 6520 6461 7461  path to the data
-00000fa0: 7365 7420 696e 2069 6e70 7574 2052 4941  set in input RIA
-00000fb0: 2e0a 2020 2020 2020 2020 2020 2020 4578  ..            Ex
-00000fc0: 616d 706c 653a 2027 3233 3864 6132 6632  ample: '238da2f2
-00000fd0: 2d32 6663 342d 3462 3838 2d61 3263 352d  -2fc4-4b88-a2c5-
-00000fe0: 6161 3665 3735 3462 3564 3062 270a 2020  aa6e754b5d0b'.  
-00000ff0: 2020 2020 2020 6c69 7374 5f73 7562 5f70        list_sub_p
-00001000: 6174 685f 7265 6c3a 2073 7472 0a20 2020  ath_rel: str.   
-00001010: 2020 2020 2020 2020 2050 6174 6820 746f           Path to
-00001020: 2074 6865 206c 6973 7420 6f66 2066 696e   the list of fin
-00001030: 616c 2069 6e63 6c75 6465 6420 7375 626a  al included subj
-00001040: 6563 7473 2028 616e 6420 7365 7373 696f  ects (and sessio
-00001050: 6e73 2920 4353 5620 6669 6c65 2e0a 2020  ns) CSV file..  
-00001060: 2020 2020 2020 2020 2020 5468 6973 2069            This i
-00001070: 7320 7265 6c61 7469 7665 2074 6f20 6061  s relative to `a
-00001080: 6e61 6c79 7369 7360 2066 6f6c 6465 722e  nalysis` folder.
-00001090: 0a20 2020 2020 2020 206c 6973 745f 7375  .        list_su
-000010a0: 625f 7061 7468 5f61 6273 3a20 7374 720a  b_path_abs: str.
-000010b0: 2020 2020 2020 2020 2020 2020 4162 736f              Abso
-000010c0: 6c75 7465 2070 6174 6820 6f66 2060 6c69  lute path of `li
-000010d0: 7374 5f73 7562 5f70 6174 685f 7265 6c60  st_sub_path_rel`
-000010e0: 2e0a 2020 2020 2020 2020 2020 2020 4578  ..            Ex
-000010f0: 616d 706c 653a 2027 2f70 6174 682f 746f  ample: '/path/to
-00001100: 2f61 6e61 6c79 7369 732f 636f 6465 2f73  /analysis/code/s
-00001110: 7562 5f66 696e 616c 5f69 6e63 6c75 2e63  ub_final_inclu.c
-00001120: 7376 2720 666f 7220 7369 6e67 6c2d 7365  sv' for singl-se
-00001130: 7320 6461 7461 7365 743b 0a20 2020 2020  s dataset;.     
-00001140: 2020 2020 2020 2020 2020 2027 2f70 6174             '/pat
-00001150: 682f 746f 2f61 6e61 6c79 7369 732f 636f  h/to/analysis/co
-00001160: 6465 2f73 7562 5f73 6573 5f66 696e 616c  de/sub_ses_final
-00001170: 5f69 6e63 6c75 2e63 7376 2720 666f 7220  _inclu.csv' for 
-00001180: 6d75 6c74 692d 7365 7320 6461 7461 7365  multi-ses datase
-00001190: 742e 0a20 2020 2020 2020 206a 6f62 5f73  t..        job_s
-000011a0: 7461 7475 735f 7061 7468 5f72 656c 3a20  tatus_path_rel: 
-000011b0: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-000011c0: 5061 7468 2074 6f20 7468 6520 606a 6f62  Path to the `job
-000011d0: 5f73 7461 7475 732e 6373 7660 2066 696c  _status.csv` fil
-000011e0: 652e 0a20 2020 2020 2020 2020 2020 2054  e..            T
-000011f0: 6869 7320 6973 2072 656c 6174 6976 6520  his is relative 
-00001200: 746f 2060 616e 616c 7973 6973 6020 666f  to `analysis` fo
-00001210: 6c64 6572 2e0a 2020 2020 2020 2020 6a6f  lder..        jo
-00001220: 625f 7374 6174 7573 5f70 6174 685f 6162  b_status_path_ab
-00001230: 733a 2073 7472 0a20 2020 2020 2020 2020  s: str.         
-00001240: 2020 2041 6273 6f6c 7574 6520 7061 7468     Absolute path
-00001250: 206f 6620 606a 6f62 5f73 7461 7475 735f   of `job_status_
-00001260: 7061 7468 5f61 6273 602e 0a20 2020 2020  path_abs`..     
-00001270: 2020 2020 2020 2045 7861 6d70 6c65 3a20         Example: 
-00001280: 272f 7061 7468 2f74 6f2f 616e 616c 7973  '/path/to/analys
-00001290: 6973 2f63 6f64 652f 6a6f 625f 7374 6174  is/code/job_stat
-000012a0: 7573 2e63 7376 270a 2020 2020 2020 2020  us.csv'.        
-000012b0: 2727 270a 0a20 2020 2020 2020 2023 2076  '''..        # v
-000012c0: 616c 6964 6174 696f 6e3a 0a20 2020 2020  alidation:.     
-000012d0: 2020 2074 7970 655f 7365 7373 696f 6e20     type_session 
-000012e0: 3d20 7661 6c69 6461 7465 5f74 7970 655f  = validate_type_
-000012f0: 7365 7373 696f 6e28 7479 7065 5f73 6573  session(type_ses
-00001300: 7369 6f6e 290a 2020 2020 2020 2020 7479  sion).        ty
-00001310: 7065 5f73 7973 7465 6d20 3d20 7661 6c69  pe_system = vali
-00001320: 6461 7465 5f74 7970 655f 7379 7374 656d  date_type_system
-00001330: 2874 7970 655f 7379 7374 656d 290a 0a20  (type_system).. 
-00001340: 2020 2020 2020 2023 2061 7474 7269 6275         # attribu
-00001350: 7465 733a 0a20 2020 2020 2020 2073 656c  tes:.        sel
-00001360: 662e 7072 6f6a 6563 745f 726f 6f74 203d  f.project_root =
-00001370: 2070 726f 6a65 6374 5f72 6f6f 740a 2020   project_root.  
-00001380: 2020 2020 2020 7365 6c66 2e74 7970 655f        self.type_
-00001390: 7365 7373 696f 6e20 3d20 7479 7065 5f73  session = type_s
-000013a0: 6573 7369 6f6e 0a20 2020 2020 2020 2073  ession.        s
-000013b0: 656c 662e 7479 7065 5f73 7973 7465 6d20  elf.type_system 
-000013c0: 3d20 7479 7065 5f73 7973 7465 6d0a 0a20  = type_system.. 
-000013d0: 2020 2020 2020 2073 656c 662e 616e 616c         self.anal
-000013e0: 7973 6973 5f70 6174 6820 3d20 6f70 2e6a  ysis_path = op.j
-000013f0: 6f69 6e28 7072 6f6a 6563 745f 726f 6f74  oin(project_root
-00001400: 2c20 2261 6e61 6c79 7369 7322 290a 2020  , "analysis").  
-00001410: 2020 2020 2020 7365 6c66 2e61 6e61 6c79        self.analy
-00001420: 7369 735f 6461 7461 6c61 645f 6861 6e64  sis_datalad_hand
-00001430: 6c65 203d 204e 6f6e 650a 0a20 2020 2020  le = None..     
-00001440: 2020 2073 656c 662e 636f 6e66 6967 5f70     self.config_p
-00001450: 6174 6820 3d20 6f70 2e6a 6f69 6e28 7365  ath = op.join(se
-00001460: 6c66 2e61 6e61 6c79 7369 735f 7061 7468  lf.analysis_path
-00001470: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001490: 2020 2020 2022 636f 6465 2f62 6162 735f       "code/babs_
-000014a0: 7072 6f6a 5f63 6f6e 6669 672e 7961 6d6c  proj_config.yaml
-000014b0: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
-000014c0: 2e69 6e70 7574 5f72 6961 5f70 6174 6820  .input_ria_path 
-000014d0: 3d20 6f70 2e6a 6f69 6e28 7072 6f6a 6563  = op.join(projec
-000014e0: 745f 726f 6f74 2c20 2269 6e70 7574 5f72  t_root, "input_r
-000014f0: 6961 2229 0a20 2020 2020 2020 2073 656c  ia").        sel
-00001500: 662e 6f75 7470 7574 5f72 6961 5f70 6174  f.output_ria_pat
-00001510: 6820 3d20 6f70 2e6a 6f69 6e28 7072 6f6a  h = op.join(proj
-00001520: 6563 745f 726f 6f74 2c20 226f 7574 7075  ect_root, "outpu
-00001530: 745f 7269 6122 290a 0a20 2020 2020 2020  t_ria")..       
-00001540: 2073 656c 662e 696e 7075 745f 7269 615f   self.input_ria_
-00001550: 7572 6c20 3d20 2272 6961 2b66 696c 653a  url = "ria+file:
-00001560: 2f2f 2220 2b20 7365 6c66 2e69 6e70 7574  //" + self.input
-00001570: 5f72 6961 5f70 6174 680a 2020 2020 2020  _ria_path.      
-00001580: 2020 7365 6c66 2e6f 7574 7075 745f 7269    self.output_ri
-00001590: 615f 7572 6c20 3d20 2272 6961 2b66 696c  a_url = "ria+fil
-000015a0: 653a 2f2f 2220 2b20 7365 6c66 2e6f 7574  e://" + self.out
-000015b0: 7075 745f 7269 615f 7061 7468 0a0a 2020  put_ria_path..  
-000015c0: 2020 2020 2020 7365 6c66 2e6f 7574 7075        self.outpu
-000015d0: 745f 7269 615f 6461 7461 5f64 6972 203d  t_ria_data_dir =
-000015e0: 204e 6f6e 6520 2020 2020 2320 6e6f 7420   None     # not 
-000015f0: 6b6e 6f77 6e20 7965 7420 6265 666f 7265  known yet before
-00001600: 206f 7574 7075 745f 7269 6120 6973 2063   output_ria is c
-00001610: 7265 6174 6564 0a20 2020 2020 2020 2073  reated.        s
-00001620: 656c 662e 616e 616c 7973 6973 5f64 6174  elf.analysis_dat
-00001630: 6173 6574 5f69 6420 3d20 4e6f 6e65 2020  aset_id = None  
-00001640: 2020 2320 746f 2075 7064 6174 6520 6c61    # to update la
-00001650: 7465 720a 0a20 2020 2020 2020 2023 2061  ter..        # a
-00001660: 7474 7269 6275 7465 2060 6c69 7374 5f73  ttribute `list_s
-00001670: 7562 5f70 6174 685f 2a60 3a0a 2020 2020  ub_path_*`:.    
-00001680: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-00001690: 5f73 6573 7369 6f6e 203d 3d20 2273 696e  _session == "sin
-000016a0: 676c 652d 7365 7322 3a0a 2020 2020 2020  gle-ses":.      
-000016b0: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-000016c0: 7375 625f 7061 7468 5f72 656c 203d 2027  sub_path_rel = '
-000016d0: 636f 6465 2f73 7562 5f66 696e 616c 5f69  code/sub_final_i
-000016e0: 6e63 6c75 2e63 7376 270a 2020 2020 2020  nclu.csv'.      
-000016f0: 2020 656c 6966 2073 656c 662e 7479 7065    elif self.type
-00001700: 5f73 6573 7369 6f6e 203d 3d20 226d 756c  _session == "mul
-00001710: 7469 2d73 6573 223a 0a20 2020 2020 2020  ti-ses":.       
-00001720: 2020 2020 2073 656c 662e 6c69 7374 5f73       self.list_s
-00001730: 7562 5f70 6174 685f 7265 6c20 3d20 2763  ub_path_rel = 'c
-00001740: 6f64 652f 7375 625f 7365 735f 6669 6e61  ode/sub_ses_fina
-00001750: 6c5f 696e 636c 752e 6373 7627 0a20 2020  l_inclu.csv'.   
-00001760: 2020 2020 2073 656c 662e 6c69 7374 5f73       self.list_s
-00001770: 7562 5f70 6174 685f 6162 7320 3d20 6f70  ub_path_abs = op
-00001780: 2e6a 6f69 6e28 7365 6c66 2e61 6e61 6c79  .join(self.analy
-00001790: 7369 735f 7061 7468 2c0a 2020 2020 2020  sis_path,.      
-000017a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017c0: 2020 2073 656c 662e 6c69 7374 5f73 7562     self.list_sub
-000017d0: 5f70 6174 685f 7265 6c29 0a0a 2020 2020  _path_rel)..    
-000017e0: 2020 2020 7365 6c66 2e6a 6f62 5f73 7461      self.job_sta
-000017f0: 7475 735f 7061 7468 5f72 656c 203d 2027  tus_path_rel = '
-00001800: 636f 6465 2f6a 6f62 5f73 7461 7475 732e  code/job_status.
-00001810: 6373 7627 0a20 2020 2020 2020 2073 656c  csv'.        sel
-00001820: 662e 6a6f 625f 7374 6174 7573 5f70 6174  f.job_status_pat
-00001830: 685f 6162 7320 3d20 6f70 2e6a 6f69 6e28  h_abs = op.join(
-00001840: 7365 6c66 2e61 6e61 6c79 7369 735f 7061  self.analysis_pa
-00001850: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00001860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00001880: 656c 662e 6a6f 625f 7374 6174 7573 5f70  elf.job_status_p
-00001890: 6174 685f 7265 6c29 0a0a 2020 2020 6465  ath_rel)..    de
-000018a0: 6620 6461 7461 6c61 645f 7361 7665 2873  f datalad_save(s
-000018b0: 656c 662c 2070 6174 682c 206d 6573 7361  elf, path, messa
-000018c0: 6765 3d4e 6f6e 6529 3a0a 2020 2020 2020  ge=None):.      
-000018d0: 2020 2222 220a 2020 2020 2020 2020 5361    """.        Sa
-000018e0: 7665 2074 6865 2063 7572 7265 6e74 2073  ve the current s
-000018f0: 7461 7475 7320 6f66 2064 6174 616c 6164  tatus of datalad
-00001900: 2064 6174 6173 6574 2060 616e 616c 7973   dataset `analys
-00001910: 6973 600a 2020 2020 2020 2020 416c 736f  is`.        Also
-00001920: 2063 6865 636b 7320 7468 6174 2061 6c6c   checks that all
-00001930: 2074 6865 2073 7461 7475 7365 7320 7265   the statuses re
-00001940: 7475 726e 6564 2061 7265 2022 6f6b 2220  turned are "ok" 
-00001950: 286f 7220 226e 6f74 6e65 6564 6564 2229  (or "notneeded")
-00001960: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-00001970: 7465 7273 3a0a 2020 2020 2020 2020 2d2d  ters:.        --
-00001980: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-00001990: 2020 2070 6174 683a 2073 7472 206f 7220     path: str or 
-000019a0: 6c69 7374 206f 6620 7374 720a 2020 2020  list of str.    
-000019b0: 2020 2020 2020 2020 7468 6520 7061 7468          the path
-000019c0: 2074 6f20 7468 6520 6669 6c65 2873 2920   to the file(s) 
-000019d0: 6f72 2066 6f6c 6465 7228 7329 2074 6f20  or folder(s) to 
-000019e0: 7361 7665 0a20 2020 2020 2020 206d 6573  save.        mes
-000019f0: 7361 6765 3a20 7374 7220 6f72 204e 6f6e  sage: str or Non
-00001a00: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
-00001a10: 6d6d 6974 206d 6573 7361 6765 2069 6e20  mmit message in 
-00001a20: 6064 6174 616c 6164 2073 6176 6560 0a0a  `datalad save`..
-00001a30: 2020 2020 2020 2020 4e6f 7465 733a 0a20          Notes:. 
-00001a40: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-00001a50: 2d2d 2d0a 2020 2020 2020 2020 4966 2074  ---.        If t
-00001a60: 6865 2070 6174 6820 646f 6573 206e 6f74  he path does not
-00001a70: 2065 7869 7374 2c20 7468 6520 7374 6174   exist, the stat
-00001a80: 7573 2077 696c 6c20 6265 2022 6e6f 746e  us will be "notn
-00001a90: 6565 6465 6422 2c20 616e 6420 776f 6e27  eeded", and won'
-00001aa0: 7420 6265 2065 7272 6f72 206d 6573 7361  t be error messa
-00001ab0: 6765 0a20 2020 2020 2020 2020 2020 2041  ge.            A
-00001ac0: 6e64 2074 6865 7265 2077 6f6e 2774 2062  nd there won't b
-00001ad0: 6520 6120 636f 6d6d 6974 2077 6974 6820  e a commit with 
-00001ae0: 7468 6174 206d 6573 7361 6765 0a20 2020  that message.   
-00001af0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00001b00: 2020 7374 6174 7573 6573 203d 2073 656c    statuses = sel
-00001b10: 662e 616e 616c 7973 6973 5f64 6174 616c  f.analysis_datal
-00001b20: 6164 5f68 616e 646c 652e 7361 7665 2870  ad_handle.save(p
-00001b30: 6174 683d 7061 7468 2c20 6d65 7373 6167  ath=path, messag
-00001b40: 653d 6d65 7373 6167 6529 0a20 2020 2020  e=message).     
-00001b50: 2020 2023 205e 5e20 6e75 6d62 6572 206f     # ^^ number o
-00001b60: 6620 6469 6374 7320 696e 206c 6973 7420  f dicts in list 
-00001b70: 6073 7461 7475 7365 7360 203d 206c 656e  `statuses` = len
-00001b80: 2870 6174 6829 0a20 2020 2020 2020 2023  (path).        #
-00001b90: 2063 6865 636b 2074 6861 7420 616c 6c20   check that all 
-00001ba0: 7374 6174 7573 6573 2072 6574 7572 6e65  statuses returne
-00001bb0: 6420 6172 6520 226f 6b61 7922 3a0a 2020  d are "okay":.  
-00001bc0: 2020 2020 2020 2320 6265 6c6f 7720 6973        # below is
-00001bd0: 2066 726f 6d20 6375 6269 6473 0a20 2020   from cubids.   
-00001be0: 2020 2020 2073 6176 6564 5f73 7461 7475       saved_statu
-00001bf0: 7320 3d20 7365 7428 5b73 7461 7475 735b  s = set([status[
-00001c00: 2773 7461 7475 7327 5d20 666f 7220 7374  'status'] for st
-00001c10: 6174 7573 2069 6e20 7374 6174 7573 6573  atus in statuses
-00001c20: 5d29 0a20 2020 2020 2020 2069 6620 7361  ]).        if sa
-00001c30: 7665 645f 7374 6174 7573 2e69 7373 7562  ved_status.issub
-00001c40: 7365 7428 7365 7428 5b22 6f6b 222c 2022  set(set(["ok", "
-00001c50: 6e6f 746e 6565 6465 6422 5d29 2920 6973  notneeded"])) is
-00001c60: 2046 616c 7365 3a0a 2020 2020 2020 2020   False:.        
-00001c70: 2020 2020 2320 6578 6973 7473 2065 6c65      # exists ele
-00001c80: 6d65 6e74 2069 6e20 6073 6176 6564 5f73  ment in `saved_s
-00001c90: 7461 7475 7360 2074 6861 7420 6973 206e  tatus` that is n
-00001ca0: 6f74 2022 6f6b 2220 6f72 2022 6e6f 746e  ot "ok" or "notn
-00001cb0: 6565 6465 6422 0a20 2020 2020 2020 2020  eeded".         
-00001cc0: 2020 2023 205e 5e20 226e 6f74 6e65 6564     # ^^ "notneed
-00001cd0: 6564 223a 206e 6f74 6869 6e67 2074 6f20  ed": nothing to 
-00001ce0: 7361 7665 0a20 2020 2020 2020 2020 2020  save.           
-00001cf0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00001d00: 2822 6064 6174 616c 6164 2073 6176 6560  ("`datalad save`
-00001d10: 2066 6169 6c65 6421 2229 0a0a 2020 2020   failed!")..    
-00001d20: 6465 6620 7774 665f 6b65 795f 696e 666f  def wtf_key_info
-00001d30: 2873 656c 662c 2066 6c61 675f 6f75 7470  (self, flag_outp
-00001d40: 7574 5f72 6961 5f6f 6e6c 793d 4661 6c73  ut_ria_only=Fals
-00001d50: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-00001d60: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-00001d70: 746f 2067 6574 2073 6f6d 6520 6b65 7920  to get some key 
-00001d80: 696e 666f 726d 6174 696f 6e20 6f6e 2044  information on D
-00001d90: 6174 614c 6164 2064 6174 6173 6574 2060  ataLad dataset `
-00001da0: 616e 616c 7973 6973 602c 0a20 2020 2020  analysis`,.     
-00001db0: 2020 2061 6e64 2061 7373 6967 6e20 746f     and assign to
-00001dc0: 2060 6f75 7470 7574 5f72 6961 5f64 6174   `output_ria_dat
-00001dd0: 615f 6469 7260 2061 6e64 2060 616e 616c  a_dir` and `anal
-00001de0: 7973 6973 5f64 6174 6173 6574 5f69 6460  ysis_dataset_id`
-00001df0: 2e0a 2020 2020 2020 2020 5468 6973 2066  ..        This f
-00001e00: 756e 6374 696f 6e20 7265 6c69 6573 206f  unction relies o
-00001e10: 6e20 6067 6974 6020 616e 6420 6064 6174  n `git` and `dat
-00001e20: 616c 6164 2077 7466 600a 2020 2020 2020  alad wtf`.      
-00001e30: 2020 5468 6973 206e 6565 6473 2074 6f20    This needs to 
-00001e40: 6265 2064 6f6e 6520 6166 7465 7220 7468  be done after th
-00001e50: 6520 6f75 7470 7574 2052 4941 2069 7320  e output RIA is 
-00001e60: 6372 6561 7465 642e 0a0a 2020 2020 2020  created...      
-00001e70: 2020 5061 7261 6d65 7465 7273 3a0a 2020    Parameters:.  
-00001e80: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00001e90: 2d2d 0a20 2020 2020 2020 2066 6c61 675f  --.        flag_
-00001ea0: 6f75 7470 7574 5f72 6961 5f6f 6e6c 793a  output_ria_only:
-00001eb0: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
-00001ec0: 2020 6966 206f 6e6c 7920 746f 2067 6574    if only to get
-00001ed0: 2069 6e66 6f72 6d61 7469 6f6e 206f 6e20   information on 
-00001ee0: 6f75 7470 7574 2052 4941 2e0a 2020 2020  output RIA..    
-00001ef0: 2020 2020 2020 2020 5468 6973 206d 6179          This may
-00001f00: 2065 7870 6564 6974 6520 7468 6520 7072   expedite the pr
-00001f10: 6f63 6573 7320 6173 206f 7468 6572 2069  ocess as other i
-00001f20: 6e66 6f72 6d61 7469 6f6e 2072 6571 7569  nformation requi
-00001f30: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-00001f40: 6361 6c6c 696e 6720 6064 6174 616c 6164  calling `datalad
-00001f50: 6020 696e 2074 6572 6d69 6e61 6c2c 2077  ` in terminal, w
-00001f60: 6869 6368 2077 6f75 6c64 2074 616b 6573  hich would takes
-00001f70: 2073 6576 6572 616c 2073 6563 6f6e 6473   several seconds
-00001f80: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00001f90: 2020 2020 2020 2023 2047 6574 2074 6865         # Get the
-00001fa0: 2060 7365 6c66 2e6f 7574 7075 745f 7269   `self.output_ri
-00001fb0: 615f 6461 7461 5f64 6972 603a 0a20 2020  a_data_dir`:.   
-00001fc0: 2020 2020 2023 2065 2e67 2e2c 202f 6675       # e.g., /fu
-00001fd0: 6c6c 2f70 6174 682f 6f75 7470 7574 5f72  ll/path/output_r
-00001fe0: 6961 2f32 3338 2f64 6132 6632 2d32 6663  ia/238/da2f2-2fc
-00001ff0: 342d 3462 3838 2d61 3263 352d 6161 3665  4-4b88-a2c5-aa6e
-00002000: 3735 3462 3564 3062 0a20 2020 2020 2020  754b5d0b.       
-00002010: 2061 6e61 6c79 7369 735f 6769 745f 7061   analysis_git_pa
-00002020: 7468 203d 206f 702e 6a6f 696e 2873 656c  th = op.join(sel
-00002030: 662e 616e 616c 7973 6973 5f70 6174 682c  f.analysis_path,
-00002040: 2022 2e67 6974 2229 0a20 2020 2020 2020   ".git").       
-00002050: 2070 726f 635f 6f75 7470 7574 5f72 6961   proc_output_ria
-00002060: 5f64 6174 615f 6469 7220 3d20 7375 6270  _data_dir = subp
-00002070: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
-00002080: 2020 2020 2020 2020 5b22 6769 7422 2c20          ["git", 
-00002090: 222d 2d67 6974 2d64 6972 222c 2061 6e61  "--git-dir", ana
-000020a0: 6c79 7369 735f 6769 745f 7061 7468 2c20  lysis_git_path, 
-000020b0: 2272 656d 6f74 6522 2c20 2267 6574 2d75  "remote", "get-u
-000020c0: 726c 222c 2022 2d2d 7075 7368 222c 2022  rl", "--push", "
-000020d0: 6f75 7470 7574 225d 2c0a 2020 2020 2020  output"],.      
-000020e0: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
-000020f0: 7072 6f63 6573 732e 5049 5045 290a 2020  process.PIPE).  
-00002100: 2020 2020 2020 2320 5e5e 3a20 666f 7220        # ^^: for 
-00002110: 6061 6e61 6c79 7369 7360 3a20 6769 7420  `analysis`: git 
-00002120: 7265 6d6f 7465 2067 6574 2d75 726c 202d  remote get-url -
-00002130: 2d70 7573 6820 6f75 7470 7574 0a20 2020  -push output.   
-00002140: 2020 2020 2023 205e 5e20 616e 6f74 6865       # ^^ anothe
-00002150: 7220 7761 7920 746f 2063 6861 6e67 6520  r way to change 
-00002160: 7468 6520 7764 2074 656d 706f 7261 7269  the wd temporari
-00002170: 6c79 3a20 6164 6420 6063 7764 3d73 656c  ly: add `cwd=sel
-00002180: 662e 7878 7860 2069 6e20 6073 7562 7072  f.xxx` in `subpr
-00002190: 6f63 6573 732e 7275 6e28 2960 0a20 2020  ocess.run()`.   
-000021a0: 2020 2020 2023 2069 6620 7375 6363 6573       # if succes
-000021b0: 733a 206e 6f20 6f75 7470 7574 3b20 6966  s: no output; if
-000021c0: 2066 6169 6c65 643a 2077 696c 6c20 7261   failed: will ra
-000021d0: 6973 6520 4361 6c6c 6564 5072 6f63 6573  ise CalledProces
-000021e0: 7345 7272 6f72 0a20 2020 2020 2020 2070  sError.        p
-000021f0: 726f 635f 6f75 7470 7574 5f72 6961 5f64  roc_output_ria_d
-00002200: 6174 615f 6469 722e 6368 6563 6b5f 7265  ata_dir.check_re
-00002210: 7475 726e 636f 6465 2829 0a20 2020 2020  turncode().     
-00002220: 2020 2073 656c 662e 6f75 7470 7574 5f72     self.output_r
-00002230: 6961 5f64 6174 615f 6469 7220 3d20 7072  ia_data_dir = pr
-00002240: 6f63 5f6f 7574 7075 745f 7269 615f 6461  oc_output_ria_da
-00002250: 7461 5f64 6972 2e73 7464 6f75 742e 6465  ta_dir.stdout.de
-00002260: 636f 6465 2827 7574 662d 3827 290a 2020  code('utf-8').  
-00002270: 2020 2020 2020 6966 2073 656c 662e 6f75        if self.ou
-00002280: 7470 7574 5f72 6961 5f64 6174 615f 6469  tput_ria_data_di
-00002290: 725b 2d31 3a5d 203d 3d20 225c 6e22 3a0a  r[-1:] == "\n":.
-000022a0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-000022b0: 6d6f 7665 2074 6865 206c 6173 7420 3220  move the last 2 
-000022c0: 6368 6172 6163 7465 7273 0a20 2020 2020  characters.     
-000022d0: 2020 2020 2020 2073 656c 662e 6f75 7470         self.outp
-000022e0: 7574 5f72 6961 5f64 6174 615f 6469 7220  ut_ria_data_dir 
-000022f0: 3d20 7365 6c66 2e6f 7574 7075 745f 7269  = self.output_ri
-00002300: 615f 6461 7461 5f64 6972 5b3a 2d31 5d0a  a_data_dir[:-1].
-00002310: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00002320: 666c 6167 5f6f 7574 7075 745f 7269 615f  flag_output_ria_
-00002330: 6f6e 6c79 3a20 2020 2320 616c 736f 2077  only:   # also w
-00002340: 616e 7420 6f74 6865 7220 696e 666f 726d  ant other inform
-00002350: 6174 696f 6e3a 0a20 2020 2020 2020 2020  ation:.         
-00002360: 2020 2023 2047 6574 2074 6865 2064 6174     # Get the dat
-00002370: 6173 6574 2049 4420 6f66 2060 616e 616c  aset ID of `anal
-00002380: 7973 6973 602c 2069 2e65 2e2c 2060 616e  ysis`, i.e., `an
-00002390: 616c 7973 6973 5f64 6174 6173 6574 5f69  alysis_dataset_i
-000023a0: 6460 3a0a 0a20 2020 2020 2020 2020 2020  d`:..           
-000023b0: 2023 2077 6179 2023 313a 2075 7369 6e67   # way #1: using
-000023c0: 2064 6174 616c 6164 2061 7069 3b20 686f   datalad api; ho
-000023d0: 7765 7665 722c 2069 7420 616c 7761 7973  wever, it always
-000023e0: 2070 7269 6e74 7320 6f75 7420 7468 6520   prints out the 
-000023f0: 6675 6c6c 2c20 6c65 6e67 7468 7920 7774  full, lengthy wt
-00002400: 6620 7265 706f 7274 2e2e 2e2e 0a20 2020  f report.....   
-00002410: 2020 2020 2020 2020 2023 2023 2066 756c           # # ful
-00002420: 6c20 6469 6374 2066 726f 6d20 6064 6174  l dict from `dat
-00002430: 616c 6164 2077 7466 603a 0a20 2020 2020  alad wtf`:.     
-00002440: 2020 2020 2020 2023 2062 6c6f 636b 5072         # blockPr
-00002450: 696e 7428 290a 2020 2020 2020 2020 2020  int().          
-00002460: 2020 2320 6675 6c6c 5f77 7466 5f6c 6973    # full_wtf_lis
-00002470: 7420 3d20 646c 6170 692e 7774 6628 6461  t = dlapi.wtf(da
-00002480: 7461 7365 743d 7365 6c66 2e61 6e61 6c79  taset=self.analy
-00002490: 7369 735f 7061 7468 290a 2020 2020 2020  sis_path).      
-000024a0: 2020 2020 2020 2320 656e 6162 6c65 5072        # enablePr
-000024b0: 696e 7428 290a 2020 2020 2020 2020 2020  int().          
-000024c0: 2020 2320 2320 5e5e 2074 6869 7320 6973    # # ^^ this is
-000024d0: 2061 206c 6973 740a 2020 2020 2020 2020   a list.        
-000024e0: 2020 2020 2320 6966 206c 656e 2866 756c      # if len(ful
-000024f0: 6c5f 7774 665f 6c69 7374 2920 3e20 313a  l_wtf_list) > 1:
-00002500: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-00002510: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-00002520: 2822 5468 6572 6520 6172 6520 6d6f 7265  ("There are more
-00002530: 2074 6861 6e20 6f6e 6520 6469 6374 696f   than one dictio
-00002540: 6e61 7279 2066 6f72 2069 6e70 7574 2052  nary for input R
-00002550: 4941 2773 2060 6461 7461 6c61 6420 7774  IA's `datalad wt
-00002560: 6660 2e22 0a20 2020 2020 2020 2020 2020  f`.".           
-00002570: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00002580: 2020 2020 202b 2022 2057 6527 6c6c 206f       + " We'll o
-00002590: 6e6c 7920 7573 6520 7468 6520 6669 7273  nly use the firs
-000025a0: 7420 6f6e 652e 2229 0a20 2020 2020 2020  t one.").       
-000025b0: 2020 2020 2023 2066 756c 6c5f 7774 6620       # full_wtf 
-000025c0: 3d20 6675 6c6c 5f77 7466 5f6c 6973 745b  = full_wtf_list[
-000025d0: 305d 0a20 2020 2020 2020 2020 2020 2023  0].            #
-000025e0: 2023 205e 5e20 6f6e 6c79 2074 616b 6520   # ^^ only take 
-000025f0: 7468 6520 6669 7273 7420 6469 6374 2028  the first dict (
-00002600: 656c 656d 656e 7429 2066 726f 6d20 7468  element) from th
-00002610: 6520 6675 6c6c 206c 6973 740a 2020 2020  e full list.    
-00002620: 2020 2020 2020 2020 2320 7365 6c66 2e61          # self.a
-00002630: 6e61 6c79 7369 735f 6461 7461 7365 745f  nalysis_dataset_
-00002640: 6964 203d 2066 756c 6c5f 7774 665b 2269  id = full_wtf["i
-00002650: 6e66 6f73 225d 5b22 6461 7461 7365 7422  nfos"]["dataset"
-00002660: 5d5b 2269 6422 5d0a 2020 2020 2020 2020  ]["id"].        
-00002670: 2020 2020 2320 2320 5e5e 3a20 2420 6461      # # ^^: $ da
-00002680: 7461 6c61 6420 2d66 2027 7b69 6e66 6f73  talad -f '{infos
-00002690: 5b64 6174 6173 6574 5d5b 6964 5d7d 2720  [dataset][id]}' 
-000026a0: 7774 6620 2d53 2064 6174 6173 6574 0a0a  wtf -S dataset..
-000026b0: 2020 2020 2020 2020 2020 2020 2320 7761              # wa
-000026c0: 7920 2332 3a20 636f 6d6d 616e 6420 6c69  y #2: command li
-000026d0: 6e65 206f 6620 6461 7461 6c61 643a 0a20  ne of datalad:. 
-000026e0: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
-000026f0: 616e 616c 7973 6973 5f64 6174 6173 6574  analysis_dataset
-00002700: 5f69 6420 3d20 7375 6270 726f 6365 7373  _id = subprocess
-00002710: 2e72 756e 280a 2020 2020 2020 2020 2020  .run(.          
-00002720: 2020 2020 2020 5b22 6461 7461 6c61 6422        ["datalad"
-00002730: 2c20 222d 6622 2c20 2227 7b69 6e66 6f73  , "-f", "'{infos
-00002740: 5b64 6174 6173 6574 5d5b 6964 5d7d 2722  [dataset][id]}'"
-00002750: 2c20 2277 7466 222c 2022 2d53 222c 2022  , "wtf", "-S", "
-00002760: 6461 7461 7365 7422 5d2c 0a20 2020 2020  dataset"],.     
-00002770: 2020 2020 2020 2020 2020 2063 7764 3d73             cwd=s
-00002780: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
-00002790: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-000027a0: 2020 2073 7464 6f75 743d 7375 6270 726f     stdout=subpro
-000027b0: 6365 7373 2e50 4950 4529 0a20 2020 2020  cess.PIPE).     
-000027c0: 2020 2020 2020 2023 2064 6174 616c 6164         # datalad
-000027d0: 202d 6620 277b 696e 666f 735b 6461 7461   -f '{infos[data
-000027e0: 7365 745d 5b69 645d 7d27 2077 7466 202d  set][id]}' wtf -
-000027f0: 5320 6461 7461 7365 740a 2020 2020 2020  S dataset.      
-00002800: 2020 2020 2020 7072 6f63 5f61 6e61 6c79        proc_analy
-00002810: 7369 735f 6461 7461 7365 745f 6964 2e63  sis_dataset_id.c
-00002820: 6865 636b 5f72 6574 7572 6e63 6f64 6528  heck_returncode(
-00002830: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00002840: 6c66 2e61 6e61 6c79 7369 735f 6461 7461  lf.analysis_data
-00002850: 7365 745f 6964 203d 2070 726f 635f 616e  set_id = proc_an
-00002860: 616c 7973 6973 5f64 6174 6173 6574 5f69  alysis_dataset_i
-00002870: 642e 7374 646f 7574 2e64 6563 6f64 6528  d.stdout.decode(
-00002880: 2775 7466 2d38 2729 0a20 2020 2020 2020  'utf-8').       
-00002890: 2020 2020 2023 2072 656d 6f76 6520 7468       # remove th
-000028a0: 6520 605c 6e60 3a0a 2020 2020 2020 2020  e `\n`:.        
-000028b0: 2020 2020 6966 2073 656c 662e 616e 616c      if self.anal
-000028c0: 7973 6973 5f64 6174 6173 6574 5f69 645b  ysis_dataset_id[
-000028d0: 2d31 3a5d 203d 3d20 225c 6e22 3a0a 2020  -1:] == "\n":.  
-000028e0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000028f0: 7265 6d6f 7665 2074 6865 206c 6173 7420  remove the last 
-00002900: 3220 6368 6172 6163 7465 7273 0a20 2020  2 characters.   
-00002910: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00002920: 662e 616e 616c 7973 6973 5f64 6174 6173  f.analysis_datas
-00002930: 6574 5f69 6420 3d20 7365 6c66 2e61 6e61  et_id = self.ana
-00002940: 6c79 7369 735f 6461 7461 7365 745f 6964  lysis_dataset_id
-00002950: 5b3a 2d31 5d0a 2020 2020 2020 2020 2020  [:-1].          
-00002960: 2020 2320 7265 6d6f 7665 2074 6865 2064    # remove the d
-00002970: 6f75 626c 6520 7175 6f74 6573 3a0a 2020  ouble quotes:.  
-00002980: 2020 2020 2020 2020 2020 6966 2028 7365            if (se
-00002990: 6c66 2e61 6e61 6c79 7369 735f 6461 7461  lf.analysis_data
-000029a0: 7365 745f 6964 5b30 5d20 3d3d 2022 2722  set_id[0] == "'"
-000029b0: 2920 2620 2873 656c 662e 616e 616c 7973  ) & (self.analys
-000029c0: 6973 5f64 6174 6173 6574 5f69 645b 2d31  is_dataset_id[-1
-000029d0: 5d20 3d3d 2022 2722 293a 0a20 2020 2020  ] == "'"):.     
-000029e0: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-000029f0: 6669 7273 7420 616e 6420 7468 6520 6c61  first and the la
-00002a00: 7374 2063 6861 7261 6374 6572 7320 6172  st characters ar
-00002a10: 6520 7175 6f74 6573 3a20 7265 6d6f 7665  e quotes: remove
-00002a20: 2074 6865 6d0a 2020 2020 2020 2020 2020   them.          
-00002a30: 2020 2020 2020 7365 6c66 2e61 6e61 6c79        self.analy
-00002a40: 7369 735f 6461 7461 7365 745f 6964 203d  sis_dataset_id =
-00002a50: 2073 656c 662e 616e 616c 7973 6973 5f64   self.analysis_d
-00002a60: 6174 6173 6574 5f69 645b 313a 2d31 5d0a  ataset_id[1:-1].
-00002a70: 0a20 2020 2064 6566 2062 6162 735f 626f  .    def babs_bo
-00002a80: 6f74 7374 7261 7028 7365 6c66 2c20 696e  otstrap(self, in
-00002a90: 7075 745f 6473 2c0a 2020 2020 2020 2020  put_ds,.        
-00002aa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002ab0: 6f6e 7461 696e 6572 5f64 732c 2063 6f6e  ontainer_ds, con
-00002ac0: 7461 696e 6572 5f6e 616d 652c 2063 6f6e  tainer_name, con
-00002ad0: 7461 696e 6572 5f63 6f6e 6669 675f 7961  tainer_config_ya
-00002ae0: 6d6c 5f66 696c 652c 0a20 2020 2020 2020  ml_file,.       
-00002af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b00: 7379 7374 656d 293a 0a20 2020 2020 2020  system):.       
-00002b10: 2022 2222 0a20 2020 2020 2020 2042 6f6f   """.        Boo
-00002b20: 7473 7472 6170 2061 2062 6162 7320 7072  tstrap a babs pr
-00002b30: 6f6a 6563 743a 2069 6e69 7469 616c 697a  oject: initializ
-00002b40: 6520 6461 7461 6c61 642d 7472 6163 6b65  e datalad-tracke
-00002b50: 6420 5249 4173 2c20 6765 6e65 7261 7465  d RIAs, generate
-00002b60: 2073 6372 6970 7473 2074 6f20 6265 2075   scripts to be u
-00002b70: 7365 642c 2065 7463 0a0a 2020 2020 2020  sed, etc..      
-00002b80: 2020 5061 7261 6d65 7465 7273 3a0a 2020    Parameters:.  
-00002b90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-00002ba0: 2d2d 2d0a 2020 2020 2020 2020 696e 7075  ---.        inpu
-00002bb0: 745f 6473 3a20 636c 6173 7320 6049 6e70  t_ds: class `Inp
-00002bc0: 7574 5f64 7360 0a20 2020 2020 2020 2020  ut_ds`.         
-00002bd0: 2020 2049 6e70 7574 2064 6174 6173 6574     Input dataset
-00002be0: 2873 292e 0a20 2020 2020 2020 2063 6f6e  (s)..        con
-00002bf0: 7461 696e 6572 5f6e 616d 653a 2073 7472  tainer_name: str
-00002c00: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-00002c10: 6520 6f66 2074 6865 2063 6f6e 7461 696e  e of the contain
-00002c20: 6572 2c20 6265 7374 2074 6f20 696e 636c  er, best to incl
-00002c30: 7564 6520 7665 7273 696f 6e20 6e75 6d62  ude version numb
-00002c40: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00002c50: 652e 672e 2c20 2766 6d72 6970 7265 702d  e.g., 'fmriprep-
-00002c60: 302d 302d 3027 0a20 2020 2020 2020 2063  0-0-0'.        c
-00002c70: 6f6e 7461 696e 6572 5f64 733a 2073 7472  ontainer_ds: str
-00002c80: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-00002c90: 6820 746f 2074 6865 2063 6f6e 7461 696e  h to the contain
-00002ca0: 6572 2064 6174 616c 6164 2064 6174 6173  er datalad datas
-00002cb0: 6574 2077 6869 6368 2074 6865 2075 7365  et which the use
-00002cc0: 7220 7072 6f76 6964 6573 0a20 2020 2020  r provides.     
-00002cd0: 2020 2063 6f6e 7461 696e 6572 5f63 6f6e     container_con
-00002ce0: 6669 675f 7961 6d6c 5f66 696c 653a 2073  fig_yaml_file: s
-00002cf0: 7472 0a20 2020 2020 2020 2020 2020 2050  tr.            P
-00002d00: 6174 6820 746f 2061 2059 414d 4c20 6669  ath to a YAML fi
-00002d10: 6c65 2074 6861 7420 636f 6e74 6169 6e73  le that contains
-00002d20: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00002d30: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-00002d40: 6f66 2068 6f77 2074 6f20 7275 6e20 7468  of how to run th
-00002d50: 6520 4249 4453 2041 7070 2063 6f6e 7461  e BIDS App conta
-00002d60: 696e 6572 0a20 2020 2020 2020 2073 7973  iner.        sys
-00002d70: 7465 6d3a 2063 6c61 7373 2060 5379 7374  tem: class `Syst
-00002d80: 656d 600a 2020 2020 2020 2020 2020 2020  em`.            
-00002d90: 696e 666f 726d 6174 696f 6e20 6162 6f75  information abou
-00002da0: 7420 7468 6520 636c 7573 7465 7220 6d61  t the cluster ma
-00002db0: 6e61 6765 6d65 6e74 2073 7973 7465 6d0a  nagement system.
-00002dc0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00002dd0: 2020 2020 2023 203d 3d3d 3d3d 3d3d 3d3d       # =========
-00002de0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002df0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002e00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002e10: 3d3d 3d3d 3d0a 2020 2020 2020 2020 2320  =====.        # 
-00002e20: 496e 6974 6961 6c69 7a65 3a0a 2020 2020  Initialize:.    
-00002e30: 2020 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d      # ==========
-00002e40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002e50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002e60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00002e70: 3d3d 3d3d 0a0a 2020 2020 2020 2020 2320  ====..        # 
-00002e80: 4d61 6b65 2061 2064 6972 6563 746f 7279  Make a directory
-00002e90: 206f 6620 7072 6f6a 6563 745f 726f 6f74   of project_root
-00002ea0: 3a0a 2020 2020 2020 2020 6f73 2e6d 616b  :.        os.mak
-00002eb0: 6564 6972 7328 7365 6c66 2e70 726f 6a65  edirs(self.proje
-00002ec0: 6374 5f72 6f6f 7429 2020 2023 2077 6520  ct_root)   # we 
-00002ed0: 646f 6e27 7420 616c 6c6f 7720 6372 6561  don't allow crea
-00002ee0: 7469 6f6e 2069 6620 666f 6c64 6572 2065  tion if folder e
-00002ef0: 7869 7374 730a 0a20 2020 2020 2020 2023  xists..        #
-00002f00: 2043 7265 6174 6520 6061 6e61 6c79 7369   Create `analysi
-00002f10: 7360 2066 6f6c 6465 723a 202d 2d2d 2d2d  s` folder: -----
-00002f20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00002f30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00002f40: 2070 7269 6e74 2822 5c6e 4372 6561 7469   print("\nCreati
-00002f50: 6e67 2060 616e 616c 7973 6973 6020 666f  ng `analysis` fo
-00002f60: 6c64 6572 2028 616c 736f 2061 2064 6174  lder (also a dat
-00002f70: 616c 6164 2064 6174 6173 6574 292e 2e2e  alad dataset)...
-00002f80: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00002f90: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
-00002fa0: 5f68 616e 646c 6520 3d20 646c 6170 692e  _handle = dlapi.
-00002fb0: 6372 6561 7465 2873 656c 662e 616e 616c  create(self.anal
-00002fc0: 7973 6973 5f70 6174 682c 0a20 2020 2020  ysis_path,.     
-00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ff0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00003000: 6667 5f70 726f 633d 2779 6f64 6127 2c0a  fg_proc='yoda',.
+00000830: 6765 745f 6769 745f 7368 6f77 5f72 6566  get_git_show_ref
+00000840: 5f73 6861 7375 6d2c 0a20 2020 2020 2020  _shasum,.       
+00000850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000860: 2063 6569 6c64 6976 290a 0a0a 2320 4062   ceildiv)...# @b
+00000870: 7569 6c64 5f64 6f63 0a63 6c61 7373 2042  uild_doc.class B
+00000880: 4142 5328 293a 0a20 2020 2022 2222 5468  ABS():.    """Th
+00000890: 6520 4241 4253 2063 6c61 7373 2069 7320  e BABS class is 
+000008a0: 666f 7220 6261 6273 2070 726f 6a65 6374  for babs project
+000008b0: 7320 6f66 2042 4944 5320 4170 7073 2222  s of BIDS Apps""
+000008c0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+000008d0: 745f 5f28 7365 6c66 2c20 7072 6f6a 6563  t__(self, projec
+000008e0: 745f 726f 6f74 2c20 7479 7065 5f73 6573  t_root, type_ses
+000008f0: 7369 6f6e 2c20 7479 7065 5f73 7973 7465  sion, type_syste
+00000900: 6d29 3a0a 2020 2020 2020 2020 2727 270a  m):.        '''.
+00000910: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00000920: 7273 3a0a 2020 2020 2020 2020 2d2d 2d2d  rs:.        ----
+00000930: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00000940: 2070 726f 6a65 6374 5f72 6f6f 743a 2073   project_root: s
+00000950: 7472 0a20 2020 2020 2020 2020 2020 2061  tr.            a
+00000960: 6273 6f6c 7574 6520 7061 7468 2074 6f20  bsolute path to 
+00000970: 7468 6520 726f 6f74 206f 6620 7468 6973  the root of this
+00000980: 2062 6162 7320 7072 6f6a 6563 740a 2020   babs project.  
+00000990: 2020 2020 2020 7479 7065 5f73 6573 7369        type_sessi
+000009a0: 6f6e 3a20 7374 720a 2020 2020 2020 2020  on: str.        
+000009b0: 2020 2020 7768 6574 6865 7220 7468 6520      whether the 
+000009c0: 696e 7075 7420 6461 7461 7365 7420 6973  input dataset is
+000009d0: 2022 6d75 6c74 692d 7365 7322 206f 7220   "multi-ses" or 
+000009e0: 2273 696e 676c 652d 7365 7322 0a20 2020  "single-ses".   
+000009f0: 2020 2020 2074 7970 655f 7379 7374 656d       type_system
+00000a00: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00000a10: 2020 7468 6520 7479 7065 206f 6620 6a6f    the type of jo
+00000a20: 6220 7363 6865 6475 6c69 6e67 2073 7973  b scheduling sys
+00000a30: 7465 6d2c 2022 7367 6522 206f 7220 2273  tem, "sge" or "s
+00000a40: 6c75 726d 220a 0a20 2020 2020 2020 2041  lurm"..        A
+00000a50: 7474 7269 6275 7465 733a 0a20 2020 2020  ttributes:.     
+00000a60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+00000a70: 2d2d 0a20 2020 2020 2020 2070 726f 6a65  --.        proje
+00000a80: 6374 5f72 6f6f 743a 2073 7472 0a20 2020  ct_root: str.   
+00000a90: 2020 2020 2020 2020 2061 6273 6f6c 7574           absolut
+00000aa0: 6520 7061 7468 2074 6f20 7468 6520 726f  e path to the ro
+00000ab0: 6f74 206f 6620 7468 6973 2062 6162 7320  ot of this babs 
+00000ac0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+00000ad0: 7479 7065 5f73 6573 7369 6f6e 3a20 7374  type_session: st
+00000ae0: 720a 2020 2020 2020 2020 2020 2020 7768  r.            wh
+00000af0: 6574 6865 7220 7468 6520 696e 7075 7420  ether the input 
+00000b00: 6461 7461 7365 7420 6973 2022 6d75 6c74  dataset is "mult
+00000b10: 692d 7365 7322 206f 7220 2273 696e 676c  i-ses" or "singl
+00000b20: 652d 7365 7322 0a20 2020 2020 2020 2074  e-ses".        t
+00000b30: 7970 655f 7379 7374 656d 3a20 7374 720a  ype_system: str.
+00000b40: 2020 2020 2020 2020 2020 2020 7468 6520              the 
+00000b50: 7479 7065 206f 6620 6a6f 6220 7363 6865  type of job sche
+00000b60: 6475 6c69 6e67 2073 7973 7465 6d2c 2022  duling system, "
+00000b70: 7367 6522 206f 7220 2273 6c75 726d 220a  sge" or "slurm".
+00000b80: 2020 2020 2020 2020 636f 6e66 6967 5f70          config_p
+00000b90: 6174 683a 2073 7472 0a20 2020 2020 2020  ath: str.       
+00000ba0: 2020 2020 2070 6174 6820 746f 2074 6865       path to the
+00000bb0: 2063 6f6e 6669 6720 7961 6d6c 2066 696c   config yaml fil
+00000bc0: 650a 2020 2020 2020 2020 616e 616c 7973  e.        analys
+00000bd0: 6973 5f70 6174 683a 2073 7472 0a20 2020  is_path: str.   
+00000be0: 2020 2020 2020 2020 2070 6174 6820 746f           path to
+00000bf0: 2074 6865 2060 616e 616c 7973 6973 6020   the `analysis` 
+00000c00: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
+00000c10: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
+00000c20: 5f68 616e 646c 653a 2064 6174 616c 6164  _handle: datalad
+00000c30: 2064 6174 6173 6574 0a20 2020 2020 2020   dataset.       
+00000c40: 2020 2020 2074 6865 2060 616e 616c 7973       the `analys
+00000c50: 6973 6020 6461 7461 6c61 6420 6461 7461  is` datalad data
+00000c60: 7365 740a 2020 2020 2020 2020 696e 7075  set.        inpu
+00000c70: 745f 7269 615f 7061 7468 3a20 7374 720a  t_ria_path: str.
+00000c80: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00000c90: 2074 6f20 7468 6520 696e 7075 7420 5249   to the input RI
+00000ca0: 4120 7374 6f72 652c 2074 6865 2073 6962  A store, the sib
+00000cb0: 6c69 6e67 206f 6620 6061 6e61 6c79 7369  ling of `analysi
+00000cc0: 7360 2e0a 2020 2020 2020 2020 2020 2020  s`..            
+00000cd0: 5468 6520 636f 6d70 7574 6174 696f 6e20  The computation 
+00000ce0: 6f66 2065 6163 6820 6a6f 6220 7769 6c6c  of each job will
+00000cf0: 2073 7461 7274 2077 6974 6820 6120 636c   start with a cl
+00000d00: 6f6e 6520 6672 6f6d 2074 6869 7320 696e  one from this in
+00000d10: 7075 7420 5249 4120 7374 6f72 652e 0a20  put RIA store.. 
+00000d20: 2020 2020 2020 206f 7574 7075 745f 7269         output_ri
+00000d30: 615f 7061 7468 3a20 7374 720a 2020 2020  a_path: str.    
+00000d40: 2020 2020 2020 2020 5061 7468 2074 6f20          Path to 
+00000d50: 7468 6520 6f75 7470 7574 2052 4941 2073  the output RIA s
+00000d60: 746f 7265 2c20 7468 6520 7369 626c 696e  tore, the siblin
+00000d70: 6720 6f66 2060 616e 616c 7973 6973 602e  g of `analysis`.
+00000d80: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+00000d90: 2072 6573 756c 7473 206f 6620 6a6f 6273   results of jobs
+00000da0: 2077 696c 6c20 6265 2070 7573 6865 6420   will be pushed 
+00000db0: 746f 2074 6869 7320 6f75 7470 7574 2052  to this output R
+00000dc0: 4941 2073 746f 7265 2e0a 2020 2020 2020  IA store..      
+00000dd0: 2020 696e 7075 745f 7269 615f 7572 6c3a    input_ria_url:
+00000de0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+00000df0: 2055 524c 206f 6620 696e 7075 7420 5249   URL of input RI
+00000e00: 4120 7374 6f72 652c 2073 7461 7274 696e  A store, startin
+00000e10: 6720 7769 7468 2022 7269 612b 6669 6c65  g with "ria+file
+00000e20: 3a2f 2f22 2e0a 2020 2020 2020 2020 6f75  ://"..        ou
+00000e30: 7470 7574 5f72 6961 5f75 726c 3a20 7374  tput_ria_url: st
+00000e40: 720a 2020 2020 2020 2020 2020 2020 5552  r.            UR
+00000e50: 4c20 6f66 206f 7574 7075 7420 5249 4120  L of output RIA 
+00000e60: 7374 6f72 652c 2073 7461 7274 696e 6720  store, starting 
+00000e70: 7769 7468 2022 7269 612b 6669 6c65 3a2f  with "ria+file:/
+00000e80: 2f22 2e0a 2020 2020 2020 2020 6f75 7470  /"..        outp
+00000e90: 7574 5f72 6961 5f64 6174 615f 6469 723a  ut_ria_data_dir:
+00000ea0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+00000eb0: 2050 6174 6820 746f 2074 6865 206f 7574   Path to the out
+00000ec0: 7075 7420 5249 4127 7320 6461 7461 2064  put RIA's data d
+00000ed0: 6972 6563 746f 7279 2e0a 2020 2020 2020  irectory..      
+00000ee0: 2020 2020 2020 4578 616d 706c 653a 202f        Example: /
+00000ef0: 6675 6c6c 2f70 6174 682f 746f 2f70 726f  full/path/to/pro
+00000f00: 6a65 6374 5f72 6f6f 742f 6f75 7470 7574  ject_root/output
+00000f10: 5f72 6961 2f32 3338 2f64 6132 6632 2d32  _ria/238/da2f2-2
+00000f20: 6663 342d 3462 3838 2d61 3263 352d 6161  fc4-4b88-a2c5-aa
+00000f30: 3665 3735 3462 3564 3062 0a20 2020 2020  6e754b5d0b.     
+00000f40: 2020 2061 6e61 6c79 7369 735f 6461 7461     analysis_data
+00000f50: 7365 745f 6964 3a20 7374 720a 2020 2020  set_id: str.    
+00000f60: 2020 2020 2020 2020 5468 6520 4944 206f          The ID o
+00000f70: 6620 4461 7461 4c61 6420 6461 7461 7365  f DataLad datase
+00000f80: 7420 6061 6e61 6c79 7369 7360 2e0a 2020  t `analysis`..  
+00000f90: 2020 2020 2020 2020 2020 5468 6973 2077            This w
+00000fa0: 696c 6c20 6265 2075 7365 6420 746f 2067  ill be used to g
+00000fb0: 6574 2074 6865 2066 756c 6c20 7061 7468  et the full path
+00000fc0: 2074 6f20 7468 6520 6461 7461 7365 7420   to the dataset 
+00000fd0: 696e 2069 6e70 7574 2052 4941 2e0a 2020  in input RIA..  
+00000fe0: 2020 2020 2020 2020 2020 4578 616d 706c            Exampl
+00000ff0: 653a 2027 3233 3864 6132 6632 2d32 6663  e: '238da2f2-2fc
+00001000: 342d 3462 3838 2d61 3263 352d 6161 3665  4-4b88-a2c5-aa6e
+00001010: 3735 3462 3564 3062 270a 2020 2020 2020  754b5d0b'.      
+00001020: 2020 6c69 7374 5f73 7562 5f70 6174 685f    list_sub_path_
+00001030: 7265 6c3a 2073 7472 0a20 2020 2020 2020  rel: str.       
+00001040: 2020 2020 2050 6174 6820 746f 2074 6865       Path to the
+00001050: 206c 6973 7420 6f66 2066 696e 616c 2069   list of final i
+00001060: 6e63 6c75 6465 6420 7375 626a 6563 7473  ncluded subjects
+00001070: 2028 616e 6420 7365 7373 696f 6e73 2920   (and sessions) 
+00001080: 4353 5620 6669 6c65 2e0a 2020 2020 2020  CSV file..      
+00001090: 2020 2020 2020 5468 6973 2069 7320 7265        This is re
+000010a0: 6c61 7469 7665 2074 6f20 6061 6e61 6c79  lative to `analy
+000010b0: 7369 7360 2066 6f6c 6465 722e 0a20 2020  sis` folder..   
+000010c0: 2020 2020 206c 6973 745f 7375 625f 7061       list_sub_pa
+000010d0: 7468 5f61 6273 3a20 7374 720a 2020 2020  th_abs: str.    
+000010e0: 2020 2020 2020 2020 4162 736f 6c75 7465          Absolute
+000010f0: 2070 6174 6820 6f66 2060 6c69 7374 5f73   path of `list_s
+00001100: 7562 5f70 6174 685f 7265 6c60 2e0a 2020  ub_path_rel`..  
+00001110: 2020 2020 2020 2020 2020 4578 616d 706c            Exampl
+00001120: 653a 2027 2f70 6174 682f 746f 2f61 6e61  e: '/path/to/ana
+00001130: 6c79 7369 732f 636f 6465 2f73 7562 5f66  lysis/code/sub_f
+00001140: 696e 616c 5f69 6e63 6c75 2e63 7376 2720  inal_inclu.csv' 
+00001150: 666f 7220 7369 6e67 6c2d 7365 7320 6461  for singl-ses da
+00001160: 7461 7365 743b 0a20 2020 2020 2020 2020  taset;.         
+00001170: 2020 2020 2020 2027 2f70 6174 682f 746f         '/path/to
+00001180: 2f61 6e61 6c79 7369 732f 636f 6465 2f73  /analysis/code/s
+00001190: 7562 5f73 6573 5f66 696e 616c 5f69 6e63  ub_ses_final_inc
+000011a0: 6c75 2e63 7376 2720 666f 7220 6d75 6c74  lu.csv' for mult
+000011b0: 692d 7365 7320 6461 7461 7365 742e 0a20  i-ses dataset.. 
+000011c0: 2020 2020 2020 206a 6f62 5f73 7461 7475         job_statu
+000011d0: 735f 7061 7468 5f72 656c 3a20 7374 720a  s_path_rel: str.
+000011e0: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+000011f0: 2074 6f20 7468 6520 606a 6f62 5f73 7461   to the `job_sta
+00001200: 7475 732e 6373 7660 2066 696c 652e 0a20  tus.csv` file.. 
+00001210: 2020 2020 2020 2020 2020 2054 6869 7320             This 
+00001220: 6973 2072 656c 6174 6976 6520 746f 2060  is relative to `
+00001230: 616e 616c 7973 6973 6020 666f 6c64 6572  analysis` folder
+00001240: 2e0a 2020 2020 2020 2020 6a6f 625f 7374  ..        job_st
+00001250: 6174 7573 5f70 6174 685f 6162 733a 2073  atus_path_abs: s
+00001260: 7472 0a20 2020 2020 2020 2020 2020 2041  tr.            A
+00001270: 6273 6f6c 7574 6520 7061 7468 206f 6620  bsolute path of 
+00001280: 606a 6f62 5f73 7461 7475 735f 7061 7468  `job_status_path
+00001290: 5f61 6273 602e 0a20 2020 2020 2020 2020  _abs`..         
+000012a0: 2020 2045 7861 6d70 6c65 3a20 272f 7061     Example: '/pa
+000012b0: 7468 2f74 6f2f 616e 616c 7973 6973 2f63  th/to/analysis/c
+000012c0: 6f64 652f 6a6f 625f 7374 6174 7573 2e63  ode/job_status.c
+000012d0: 7376 270a 2020 2020 2020 2020 2727 270a  sv'.        '''.
+000012e0: 0a20 2020 2020 2020 2023 2076 616c 6964  .        # valid
+000012f0: 6174 696f 6e3a 0a20 2020 2020 2020 2074  ation:.        t
+00001300: 7970 655f 7365 7373 696f 6e20 3d20 7661  ype_session = va
+00001310: 6c69 6461 7465 5f74 7970 655f 7365 7373  lidate_type_sess
+00001320: 696f 6e28 7479 7065 5f73 6573 7369 6f6e  ion(type_session
+00001330: 290a 2020 2020 2020 2020 7479 7065 5f73  ).        type_s
+00001340: 7973 7465 6d20 3d20 7661 6c69 6461 7465  ystem = validate
+00001350: 5f74 7970 655f 7379 7374 656d 2874 7970  _type_system(typ
+00001360: 655f 7379 7374 656d 290a 0a20 2020 2020  e_system)..     
+00001370: 2020 2023 2061 7474 7269 6275 7465 733a     # attributes:
+00001380: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00001390: 6f6a 6563 745f 726f 6f74 203d 2070 726f  oject_root = pro
+000013a0: 6a65 6374 5f72 6f6f 740a 2020 2020 2020  ject_root.      
+000013b0: 2020 7365 6c66 2e74 7970 655f 7365 7373    self.type_sess
+000013c0: 696f 6e20 3d20 7479 7065 5f73 6573 7369  ion = type_sessi
+000013d0: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
+000013e0: 7479 7065 5f73 7973 7465 6d20 3d20 7479  type_system = ty
+000013f0: 7065 5f73 7973 7465 6d0a 0a20 2020 2020  pe_system..     
+00001400: 2020 2073 656c 662e 616e 616c 7973 6973     self.analysis
+00001410: 5f70 6174 6820 3d20 6f70 2e6a 6f69 6e28  _path = op.join(
+00001420: 7072 6f6a 6563 745f 726f 6f74 2c20 2261  project_root, "a
+00001430: 6e61 6c79 7369 7322 290a 2020 2020 2020  nalysis").      
+00001440: 2020 7365 6c66 2e61 6e61 6c79 7369 735f    self.analysis_
+00001450: 6461 7461 6c61 645f 6861 6e64 6c65 203d  datalad_handle =
+00001460: 204e 6f6e 650a 0a20 2020 2020 2020 2073   None..        s
+00001470: 656c 662e 636f 6e66 6967 5f70 6174 6820  elf.config_path 
+00001480: 3d20 6f70 2e6a 6f69 6e28 7365 6c66 2e61  = op.join(self.a
+00001490: 6e61 6c79 7369 735f 7061 7468 2c0a 2020  nalysis_path,.  
+000014a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000014c0: 2022 636f 6465 2f62 6162 735f 7072 6f6a   "code/babs_proj
+000014d0: 5f63 6f6e 6669 672e 7961 6d6c 2229 0a0a  _config.yaml")..
+000014e0: 2020 2020 2020 2020 7365 6c66 2e69 6e70          self.inp
+000014f0: 7574 5f72 6961 5f70 6174 6820 3d20 6f70  ut_ria_path = op
+00001500: 2e6a 6f69 6e28 7072 6f6a 6563 745f 726f  .join(project_ro
+00001510: 6f74 2c20 2269 6e70 7574 5f72 6961 2229  ot, "input_ria")
+00001520: 0a20 2020 2020 2020 2073 656c 662e 6f75  .        self.ou
+00001530: 7470 7574 5f72 6961 5f70 6174 6820 3d20  tput_ria_path = 
+00001540: 6f70 2e6a 6f69 6e28 7072 6f6a 6563 745f  op.join(project_
+00001550: 726f 6f74 2c20 226f 7574 7075 745f 7269  root, "output_ri
+00001560: 6122 290a 0a20 2020 2020 2020 2073 656c  a")..        sel
+00001570: 662e 696e 7075 745f 7269 615f 7572 6c20  f.input_ria_url 
+00001580: 3d20 2272 6961 2b66 696c 653a 2f2f 2220  = "ria+file://" 
+00001590: 2b20 7365 6c66 2e69 6e70 7574 5f72 6961  + self.input_ria
+000015a0: 5f70 6174 680a 2020 2020 2020 2020 7365  _path.        se
+000015b0: 6c66 2e6f 7574 7075 745f 7269 615f 7572  lf.output_ria_ur
+000015c0: 6c20 3d20 2272 6961 2b66 696c 653a 2f2f  l = "ria+file://
+000015d0: 2220 2b20 7365 6c66 2e6f 7574 7075 745f  " + self.output_
+000015e0: 7269 615f 7061 7468 0a0a 2020 2020 2020  ria_path..      
+000015f0: 2020 7365 6c66 2e6f 7574 7075 745f 7269    self.output_ri
+00001600: 615f 6461 7461 5f64 6972 203d 204e 6f6e  a_data_dir = Non
+00001610: 6520 2020 2020 2320 6e6f 7420 6b6e 6f77  e     # not know
+00001620: 6e20 7965 7420 6265 666f 7265 206f 7574  n yet before out
+00001630: 7075 745f 7269 6120 6973 2063 7265 6174  put_ria is creat
+00001640: 6564 0a20 2020 2020 2020 2073 656c 662e  ed.        self.
+00001650: 616e 616c 7973 6973 5f64 6174 6173 6574  analysis_dataset
+00001660: 5f69 6420 3d20 4e6f 6e65 2020 2020 2320  _id = None    # 
+00001670: 746f 2075 7064 6174 6520 6c61 7465 720a  to update later.
+00001680: 0a20 2020 2020 2020 2023 2061 7474 7269  .        # attri
+00001690: 6275 7465 2060 6c69 7374 5f73 7562 5f70  bute `list_sub_p
+000016a0: 6174 685f 2a60 3a0a 2020 2020 2020 2020  ath_*`:.        
+000016b0: 6966 2073 656c 662e 7479 7065 5f73 6573  if self.type_ses
+000016c0: 7369 6f6e 203d 3d20 2273 696e 676c 652d  sion == "single-
+000016d0: 7365 7322 3a0a 2020 2020 2020 2020 2020  ses":.          
+000016e0: 2020 7365 6c66 2e6c 6973 745f 7375 625f    self.list_sub_
+000016f0: 7061 7468 5f72 656c 203d 2027 636f 6465  path_rel = 'code
+00001700: 2f73 7562 5f66 696e 616c 5f69 6e63 6c75  /sub_final_inclu
+00001710: 2e63 7376 270a 2020 2020 2020 2020 656c  .csv'.        el
+00001720: 6966 2073 656c 662e 7479 7065 5f73 6573  if self.type_ses
+00001730: 7369 6f6e 203d 3d20 226d 756c 7469 2d73  sion == "multi-s
+00001740: 6573 223a 0a20 2020 2020 2020 2020 2020  es":.           
+00001750: 2073 656c 662e 6c69 7374 5f73 7562 5f70   self.list_sub_p
+00001760: 6174 685f 7265 6c20 3d20 2763 6f64 652f  ath_rel = 'code/
+00001770: 7375 625f 7365 735f 6669 6e61 6c5f 696e  sub_ses_final_in
+00001780: 636c 752e 6373 7627 0a20 2020 2020 2020  clu.csv'.       
+00001790: 2073 656c 662e 6c69 7374 5f73 7562 5f70   self.list_sub_p
+000017a0: 6174 685f 6162 7320 3d20 6f70 2e6a 6f69  ath_abs = op.joi
+000017b0: 6e28 7365 6c66 2e61 6e61 6c79 7369 735f  n(self.analysis_
+000017c0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+000017d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000017f0: 656c 662e 6c69 7374 5f73 7562 5f70 6174  elf.list_sub_pat
+00001800: 685f 7265 6c29 0a0a 2020 2020 2020 2020  h_rel)..        
+00001810: 7365 6c66 2e6a 6f62 5f73 7461 7475 735f  self.job_status_
+00001820: 7061 7468 5f72 656c 203d 2027 636f 6465  path_rel = 'code
+00001830: 2f6a 6f62 5f73 7461 7475 732e 6373 7627  /job_status.csv'
+00001840: 0a20 2020 2020 2020 2073 656c 662e 6a6f  .        self.jo
+00001850: 625f 7374 6174 7573 5f70 6174 685f 6162  b_status_path_ab
+00001860: 7320 3d20 6f70 2e6a 6f69 6e28 7365 6c66  s = op.join(self
+00001870: 2e61 6e61 6c79 7369 735f 7061 7468 2c0a  .analysis_path,.
+00001880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000018a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000018b0: 6a6f 625f 7374 6174 7573 5f70 6174 685f  job_status_path_
+000018c0: 7265 6c29 0a0a 2020 2020 6465 6620 6461  rel)..    def da
+000018d0: 7461 6c61 645f 7361 7665 2873 656c 662c  talad_save(self,
+000018e0: 2070 6174 682c 206d 6573 7361 6765 3d4e   path, message=N
+000018f0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00001900: 220a 2020 2020 2020 2020 5361 7665 2074  ".        Save t
+00001910: 6865 2063 7572 7265 6e74 2073 7461 7475  he current statu
+00001920: 7320 6f66 2064 6174 616c 6164 2064 6174  s of datalad dat
+00001930: 6173 6574 2060 616e 616c 7973 6973 600a  aset `analysis`.
+00001940: 2020 2020 2020 2020 416c 736f 2063 6865          Also che
+00001950: 636b 7320 7468 6174 2061 6c6c 2074 6865  cks that all the
+00001960: 2073 7461 7475 7365 7320 7265 7475 726e   statuses return
+00001970: 6564 2061 7265 2022 6f6b 2220 286f 7220  ed are "ok" (or 
+00001980: 226e 6f74 6e65 6564 6564 2229 0a0a 2020  "notneeded")..  
+00001990: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+000019a0: 3a0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  :.        ------
+000019b0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
+000019c0: 6174 683a 2073 7472 206f 7220 6c69 7374  ath: str or list
+000019d0: 206f 6620 7374 720a 2020 2020 2020 2020   of str.        
+000019e0: 2020 2020 7468 6520 7061 7468 2074 6f20      the path to 
+000019f0: 7468 6520 6669 6c65 2873 2920 6f72 2066  the file(s) or f
+00001a00: 6f6c 6465 7228 7329 2074 6f20 7361 7665  older(s) to save
+00001a10: 0a20 2020 2020 2020 206d 6573 7361 6765  .        message
+00001a20: 3a20 7374 7220 6f72 204e 6f6e 650a 2020  : str or None.  
+00001a30: 2020 2020 2020 2020 2020 636f 6d6d 6974            commit
+00001a40: 206d 6573 7361 6765 2069 6e20 6064 6174   message in `dat
+00001a50: 616c 6164 2073 6176 6560 0a0a 2020 2020  alad save`..    
+00001a60: 2020 2020 4e6f 7465 733a 0a20 2020 2020      Notes:.     
+00001a70: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a     ------------.
+00001a80: 2020 2020 2020 2020 4966 2074 6865 2070          If the p
+00001a90: 6174 6820 646f 6573 206e 6f74 2065 7869  ath does not exi
+00001aa0: 7374 2c20 7468 6520 7374 6174 7573 2077  st, the status w
+00001ab0: 696c 6c20 6265 2022 6e6f 746e 6565 6465  ill be "notneede
+00001ac0: 6422 2c20 616e 6420 776f 6e27 7420 6265  d", and won't be
+00001ad0: 2065 7272 6f72 206d 6573 7361 6765 0a20   error message. 
+00001ae0: 2020 2020 2020 2020 2020 2041 6e64 2074             And t
+00001af0: 6865 7265 2077 6f6e 2774 2062 6520 6120  here won't be a 
+00001b00: 636f 6d6d 6974 2077 6974 6820 7468 6174  commit with that
+00001b10: 206d 6573 7361 6765 0a20 2020 2020 2020   message.       
+00001b20: 2022 2222 0a0a 2020 2020 2020 2020 7374   """..        st
+00001b30: 6174 7573 6573 203d 2073 656c 662e 616e  atuses = self.an
+00001b40: 616c 7973 6973 5f64 6174 616c 6164 5f68  alysis_datalad_h
+00001b50: 616e 646c 652e 7361 7665 2870 6174 683d  andle.save(path=
+00001b60: 7061 7468 2c20 6d65 7373 6167 653d 6d65  path, message=me
+00001b70: 7373 6167 6529 0a20 2020 2020 2020 2023  ssage).        #
+00001b80: 205e 5e20 6e75 6d62 6572 206f 6620 6469   ^^ number of di
+00001b90: 6374 7320 696e 206c 6973 7420 6073 7461  cts in list `sta
+00001ba0: 7475 7365 7360 203d 206c 656e 2870 6174  tuses` = len(pat
+00001bb0: 6829 0a20 2020 2020 2020 2023 2063 6865  h).        # che
+00001bc0: 636b 2074 6861 7420 616c 6c20 7374 6174  ck that all stat
+00001bd0: 7573 6573 2072 6574 7572 6e65 6420 6172  uses returned ar
+00001be0: 6520 226f 6b61 7922 3a0a 2020 2020 2020  e "okay":.      
+00001bf0: 2020 2320 6265 6c6f 7720 6973 2066 726f    # below is fro
+00001c00: 6d20 6375 6269 6473 0a20 2020 2020 2020  m cubids.       
+00001c10: 2073 6176 6564 5f73 7461 7475 7320 3d20   saved_status = 
+00001c20: 7365 7428 5b73 7461 7475 735b 2773 7461  set([status['sta
+00001c30: 7475 7327 5d20 666f 7220 7374 6174 7573  tus'] for status
+00001c40: 2069 6e20 7374 6174 7573 6573 5d29 0a20   in statuses]). 
+00001c50: 2020 2020 2020 2069 6620 7361 7665 645f         if saved_
+00001c60: 7374 6174 7573 2e69 7373 7562 7365 7428  status.issubset(
+00001c70: 7365 7428 5b22 6f6b 222c 2022 6e6f 746e  set(["ok", "notn
+00001c80: 6565 6465 6422 5d29 2920 6973 2046 616c  eeded"])) is Fal
+00001c90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00001ca0: 2320 6578 6973 7473 2065 6c65 6d65 6e74  # exists element
+00001cb0: 2069 6e20 6073 6176 6564 5f73 7461 7475   in `saved_statu
+00001cc0: 7360 2074 6861 7420 6973 206e 6f74 2022  s` that is not "
+00001cd0: 6f6b 2220 6f72 2022 6e6f 746e 6565 6465  ok" or "notneede
+00001ce0: 6422 0a20 2020 2020 2020 2020 2020 2023  d".            #
+00001cf0: 205e 5e20 226e 6f74 6e65 6564 6564 223a   ^^ "notneeded":
+00001d00: 206e 6f74 6869 6e67 2074 6f20 7361 7665   nothing to save
+00001d10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00001d20: 7365 2045 7863 6570 7469 6f6e 2822 6064  se Exception("`d
+00001d30: 6174 616c 6164 2073 6176 6560 2066 6169  atalad save` fai
+00001d40: 6c65 6421 2229 0a0a 2020 2020 6465 6620  led!")..    def 
+00001d50: 7774 665f 6b65 795f 696e 666f 2873 656c  wtf_key_info(sel
+00001d60: 662c 2066 6c61 675f 6f75 7470 7574 5f72  f, flag_output_r
+00001d70: 6961 5f6f 6e6c 793d 4661 6c73 6529 3a0a  ia_only=False):.
+00001d80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001d90: 2020 2020 5468 6973 2069 7320 746f 2067      This is to g
+00001da0: 6574 2073 6f6d 6520 6b65 7920 696e 666f  et some key info
+00001db0: 726d 6174 696f 6e20 6f6e 2044 6174 614c  rmation on DataL
+00001dc0: 6164 2064 6174 6173 6574 2060 616e 616c  ad dataset `anal
+00001dd0: 7973 6973 602c 0a20 2020 2020 2020 2061  ysis`,.        a
+00001de0: 6e64 2061 7373 6967 6e20 746f 2060 6f75  nd assign to `ou
+00001df0: 7470 7574 5f72 6961 5f64 6174 615f 6469  tput_ria_data_di
+00001e00: 7260 2061 6e64 2060 616e 616c 7973 6973  r` and `analysis
+00001e10: 5f64 6174 6173 6574 5f69 6460 2e0a 2020  _dataset_id`..  
+00001e20: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
+00001e30: 696f 6e20 7265 6c69 6573 206f 6e20 6067  ion relies on `g
+00001e40: 6974 6020 616e 6420 6064 6174 616c 6164  it` and `datalad
+00001e50: 2077 7466 600a 2020 2020 2020 2020 5468   wtf`.        Th
+00001e60: 6973 206e 6565 6473 2074 6f20 6265 2064  is needs to be d
+00001e70: 6f6e 6520 6166 7465 7220 7468 6520 6f75  one after the ou
+00001e80: 7470 7574 2052 4941 2069 7320 6372 6561  tput RIA is crea
+00001e90: 7465 642e 0a0a 2020 2020 2020 2020 5061  ted...        Pa
+00001ea0: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+00001eb0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20    ------------. 
+00001ec0: 2020 2020 2020 2066 6c61 675f 6f75 7470         flag_outp
+00001ed0: 7574 5f72 6961 5f6f 6e6c 793a 2062 6f6f  ut_ria_only: boo
+00001ee0: 6c0a 2020 2020 2020 2020 2020 2020 6966  l.            if
+00001ef0: 206f 6e6c 7920 746f 2067 6574 2069 6e66   only to get inf
+00001f00: 6f72 6d61 7469 6f6e 206f 6e20 6f75 7470  ormation on outp
+00001f10: 7574 2052 4941 2e0a 2020 2020 2020 2020  ut RIA..        
+00001f20: 2020 2020 5468 6973 206d 6179 2065 7870      This may exp
+00001f30: 6564 6974 6520 7468 6520 7072 6f63 6573  edite the proces
+00001f40: 7320 6173 206f 7468 6572 2069 6e66 6f72  s as other infor
+00001f50: 6d61 7469 6f6e 2072 6571 7569 7265 730a  mation requires.
+00001f60: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00001f70: 696e 6720 6064 6174 616c 6164 6020 696e  ing `datalad` in
+00001f80: 2074 6572 6d69 6e61 6c2c 2077 6869 6368   terminal, which
+00001f90: 2077 6f75 6c64 2074 616b 6573 2073 6576   would takes sev
+00001fa0: 6572 616c 2073 6563 6f6e 6473 2e0a 2020  eral seconds..  
+00001fb0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00001fc0: 2020 2023 2047 6574 2074 6865 2060 7365     # Get the `se
+00001fd0: 6c66 2e6f 7574 7075 745f 7269 615f 6461  lf.output_ria_da
+00001fe0: 7461 5f64 6972 603a 0a20 2020 2020 2020  ta_dir`:.       
+00001ff0: 2023 2065 2e67 2e2c 202f 6675 6c6c 2f70   # e.g., /full/p
+00002000: 6174 682f 6f75 7470 7574 5f72 6961 2f32  ath/output_ria/2
+00002010: 3338 2f64 6132 6632 2d32 6663 342d 3462  38/da2f2-2fc4-4b
+00002020: 3838 2d61 3263 352d 6161 3665 3735 3462  88-a2c5-aa6e754b
+00002030: 3564 3062 0a20 2020 2020 2020 2061 6e61  5d0b.        ana
+00002040: 6c79 7369 735f 6769 745f 7061 7468 203d  lysis_git_path =
+00002050: 206f 702e 6a6f 696e 2873 656c 662e 616e   op.join(self.an
+00002060: 616c 7973 6973 5f70 6174 682c 2022 2e67  alysis_path, ".g
+00002070: 6974 2229 0a20 2020 2020 2020 2070 726f  it").        pro
+00002080: 635f 6f75 7470 7574 5f72 6961 5f64 6174  c_output_ria_dat
+00002090: 615f 6469 7220 3d20 7375 6270 726f 6365  a_dir = subproce
+000020a0: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
+000020b0: 2020 2020 5b22 6769 7422 2c20 222d 2d67      ["git", "--g
+000020c0: 6974 2d64 6972 222c 2061 6e61 6c79 7369  it-dir", analysi
+000020d0: 735f 6769 745f 7061 7468 2c20 2272 656d  s_git_path, "rem
+000020e0: 6f74 6522 2c20 2267 6574 2d75 726c 222c  ote", "get-url",
+000020f0: 2022 2d2d 7075 7368 222c 2022 6f75 7470   "--push", "outp
+00002100: 7574 225d 2c0a 2020 2020 2020 2020 2020  ut"],.          
+00002110: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
+00002120: 6573 732e 5049 5045 290a 2020 2020 2020  ess.PIPE).      
+00002130: 2020 2320 5e5e 3a20 666f 7220 6061 6e61    # ^^: for `ana
+00002140: 6c79 7369 7360 3a20 6769 7420 7265 6d6f  lysis`: git remo
+00002150: 7465 2067 6574 2d75 726c 202d 2d70 7573  te get-url --pus
+00002160: 6820 6f75 7470 7574 0a20 2020 2020 2020  h output.       
+00002170: 2023 205e 5e20 616e 6f74 6865 7220 7761   # ^^ another wa
+00002180: 7920 746f 2063 6861 6e67 6520 7468 6520  y to change the 
+00002190: 7764 2074 656d 706f 7261 7269 6c79 3a20  wd temporarily: 
+000021a0: 6164 6420 6063 7764 3d73 656c 662e 7878  add `cwd=self.xx
+000021b0: 7860 2069 6e20 6073 7562 7072 6f63 6573  x` in `subproces
+000021c0: 732e 7275 6e28 2960 0a20 2020 2020 2020  s.run()`.       
+000021d0: 2023 2069 6620 7375 6363 6573 733a 206e   # if success: n
+000021e0: 6f20 6f75 7470 7574 3b20 6966 2066 6169  o output; if fai
+000021f0: 6c65 643a 2077 696c 6c20 7261 6973 6520  led: will raise 
+00002200: 4361 6c6c 6564 5072 6f63 6573 7345 7272  CalledProcessErr
+00002210: 6f72 0a20 2020 2020 2020 2070 726f 635f  or.        proc_
+00002220: 6f75 7470 7574 5f72 6961 5f64 6174 615f  output_ria_data_
+00002230: 6469 722e 6368 6563 6b5f 7265 7475 726e  dir.check_return
+00002240: 636f 6465 2829 0a20 2020 2020 2020 2073  code().        s
+00002250: 656c 662e 6f75 7470 7574 5f72 6961 5f64  elf.output_ria_d
+00002260: 6174 615f 6469 7220 3d20 7072 6f63 5f6f  ata_dir = proc_o
+00002270: 7574 7075 745f 7269 615f 6461 7461 5f64  utput_ria_data_d
+00002280: 6972 2e73 7464 6f75 742e 6465 636f 6465  ir.stdout.decode
+00002290: 2827 7574 662d 3827 290a 2020 2020 2020  ('utf-8').      
+000022a0: 2020 6966 2073 656c 662e 6f75 7470 7574    if self.output
+000022b0: 5f72 6961 5f64 6174 615f 6469 725b 2d31  _ria_data_dir[-1
+000022c0: 3a5d 203d 3d20 225c 6e22 3a0a 2020 2020  :] == "\n":.    
+000022d0: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+000022e0: 2074 6865 206c 6173 7420 3220 6368 6172   the last 2 char
+000022f0: 6163 7465 7273 0a20 2020 2020 2020 2020  acters.         
+00002300: 2020 2073 656c 662e 6f75 7470 7574 5f72     self.output_r
+00002310: 6961 5f64 6174 615f 6469 7220 3d20 7365  ia_data_dir = se
+00002320: 6c66 2e6f 7574 7075 745f 7269 615f 6461  lf.output_ria_da
+00002330: 7461 5f64 6972 5b3a 2d31 5d0a 0a20 2020  ta_dir[:-1]..   
+00002340: 2020 2020 2069 6620 6e6f 7420 666c 6167       if not flag
+00002350: 5f6f 7574 7075 745f 7269 615f 6f6e 6c79  _output_ria_only
+00002360: 3a20 2020 2320 616c 736f 2077 616e 7420  :   # also want 
+00002370: 6f74 6865 7220 696e 666f 726d 6174 696f  other informatio
+00002380: 6e3a 0a20 2020 2020 2020 2020 2020 2023  n:.            #
+00002390: 2047 6574 2074 6865 2064 6174 6173 6574   Get the dataset
+000023a0: 2049 4420 6f66 2060 616e 616c 7973 6973   ID of `analysis
+000023b0: 602c 2069 2e65 2e2c 2060 616e 616c 7973  `, i.e., `analys
+000023c0: 6973 5f64 6174 6173 6574 5f69 6460 3a0a  is_dataset_id`:.
+000023d0: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
+000023e0: 6179 2023 313a 2075 7369 6e67 2064 6174  ay #1: using dat
+000023f0: 616c 6164 2061 7069 3b20 686f 7765 7665  alad api; howeve
+00002400: 722c 2069 7420 616c 7761 7973 2070 7269  r, it always pri
+00002410: 6e74 7320 6f75 7420 7468 6520 6675 6c6c  nts out the full
+00002420: 2c20 6c65 6e67 7468 7920 7774 6620 7265  , lengthy wtf re
+00002430: 706f 7274 2e2e 2e2e 0a20 2020 2020 2020  port.....       
+00002440: 2020 2020 2023 2023 2066 756c 6c20 6469       # # full di
+00002450: 6374 2066 726f 6d20 6064 6174 616c 6164  ct from `datalad
+00002460: 2077 7466 603a 0a20 2020 2020 2020 2020   wtf`:.         
+00002470: 2020 2023 2062 6c6f 636b 5072 696e 7428     # blockPrint(
+00002480: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00002490: 6675 6c6c 5f77 7466 5f6c 6973 7420 3d20  full_wtf_list = 
+000024a0: 646c 6170 692e 7774 6628 6461 7461 7365  dlapi.wtf(datase
+000024b0: 743d 7365 6c66 2e61 6e61 6c79 7369 735f  t=self.analysis_
+000024c0: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+000024d0: 2020 2320 656e 6162 6c65 5072 696e 7428    # enablePrint(
+000024e0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+000024f0: 2320 5e5e 2074 6869 7320 6973 2061 206c  # ^^ this is a l
+00002500: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+00002510: 2320 6966 206c 656e 2866 756c 6c5f 7774  # if len(full_wt
+00002520: 665f 6c69 7374 2920 3e20 313a 0a20 2020  f_list) > 1:.   
+00002530: 2020 2020 2020 2020 2023 2020 2020 2077           #     w
+00002540: 6172 6e69 6e67 732e 7761 726e 2822 5468  arnings.warn("Th
+00002550: 6572 6520 6172 6520 6d6f 7265 2074 6861  ere are more tha
+00002560: 6e20 6f6e 6520 6469 6374 696f 6e61 7279  n one dictionary
+00002570: 2066 6f72 2069 6e70 7574 2052 4941 2773   for input RIA's
+00002580: 2060 6461 7461 6c61 6420 7774 6660 2e22   `datalad wtf`."
+00002590: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025b0: 202b 2022 2057 6527 6c6c 206f 6e6c 7920   + " We'll only 
+000025c0: 7573 6520 7468 6520 6669 7273 7420 6f6e  use the first on
+000025d0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+000025e0: 2023 2066 756c 6c5f 7774 6620 3d20 6675   # full_wtf = fu
+000025f0: 6c6c 5f77 7466 5f6c 6973 745b 305d 0a20  ll_wtf_list[0]. 
+00002600: 2020 2020 2020 2020 2020 2023 2023 205e             # # ^
+00002610: 5e20 6f6e 6c79 2074 616b 6520 7468 6520  ^ only take the 
+00002620: 6669 7273 7420 6469 6374 2028 656c 656d  first dict (elem
+00002630: 656e 7429 2066 726f 6d20 7468 6520 6675  ent) from the fu
+00002640: 6c6c 206c 6973 740a 2020 2020 2020 2020  ll list.        
+00002650: 2020 2020 2320 7365 6c66 2e61 6e61 6c79      # self.analy
+00002660: 7369 735f 6461 7461 7365 745f 6964 203d  sis_dataset_id =
+00002670: 2066 756c 6c5f 7774 665b 2269 6e66 6f73   full_wtf["infos
+00002680: 225d 5b22 6461 7461 7365 7422 5d5b 2269  "]["dataset"]["i
+00002690: 6422 5d0a 2020 2020 2020 2020 2020 2020  d"].            
+000026a0: 2320 2320 5e5e 3a20 2420 6461 7461 6c61  # # ^^: $ datala
+000026b0: 6420 2d66 2027 7b69 6e66 6f73 5b64 6174  d -f '{infos[dat
+000026c0: 6173 6574 5d5b 6964 5d7d 2720 7774 6620  aset][id]}' wtf 
+000026d0: 2d53 2064 6174 6173 6574 0a0a 2020 2020  -S dataset..    
+000026e0: 2020 2020 2020 2020 2320 7761 7920 2332          # way #2
+000026f0: 3a20 636f 6d6d 616e 6420 6c69 6e65 206f  : command line o
+00002700: 6620 6461 7461 6c61 643a 0a20 2020 2020  f datalad:.     
+00002710: 2020 2020 2020 2070 726f 635f 616e 616c         proc_anal
+00002720: 7973 6973 5f64 6174 6173 6574 5f69 6420  ysis_dataset_id 
+00002730: 3d20 7375 6270 726f 6365 7373 2e72 756e  = subprocess.run
+00002740: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002750: 2020 5b22 6461 7461 6c61 6422 2c20 222d    ["datalad", "-
+00002760: 6622 2c20 2227 7b69 6e66 6f73 5b64 6174  f", "'{infos[dat
+00002770: 6173 6574 5d5b 6964 5d7d 2722 2c20 2277  aset][id]}'", "w
+00002780: 7466 222c 2022 2d53 222c 2022 6461 7461  tf", "-S", "data
+00002790: 7365 7422 5d2c 0a20 2020 2020 2020 2020  set"],.         
+000027a0: 2020 2020 2020 2063 7764 3d73 656c 662e         cwd=self.
+000027b0: 616e 616c 7973 6973 5f70 6174 682c 0a20  analysis_path,. 
+000027c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000027d0: 7464 6f75 743d 7375 6270 726f 6365 7373  tdout=subprocess
+000027e0: 2e50 4950 4529 0a20 2020 2020 2020 2020  .PIPE).         
+000027f0: 2020 2023 2064 6174 616c 6164 202d 6620     # datalad -f 
+00002800: 277b 696e 666f 735b 6461 7461 7365 745d  '{infos[dataset]
+00002810: 5b69 645d 7d27 2077 7466 202d 5320 6461  [id]}' wtf -S da
+00002820: 7461 7365 740a 2020 2020 2020 2020 2020  taset.          
+00002830: 2020 7072 6f63 5f61 6e61 6c79 7369 735f    proc_analysis_
+00002840: 6461 7461 7365 745f 6964 2e63 6865 636b  dataset_id.check
+00002850: 5f72 6574 7572 6e63 6f64 6528 290a 2020  _returncode().  
+00002860: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00002870: 6e61 6c79 7369 735f 6461 7461 7365 745f  nalysis_dataset_
+00002880: 6964 203d 2070 726f 635f 616e 616c 7973  id = proc_analys
+00002890: 6973 5f64 6174 6173 6574 5f69 642e 7374  is_dataset_id.st
+000028a0: 646f 7574 2e64 6563 6f64 6528 2775 7466  dout.decode('utf
+000028b0: 2d38 2729 0a20 2020 2020 2020 2020 2020  -8').           
+000028c0: 2023 2072 656d 6f76 6520 7468 6520 605c   # remove the `\
+000028d0: 6e60 3a0a 2020 2020 2020 2020 2020 2020  n`:.            
+000028e0: 6966 2073 656c 662e 616e 616c 7973 6973  if self.analysis
+000028f0: 5f64 6174 6173 6574 5f69 645b 2d31 3a5d  _dataset_id[-1:]
+00002900: 203d 3d20 225c 6e22 3a0a 2020 2020 2020   == "\n":.      
+00002910: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
+00002920: 7665 2074 6865 206c 6173 7420 3220 6368  ve the last 2 ch
+00002930: 6172 6163 7465 7273 0a20 2020 2020 2020  aracters.       
+00002940: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
+00002950: 616c 7973 6973 5f64 6174 6173 6574 5f69  alysis_dataset_i
+00002960: 6420 3d20 7365 6c66 2e61 6e61 6c79 7369  d = self.analysi
+00002970: 735f 6461 7461 7365 745f 6964 5b3a 2d31  s_dataset_id[:-1
+00002980: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00002990: 7265 6d6f 7665 2074 6865 2064 6f75 626c  remove the doubl
+000029a0: 6520 7175 6f74 6573 3a0a 2020 2020 2020  e quotes:.      
+000029b0: 2020 2020 2020 6966 2028 7365 6c66 2e61        if (self.a
+000029c0: 6e61 6c79 7369 735f 6461 7461 7365 745f  nalysis_dataset_
+000029d0: 6964 5b30 5d20 3d3d 2022 2722 2920 2620  id[0] == "'") & 
+000029e0: 2873 656c 662e 616e 616c 7973 6973 5f64  (self.analysis_d
+000029f0: 6174 6173 6574 5f69 645b 2d31 5d20 3d3d  ataset_id[-1] ==
+00002a00: 2022 2722 293a 0a20 2020 2020 2020 2020   "'"):.         
+00002a10: 2020 2020 2020 2023 2069 6620 6669 7273         # if firs
+00002a20: 7420 616e 6420 7468 6520 6c61 7374 2063  t and the last c
+00002a30: 6861 7261 6374 6572 7320 6172 6520 7175  haracters are qu
+00002a40: 6f74 6573 3a20 7265 6d6f 7665 2074 6865  otes: remove the
+00002a50: 6d0a 2020 2020 2020 2020 2020 2020 2020  m.              
+00002a60: 2020 7365 6c66 2e61 6e61 6c79 7369 735f    self.analysis_
+00002a70: 6461 7461 7365 745f 6964 203d 2073 656c  dataset_id = sel
+00002a80: 662e 616e 616c 7973 6973 5f64 6174 6173  f.analysis_datas
+00002a90: 6574 5f69 645b 313a 2d31 5d0a 0a20 2020  et_id[1:-1]..   
+00002aa0: 2064 6566 2062 6162 735f 626f 6f74 7374   def babs_bootst
+00002ab0: 7261 7028 7365 6c66 2c20 696e 7075 745f  rap(self, input_
+00002ac0: 6473 2c0a 2020 2020 2020 2020 2020 2020  ds,.            
+00002ad0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+00002ae0: 696e 6572 5f64 732c 2063 6f6e 7461 696e  iner_ds, contain
+00002af0: 6572 5f6e 616d 652c 2063 6f6e 7461 696e  er_name, contain
+00002b00: 6572 5f63 6f6e 6669 675f 7961 6d6c 5f66  er_config_yaml_f
+00002b10: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
+00002b20: 2020 2020 2020 2020 2020 2020 7379 7374              syst
+00002b30: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+00002b40: 0a20 2020 2020 2020 2042 6f6f 7473 7472  .        Bootstr
+00002b50: 6170 2061 2062 6162 7320 7072 6f6a 6563  ap a babs projec
+00002b60: 743a 2069 6e69 7469 616c 697a 6520 6461  t: initialize da
+00002b70: 7461 6c61 642d 7472 6163 6b65 6420 5249  talad-tracked RI
+00002b80: 4173 2c20 6765 6e65 7261 7465 2073 6372  As, generate scr
+00002b90: 6970 7473 2074 6f20 6265 2075 7365 642c  ipts to be used,
+00002ba0: 2065 7463 0a0a 2020 2020 2020 2020 5061   etc..        Pa
+00002bb0: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+00002bc0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a    -------------.
+00002bd0: 2020 2020 2020 2020 696e 7075 745f 6473          input_ds
+00002be0: 3a20 636c 6173 7320 6049 6e70 7574 5f64  : class `Input_d
+00002bf0: 7360 0a20 2020 2020 2020 2020 2020 2049  s`.            I
+00002c00: 6e70 7574 2064 6174 6173 6574 2873 292e  nput dataset(s).
+00002c10: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
+00002c20: 6572 5f6e 616d 653a 2073 7472 0a20 2020  er_name: str.   
+00002c30: 2020 2020 2020 2020 206e 616d 6520 6f66           name of
+00002c40: 2074 6865 2063 6f6e 7461 696e 6572 2c20   the container, 
+00002c50: 6265 7374 2074 6f20 696e 636c 7564 6520  best to include 
+00002c60: 7665 7273 696f 6e20 6e75 6d62 6572 2e0a  version number..
+00002c70: 2020 2020 2020 2020 2020 2020 652e 672e              e.g.
+00002c80: 2c20 2766 6d72 6970 7265 702d 302d 302d  , 'fmriprep-0-0-
+00002c90: 3027 0a20 2020 2020 2020 2063 6f6e 7461  0'.        conta
+00002ca0: 696e 6572 5f64 733a 2073 7472 0a20 2020  iner_ds: str.   
+00002cb0: 2020 2020 2020 2020 2070 6174 6820 746f           path to
+00002cc0: 2074 6865 2063 6f6e 7461 696e 6572 2064   the container d
+00002cd0: 6174 616c 6164 2064 6174 6173 6574 2077  atalad dataset w
+00002ce0: 6869 6368 2074 6865 2075 7365 7220 7072  hich the user pr
+00002cf0: 6f76 6964 6573 0a20 2020 2020 2020 2063  ovides.        c
+00002d00: 6f6e 7461 696e 6572 5f63 6f6e 6669 675f  ontainer_config_
+00002d10: 7961 6d6c 5f66 696c 653a 2073 7472 0a20  yaml_file: str. 
+00002d20: 2020 2020 2020 2020 2020 2050 6174 6820             Path 
+00002d30: 746f 2061 2059 414d 4c20 6669 6c65 2074  to a YAML file t
+00002d40: 6861 7420 636f 6e74 6169 6e73 2074 6865  hat contains the
+00002d50: 2063 6f6e 6669 6775 7261 7469 6f6e 730a   configurations.
+00002d60: 2020 2020 2020 2020 2020 2020 6f66 2068              of h
+00002d70: 6f77 2074 6f20 7275 6e20 7468 6520 4249  ow to run the BI
+00002d80: 4453 2041 7070 2063 6f6e 7461 696e 6572  DS App container
+00002d90: 0a20 2020 2020 2020 2073 7973 7465 6d3a  .        system:
+00002da0: 2063 6c61 7373 2060 5379 7374 656d 600a   class `System`.
+00002db0: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00002dc0: 726d 6174 696f 6e20 6162 6f75 7420 7468  rmation about th
+00002dd0: 6520 636c 7573 7465 7220 6d61 6e61 6765  e cluster manage
+00002de0: 6d65 6e74 2073 7973 7465 6d0a 2020 2020  ment system.    
+00002df0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00002e00: 2023 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   # =============
+00002e10: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002e20: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002e30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002e40: 3d0a 2020 2020 2020 2020 2320 496e 6974  =.        # Init
+00002e50: 6961 6c69 7a65 3a0a 2020 2020 2020 2020  ialize:.        
+00002e60: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
+00002e70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002e80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002e90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00002ea0: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
+00002eb0: 2061 2064 6972 6563 746f 7279 206f 6620   a directory of 
+00002ec0: 7072 6f6a 6563 745f 726f 6f74 3a0a 2020  project_root:.  
+00002ed0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00002ee0: 7328 7365 6c66 2e70 726f 6a65 6374 5f72  s(self.project_r
+00002ef0: 6f6f 7429 2020 2023 2077 6520 646f 6e27  oot)   # we don'
+00002f00: 7420 616c 6c6f 7720 6372 6561 7469 6f6e  t allow creation
+00002f10: 2069 6620 666f 6c64 6572 2065 7869 7374   if folder exist
+00002f20: 730a 0a20 2020 2020 2020 2023 2043 7265  s..        # Cre
+00002f30: 6174 6520 6061 6e61 6c79 7369 7360 2066  ate `analysis` f
+00002f40: 6f6c 6465 723a 202d 2d2d 2d2d 2d2d 2d2d  older: ---------
+00002f50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00002f60: 2d2d 2d2d 0a20 2020 2020 2020 2070 7269  ----.        pri
+00002f70: 6e74 2822 5c6e 4372 6561 7469 6e67 2060  nt("\nCreating `
+00002f80: 616e 616c 7973 6973 6020 666f 6c64 6572  analysis` folder
+00002f90: 2028 616c 736f 2061 2064 6174 616c 6164   (also a datalad
+00002fa0: 2064 6174 6173 6574 292e 2e2e 2229 0a20   dataset)..."). 
+00002fb0: 2020 2020 2020 2073 656c 662e 616e 616c         self.anal
+00002fc0: 7973 6973 5f64 6174 616c 6164 5f68 616e  ysis_datalad_han
+00002fd0: 646c 6520 3d20 646c 6170 692e 6372 6561  dle = dlapi.crea
+00002fe0: 7465 2873 656c 662e 616e 616c 7973 6973  te(self.analysis
+00002ff0: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
+00003000: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00003010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003040: 2020 2020 616e 6e65 783d 5472 7565 290a      annex=True).
-00003050: 0a20 2020 2020 2020 2023 2050 7265 7061  .        # Prepa
-00003060: 7265 2060 2e67 6974 6967 6e6f 7265 6020  re `.gitignore` 
-00003070: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00003080: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-00003090: 2020 2020 2020 2023 2077 7269 7465 2069         # write i
-000030a0: 6e74 6f20 2e67 6974 6967 6e6f 7265 2073  nto .gitignore s
-000030b0: 6f20 776f 6e27 7420 6265 2074 7261 636b  o won't be track
-000030c0: 6564 2062 7920 6769 743a 0a20 2020 2020  ed by git:.     
-000030d0: 2020 2067 6974 6967 6e6f 7265 5f70 6174     gitignore_pat
-000030e0: 6820 3d20 6f70 2e6a 6f69 6e28 7365 6c66  h = op.join(self
-000030f0: 2e61 6e61 6c79 7369 735f 7061 7468 2c20  .analysis_path, 
-00003100: 222e 6769 7469 676e 6f72 6522 290a 2020  ".gitignore").  
-00003110: 2020 2020 2020 2320 6966 2065 7869 7374        # if exist
-00003120: 7320 616c 7265 6164 792c 2072 656d 6f76  s already, remov
-00003130: 6520 6974 3a0a 2020 2020 2020 2020 6966  e it:.        if
-00003140: 206f 702e 6578 6973 7473 2867 6974 6967   op.exists(gitig
-00003150: 6e6f 7265 5f70 6174 6829 3a0a 2020 2020  nore_path):.    
-00003160: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
-00003170: 6528 6769 7469 676e 6f72 655f 7061 7468  e(gitignore_path
-00003180: 290a 2020 2020 2020 2020 6769 7469 676e  ).        gitign
-00003190: 6f72 655f 6669 6c65 203d 206f 7065 6e28  ore_file = open(
-000031a0: 6769 7469 676e 6f72 655f 7061 7468 2c20  gitignore_path, 
-000031b0: 2261 2229 2020 2023 206f 7065 6e20 696e  "a")   # open in
-000031c0: 2061 7070 656e 6420 6d6f 6465 0a0a 2020   append mode..  
-000031d0: 2020 2020 2020 2320 6e6f 7420 746f 2074        # not to t
-000031e0: 7261 636b 2060 6c6f 6773 6020 666f 6c64  rack `logs` fold
-000031f0: 6572 3a0a 2020 2020 2020 2020 6769 7469  er:.        giti
-00003200: 676e 6f72 655f 6669 6c65 2e77 7269 7465  gnore_file.write
-00003210: 2822 5c6e 6c6f 6773 2229 0a20 2020 2020  ("\nlogs").     
-00003220: 2020 2023 206e 6f74 2074 6f20 7472 6163     # not to trac
-00003230: 6b20 602e 2a5f 6461 7461 6c61 645f 6c6f  k `.*_datalad_lo
-00003240: 636b 603a 0a20 2020 2020 2020 2069 6620  ck`:.        if 
-00003250: 7379 7374 656d 2e74 7970 6520 3d3d 2022  system.type == "
-00003260: 7367 6522 3a0a 2020 2020 2020 2020 2020  sge":.          
-00003270: 2020 6769 7469 676e 6f72 655f 6669 6c65    gitignore_file
-00003280: 2e77 7269 7465 2822 5c6e 2e53 4745 5f64  .write("\n.SGE_d
-00003290: 6174 616c 6164 5f6c 6f63 6b22 290a 2020  atalad_lock").  
-000032a0: 2020 2020 2020 656c 6966 2073 7973 7465        elif syste
-000032b0: 6d2e 7479 7065 203d 3d20 2273 6c75 726d  m.type == "slurm
-000032c0: 223a 0a20 2020 2020 2020 2020 2020 2067  ":.            g
-000032d0: 6974 6967 6e6f 7265 5f66 696c 652e 7772  itignore_file.wr
-000032e0: 6974 6528 225c 6e2e 534c 5552 4d5f 6461  ite("\n.SLURM_da
-000032f0: 7461 6c61 645f 6c6f 636b 2229 0a20 2020  talad_lock").   
-00003300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00003310: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-00003320: 7761 726e 2822 4e6f 7420 7375 7070 6f72  warn("Not suppor
-00003330: 7469 6e67 2073 7973 7465 6d73 206f 7468  ting systems oth
-00003340: 6572 2074 6861 6e20 5347 4520 6f72 2053  er than SGE or S
-00003350: 6c75 726d 220a 2020 2020 2020 2020 2020  lurm".          
-00003360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003370: 2b20 2220 666f 7220 272e 6769 7469 676e  + " for '.gitign
-00003380: 6f72 6527 2e22 290a 2020 2020 2020 2020  ore'.").        
-00003390: 2320 6e6f 7420 746f 2074 7261 636b 206c  # not to track l
-000033a0: 6f63 6b20 6669 6c65 3a0a 2020 2020 2020  ock file:.      
-000033b0: 2020 6769 7469 676e 6f72 655f 6669 6c65    gitignore_file
-000033c0: 2e77 7269 7465 2822 5c6e 2220 2b20 2263  .write("\n" + "c
-000033d0: 6f64 652f 6261 6273 5f70 726f 6a5f 636f  ode/babs_proj_co
-000033e0: 6e66 6967 2e79 616d 6c2e 6c6f 636b 2229  nfig.yaml.lock")
-000033f0: 0a20 2020 2020 2020 2023 206e 6f74 2074  .        # not t
-00003400: 6f20 7472 6163 6b20 606a 6f62 5f73 7461  o track `job_sta
-00003410: 7475 732e 6373 7660 3a0a 2020 2020 2020  tus.csv`:.      
-00003420: 2020 6769 7469 676e 6f72 655f 6669 6c65    gitignore_file
-00003430: 2e77 7269 7465 2822 5c6e 2220 2b20 2263  .write("\n" + "c
-00003440: 6f64 652f 6a6f 625f 7374 6174 7573 2e63  ode/job_status.c
-00003450: 7376 2229 0a20 2020 2020 2020 2067 6974  sv").        git
-00003460: 6967 6e6f 7265 5f66 696c 652e 7772 6974  ignore_file.writ
-00003470: 6528 225c 6e22 202b 2022 636f 6465 2f6a  e("\n" + "code/j
-00003480: 6f62 5f73 7461 7475 732e 6373 762e 6c6f  ob_status.csv.lo
-00003490: 636b 2229 0a20 2020 2020 2020 2023 206e  ck").        # n
-000034a0: 6f74 2074 6f20 7472 6163 6b20 6669 6c65  ot to track file
-000034b0: 7320 6765 6e65 7261 7465 6420 6279 2060  s generated by `
-000034c0: 6261 6273 2d63 6865 636b 2d73 6574 7570  babs-check-setup
-000034d0: 603a 0a20 2020 2020 2020 2067 6974 6967  `:.        gitig
-000034e0: 6e6f 7265 5f66 696c 652e 7772 6974 6528  nore_file.write(
-000034f0: 225c 6e22 202b 2022 636f 6465 2f63 6865  "\n" + "code/che
-00003500: 636b 5f73 6574 7570 2f74 6573 745f 6a6f  ck_setup/test_jo
-00003510: 625f 696e 666f 2e79 616d 6c22 290a 2020  b_info.yaml").  
-00003520: 2020 2020 2020 6769 7469 676e 6f72 655f        gitignore_
-00003530: 6669 6c65 2e77 7269 7465 2822 5c6e 2220  file.write("\n" 
-00003540: 2b20 2263 6f64 652f 6368 6563 6b5f 7365  + "code/check_se
-00003550: 7475 702f 6368 6563 6b5f 656e 762e 7961  tup/check_env.ya
-00003560: 6d6c 2229 0a20 2020 2020 2020 2067 6974  ml").        git
-00003570: 6967 6e6f 7265 5f66 696c 652e 7772 6974  ignore_file.writ
-00003580: 6528 225c 6e22 290a 0a20 2020 2020 2020  e("\n")..       
-00003590: 2067 6974 6967 6e6f 7265 5f66 696c 652e   gitignore_file.
-000035a0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-000035b0: 7365 6c66 2e64 6174 616c 6164 5f73 6176  self.datalad_sav
-000035c0: 6528 7061 7468 3d22 2e67 6974 6967 6e6f  e(path=".gitigno
-000035d0: 7265 222c 0a20 2020 2020 2020 2020 2020  re",.           
-000035e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000035f0: 6573 7361 6765 3d22 5361 7665 202e 6769  essage="Save .gi
-00003600: 7469 676e 6f72 6520 6669 6c65 2229 0a0a  tignore file")..
-00003610: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
-00003620: 2060 6261 6273 5f70 726f 6a5f 636f 6e66   `babs_proj_conf
-00003630: 6967 2e79 616d 6c60 2066 696c 653a 202d  ig.yaml` file: -
-00003640: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00003650: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7072  -----.        pr
-00003660: 696e 7428 2253 6176 6520 4241 4253 2070  int("Save BABS p
-00003670: 726f 6a65 6374 2063 6f6e 6669 6775 7261  roject configura
-00003680: 7469 6f6e 7320 696e 2061 2059 414d 4c20  tions in a YAML 
-00003690: 6669 6c65 202e 2e2e 2229 0a20 2020 2020  file ...").     
-000036a0: 2020 2070 7269 6e74 2822 5061 7468 2074     print("Path t
-000036b0: 6f20 7468 6973 2079 616d 6c20 6669 6c65  o this yaml file
-000036c0: 2077 696c 6c20 6265 3a20 2761 6e61 6c79   will be: 'analy
-000036d0: 7369 732f 636f 6465 2f62 6162 735f 7072  sis/code/babs_pr
-000036e0: 6f6a 5f63 6f6e 6669 672e 7961 6d6c 2722  oj_config.yaml'"
-000036f0: 290a 2020 2020 2020 2020 6261 6273 5f70  ).        babs_p
-00003700: 726f 6a5f 636f 6e66 6967 5f66 696c 6520  roj_config_file 
-00003710: 3d20 6f70 656e 2873 656c 662e 636f 6e66  = open(self.conf
-00003720: 6967 5f70 6174 682c 2022 7722 290a 2020  ig_path, "w").  
-00003730: 2020 2020 2020 6261 6273 5f70 726f 6a5f        babs_proj_
-00003740: 636f 6e66 6967 5f66 696c 652e 7772 6974  config_file.writ
-00003750: 6528 2274 7970 655f 7365 7373 696f 6e3a  e("type_session:
-00003760: 2027 220a 2020 2020 2020 2020 2020 2020   '".            
-00003770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003780: 2020 2020 2020 2020 2b20 7365 6c66 2e74          + self.t
-00003790: 7970 655f 7365 7373 696f 6e20 2b20 2227  ype_session + "'
-000037a0: 5c6e 2229 0a20 2020 2020 2020 2062 6162  \n").        bab
-000037b0: 735f 7072 6f6a 5f63 6f6e 6669 675f 6669  s_proj_config_fi
-000037c0: 6c65 2e77 7269 7465 2822 7479 7065 5f73  le.write("type_s
-000037d0: 7973 7465 6d3a 2027 220a 2020 2020 2020  ystem: '".      
-000037e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00003800: 7365 6c66 2e74 7970 655f 7379 7374 656d  self.type_system
-00003810: 202b 2022 275c 6e22 290a 2020 2020 2020   + "'\n").      
-00003820: 2020 2320 696e 7075 745f 6473 3a0a 2020    # input_ds:.  
-00003830: 2020 2020 2020 6261 6273 5f70 726f 6a5f        babs_proj_
-00003840: 636f 6e66 6967 5f66 696c 652e 7772 6974  config_file.writ
-00003850: 6528 2269 6e70 7574 5f64 733a 5c6e 2229  e("input_ds:\n")
-00003860: 2020 2023 2069 6e70 7574 2064 6174 6173     # input datas
-00003870: 6574 2773 206e 616d 6528 7329 0a20 2020  et's name(s).   
-00003880: 2020 2020 2066 6f72 2069 5f64 7320 696e       for i_ds in
-00003890: 2072 616e 6765 2830 2c20 696e 7075 745f   range(0, input_
-000038a0: 6473 2e6e 756d 5f64 7329 3a0a 2020 2020  ds.num_ds):.    
-000038b0: 2020 2020 2020 2020 6261 6273 5f70 726f          babs_pro
-000038c0: 6a5f 636f 6e66 6967 5f66 696c 652e 7772  j_config_file.wr
-000038d0: 6974 6528 2220 2024 494e 5055 545f 4441  ite("  $INPUT_DA
-000038e0: 5441 5345 545f 2322 202b 2073 7472 2869  TASET_#" + str(i
-000038f0: 5f64 732b 3129 202b 2022 3a5c 6e22 290a  _ds+1) + ":\n").
-00003900: 2020 2020 2020 2020 2020 2020 6261 6273              babs
-00003910: 5f70 726f 6a5f 636f 6e66 6967 5f66 696c  _proj_config_fil
-00003920: 652e 7772 6974 6528 2220 2020 206e 616d  e.write("    nam
-00003930: 653a 2027 2220 2b20 696e 7075 745f 6473  e: '" + input_ds
-00003940: 2e64 665b 226e 616d 6522 5d5b 695f 6473  .df["name"][i_ds
-00003950: 5d20 2b20 2227 5c6e 2229 0a20 2020 2020  ] + "'\n").     
-00003960: 2020 2020 2020 2062 6162 735f 7072 6f6a         babs_proj
-00003970: 5f63 6f6e 6669 675f 6669 6c65 2e77 7269  _config_file.wri
-00003980: 7465 2822 2020 2020 7061 7468 5f69 6e3a  te("    path_in:
-00003990: 2027 2220 2b20 696e 7075 745f 6473 2e64   '" + input_ds.d
-000039a0: 665b 2270 6174 685f 696e 225d 5b69 5f64  f["path_in"][i_d
-000039b0: 735d 202b 2022 275c 6e22 290a 2020 2020  s] + "'\n").    
-000039c0: 2020 2020 2020 2020 6261 6273 5f70 726f          babs_pro
-000039d0: 6a5f 636f 6e66 6967 5f66 696c 652e 7772  j_config_file.wr
-000039e0: 6974 6528 2220 2020 2070 6174 685f 6461  ite("    path_da
-000039f0: 7461 5f72 656c 3a20 2754 4f5f 4245 5f46  ta_rel: 'TO_BE_F
-00003a00: 494c 4c45 4427 5c6e 2229 0a20 2020 2020  ILLED'\n").     
-00003a10: 2020 2020 2020 2062 6162 735f 7072 6f6a         babs_proj
-00003a20: 5f63 6f6e 6669 675f 6669 6c65 2e77 7269  _config_file.wri
-00003a30: 7465 2822 2020 2020 6973 5f7a 6970 7065  te("    is_zippe
-00003a40: 643a 2027 544f 5f42 455f 4649 4c4c 4544  d: 'TO_BE_FILLED
-00003a50: 275c 6e22 290a 2020 2020 2020 2020 2320  '\n").        # 
-00003a60: 636f 6e74 6169 6e65 7220 6473 3a0a 2020  container ds:.  
-00003a70: 2020 2020 2020 6261 6273 5f70 726f 6a5f        babs_proj_
-00003a80: 636f 6e66 6967 5f66 696c 652e 7772 6974  config_file.writ
-00003a90: 6528 2263 6f6e 7461 696e 6572 3a5c 6e22  e("container:\n"
-00003aa0: 290a 2020 2020 2020 2020 6261 6273 5f70  ).        babs_p
-00003ab0: 726f 6a5f 636f 6e66 6967 5f66 696c 652e  roj_config_file.
-00003ac0: 7772 6974 6528 2220 206e 616d 653a 2027  write("  name: '
-00003ad0: 2220 2b20 636f 6e74 6169 6e65 725f 6e61  " + container_na
-00003ae0: 6d65 202b 2022 275c 6e22 290a 2020 2020  me + "'\n").    
-00003af0: 2020 2020 6261 6273 5f70 726f 6a5f 636f      babs_proj_co
-00003b00: 6e66 6967 5f66 696c 652e 7772 6974 6528  nfig_file.write(
-00003b10: 2220 2070 6174 685f 696e 3a20 2722 202b  "  path_in: '" +
-00003b20: 2063 6f6e 7461 696e 6572 5f64 7320 2b20   container_ds + 
-00003b30: 2227 5c6e 2229 0a0a 2020 2020 2020 2020  "'\n")..        
-00003b40: 6261 6273 5f70 726f 6a5f 636f 6e66 6967  babs_proj_config
-00003b50: 5f66 696c 652e 636c 6f73 6528 290a 2020  _file.close().  
-00003b60: 2020 2020 2020 7365 6c66 2e64 6174 616c        self.datal
-00003b70: 6164 5f73 6176 6528 7061 7468 3d22 636f  ad_save(path="co
-00003b80: 6465 2f62 6162 735f 7072 6f6a 5f63 6f6e  de/babs_proj_con
-00003b90: 6669 672e 7961 6d6c 222c 0a20 2020 2020  fig.yaml",.     
-00003ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003bb0: 2020 2020 206d 6573 7361 6765 3d22 5361       message="Sa
-00003bc0: 7665 2063 6f6e 6669 6775 7261 7469 6f6e  ve configuration
-00003bd0: 7320 6f66 2074 6869 7320 4241 4253 2070  s of this BABS p
-00003be0: 726f 6a65 6374 2229 0a0a 2020 2020 2020  roject")..      
-00003bf0: 2020 2320 4372 6561 7465 206f 7574 7075    # Create outpu
-00003c00: 7420 5249 4120 7369 626c 696e 673a 202d  t RIA sibling: -
-00003c10: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00003c20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-00003c30: 2020 2020 2070 7269 6e74 2822 5c6e 4372       print("\nCr
-00003c40: 6561 7469 6e67 206f 7574 7075 7420 616e  eating output an
-00003c50: 6420 696e 7075 7420 5249 412e 2e2e 2229  d input RIA...")
-00003c60: 0a20 2020 2020 2020 2073 656c 662e 616e  .        self.an
-00003c70: 616c 7973 6973 5f64 6174 616c 6164 5f68  alysis_datalad_h
-00003c80: 616e 646c 652e 6372 6561 7465 5f73 6962  andle.create_sib
-00003c90: 6c69 6e67 5f72 6961 286e 616d 653d 226f  ling_ria(name="o
-00003ca0: 7574 7075 7422 2c0a 2020 2020 2020 2020  utput",.        
-00003cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ce0: 7572 6c3d 7365 6c66 2e6f 7574 7075 745f  url=self.output_
-00003cf0: 7269 615f 7572 6c2c 0a20 2020 2020 2020  ria_url,.       
-00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003d30: 206e 6577 5f73 746f 7265 5f6f 6b3d 5472   new_store_ok=Tr
-00003d40: 7565 290a 2020 2020 2020 2020 2320 5e20  ue).        # ^ 
-00003d50: 7265 663a 2069 6e20 7079 7468 6f6e 2065  ref: in python e
-00003d60: 6e76 6972 6f6e 6d65 6e74 3a0a 2020 2020  nvironment:.    
-00003d70: 2020 2020 2320 2020 696d 706f 7274 2064      #   import d
-00003d80: 6174 616c 6164 3b20 6865 6c70 2864 6174  atalad; help(dat
-00003d90: 616c 6164 2e64 6973 7472 6962 7574 6564  alad.distributed
-00003da0: 2e63 7265 6174 655f 7369 626c 696e 675f  .create_sibling_
-00003db0: 7269 6129 0a20 2020 2020 2020 2023 2020  ria).        #  
-00003dc0: 2073 6f6d 6574 696d 6573 2c20 6861 7665   sometimes, have
-00003dd0: 2074 6f20 6669 7273 7420 6074 656d 7020   to first `temp 
-00003de0: 3d20 646c 6170 692e 4461 7461 7365 7428  = dlapi.Dataset(
-00003df0: 222f 7061 7468 2f74 6f2f 616e 616c 7973  "/path/to/analys
-00003e00: 6973 2f66 6f6c 6465 7222 2960 2c0a 2020  is/folder")`,.  
-00003e10: 2020 2020 2020 2320 2020 7468 656e 2060        #   then `
-00003e20: 6865 6c70 2874 656d 702e 6372 6561 7465  help(temp.create
-00003e30: 5f73 6962 6c69 6e67 5f72 6961 2960 2c20  _sibling_ria)`, 
-00003e40: 796f 7520 6361 6e20 7374 6f70 2068 6572  you can stop her
-00003e50: 652c 0a20 2020 2020 2020 2023 2020 206f  e,.        #   o
-00003e60: 7220 6e6f 7720 796f 7520 6361 6e20 6865  r now you can he
-00003e70: 6c70 2864 6174 616c 6164 2e64 6973 7472  lp(datalad.distr
-00003e80: 6962 7574 6564 2e63 7265 6174 655f 7369  ibuted.create_si
-00003e90: 626c 696e 675f 7269 6129 0a20 2020 2020  bling_ria).     
-00003ea0: 2020 2023 2020 2073 6565 6d73 2074 6865     #   seems the
-00003eb0: 7265 2069 7320 6e6f 2064 6f63 7320 6f6e  re is no docs on
-00003ec0: 6c69 6e65 3f0a 2020 2020 2020 2020 2320  line?.        # 
-00003ed0: 736f 7572 6365 2063 6f64 653a 0a20 2020  source code:.   
-00003ee0: 2020 2020 2023 2068 7474 7073 3a2f 2f67       # https://g
-00003ef0: 6974 6875 622e 636f 6d2f 6461 7461 6c61  ithub.com/datala
-00003f00: 642f 6461 7461 6c61 642f 626c 6f62 2f6d  d/datalad/blob/m
-00003f10: 6173 7465 722f 6461 7461 6c61 642f 6469  aster/datalad/di
-00003f20: 7374 7269 6275 7465 642f 6372 6561 7465  stributed/create
-00003f30: 5f73 6962 6c69 6e67 5f72 6961 2e70 790a  _sibling_ria.py.
-00003f40: 0a20 2020 2020 2020 2023 2047 6574 2073  .        # Get s
-00003f50: 6f6d 6520 6b65 7920 696e 666f 726d 6174  ome key informat
-00003f60: 696f 6e20 7265 3a20 4461 7461 4c61 6420  ion re: DataLad 
-00003f70: 6461 7461 7365 7420 6061 6e61 6c79 7369  dataset `analysi
-00003f80: 7360 2c0a 2020 2020 2020 2020 2320 6166  s`,.        # af
-00003f90: 7465 7220 6372 6561 7469 6e67 206f 7574  ter creating out
-00003fa0: 7075 7420 5249 413a 0a20 2020 2020 2020  put RIA:.       
-00003fb0: 2073 656c 662e 7774 665f 6b65 795f 696e   self.wtf_key_in
-00003fc0: 666f 2829 0a0a 2020 2020 2020 2020 2320  fo()..        # 
-00003fd0: 4372 6561 7465 2069 6e70 7574 2052 4941  Create input RIA
-00003fe0: 2073 6962 6c69 6e67 3a0a 2020 2020 2020   sibling:.      
-00003ff0: 2020 7365 6c66 2e61 6e61 6c79 7369 735f    self.analysis_
-00004000: 6461 7461 6c61 645f 6861 6e64 6c65 2e63  datalad_handle.c
-00004010: 7265 6174 655f 7369 626c 696e 675f 7269  reate_sibling_ri
-00004020: 6128 0a20 2020 2020 2020 2020 2020 206e  a(.            n
-00004030: 616d 653d 2269 6e70 7574 222c 0a20 2020  ame="input",.   
-00004040: 2020 2020 2020 2020 2075 726c 3d73 656c           url=sel
-00004050: 662e 696e 7075 745f 7269 615f 7572 6c2c  f.input_ria_url,
-00004060: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-00004070: 7261 6765 5f73 6962 6c69 6e67 3d46 616c  rage_sibling=Fal
-00004080: 7365 2c20 2020 2320 4661 6c73 6520 6973  se,   # False is
-00004090: 2060 6f66 6660 2069 6e20 434c 4920 6f66   `off` in CLI of
-000040a0: 2064 6174 616c 6164 0a20 2020 2020 2020   datalad.       
-000040b0: 2020 2020 206e 6577 5f73 746f 7265 5f6f       new_store_o
-000040c0: 6b3d 5472 7565 290a 0a20 2020 2020 2020  k=True)..       
-000040d0: 2023 2052 6567 6973 7465 7220 7468 6520   # Register the 
-000040e0: 696e 7075 7420 6461 7461 7365 7428 7329  input dataset(s)
-000040f0: 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  : --------------
-00004100: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00004110: 2020 2020 2020 2020 7072 696e 7428 225c          print("\
-00004120: 6e52 6567 6973 7465 7269 6e67 2074 6865  nRegistering the
-00004130: 2069 6e70 7574 2064 6174 6173 6574 2873   input dataset(s
-00004140: 292e 2e2e 2229 0a20 2020 2020 2020 2066  )...").        f
-00004150: 6f72 2069 5f64 7320 696e 2072 616e 6765  or i_ds in range
-00004160: 2830 2c20 696e 7075 745f 6473 2e6e 756d  (0, input_ds.num
-00004170: 5f64 7329 3a0a 2020 2020 2020 2020 2020  _ds):.          
-00004180: 2020 2320 7061 7468 2074 6f20 636c 6f6e    # path to clon
-00004190: 6564 2064 6174 6173 6574 3a0a 2020 2020  ed dataset:.    
-000041a0: 2020 2020 2020 2020 695f 6473 5f70 6174          i_ds_pat
-000041b0: 6820 3d20 6f70 2e6a 6f69 6e28 7365 6c66  h = op.join(self
-000041c0: 2e61 6e61 6c79 7369 735f 7061 7468 2c0a  .analysis_path,.
-000041d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041f0: 696e 7075 745f 6473 2e64 665b 2270 6174  input_ds.df["pat
-00004200: 685f 6e6f 775f 7265 6c22 5d5b 695f 6473  h_now_rel"][i_ds
-00004210: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
-00004220: 7269 6e74 2822 436c 6f6e 696e 6720 696e  rint("Cloning in
-00004230: 7075 7420 6461 7461 7365 7420 2322 202b  put dataset #" +
-00004240: 2073 7472 2869 5f64 732b 3129 202b 2022   str(i_ds+1) + "
-00004250: 3a20 2722 0a20 2020 2020 2020 2020 2020  : '".           
-00004260: 2020 2020 2020 202b 2069 6e70 7574 5f64         + input_d
-00004270: 732e 6466 5b22 6e61 6d65 225d 5b69 5f64  s.df["name"][i_d
-00004280: 735d 202b 2022 2722 290a 2020 2020 2020  s] + "'").      
-00004290: 2020 2020 2020 2320 636c 6f6e 6520 696e        # clone in
-000042a0: 7075 7420 6461 7461 7365 7428 7329 2061  put dataset(s) a
-000042b0: 7320 7375 622d 6461 7461 7365 7420 696e  s sub-dataset in
-000042c0: 746f 2060 616e 616c 7973 6973 6020 6461  to `analysis` da
-000042d0: 7461 7365 743a 0a20 2020 2020 2020 2020  taset:.         
-000042e0: 2020 2064 6c61 7069 2e63 6c6f 6e65 2864     dlapi.clone(d
-000042f0: 6174 6173 6574 3d73 656c 662e 616e 616c  ataset=self.anal
-00004300: 7973 6973 5f70 6174 682c 0a20 2020 2020  ysis_path,.     
-00004310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004320: 2020 2073 6f75 7263 653d 696e 7075 745f     source=input_
-00004330: 6473 2e64 665b 2270 6174 685f 696e 225d  ds.df["path_in"]
-00004340: 5b69 5f64 735d 2c20 2020 2023 2069 6e70  [i_ds],    # inp
-00004350: 7574 2064 6174 6173 6574 2873 290a 2020  ut dataset(s).  
-00004360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004370: 2020 2020 2020 7061 7468 3d69 5f64 735f        path=i_ds_
-00004380: 7061 7468 2920 2023 2070 6174 6820 746f  path)  # path to
-00004390: 2063 6c6f 6e65 2069 6e74 6f0a 0a20 2020   clone into..   
-000043a0: 2020 2020 2020 2020 2023 2061 6d65 6e64           # amend
-000043b0: 2074 6865 2070 7265 7669 6f75 7320 636f   the previous co
-000043c0: 6d6d 6974 2077 6974 6820 6120 6e69 6365  mmit with a nice
-000043d0: 7220 636f 6d6d 6974 206d 6573 7361 6765  r commit message
-000043e0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000043f0: 6f63 5f67 6974 5f63 6f6d 6d69 745f 616d  oc_git_commit_am
-00004400: 656e 6420 3d20 7375 6270 726f 6365 7373  end = subprocess
-00004410: 2e72 756e 280a 2020 2020 2020 2020 2020  .run(.          
-00004420: 2020 2020 2020 5b22 6769 7422 2c20 2263        ["git", "c
-00004430: 6f6d 6d69 7422 2c20 222d 2d61 6d65 6e64  ommit", "--amend
-00004440: 222c 2022 2d6d 222c 0a20 2020 2020 2020  ", "-m",.       
-00004450: 2020 2020 2020 2020 2020 2020 2022 5265               "Re
-00004460: 6769 7374 6572 2069 6e70 7574 2064 6174  gister input dat
-00004470: 6120 6461 7461 7365 7420 2722 202b 2069  a dataset '" + i
-00004480: 6e70 7574 5f64 732e 6466 5b22 6e61 6d65  nput_ds.df["name
-00004490: 225d 5b69 5f64 735d 0a20 2020 2020 2020  "][i_ds].       
-000044a0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-000044b0: 2720 6173 2061 2073 7562 6461 7461 7365  ' as a subdatase
-000044c0: 7422 5d2c 0a20 2020 2020 2020 2020 2020  t"],.           
-000044d0: 2020 2020 2063 7764 3d73 656c 662e 616e       cwd=self.an
-000044e0: 616c 7973 6973 5f70 6174 682c 0a20 2020  alysis_path,.   
-000044f0: 2020 2020 2020 2020 2020 2020 2073 7464               std
-00004500: 6f75 743d 7375 6270 726f 6365 7373 2e50  out=subprocess.P
-00004510: 4950 450a 2020 2020 2020 2020 2020 2020  IPE.            
-00004520: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-00004530: 6f63 5f67 6974 5f63 6f6d 6d69 745f 616d  oc_git_commit_am
-00004540: 656e 642e 6368 6563 6b5f 7265 7475 726e  end.check_return
-00004550: 636f 6465 2829 0a0a 2020 2020 2020 2020  code()..        
-00004560: 2320 6765 7420 7468 6520 6375 7272 656e  # get the curren
-00004570: 7420 6162 736f 6c75 7465 2070 6174 6820  t absolute path 
-00004580: 746f 2074 6865 2069 6e70 7574 2064 6174  to the input dat
-00004590: 6173 6574 3a0a 2020 2020 2020 2020 696e  aset:.        in
-000045a0: 7075 745f 6473 2e61 7373 6967 6e5f 7061  put_ds.assign_pa
-000045b0: 7468 5f6e 6f77 5f61 6273 2873 656c 662e  th_now_abs(self.
-000045c0: 616e 616c 7973 6973 5f70 6174 6829 0a0a  analysis_path)..
-000045d0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000045e0: 7468 6520 7479 7065 206f 6620 6561 6368  the type of each
-000045f0: 2069 6e70 7574 2064 6174 6173 6574 3a20   input dataset: 
-00004600: 287a 6970 7065 643f 2075 6e7a 6970 7065  (zipped? unzippe
-00004610: 643f 290a 2020 2020 2020 2020 2320 2020  d?).        #   
-00004620: 7468 6973 2061 6c73 6f20 6765 7473 2060  this also gets `
-00004630: 6973 5f7a 6970 7065 6460 0a20 2020 2020  is_zipped`.     
-00004640: 2020 2070 7269 6e74 2822 5c6e 4368 6563     print("\nChec
-00004650: 6b69 6e67 2077 6865 7468 6572 2065 6163  king whether eac
-00004660: 6820 696e 7075 7420 6461 7461 7365 7420  h input dataset 
-00004670: 6973 2061 207a 6970 7065 6420 6f72 2075  is a zipped or u
-00004680: 6e7a 6970 7065 6420 6461 7461 7365 742e  nzipped dataset.
-00004690: 2e2e 2229 0a20 2020 2020 2020 2069 6e70  ..").        inp
-000046a0: 7574 5f64 732e 6368 6563 6b5f 6966 5f7a  ut_ds.check_if_z
-000046b0: 6970 7065 6428 290a 2020 2020 2020 2020  ipped().        
-000046c0: 2320 7361 6e69 7479 2063 6865 636b 733a  # sanity checks:
-000046d0: 0a20 2020 2020 2020 2069 6e70 7574 5f64  .        input_d
-000046e0: 732e 6368 6563 6b5f 7661 6c69 6469 7479  s.check_validity
-000046f0: 5f7a 6970 7065 645f 696e 7075 745f 6461  _zipped_input_da
-00004700: 7461 7365 7428 7365 6c66 2e74 7970 655f  taset(self.type_
-00004710: 7365 7373 696f 6e29 0a0a 2020 2020 2020  session)..      
-00004720: 2020 2320 4368 6563 6b20 7661 6c69 6469    # Check validi
-00004730: 7479 206f 6620 756e 7a69 7070 6564 2064  ty of unzipped d
-00004740: 733a 0a20 2020 2020 2020 2023 2020 2069  s:.        #   i
-00004750: 6620 6d75 6c74 692d 7365 732c 2068 6173  f multi-ses, has
-00004760: 2060 7365 732d 2a60 2069 6e20 6561 6368   `ses-*` in each
-00004770: 2060 7375 622d 2a60 3b20 6966 2073 696e   `sub-*`; if sin
-00004780: 676c 652d 7365 732c 2068 6173 2061 2060  gle-ses, has a `
-00004790: 7375 622d 2a60 0a20 2020 2020 2020 2063  sub-*`.        c
-000047a0: 6865 636b 5f76 616c 6964 6974 795f 756e  heck_validity_un
-000047b0: 7a69 7070 6564 5f69 6e70 7574 5f64 6174  zipped_input_dat
-000047c0: 6173 6574 2869 6e70 7574 5f64 732c 2073  aset(input_ds, s
-000047d0: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
-000047e0: 290a 0a20 2020 2020 2020 2023 2055 7064  )..        # Upd
-000047f0: 6174 6520 696e 7075 7420 6473 2069 6e66  ate input ds inf
-00004800: 6f72 6d61 7469 6f6e 2069 6e20 6062 6162  ormation in `bab
-00004810: 735f 7072 6f6a 5f63 6f6e 6669 672e 7961  s_proj_config.ya
-00004820: 6d6c 603a 0a20 2020 2020 2020 2062 6162  ml`:.        bab
-00004830: 735f 7072 6f6a 5f63 6f6e 6669 6720 3d20  s_proj_config = 
-00004840: 7265 6164 5f79 616d 6c28 7365 6c66 2e63  read_yaml(self.c
-00004850: 6f6e 6669 675f 7061 7468 2c20 6966 5f66  onfig_path, if_f
-00004860: 696c 656c 6f63 6b3d 5472 7565 290a 2020  ilelock=True).  
-00004870: 2020 2020 2020 666f 7220 695f 6473 2069        for i_ds i
-00004880: 6e20 7261 6e67 6528 302c 2069 6e70 7574  n range(0, input
-00004890: 5f64 732e 6e75 6d5f 6473 293a 0a20 2020  _ds.num_ds):.   
-000048a0: 2020 2020 2020 2020 2064 735f 696e 6465           ds_inde
-000048b0: 785f 7374 7220 3d20 2224 494e 5055 545f  x_str = "$INPUT_
-000048c0: 4441 5441 5345 545f 2322 202b 2073 7472  DATASET_#" + str
-000048d0: 2869 5f64 732b 3129 0a20 2020 2020 2020  (i_ds+1).       
-000048e0: 2020 2020 2023 2075 7064 6174 6520 6070       # update `p
-000048f0: 6174 685f 6461 7461 5f72 656c 603a 0a20  ath_data_rel`:. 
-00004900: 2020 2020 2020 2020 2020 2062 6162 735f             babs_
-00004910: 7072 6f6a 5f63 6f6e 6669 675b 2269 6e70  proj_config["inp
-00004920: 7574 5f64 7322 5d5b 6473 5f69 6e64 6578  ut_ds"][ds_index
-00004930: 5f73 7472 5d5b 2270 6174 685f 6461 7461  _str]["path_data
-00004940: 5f72 656c 225d 203d 205c 0a20 2020 2020  _rel"] = \.     
-00004950: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00004960: 5f64 732e 6466 5b22 7061 7468 5f64 6174  _ds.df["path_dat
-00004970: 615f 7265 6c22 5d5b 695f 6473 5d0a 2020  a_rel"][i_ds].  
-00004980: 2020 2020 2020 2020 2020 2320 7570 6461            # upda
-00004990: 7465 2060 6973 5f7a 6970 7065 6460 3a0a  te `is_zipped`:.
-000049a0: 2020 2020 2020 2020 2020 2020 6261 6273              babs
-000049b0: 5f70 726f 6a5f 636f 6e66 6967 5b22 696e  _proj_config["in
-000049c0: 7075 745f 6473 225d 5b64 735f 696e 6465  put_ds"][ds_inde
-000049d0: 785f 7374 725d 5b22 6973 5f7a 6970 7065  x_str]["is_zippe
-000049e0: 6422 5d20 3d20 5c0a 2020 2020 2020 2020  d"] = \.        
-000049f0: 2020 2020 2020 2020 696e 7075 745f 6473          input_ds
-00004a00: 2e64 665b 2269 735f 7a69 7070 6564 225d  .df["is_zipped"]
-00004a10: 5b69 5f64 735d 0a20 2020 2020 2020 2023  [i_ds].        #
-00004a20: 2064 756d 703a 0a20 2020 2020 2020 2077   dump:.        w
-00004a30: 7269 7465 5f79 616d 6c28 6261 6273 5f70  rite_yaml(babs_p
-00004a40: 726f 6a5f 636f 6e66 6967 2c20 7365 6c66  roj_config, self
-00004a50: 2e63 6f6e 6669 675f 7061 7468 2c20 6966  .config_path, if
-00004a60: 5f66 696c 656c 6f63 6b3d 5472 7565 290a  _filelock=True).
-00004a70: 2020 2020 2020 2020 2320 6461 7461 6c61          # datala
-00004a80: 6420 7361 7665 3a20 7570 6461 7465 3a0a  d save: update:.
-00004a90: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00004aa0: 616c 6164 5f73 6176 6528 7061 7468 3d22  alad_save(path="
-00004ab0: 636f 6465 2f62 6162 735f 7072 6f6a 5f63  code/babs_proj_c
-00004ac0: 6f6e 6669 672e 7961 6d6c 222c 0a20 2020  onfig.yaml",.   
-00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ae0: 2020 2020 2020 206d 6573 7361 6765 3d22         message="
-00004af0: 5570 6461 7465 2063 6f6e 6669 6775 7261  Update configura
-00004b00: 7469 6f6e 7320 6f66 2069 6e70 7574 2064  tions of input d
-00004b10: 6174 6173 6574 206f 6620 7468 6973 2042  ataset of this B
-00004b20: 4142 5320 7072 6f6a 6563 7422 290a 0a20  ABS project").. 
-00004b30: 2020 2020 2020 2023 2041 6464 2063 6f6e         # Add con
-00004b40: 7461 696e 6572 2061 7320 7375 622d 6461  tainer as sub-da
-00004b50: 7461 7365 7420 6f66 2060 616e 616c 7973  taset of `analys
-00004b60: 6973 603a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  is`: -----------
-00004b70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00004b80: 2d2d 0a20 2020 2020 2020 2023 2023 2054  --.        # # T
-00004b90: 4f20 4153 4b3a 2057 4859 2057 4520 4e45  O ASK: WHY WE NE
-00004ba0: 4544 2054 4f20 434c 4f4e 4520 4954 2046  ED TO CLONE IT F
-00004bb0: 4952 5354 2049 4e54 4f20 6070 726f 6a65  IRST INTO `proje
-00004bc0: 6374 5f72 6f6f 7460 3f3f 3f0a 2020 2020  ct_root`???.    
-00004bd0: 2020 2020 2320 646c 6170 692e 636c 6f6e      # dlapi.clon
-00004be0: 6528 736f 7572 6365 203d 2063 6f6e 7461  e(source = conta
-00004bf0: 696e 6572 5f64 732c 2020 2020 2320 636f  iner_ds,    # co
-00004c00: 6e74 6169 6e65 7220 6461 7461 6c61 6420  ntainer datalad 
-00004c10: 6461 7461 7365 740a 2020 2020 2020 2020  dataset.        
-00004c20: 2320 2020 2020 2020 2020 2020 2020 7061  #             pa
-00004c30: 7468 203d 206f 702e 6a6f 696e 2873 656c  th = op.join(sel
-00004c40: 662e 7072 6f6a 6563 745f 726f 6f74 2c20  f.project_root, 
-00004c50: 2263 6f6e 7461 696e 6572 7322 2929 2020  "containers"))  
-00004c60: 2023 2070 6174 6820 746f 2063 6c6f 6e65   # path to clone
-00004c70: 2069 6e74 6f0a 0a20 2020 2020 2020 2023   into..        #
-00004c80: 2064 6972 6563 746c 7920 6164 6420 636f   directly add co
-00004c90: 6e74 6169 6e65 7220 6173 2073 7562 2d64  ntainer as sub-d
-00004ca0: 6174 6173 6574 206f 6620 6061 6e61 6c79  ataset of `analy
-00004cb0: 7369 7360 3a0a 2020 2020 2020 2020 7072  sis`:.        pr
-00004cc0: 696e 7428 225c 6e41 6464 696e 6720 7468  int("\nAdding th
-00004cd0: 6520 636f 6e74 6169 6e65 7220 6173 2061  e container as a
-00004ce0: 2073 7562 2d64 6174 6173 6574 206f 6620   sub-dataset of 
-00004cf0: 6061 6e61 6c79 7369 7360 2064 6174 6173  `analysis` datas
-00004d00: 6574 2e2e 2e22 290a 2020 2020 2020 2020  et...").        
-00004d10: 646c 6170 692e 696e 7374 616c 6c28 6461  dlapi.install(da
-00004d20: 7461 7365 743d 7365 6c66 2e61 6e61 6c79  taset=self.analy
-00004d30: 7369 735f 7061 7468 2c0a 2020 2020 2020  sis_path,.      
-00004d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d50: 736f 7572 6365 3d63 6f6e 7461 696e 6572  source=container
-00004d60: 5f64 732c 2020 2020 2320 636f 6e74 6169  _ds,    # contai
-00004d70: 6e65 7220 6461 7461 6c61 6420 6461 7461  ner datalad data
-00004d80: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
-00004d90: 2020 2020 2020 2020 2020 7061 7468 3d6f            path=o
-00004da0: 702e 6a6f 696e 2873 656c 662e 616e 616c  p.join(self.anal
-00004db0: 7973 6973 5f70 6174 682c 2022 636f 6e74  ysis_path, "cont
-00004dc0: 6169 6e65 7273 2229 290a 2020 2020 2020  ainers")).      
-00004dd0: 2020 2320 696e 746f 2060 616e 616c 7973    # into `analys
-00004de0: 6973 2f63 6f6e 7461 696e 6572 7360 2066  is/containers` f
-00004df0: 6f6c 6465 720a 0a20 2020 2020 2020 2023  older..        #
-00004e00: 206f 7269 6769 6e61 6c20 6261 7368 2063   original bash c
-00004e10: 6f6d 6d61 6e64 2c20 6966 2064 6972 6563  ommand, if direc
-00004e20: 746c 7920 676f 696e 6720 696e 746f 2061  tly going into a
-00004e30: 7320 7375 622d 6461 7461 7365 743a 0a20  s sub-dataset:. 
-00004e40: 2020 2020 2020 2023 2064 6174 616c 6164         # datalad
-00004e50: 2069 6e73 7461 6c6c 202d 6420 2e20 2d2d   install -d . --
-00004e60: 736f 7572 6365 202e 2e2f 2e2e 2f74 6f79  source ../../toy
-00004e70: 6269 6473 6170 702d 636f 6e74 6169 6e65  bidsapp-containe
-00004e80: 722d 646f 636b 6572 2f20 636f 6e74 6169  r-docker/ contai
-00004e90: 6e65 7273 0a0a 2020 2020 2020 2020 2320  ners..        # 
-00004ea0: 6672 6f6d 206f 7572 2074 6865 2077 6179  from our the way
-00004eb0: 3a0a 2020 2020 2020 2020 2320 6364 2024  :.        # cd $
-00004ec0: 7b50 524f 4a45 4354 524f 4f54 7d2f 616e  {PROJECTROOT}/an
-00004ed0: 616c 7973 6973 0a20 2020 2020 2020 2023  alysis.        #
-00004ee0: 2064 6174 616c 6164 2069 6e73 7461 6c6c   datalad install
-00004ef0: 202d 6420 2e20 2d2d 736f 7572 6365 2024   -d . --source $
-00004f00: 7b50 524f 4a45 4354 524f 4f54 7d2f 7065  {PROJECTROOT}/pe
-00004f10: 6e6e 6c69 6e63 2d63 6f6e 7461 696e 6572  nnlinc-container
-00004f20: 730a 0a20 2020 2020 2020 2063 6f6e 7461  s..        conta
-00004f30: 696e 6572 203d 2043 6f6e 7461 696e 6572  iner = Container
-00004f40: 2863 6f6e 7461 696e 6572 5f64 732c 2063  (container_ds, c
-00004f50: 6f6e 7461 696e 6572 5f6e 616d 652c 2063  ontainer_name, c
-00004f60: 6f6e 7461 696e 6572 5f63 6f6e 6669 675f  ontainer_config_
-00004f70: 7961 6d6c 5f66 696c 6529 0a0a 2020 2020  yaml_file)..    
-00004f80: 2020 2020 2320 7361 6e69 7479 2063 6865      # sanity che
-00004f90: 636b 206f 6620 636f 6e74 6169 6e65 7220  ck of container 
-00004fa0: 6473 3a0a 2020 2020 2020 2020 636f 6e74  ds:.        cont
-00004fb0: 6169 6e65 722e 7361 6e69 7479 5f63 6865  ainer.sanity_che
-00004fc0: 636b 2873 656c 662e 616e 616c 7973 6973  ck(self.analysis
-00004fd0: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
-00004fe0: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
-00004ff0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005000: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00003020: 2020 2020 2020 2020 2020 2063 6667 5f70             cfg_p
+00003030: 726f 633d 2779 6f64 6127 2c0a 2020 2020  roc='yoda',.    
+00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003070: 616e 6e65 783d 5472 7565 290a 0a20 2020  annex=True)..   
+00003080: 2020 2020 2023 2050 7265 7061 7265 2060       # Prepare `
+00003090: 2e67 6974 6967 6e6f 7265 6020 2d2d 2d2d  .gitignore` ----
+000030a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000030b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+000030c0: 2020 2023 2077 7269 7465 2069 6e74 6f20     # write into 
+000030d0: 2e67 6974 6967 6e6f 7265 2073 6f20 776f  .gitignore so wo
+000030e0: 6e27 7420 6265 2074 7261 636b 6564 2062  n't be tracked b
+000030f0: 7920 6769 743a 0a20 2020 2020 2020 2067  y git:.        g
+00003100: 6974 6967 6e6f 7265 5f70 6174 6820 3d20  itignore_path = 
+00003110: 6f70 2e6a 6f69 6e28 7365 6c66 2e61 6e61  op.join(self.ana
+00003120: 6c79 7369 735f 7061 7468 2c20 222e 6769  lysis_path, ".gi
+00003130: 7469 676e 6f72 6522 290a 2020 2020 2020  tignore").      
+00003140: 2020 2320 6966 2065 7869 7374 7320 616c    # if exists al
+00003150: 7265 6164 792c 2072 656d 6f76 6520 6974  ready, remove it
+00003160: 3a0a 2020 2020 2020 2020 6966 206f 702e  :.        if op.
+00003170: 6578 6973 7473 2867 6974 6967 6e6f 7265  exists(gitignore
+00003180: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+00003190: 2020 2020 6f73 2e72 656d 6f76 6528 6769      os.remove(gi
+000031a0: 7469 676e 6f72 655f 7061 7468 290a 2020  tignore_path).  
+000031b0: 2020 2020 2020 6769 7469 676e 6f72 655f        gitignore_
+000031c0: 6669 6c65 203d 206f 7065 6e28 6769 7469  file = open(giti
+000031d0: 676e 6f72 655f 7061 7468 2c20 2261 2229  gnore_path, "a")
+000031e0: 2020 2023 206f 7065 6e20 696e 2061 7070     # open in app
+000031f0: 656e 6420 6d6f 6465 0a0a 2020 2020 2020  end mode..      
+00003200: 2020 2320 6e6f 7420 746f 2074 7261 636b    # not to track
+00003210: 2060 6c6f 6773 6020 666f 6c64 6572 3a0a   `logs` folder:.
+00003220: 2020 2020 2020 2020 6769 7469 676e 6f72          gitignor
+00003230: 655f 6669 6c65 2e77 7269 7465 2822 5c6e  e_file.write("\n
+00003240: 6c6f 6773 2229 0a20 2020 2020 2020 2023  logs").        #
+00003250: 206e 6f74 2074 6f20 7472 6163 6b20 602e   not to track `.
+00003260: 2a5f 6461 7461 6c61 645f 6c6f 636b 603a  *_datalad_lock`:
+00003270: 0a20 2020 2020 2020 2069 6620 7379 7374  .        if syst
+00003280: 656d 2e74 7970 6520 3d3d 2022 7367 6522  em.type == "sge"
+00003290: 3a0a 2020 2020 2020 2020 2020 2020 6769  :.            gi
+000032a0: 7469 676e 6f72 655f 6669 6c65 2e77 7269  tignore_file.wri
+000032b0: 7465 2822 5c6e 2e53 4745 5f64 6174 616c  te("\n.SGE_datal
+000032c0: 6164 5f6c 6f63 6b22 290a 2020 2020 2020  ad_lock").      
+000032d0: 2020 656c 6966 2073 7973 7465 6d2e 7479    elif system.ty
+000032e0: 7065 203d 3d20 2273 6c75 726d 223a 0a20  pe == "slurm":. 
+000032f0: 2020 2020 2020 2020 2020 2067 6974 6967             gitig
+00003300: 6e6f 7265 5f66 696c 652e 7772 6974 6528  nore_file.write(
+00003310: 225c 6e2e 534c 5552 4d5f 6461 7461 6c61  "\n.SLURM_datala
+00003320: 645f 6c6f 636b 2229 0a20 2020 2020 2020  d_lock").       
+00003330: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00003340: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00003350: 2822 4e6f 7420 7375 7070 6f72 7469 6e67  ("Not supporting
+00003360: 2073 7973 7465 6d73 206f 7468 6572 2074   systems other t
+00003370: 6861 6e20 5347 4520 6f72 2053 6c75 726d  han SGE or Slurm
+00003380: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003390: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+000033a0: 666f 7220 272e 6769 7469 676e 6f72 6527  for '.gitignore'
+000033b0: 2e22 290a 2020 2020 2020 2020 2320 6e6f  .").        # no
+000033c0: 7420 746f 2074 7261 636b 206c 6f63 6b20  t to track lock 
+000033d0: 6669 6c65 3a0a 2020 2020 2020 2020 6769  file:.        gi
+000033e0: 7469 676e 6f72 655f 6669 6c65 2e77 7269  tignore_file.wri
+000033f0: 7465 2822 5c6e 2220 2b20 2263 6f64 652f  te("\n" + "code/
+00003400: 6261 6273 5f70 726f 6a5f 636f 6e66 6967  babs_proj_config
+00003410: 2e79 616d 6c2e 6c6f 636b 2229 0a20 2020  .yaml.lock").   
+00003420: 2020 2020 2023 206e 6f74 2074 6f20 7472       # not to tr
+00003430: 6163 6b20 606a 6f62 5f73 7461 7475 732e  ack `job_status.
+00003440: 6373 7660 3a0a 2020 2020 2020 2020 6769  csv`:.        gi
+00003450: 7469 676e 6f72 655f 6669 6c65 2e77 7269  tignore_file.wri
+00003460: 7465 2822 5c6e 2220 2b20 2263 6f64 652f  te("\n" + "code/
+00003470: 6a6f 625f 7374 6174 7573 2e63 7376 2229  job_status.csv")
+00003480: 0a20 2020 2020 2020 2067 6974 6967 6e6f  .        gitigno
+00003490: 7265 5f66 696c 652e 7772 6974 6528 225c  re_file.write("\
+000034a0: 6e22 202b 2022 636f 6465 2f6a 6f62 5f73  n" + "code/job_s
+000034b0: 7461 7475 732e 6373 762e 6c6f 636b 2229  tatus.csv.lock")
+000034c0: 0a20 2020 2020 2020 2023 206e 6f74 2074  .        # not t
+000034d0: 6f20 7472 6163 6b20 6669 6c65 7320 6765  o track files ge
+000034e0: 6e65 7261 7465 6420 6279 2060 6261 6273  nerated by `babs
+000034f0: 2d63 6865 636b 2d73 6574 7570 603a 0a20  -check-setup`:. 
+00003500: 2020 2020 2020 2067 6974 6967 6e6f 7265         gitignore
+00003510: 5f66 696c 652e 7772 6974 6528 225c 6e22  _file.write("\n"
+00003520: 202b 2022 636f 6465 2f63 6865 636b 5f73   + "code/check_s
+00003530: 6574 7570 2f74 6573 745f 6a6f 625f 696e  etup/test_job_in
+00003540: 666f 2e79 616d 6c22 290a 2020 2020 2020  fo.yaml").      
+00003550: 2020 6769 7469 676e 6f72 655f 6669 6c65    gitignore_file
+00003560: 2e77 7269 7465 2822 5c6e 2220 2b20 2263  .write("\n" + "c
+00003570: 6f64 652f 6368 6563 6b5f 7365 7475 702f  ode/check_setup/
+00003580: 6368 6563 6b5f 656e 762e 7961 6d6c 2229  check_env.yaml")
+00003590: 0a20 2020 2020 2020 2067 6974 6967 6e6f  .        gitigno
+000035a0: 7265 5f66 696c 652e 7772 6974 6528 225c  re_file.write("\
+000035b0: 6e22 290a 0a20 2020 2020 2020 2067 6974  n")..        git
+000035c0: 6967 6e6f 7265 5f66 696c 652e 636c 6f73  ignore_file.clos
+000035d0: 6528 290a 2020 2020 2020 2020 7365 6c66  e().        self
+000035e0: 2e64 6174 616c 6164 5f73 6176 6528 7061  .datalad_save(pa
+000035f0: 7468 3d22 2e67 6974 6967 6e6f 7265 222c  th=".gitignore",
+00003600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003610: 2020 2020 2020 2020 2020 206d 6573 7361             messa
+00003620: 6765 3d22 5361 7665 202e 6769 7469 676e  ge="Save .gitign
+00003630: 6f72 6520 6669 6c65 2229 0a0a 2020 2020  ore file")..    
+00003640: 2020 2020 2320 4372 6561 7465 2060 6261      # Create `ba
+00003650: 6273 5f70 726f 6a5f 636f 6e66 6967 2e79  bs_proj_config.y
+00003660: 616d 6c60 2066 696c 653a 202d 2d2d 2d2d  aml` file: -----
+00003670: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00003680: 2d0a 2020 2020 2020 2020 7072 696e 7428  -.        print(
+00003690: 2253 6176 6520 4241 4253 2070 726f 6a65  "Save BABS proje
+000036a0: 6374 2063 6f6e 6669 6775 7261 7469 6f6e  ct configuration
+000036b0: 7320 696e 2061 2059 414d 4c20 6669 6c65  s in a YAML file
+000036c0: 202e 2e2e 2229 0a20 2020 2020 2020 2070   ...").        p
+000036d0: 7269 6e74 2822 5061 7468 2074 6f20 7468  rint("Path to th
+000036e0: 6973 2079 616d 6c20 6669 6c65 2077 696c  is yaml file wil
+000036f0: 6c20 6265 3a20 2761 6e61 6c79 7369 732f  l be: 'analysis/
+00003700: 636f 6465 2f62 6162 735f 7072 6f6a 5f63  code/babs_proj_c
+00003710: 6f6e 6669 672e 7961 6d6c 2722 290a 2020  onfig.yaml'").  
+00003720: 2020 2020 2020 6261 6273 5f70 726f 6a5f        babs_proj_
+00003730: 636f 6e66 6967 5f66 696c 6520 3d20 6f70  config_file = op
+00003740: 656e 2873 656c 662e 636f 6e66 6967 5f70  en(self.config_p
+00003750: 6174 682c 2022 7722 290a 2020 2020 2020  ath, "w").      
+00003760: 2020 6261 6273 5f70 726f 6a5f 636f 6e66    babs_proj_conf
+00003770: 6967 5f66 696c 652e 7772 6974 6528 2274  ig_file.write("t
+00003780: 7970 655f 7365 7373 696f 6e3a 2027 220a  ype_session: '".
+00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037b0: 2020 2020 2b20 7365 6c66 2e74 7970 655f      + self.type_
+000037c0: 7365 7373 696f 6e20 2b20 2227 5c6e 2229  session + "'\n")
+000037d0: 0a20 2020 2020 2020 2062 6162 735f 7072  .        babs_pr
+000037e0: 6f6a 5f63 6f6e 6669 675f 6669 6c65 2e77  oj_config_file.w
+000037f0: 7269 7465 2822 7479 7065 5f73 7973 7465  rite("type_syste
+00003800: 6d3a 2027 220a 2020 2020 2020 2020 2020  m: '".          
+00003810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003820: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+00003830: 2e74 7970 655f 7379 7374 656d 202b 2022  .type_system + "
+00003840: 275c 6e22 290a 2020 2020 2020 2020 2320  '\n").        # 
+00003850: 696e 7075 745f 6473 3a0a 2020 2020 2020  input_ds:.      
+00003860: 2020 6261 6273 5f70 726f 6a5f 636f 6e66    babs_proj_conf
+00003870: 6967 5f66 696c 652e 7772 6974 6528 2269  ig_file.write("i
+00003880: 6e70 7574 5f64 733a 5c6e 2229 2020 2023  nput_ds:\n")   #
+00003890: 2069 6e70 7574 2064 6174 6173 6574 2773   input dataset's
+000038a0: 206e 616d 6528 7329 0a20 2020 2020 2020   name(s).       
+000038b0: 2066 6f72 2069 5f64 7320 696e 2072 616e   for i_ds in ran
+000038c0: 6765 2830 2c20 696e 7075 745f 6473 2e6e  ge(0, input_ds.n
+000038d0: 756d 5f64 7329 3a0a 2020 2020 2020 2020  um_ds):.        
+000038e0: 2020 2020 6261 6273 5f70 726f 6a5f 636f      babs_proj_co
+000038f0: 6e66 6967 5f66 696c 652e 7772 6974 6528  nfig_file.write(
+00003900: 2220 2024 494e 5055 545f 4441 5441 5345  "  $INPUT_DATASE
+00003910: 545f 2322 202b 2073 7472 2869 5f64 732b  T_#" + str(i_ds+
+00003920: 3129 202b 2022 3a5c 6e22 290a 2020 2020  1) + ":\n").    
+00003930: 2020 2020 2020 2020 6261 6273 5f70 726f          babs_pro
+00003940: 6a5f 636f 6e66 6967 5f66 696c 652e 7772  j_config_file.wr
+00003950: 6974 6528 2220 2020 206e 616d 653a 2027  ite("    name: '
+00003960: 2220 2b20 696e 7075 745f 6473 2e64 665b  " + input_ds.df[
+00003970: 226e 616d 6522 5d5b 695f 6473 5d20 2b20  "name"][i_ds] + 
+00003980: 2227 5c6e 2229 0a20 2020 2020 2020 2020  "'\n").         
+00003990: 2020 2062 6162 735f 7072 6f6a 5f63 6f6e     babs_proj_con
+000039a0: 6669 675f 6669 6c65 2e77 7269 7465 2822  fig_file.write("
+000039b0: 2020 2020 7061 7468 5f69 6e3a 2027 2220      path_in: '" 
+000039c0: 2b20 696e 7075 745f 6473 2e64 665b 2270  + input_ds.df["p
+000039d0: 6174 685f 696e 225d 5b69 5f64 735d 202b  ath_in"][i_ds] +
+000039e0: 2022 275c 6e22 290a 2020 2020 2020 2020   "'\n").        
+000039f0: 2020 2020 6261 6273 5f70 726f 6a5f 636f      babs_proj_co
+00003a00: 6e66 6967 5f66 696c 652e 7772 6974 6528  nfig_file.write(
+00003a10: 2220 2020 2070 6174 685f 6461 7461 5f72  "    path_data_r
+00003a20: 656c 3a20 2754 4f5f 4245 5f46 494c 4c45  el: 'TO_BE_FILLE
+00003a30: 4427 5c6e 2229 0a20 2020 2020 2020 2020  D'\n").         
+00003a40: 2020 2062 6162 735f 7072 6f6a 5f63 6f6e     babs_proj_con
+00003a50: 6669 675f 6669 6c65 2e77 7269 7465 2822  fig_file.write("
+00003a60: 2020 2020 6973 5f7a 6970 7065 643a 2027      is_zipped: '
+00003a70: 544f 5f42 455f 4649 4c4c 4544 275c 6e22  TO_BE_FILLED'\n"
+00003a80: 290a 2020 2020 2020 2020 2320 636f 6e74  ).        # cont
+00003a90: 6169 6e65 7220 6473 3a0a 2020 2020 2020  ainer ds:.      
+00003aa0: 2020 6261 6273 5f70 726f 6a5f 636f 6e66    babs_proj_conf
+00003ab0: 6967 5f66 696c 652e 7772 6974 6528 2263  ig_file.write("c
+00003ac0: 6f6e 7461 696e 6572 3a5c 6e22 290a 2020  ontainer:\n").  
+00003ad0: 2020 2020 2020 6261 6273 5f70 726f 6a5f        babs_proj_
+00003ae0: 636f 6e66 6967 5f66 696c 652e 7772 6974  config_file.writ
+00003af0: 6528 2220 206e 616d 653a 2027 2220 2b20  e("  name: '" + 
+00003b00: 636f 6e74 6169 6e65 725f 6e61 6d65 202b  container_name +
+00003b10: 2022 275c 6e22 290a 2020 2020 2020 2020   "'\n").        
+00003b20: 6261 6273 5f70 726f 6a5f 636f 6e66 6967  babs_proj_config
+00003b30: 5f66 696c 652e 7772 6974 6528 2220 2070  _file.write("  p
+00003b40: 6174 685f 696e 3a20 2722 202b 2063 6f6e  ath_in: '" + con
+00003b50: 7461 696e 6572 5f64 7320 2b20 2227 5c6e  tainer_ds + "'\n
+00003b60: 2229 0a0a 2020 2020 2020 2020 6261 6273  ")..        babs
+00003b70: 5f70 726f 6a5f 636f 6e66 6967 5f66 696c  _proj_config_fil
+00003b80: 652e 636c 6f73 6528 290a 2020 2020 2020  e.close().      
+00003b90: 2020 7365 6c66 2e64 6174 616c 6164 5f73    self.datalad_s
+00003ba0: 6176 6528 7061 7468 3d22 636f 6465 2f62  ave(path="code/b
+00003bb0: 6162 735f 7072 6f6a 5f63 6f6e 6669 672e  abs_proj_config.
+00003bc0: 7961 6d6c 222c 0a20 2020 2020 2020 2020  yaml",.         
+00003bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003be0: 206d 6573 7361 6765 3d22 5361 7665 2063   message="Save c
+00003bf0: 6f6e 6669 6775 7261 7469 6f6e 7320 6f66  onfigurations of
+00003c00: 2074 6869 7320 4241 4253 2070 726f 6a65   this BABS proje
+00003c10: 6374 2229 0a0a 2020 2020 2020 2020 2320  ct")..        # 
+00003c20: 4372 6561 7465 206f 7574 7075 7420 5249  Create output RI
+00003c30: 4120 7369 626c 696e 673a 202d 2d2d 2d2d  A sibling: -----
+00003c40: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00003c50: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00003c60: 2070 7269 6e74 2822 5c6e 4372 6561 7469   print("\nCreati
+00003c70: 6e67 206f 7574 7075 7420 616e 6420 696e  ng output and in
+00003c80: 7075 7420 5249 412e 2e2e 2229 0a20 2020  put RIA...").   
+00003c90: 2020 2020 2073 656c 662e 616e 616c 7973       self.analys
+00003ca0: 6973 5f64 6174 616c 6164 5f68 616e 646c  is_datalad_handl
+00003cb0: 652e 6372 6561 7465 5f73 6962 6c69 6e67  e.create_sibling
+00003cc0: 5f72 6961 286e 616d 653d 226f 7574 7075  _ria(name="outpu
+00003cd0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00003ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d00: 2020 2020 2020 2020 2020 2020 7572 6c3d              url=
+00003d10: 7365 6c66 2e6f 7574 7075 745f 7269 615f  self.output_ria_
+00003d20: 7572 6c2c 0a20 2020 2020 2020 2020 2020  url,.           
+00003d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d50: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00003d60: 5f73 746f 7265 5f6f 6b3d 5472 7565 290a  _store_ok=True).
+00003d70: 2020 2020 2020 2020 2320 5e20 7265 663a          # ^ ref:
+00003d80: 2069 6e20 7079 7468 6f6e 2065 6e76 6972   in python envir
+00003d90: 6f6e 6d65 6e74 3a0a 2020 2020 2020 2020  onment:.        
+00003da0: 2320 2020 696d 706f 7274 2064 6174 616c  #   import datal
+00003db0: 6164 3b20 6865 6c70 2864 6174 616c 6164  ad; help(datalad
+00003dc0: 2e64 6973 7472 6962 7574 6564 2e63 7265  .distributed.cre
+00003dd0: 6174 655f 7369 626c 696e 675f 7269 6129  ate_sibling_ria)
+00003de0: 0a20 2020 2020 2020 2023 2020 2073 6f6d  .        #   som
+00003df0: 6574 696d 6573 2c20 6861 7665 2074 6f20  etimes, have to 
+00003e00: 6669 7273 7420 6074 656d 7020 3d20 646c  first `temp = dl
+00003e10: 6170 692e 4461 7461 7365 7428 222f 7061  api.Dataset("/pa
+00003e20: 7468 2f74 6f2f 616e 616c 7973 6973 2f66  th/to/analysis/f
+00003e30: 6f6c 6465 7222 2960 2c0a 2020 2020 2020  older")`,.      
+00003e40: 2020 2320 2020 7468 656e 2060 6865 6c70    #   then `help
+00003e50: 2874 656d 702e 6372 6561 7465 5f73 6962  (temp.create_sib
+00003e60: 6c69 6e67 5f72 6961 2960 2c20 796f 7520  ling_ria)`, you 
+00003e70: 6361 6e20 7374 6f70 2068 6572 652c 0a20  can stop here,. 
+00003e80: 2020 2020 2020 2023 2020 206f 7220 6e6f         #   or no
+00003e90: 7720 796f 7520 6361 6e20 6865 6c70 2864  w you can help(d
+00003ea0: 6174 616c 6164 2e64 6973 7472 6962 7574  atalad.distribut
+00003eb0: 6564 2e63 7265 6174 655f 7369 626c 696e  ed.create_siblin
+00003ec0: 675f 7269 6129 0a20 2020 2020 2020 2023  g_ria).        #
+00003ed0: 2020 2073 6565 6d73 2074 6865 7265 2069     seems there i
+00003ee0: 7320 6e6f 2064 6f63 7320 6f6e 6c69 6e65  s no docs online
+00003ef0: 3f0a 2020 2020 2020 2020 2320 736f 7572  ?.        # sour
+00003f00: 6365 2063 6f64 653a 0a20 2020 2020 2020  ce code:.       
+00003f10: 2023 2068 7474 7073 3a2f 2f67 6974 6875   # https://githu
+00003f20: 622e 636f 6d2f 6461 7461 6c61 642f 6461  b.com/datalad/da
+00003f30: 7461 6c61 642f 626c 6f62 2f6d 6173 7465  talad/blob/maste
+00003f40: 722f 6461 7461 6c61 642f 6469 7374 7269  r/datalad/distri
+00003f50: 6275 7465 642f 6372 6561 7465 5f73 6962  buted/create_sib
+00003f60: 6c69 6e67 5f72 6961 2e70 790a 0a20 2020  ling_ria.py..   
+00003f70: 2020 2020 2023 2047 6574 2073 6f6d 6520       # Get some 
+00003f80: 6b65 7920 696e 666f 726d 6174 696f 6e20  key information 
+00003f90: 7265 3a20 4461 7461 4c61 6420 6461 7461  re: DataLad data
+00003fa0: 7365 7420 6061 6e61 6c79 7369 7360 2c0a  set `analysis`,.
+00003fb0: 2020 2020 2020 2020 2320 6166 7465 7220          # after 
+00003fc0: 6372 6561 7469 6e67 206f 7574 7075 7420  creating output 
+00003fd0: 5249 413a 0a20 2020 2020 2020 2073 656c  RIA:.        sel
+00003fe0: 662e 7774 665f 6b65 795f 696e 666f 2829  f.wtf_key_info()
+00003ff0: 0a0a 2020 2020 2020 2020 2320 4372 6561  ..        # Crea
+00004000: 7465 2069 6e70 7574 2052 4941 2073 6962  te input RIA sib
+00004010: 6c69 6e67 3a0a 2020 2020 2020 2020 7365  ling:.        se
+00004020: 6c66 2e61 6e61 6c79 7369 735f 6461 7461  lf.analysis_data
+00004030: 6c61 645f 6861 6e64 6c65 2e63 7265 6174  lad_handle.creat
+00004040: 655f 7369 626c 696e 675f 7269 6128 0a20  e_sibling_ria(. 
+00004050: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+00004060: 2269 6e70 7574 222c 0a20 2020 2020 2020  "input",.       
+00004070: 2020 2020 2075 726c 3d73 656c 662e 696e       url=self.in
+00004080: 7075 745f 7269 615f 7572 6c2c 0a20 2020  put_ria_url,.   
+00004090: 2020 2020 2020 2020 2073 746f 7261 6765           storage
+000040a0: 5f73 6962 6c69 6e67 3d46 616c 7365 2c20  _sibling=False, 
+000040b0: 2020 2320 4661 6c73 6520 6973 2060 6f66    # False is `of
+000040c0: 6660 2069 6e20 434c 4920 6f66 2064 6174  f` in CLI of dat
+000040d0: 616c 6164 0a20 2020 2020 2020 2020 2020  alad.           
+000040e0: 206e 6577 5f73 746f 7265 5f6f 6b3d 5472   new_store_ok=Tr
+000040f0: 7565 290a 0a20 2020 2020 2020 2023 2052  ue)..        # R
+00004100: 6567 6973 7465 7220 7468 6520 696e 7075  egister the inpu
+00004110: 7420 6461 7461 7365 7428 7329 3a20 2d2d  t dataset(s): --
+00004120: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00004130: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00004140: 2020 2020 7072 696e 7428 225c 6e52 6567      print("\nReg
+00004150: 6973 7465 7269 6e67 2074 6865 2069 6e70  istering the inp
+00004160: 7574 2064 6174 6173 6574 2873 292e 2e2e  ut dataset(s)...
+00004170: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+00004180: 5f64 7320 696e 2072 616e 6765 2830 2c20  _ds in range(0, 
+00004190: 696e 7075 745f 6473 2e6e 756d 5f64 7329  input_ds.num_ds)
+000041a0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000041b0: 7061 7468 2074 6f20 636c 6f6e 6564 2064  path to cloned d
+000041c0: 6174 6173 6574 3a0a 2020 2020 2020 2020  ataset:.        
+000041d0: 2020 2020 695f 6473 5f70 6174 6820 3d20      i_ds_path = 
+000041e0: 6f70 2e6a 6f69 6e28 7365 6c66 2e61 6e61  op.join(self.ana
+000041f0: 6c79 7369 735f 7061 7468 2c0a 2020 2020  lysis_path,.    
+00004200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004210: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+00004220: 745f 6473 2e64 665b 2270 6174 685f 6e6f  t_ds.df["path_no
+00004230: 775f 7265 6c22 5d5b 695f 6473 5d29 0a20  w_rel"][i_ds]). 
+00004240: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00004250: 2822 436c 6f6e 696e 6720 696e 7075 7420  ("Cloning input 
+00004260: 6461 7461 7365 7420 2322 202b 2073 7472  dataset #" + str
+00004270: 2869 5f64 732b 3129 202b 2022 3a20 2722  (i_ds+1) + ": '"
+00004280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004290: 2020 202b 2069 6e70 7574 5f64 732e 6466     + input_ds.df
+000042a0: 5b22 6e61 6d65 225d 5b69 5f64 735d 202b  ["name"][i_ds] +
+000042b0: 2022 2722 290a 2020 2020 2020 2020 2020   "'").          
+000042c0: 2020 2320 636c 6f6e 6520 696e 7075 7420    # clone input 
+000042d0: 6461 7461 7365 7428 7329 2061 7320 7375  dataset(s) as su
+000042e0: 622d 6461 7461 7365 7420 696e 746f 2060  b-dataset into `
+000042f0: 616e 616c 7973 6973 6020 6461 7461 7365  analysis` datase
+00004300: 743a 0a20 2020 2020 2020 2020 2020 2064  t:.            d
+00004310: 6c61 7069 2e63 6c6f 6e65 2864 6174 6173  lapi.clone(datas
+00004320: 6574 3d73 656c 662e 616e 616c 7973 6973  et=self.analysis
+00004330: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
+00004340: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004350: 6f75 7263 653d 696e 7075 745f 6473 2e64  ource=input_ds.d
+00004360: 665b 2270 6174 685f 696e 225d 5b69 5f64  f["path_in"][i_d
+00004370: 735d 2c20 2020 2023 2069 6e70 7574 2064  s],    # input d
+00004380: 6174 6173 6574 2873 290a 2020 2020 2020  ataset(s).      
+00004390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043a0: 2020 7061 7468 3d69 5f64 735f 7061 7468    path=i_ds_path
+000043b0: 2920 2023 2070 6174 6820 746f 2063 6c6f  )  # path to clo
+000043c0: 6e65 2069 6e74 6f0a 0a20 2020 2020 2020  ne into..       
+000043d0: 2020 2020 2023 2061 6d65 6e64 2074 6865       # amend the
+000043e0: 2070 7265 7669 6f75 7320 636f 6d6d 6974   previous commit
+000043f0: 2077 6974 6820 6120 6e69 6365 7220 636f   with a nicer co
+00004400: 6d6d 6974 206d 6573 7361 6765 3a0a 2020  mmit message:.  
+00004410: 2020 2020 2020 2020 2020 7072 6f63 5f67            proc_g
+00004420: 6974 5f63 6f6d 6d69 745f 616d 656e 6420  it_commit_amend 
+00004430: 3d20 7375 6270 726f 6365 7373 2e72 756e  = subprocess.run
+00004440: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004450: 2020 5b22 6769 7422 2c20 2263 6f6d 6d69    ["git", "commi
+00004460: 7422 2c20 222d 2d61 6d65 6e64 222c 2022  t", "--amend", "
+00004470: 2d6d 222c 0a20 2020 2020 2020 2020 2020  -m",.           
+00004480: 2020 2020 2020 2020 2022 5265 6769 7374           "Regist
+00004490: 6572 2069 6e70 7574 2064 6174 6120 6461  er input data da
+000044a0: 7461 7365 7420 2722 202b 2069 6e70 7574  taset '" + input
+000044b0: 5f64 732e 6466 5b22 6e61 6d65 225d 5b69  _ds.df["name"][i
+000044c0: 5f64 735d 0a20 2020 2020 2020 2020 2020  _ds].           
+000044d0: 2020 2020 2020 2020 202b 2022 2720 6173           + "' as
+000044e0: 2061 2073 7562 6461 7461 7365 7422 5d2c   a subdataset"],
+000044f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004500: 2063 7764 3d73 656c 662e 616e 616c 7973   cwd=self.analys
+00004510: 6973 5f70 6174 682c 0a20 2020 2020 2020  is_path,.       
+00004520: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00004530: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
+00004540: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004550: 2020 2020 2020 2020 2020 7072 6f63 5f67            proc_g
+00004560: 6974 5f63 6f6d 6d69 745f 616d 656e 642e  it_commit_amend.
+00004570: 6368 6563 6b5f 7265 7475 726e 636f 6465  check_returncode
+00004580: 2829 0a0a 2020 2020 2020 2020 2320 6765  ()..        # ge
+00004590: 7420 7468 6520 6375 7272 656e 7420 6162  t the current ab
+000045a0: 736f 6c75 7465 2070 6174 6820 746f 2074  solute path to t
+000045b0: 6865 2069 6e70 7574 2064 6174 6173 6574  he input dataset
+000045c0: 3a0a 2020 2020 2020 2020 696e 7075 745f  :.        input_
+000045d0: 6473 2e61 7373 6967 6e5f 7061 7468 5f6e  ds.assign_path_n
+000045e0: 6f77 5f61 6273 2873 656c 662e 616e 616c  ow_abs(self.anal
+000045f0: 7973 6973 5f70 6174 6829 0a0a 2020 2020  ysis_path)..    
+00004600: 2020 2020 2320 4368 6563 6b20 7468 6520      # Check the 
+00004610: 7479 7065 206f 6620 6561 6368 2069 6e70  type of each inp
+00004620: 7574 2064 6174 6173 6574 3a20 287a 6970  ut dataset: (zip
+00004630: 7065 643f 2075 6e7a 6970 7065 643f 290a  ped? unzipped?).
+00004640: 2020 2020 2020 2020 2320 2020 7468 6973          #   this
+00004650: 2061 6c73 6f20 6765 7473 2060 6973 5f7a   also gets `is_z
+00004660: 6970 7065 6460 0a20 2020 2020 2020 2070  ipped`.        p
+00004670: 7269 6e74 2822 5c6e 4368 6563 6b69 6e67  rint("\nChecking
+00004680: 2077 6865 7468 6572 2065 6163 6820 696e   whether each in
+00004690: 7075 7420 6461 7461 7365 7420 6973 2061  put dataset is a
+000046a0: 207a 6970 7065 6420 6f72 2075 6e7a 6970   zipped or unzip
+000046b0: 7065 6420 6461 7461 7365 742e 2e2e 2229  ped dataset...")
+000046c0: 0a20 2020 2020 2020 2069 6e70 7574 5f64  .        input_d
+000046d0: 732e 6368 6563 6b5f 6966 5f7a 6970 7065  s.check_if_zippe
+000046e0: 6428 290a 2020 2020 2020 2020 2320 7361  d().        # sa
+000046f0: 6e69 7479 2063 6865 636b 733a 0a20 2020  nity checks:.   
+00004700: 2020 2020 2069 6e70 7574 5f64 732e 6368       input_ds.ch
+00004710: 6563 6b5f 7661 6c69 6469 7479 5f7a 6970  eck_validity_zip
+00004720: 7065 645f 696e 7075 745f 6461 7461 7365  ped_input_datase
+00004730: 7428 7365 6c66 2e74 7970 655f 7365 7373  t(self.type_sess
+00004740: 696f 6e29 0a0a 2020 2020 2020 2020 2320  ion)..        # 
+00004750: 4368 6563 6b20 7661 6c69 6469 7479 206f  Check validity o
+00004760: 6620 756e 7a69 7070 6564 2064 733a 0a20  f unzipped ds:. 
+00004770: 2020 2020 2020 2023 2020 2069 6620 6d75         #   if mu
+00004780: 6c74 692d 7365 732c 2068 6173 2060 7365  lti-ses, has `se
+00004790: 732d 2a60 2069 6e20 6561 6368 2060 7375  s-*` in each `su
+000047a0: 622d 2a60 3b20 6966 2073 696e 676c 652d  b-*`; if single-
+000047b0: 7365 732c 2068 6173 2061 2060 7375 622d  ses, has a `sub-
+000047c0: 2a60 0a20 2020 2020 2020 2063 6865 636b  *`.        check
+000047d0: 5f76 616c 6964 6974 795f 756e 7a69 7070  _validity_unzipp
+000047e0: 6564 5f69 6e70 7574 5f64 6174 6173 6574  ed_input_dataset
+000047f0: 2869 6e70 7574 5f64 732c 2073 656c 662e  (input_ds, self.
+00004800: 7479 7065 5f73 6573 7369 6f6e 290a 0a20  type_session).. 
+00004810: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
+00004820: 696e 7075 7420 6473 2069 6e66 6f72 6d61  input ds informa
+00004830: 7469 6f6e 2069 6e20 6062 6162 735f 7072  tion in `babs_pr
+00004840: 6f6a 5f63 6f6e 6669 672e 7961 6d6c 603a  oj_config.yaml`:
+00004850: 0a20 2020 2020 2020 2062 6162 735f 7072  .        babs_pr
+00004860: 6f6a 5f63 6f6e 6669 6720 3d20 7265 6164  oj_config = read
+00004870: 5f79 616d 6c28 7365 6c66 2e63 6f6e 6669  _yaml(self.confi
+00004880: 675f 7061 7468 2c20 6966 5f66 696c 656c  g_path, if_filel
+00004890: 6f63 6b3d 5472 7565 290a 2020 2020 2020  ock=True).      
+000048a0: 2020 666f 7220 695f 6473 2069 6e20 7261    for i_ds in ra
+000048b0: 6e67 6528 302c 2069 6e70 7574 5f64 732e  nge(0, input_ds.
+000048c0: 6e75 6d5f 6473 293a 0a20 2020 2020 2020  num_ds):.       
+000048d0: 2020 2020 2064 735f 696e 6465 785f 7374       ds_index_st
+000048e0: 7220 3d20 2224 494e 5055 545f 4441 5441  r = "$INPUT_DATA
+000048f0: 5345 545f 2322 202b 2073 7472 2869 5f64  SET_#" + str(i_d
+00004900: 732b 3129 0a20 2020 2020 2020 2020 2020  s+1).           
+00004910: 2023 2075 7064 6174 6520 6070 6174 685f   # update `path_
+00004920: 6461 7461 5f72 656c 603a 0a20 2020 2020  data_rel`:.     
+00004930: 2020 2020 2020 2062 6162 735f 7072 6f6a         babs_proj
+00004940: 5f63 6f6e 6669 675b 2269 6e70 7574 5f64  _config["input_d
+00004950: 7322 5d5b 6473 5f69 6e64 6578 5f73 7472  s"][ds_index_str
+00004960: 5d5b 2270 6174 685f 6461 7461 5f72 656c  ]["path_data_rel
+00004970: 225d 203d 205c 0a20 2020 2020 2020 2020  "] = \.         
+00004980: 2020 2020 2020 2069 6e70 7574 5f64 732e         input_ds.
+00004990: 6466 5b22 7061 7468 5f64 6174 615f 7265  df["path_data_re
+000049a0: 6c22 5d5b 695f 6473 5d0a 2020 2020 2020  l"][i_ds].      
+000049b0: 2020 2020 2020 2320 7570 6461 7465 2060        # update `
+000049c0: 6973 5f7a 6970 7065 6460 3a0a 2020 2020  is_zipped`:.    
+000049d0: 2020 2020 2020 2020 6261 6273 5f70 726f          babs_pro
+000049e0: 6a5f 636f 6e66 6967 5b22 696e 7075 745f  j_config["input_
+000049f0: 6473 225d 5b64 735f 696e 6465 785f 7374  ds"][ds_index_st
+00004a00: 725d 5b22 6973 5f7a 6970 7065 6422 5d20  r]["is_zipped"] 
+00004a10: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+00004a20: 2020 2020 696e 7075 745f 6473 2e64 665b      input_ds.df[
+00004a30: 2269 735f 7a69 7070 6564 225d 5b69 5f64  "is_zipped"][i_d
+00004a40: 735d 0a20 2020 2020 2020 2023 2064 756d  s].        # dum
+00004a50: 703a 0a20 2020 2020 2020 2077 7269 7465  p:.        write
+00004a60: 5f79 616d 6c28 6261 6273 5f70 726f 6a5f  _yaml(babs_proj_
+00004a70: 636f 6e66 6967 2c20 7365 6c66 2e63 6f6e  config, self.con
+00004a80: 6669 675f 7061 7468 2c20 6966 5f66 696c  fig_path, if_fil
+00004a90: 656c 6f63 6b3d 5472 7565 290a 2020 2020  elock=True).    
+00004aa0: 2020 2020 2320 6461 7461 6c61 6420 7361      # datalad sa
+00004ab0: 7665 3a20 7570 6461 7465 3a0a 2020 2020  ve: update:.    
+00004ac0: 2020 2020 7365 6c66 2e64 6174 616c 6164      self.datalad
+00004ad0: 5f73 6176 6528 7061 7468 3d22 636f 6465  _save(path="code
+00004ae0: 2f62 6162 735f 7072 6f6a 5f63 6f6e 6669  /babs_proj_confi
+00004af0: 672e 7961 6d6c 222c 0a20 2020 2020 2020  g.yaml",.       
+00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b10: 2020 206d 6573 7361 6765 3d22 5570 6461     message="Upda
+00004b20: 7465 2063 6f6e 6669 6775 7261 7469 6f6e  te configuration
+00004b30: 7320 6f66 2069 6e70 7574 2064 6174 6173  s of input datas
+00004b40: 6574 206f 6620 7468 6973 2042 4142 5320  et of this BABS 
+00004b50: 7072 6f6a 6563 7422 290a 0a20 2020 2020  project")..     
+00004b60: 2020 2023 2041 6464 2063 6f6e 7461 696e     # Add contain
+00004b70: 6572 2061 7320 7375 622d 6461 7461 7365  er as sub-datase
+00004b80: 7420 6f66 2060 616e 616c 7973 6973 603a  t of `analysis`:
+00004b90: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+00004ba0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+00004bb0: 2020 2020 2020 2023 2023 2054 4f20 4153         # # TO AS
+00004bc0: 4b3a 2057 4859 2057 4520 4e45 4544 2054  K: WHY WE NEED T
+00004bd0: 4f20 434c 4f4e 4520 4954 2046 4952 5354  O CLONE IT FIRST
+00004be0: 2049 4e54 4f20 6070 726f 6a65 6374 5f72   INTO `project_r
+00004bf0: 6f6f 7460 3f3f 3f0a 2020 2020 2020 2020  oot`???.        
+00004c00: 2320 646c 6170 692e 636c 6f6e 6528 736f  # dlapi.clone(so
+00004c10: 7572 6365 203d 2063 6f6e 7461 696e 6572  urce = container
+00004c20: 5f64 732c 2020 2020 2320 636f 6e74 6169  _ds,    # contai
+00004c30: 6e65 7220 6461 7461 6c61 6420 6461 7461  ner datalad data
+00004c40: 7365 740a 2020 2020 2020 2020 2320 2020  set.        #   
+00004c50: 2020 2020 2020 2020 2020 7061 7468 203d            path =
+00004c60: 206f 702e 6a6f 696e 2873 656c 662e 7072   op.join(self.pr
+00004c70: 6f6a 6563 745f 726f 6f74 2c20 2263 6f6e  oject_root, "con
+00004c80: 7461 696e 6572 7322 2929 2020 2023 2070  tainers"))   # p
+00004c90: 6174 6820 746f 2063 6c6f 6e65 2069 6e74  ath to clone int
+00004ca0: 6f0a 0a20 2020 2020 2020 2023 2064 6972  o..        # dir
+00004cb0: 6563 746c 7920 6164 6420 636f 6e74 6169  ectly add contai
+00004cc0: 6e65 7220 6173 2073 7562 2d64 6174 6173  ner as sub-datas
+00004cd0: 6574 206f 6620 6061 6e61 6c79 7369 7360  et of `analysis`
+00004ce0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00004cf0: 225c 6e41 6464 696e 6720 7468 6520 636f  "\nAdding the co
+00004d00: 6e74 6169 6e65 7220 6173 2061 2073 7562  ntainer as a sub
+00004d10: 2d64 6174 6173 6574 206f 6620 6061 6e61  -dataset of `ana
+00004d20: 6c79 7369 7360 2064 6174 6173 6574 2e2e  lysis` dataset..
+00004d30: 2e22 290a 2020 2020 2020 2020 646c 6170  .").        dlap
+00004d40: 692e 696e 7374 616c 6c28 6461 7461 7365  i.install(datase
+00004d50: 743d 7365 6c66 2e61 6e61 6c79 7369 735f  t=self.analysis_
+00004d60: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+00004d70: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+00004d80: 6365 3d63 6f6e 7461 696e 6572 5f64 732c  ce=container_ds,
+00004d90: 2020 2020 2320 636f 6e74 6169 6e65 7220      # container 
+00004da0: 6461 7461 6c61 6420 6461 7461 7365 740a  datalad dataset.
+00004db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dc0: 2020 2020 2020 7061 7468 3d6f 702e 6a6f        path=op.jo
+00004dd0: 696e 2873 656c 662e 616e 616c 7973 6973  in(self.analysis
+00004de0: 5f70 6174 682c 2022 636f 6e74 6169 6e65  _path, "containe
+00004df0: 7273 2229 290a 2020 2020 2020 2020 2320  rs")).        # 
+00004e00: 696e 746f 2060 616e 616c 7973 6973 2f63  into `analysis/c
+00004e10: 6f6e 7461 696e 6572 7360 2066 6f6c 6465  ontainers` folde
+00004e20: 720a 0a20 2020 2020 2020 2023 206f 7269  r..        # ori
+00004e30: 6769 6e61 6c20 6261 7368 2063 6f6d 6d61  ginal bash comma
+00004e40: 6e64 2c20 6966 2064 6972 6563 746c 7920  nd, if directly 
+00004e50: 676f 696e 6720 696e 746f 2061 7320 7375  going into as su
+00004e60: 622d 6461 7461 7365 743a 0a20 2020 2020  b-dataset:.     
+00004e70: 2020 2023 2064 6174 616c 6164 2069 6e73     # datalad ins
+00004e80: 7461 6c6c 202d 6420 2e20 2d2d 736f 7572  tall -d . --sour
+00004e90: 6365 202e 2e2f 2e2e 2f74 6f79 6269 6473  ce ../../toybids
+00004ea0: 6170 702d 636f 6e74 6169 6e65 722d 646f  app-container-do
+00004eb0: 636b 6572 2f20 636f 6e74 6169 6e65 7273  cker/ containers
+00004ec0: 0a0a 2020 2020 2020 2020 2320 6672 6f6d  ..        # from
+00004ed0: 206f 7572 2074 6865 2077 6179 3a0a 2020   our the way:.  
+00004ee0: 2020 2020 2020 2320 6364 2024 7b50 524f        # cd ${PRO
+00004ef0: 4a45 4354 524f 4f54 7d2f 616e 616c 7973  JECTROOT}/analys
+00004f00: 6973 0a20 2020 2020 2020 2023 2064 6174  is.        # dat
+00004f10: 616c 6164 2069 6e73 7461 6c6c 202d 6420  alad install -d 
+00004f20: 2e20 2d2d 736f 7572 6365 2024 7b50 524f  . --source ${PRO
+00004f30: 4a45 4354 524f 4f54 7d2f 7065 6e6e 6c69  JECTROOT}/pennli
+00004f40: 6e63 2d63 6f6e 7461 696e 6572 730a 0a20  nc-containers.. 
+00004f50: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
+00004f60: 203d 2043 6f6e 7461 696e 6572 2863 6f6e   = Container(con
+00004f70: 7461 696e 6572 5f64 732c 2063 6f6e 7461  tainer_ds, conta
+00004f80: 696e 6572 5f6e 616d 652c 2063 6f6e 7461  iner_name, conta
+00004f90: 696e 6572 5f63 6f6e 6669 675f 7961 6d6c  iner_config_yaml
+00004fa0: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
+00004fb0: 2320 7361 6e69 7479 2063 6865 636b 206f  # sanity check o
+00004fc0: 6620 636f 6e74 6169 6e65 7220 6473 3a0a  f container ds:.
+00004fd0: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+00004fe0: 722e 7361 6e69 7479 5f63 6865 636b 2873  r.sanity_check(s
+00004ff0: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
+00005000: 6829 0a0a 2020 2020 2020 2020 2320 3d3d  h)..        # ==
 00005010: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005020: 0a20 2020 2020 2020 2023 2042 6f6f 7473  .        # Boots
-00005030: 7472 6170 2073 6372 6970 7473 3a0a 2020  trap scripts:.  
-00005040: 2020 2020 2020 2320 3d3d 3d3d 3d3d 3d3d        # ========
-00005050: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005060: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005070: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005080: 3d3d 3d3d 3d3d 0a0a 2020 2020 2020 2020  ======..        
-00005090: 2320 4765 6e65 7261 7465 2060 3c63 6f6e  # Generate `<con
-000050a0: 7461 696e 6572 4e61 6d65 3e5f 7a69 702e  tainerName>_zip.
-000050b0: 7368 603a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  sh`: -----------
-000050c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000050d0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000050e0: 2320 7768 6963 6820 6973 2061 2062 6173  # which is a bas
-000050f0: 6820 7363 7269 7074 206f 6620 7369 6e67  h script of sing
-00005100: 756c 6172 6974 7920 7275 6e20 2b20 7a69  ularity run + zi
-00005110: 700a 2020 2020 2020 2020 2320 696e 2066  p.        # in f
-00005120: 6f6c 6465 723a 2060 616e 616c 7973 6973  older: `analysis
-00005130: 2f63 6f64 6560 0a20 2020 2020 2020 2070  /code`.        p
-00005140: 7269 6e74 2822 5c6e 4765 6e65 7261 7469  rint("\nGenerati
-00005150: 6e67 2061 2062 6173 6820 7363 7269 7074  ng a bash script
-00005160: 2066 6f72 2072 756e 6e69 6e67 2063 6f6e   for running con
-00005170: 7461 696e 6572 2061 6e64 207a 6970 7069  tainer and zippi
-00005180: 6e67 2074 6865 206f 7574 7075 7473 2e2e  ng the outputs..
-00005190: 2e22 290a 2020 2020 2020 2020 7072 696e  .").        prin
-000051a0: 7428 2254 6869 7320 6261 7368 2073 6372  t("This bash scr
-000051b0: 6970 7420 7769 6c6c 2062 6520 6e61 6d65  ipt will be name
-000051c0: 6420 6173 2060 2220 2b20 636f 6e74 6169  d as `" + contai
-000051d0: 6e65 725f 6e61 6d65 202b 2022 5f7a 6970  ner_name + "_zip
-000051e0: 2e73 6860 2229 0a20 2020 2020 2020 2062  .sh`").        b
-000051f0: 6173 685f 7061 7468 203d 206f 702e 6a6f  ash_path = op.jo
-00005200: 696e 2873 656c 662e 616e 616c 7973 6973  in(self.analysis
-00005210: 5f70 6174 682c 2022 636f 6465 222c 2063  _path, "code", c
-00005220: 6f6e 7461 696e 6572 5f6e 616d 6520 2b20  ontainer_name + 
-00005230: 225f 7a69 702e 7368 2229 0a20 2020 2020  "_zip.sh").     
-00005240: 2020 2063 6f6e 7461 696e 6572 2e67 656e     container.gen
-00005250: 6572 6174 655f 6261 7368 5f72 756e 5f62  erate_bash_run_b
-00005260: 6964 7361 7070 2862 6173 685f 7061 7468  idsapp(bash_path
-00005270: 2c20 696e 7075 745f 6473 2c20 7365 6c66  , input_ds, self
-00005280: 2e74 7970 655f 7365 7373 696f 6e29 0a20  .type_session). 
-00005290: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-000052a0: 6c61 645f 7361 7665 2870 6174 683d 2263  lad_save(path="c
-000052b0: 6f64 652f 2220 2b20 636f 6e74 6169 6e65  ode/" + containe
-000052c0: 725f 6e61 6d65 202b 2022 5f7a 6970 2e73  r_name + "_zip.s
-000052d0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
-000052e0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-000052f0: 7373 6167 653d 2247 656e 6572 6174 6520  ssage="Generate 
-00005300: 7363 7269 7074 206f 6620 7275 6e6e 696e  script of runnin
-00005310: 6720 636f 6e74 6169 6e65 7222 290a 0a20  g container").. 
-00005320: 2020 2020 2020 2023 206d 616b 6520 616e         # make an
-00005330: 6f74 6865 7220 666f 6c64 6572 2077 6974  other folder wit
-00005340: 6869 6e20 6063 6f64 6560 2066 6f72 2074  hin `code` for t
-00005350: 6573 7420 6a6f 6273 3a0a 2020 2020 2020  est jobs:.      
-00005360: 2020 6f73 2e6d 616b 6564 6972 7328 6f70    os.makedirs(op
-00005370: 2e6a 6f69 6e28 7365 6c66 2e61 6e61 6c79  .join(self.analy
-00005380: 7369 735f 7061 7468 2c20 2263 6f64 652f  sis_path, "code/
-00005390: 6368 6563 6b5f 7365 7475 7022 292c 2065  check_setup"), e
-000053a0: 7869 7374 5f6f 6b3d 5472 7565 290a 0a20  xist_ok=True).. 
-000053b0: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
-000053c0: 6520 6070 6172 7469 6369 7061 6e74 5f6a  e `participant_j
-000053d0: 6f62 2e73 6860 3a20 2d2d 2d2d 2d2d 2d2d  ob.sh`: --------
-000053e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000053f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-00005400: 2020 2020 2020 2070 7269 6e74 2822 5c6e         print("\n
-00005410: 4765 6e65 7261 7469 6e67 2061 2062 6173  Generating a bas
-00005420: 6820 7363 7269 7074 2066 6f72 2072 756e  h script for run
-00005430: 6e69 6e67 206a 6f62 7320 6174 2070 6172  ning jobs at par
-00005440: 7469 6369 7061 6e74 2028 6f72 2073 6573  ticipant (or ses
-00005450: 7369 6f6e 2920 6c65 7665 6c2e 2e2e 2229  sion) level...")
-00005460: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00005470: 5468 6973 2062 6173 6820 7363 7269 7074  This bash script
-00005480: 2077 696c 6c20 6265 206e 616d 6564 2061   will be named a
-00005490: 7320 6070 6172 7469 6369 7061 6e74 5f6a  s `participant_j
-000054a0: 6f62 2e73 6860 2229 0a20 2020 2020 2020  ob.sh`").       
-000054b0: 2062 6173 685f 7061 7468 203d 206f 702e   bash_path = op.
-000054c0: 6a6f 696e 2873 656c 662e 616e 616c 7973  join(self.analys
-000054d0: 6973 5f70 6174 682c 2022 636f 6465 222c  is_path, "code",
-000054e0: 2022 7061 7274 6963 6970 616e 745f 6a6f   "participant_jo
-000054f0: 622e 7368 2229 0a20 2020 2020 2020 2063  b.sh").        c
-00005500: 6f6e 7461 696e 6572 2e67 656e 6572 6174  ontainer.generat
-00005510: 655f 6261 7368 5f70 6172 7469 6369 7061  e_bash_participa
-00005520: 6e74 5f6a 6f62 2862 6173 685f 7061 7468  nt_job(bash_path
-00005530: 2c20 696e 7075 745f 6473 2c20 7365 6c66  , input_ds, self
-00005540: 2e74 7970 655f 7365 7373 696f 6e2c 0a20  .type_session,. 
-00005550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005570: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005580: 7973 7465 6d29 0a0a 2020 2020 2020 2020  ystem)..        
-00005590: 2320 616c 736f 2c20 6765 6e65 7261 7465  # also, generate
-000055a0: 2061 2062 6173 6820 7363 7269 7074 206f   a bash script o
-000055b0: 6620 6120 7465 7374 206a 6f62 2075 7365  f a test job use
-000055c0: 6420 6279 2060 6261 6273 2d63 6865 636b  d by `babs-check
-000055d0: 2d73 6574 7570 603a 0a20 2020 2020 2020  -setup`:.       
-000055e0: 2070 6174 685f 6368 6563 6b5f 7365 7475   path_check_setu
-000055f0: 7020 3d20 6f70 2e6a 6f69 6e28 7365 6c66  p = op.join(self
-00005600: 2e61 6e61 6c79 7369 735f 7061 7468 2c20  .analysis_path, 
-00005610: 2263 6f64 652f 6368 6563 6b5f 7365 7475  "code/check_setu
-00005620: 7022 290a 2020 2020 2020 2020 636f 6e74  p").        cont
-00005630: 6169 6e65 722e 6765 6e65 7261 7465 5f62  ainer.generate_b
-00005640: 6173 685f 7465 7374 5f6a 6f62 2870 6174  ash_test_job(pat
-00005650: 685f 6368 6563 6b5f 7365 7475 702c 2073  h_check_setup, s
-00005660: 7973 7465 6d29 0a0a 2020 2020 2020 2020  ystem)..        
-00005670: 7365 6c66 2e64 6174 616c 6164 5f73 6176  self.datalad_sav
-00005680: 6528 7061 7468 3d5b 2263 6f64 652f 7061  e(path=["code/pa
-00005690: 7274 6963 6970 616e 745f 6a6f 622e 7368  rticipant_job.sh
-000056a0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056c0: 2020 2022 636f 6465 2f63 6865 636b 5f73     "code/check_s
-000056d0: 6574 7570 2f63 616c 6c5f 7465 7374 5f6a  etup/call_test_j
-000056e0: 6f62 2e73 6822 2c0a 2020 2020 2020 2020  ob.sh",.        
-000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005700: 2020 2020 2020 2020 2263 6f64 652f 6368          "code/ch
-00005710: 6563 6b5f 7365 7475 702f 7465 7374 5f6a  eck_setup/test_j
-00005720: 6f62 2e70 7922 5d2c 0a20 2020 2020 2020  ob.py"],.       
-00005730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005740: 2020 206d 6573 7361 6765 3d22 5061 7274     message="Part
-00005750: 6963 6970 616e 7420 636f 6d70 7574 6520  icipant compute 
-00005760: 6a6f 6220 696d 706c 656d 656e 7461 7469  job implementati
-00005770: 6f6e 2229 0a20 2020 2020 2020 2023 204e  on").        # N
-00005780: 4f54 453a 2060 646c 6170 692e 7361 7665  OTE: `dlapi.save
-00005790: 2829 6020 646f 6573 206e 6f74 2077 6f72  ()` does not wor
-000057a0: 6b2e 2e2e 0a20 2020 2020 2020 2023 2065  k....        # e
-000057b0: 2e67 2e2c 2064 6174 616c 6164 2073 6176  .g., datalad sav
-000057c0: 6520 2d6d 2022 5061 7274 6963 6970 616e  e -m "Participan
-000057d0: 7420 636f 6d70 7574 6520 6a6f 6220 696d  t compute job im
-000057e0: 706c 656d 656e 7461 7469 6f6e 220a 0a20  plementation".. 
-000057f0: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
-00005800: 6e65 2074 6865 206c 6973 7420 6f66 2073  ne the list of s
-00005810: 7562 6a65 6374 7320 746f 2061 6e61 6c79  ubjects to analy
-00005820: 7a65 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ze: ------------
-00005830: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00005840: 2d0a 2020 2020 2020 2020 7072 696e 7428  -.        print(
-00005850: 225c 6e44 6574 6572 6d69 6e69 6e67 2074  "\nDetermining t
-00005860: 6865 206c 6973 7420 6f66 2073 7562 6a65  he list of subje
-00005870: 6374 7320 2861 6e64 2073 6573 7369 6f6e  cts (and session
-00005880: 7329 2074 6f20 616e 616c 797a 652e 2e2e  s) to analyze...
-00005890: 2229 0a20 2020 2020 2020 205f 203d 2067  ").        _ = g
-000058a0: 6574 5f6c 6973 745f 7375 625f 7365 7328  et_list_sub_ses(
-000058b0: 696e 7075 745f 6473 2c20 636f 6e74 6169  input_ds, contai
-000058c0: 6e65 722e 636f 6e66 6967 2c20 7365 6c66  ner.config, self
-000058d0: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
-000058e0: 6174 616c 6164 5f73 6176 6528 7061 7468  atalad_save(path
-000058f0: 3d22 636f 6465 2f2a 2e63 7376 222c 0a20  ="code/*.csv",. 
-00005900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005910: 2020 2020 2020 2020 206d 6573 7361 6765           message
-00005920: 3d22 5265 636f 7264 206f 6620 696e 636c  ="Record of incl
-00005930: 7573 696f 6e2f 6578 636c 7573 696f 6e20  usion/exclusion 
-00005940: 6f66 2070 6172 7469 6369 7061 6e74 7322  of participants"
-00005950: 290a 0a20 2020 2020 2020 2023 2047 656e  )..        # Gen
-00005960: 6572 6174 6520 7468 6520 7465 6d70 6c61  erate the templa
-00005970: 7465 206f 6620 6a6f 6220 7375 626d 6973  te of job submis
-00005980: 7369 6f6e 3a20 2d2d 2d2d 2d2d 2d2d 2d2d  sion: ----------
-00005990: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000059a0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
-000059b0: 7269 6e74 2822 5c6e 4765 6e65 7261 7469  rint("\nGenerati
-000059c0: 6e67 2061 2074 656d 706c 6174 6520 666f  ng a template fo
-000059d0: 7220 6a6f 6220 7375 626d 6973 7369 6f6e  r job submission
-000059e0: 2063 616c 6c73 2e2e 2e22 290a 2020 2020   calls...").    
-000059f0: 2020 2020 7072 696e 7428 2254 6865 2074      print("The t
-00005a00: 656d 706c 6174 6520 7465 7874 2066 696c  emplate text fil
-00005a10: 6520 7769 6c6c 2062 6520 6e61 6d65 6420  e will be named 
-00005a20: 6173 2060 7375 626d 6974 5f6a 6f62 5f74  as `submit_job_t
-00005a30: 656d 706c 6174 652e 7961 6d6c 602e 2229  emplate.yaml`.")
-00005a40: 0a20 2020 2020 2020 2079 616d 6c5f 7061  .        yaml_pa
-00005a50: 7468 203d 206f 702e 6a6f 696e 2873 656c  th = op.join(sel
-00005a60: 662e 616e 616c 7973 6973 5f70 6174 682c  f.analysis_path,
-00005a70: 2022 636f 6465 222c 2022 7375 626d 6974   "code", "submit
-00005a80: 5f6a 6f62 5f74 656d 706c 6174 652e 7961  _job_template.ya
-00005a90: 6d6c 2229 0a20 2020 2020 2020 2063 6f6e  ml").        con
-00005aa0: 7461 696e 6572 2e67 656e 6572 6174 655f  tainer.generate_
-00005ab0: 6a6f 625f 7375 626d 6974 5f74 656d 706c  job_submit_templ
-00005ac0: 6174 6528 7961 6d6c 5f70 6174 682c 2073  ate(yaml_path, s
-00005ad0: 656c 662c 2073 7973 7465 6d29 0a0a 2020  elf, system)..  
-00005ae0: 2020 2020 2020 2320 616c 736f 2c20 6765        # also, ge
-00005af0: 6e65 7261 7465 2074 656d 706c 6174 6520  nerate template 
-00005b00: 666f 7220 7465 7374 696e 6720 6a6f 6220  for testing job 
-00005b10: 7573 6564 2062 7920 6062 6162 732d 6368  used by `babs-ch
-00005b20: 6563 6b2d 7365 7475 7060 3a0a 2020 2020  eck-setup`:.    
-00005b30: 2020 2020 7961 6d6c 5f74 6573 745f 7061      yaml_test_pa
-00005b40: 7468 203d 206f 702e 6a6f 696e 2873 656c  th = op.join(sel
-00005b50: 662e 616e 616c 7973 6973 5f70 6174 682c  f.analysis_path,
-00005b60: 2022 636f 6465 2f63 6865 636b 5f73 6574   "code/check_set
-00005b70: 7570 222c 2022 7375 626d 6974 5f74 6573  up", "submit_tes
-00005b80: 745f 6a6f 625f 7465 6d70 6c61 7465 2e79  t_job_template.y
-00005b90: 616d 6c22 290a 2020 2020 2020 2020 636f  aml").        co
-00005ba0: 6e74 6169 6e65 722e 6765 6e65 7261 7465  ntainer.generate
-00005bb0: 5f6a 6f62 5f73 7562 6d69 745f 7465 6d70  _job_submit_temp
-00005bc0: 6c61 7465 2879 616d 6c5f 7465 7374 5f70  late(yaml_test_p
-00005bd0: 6174 682c 2073 656c 662c 2073 7973 7465  ath, self, syste
-00005be0: 6d2c 2074 6573 743d 5472 7565 290a 0a20  m, test=True).. 
-00005bf0: 2020 2020 2020 2023 2064 6174 616c 6164         # datalad
-00005c00: 2073 6176 653a 0a20 2020 2020 2020 2073   save:.        s
-00005c10: 656c 662e 6461 7461 6c61 645f 7361 7665  elf.datalad_save
-00005c20: 2870 6174 683d 5b22 636f 6465 2f73 7562  (path=["code/sub
-00005c30: 6d69 745f 6a6f 625f 7465 6d70 6c61 7465  mit_job_template
-00005c40: 2e79 616d 6c22 2c0a 2020 2020 2020 2020  .yaml",.        
-00005c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c60: 2020 2020 2020 2020 2263 6f64 652f 6368          "code/ch
-00005c70: 6563 6b5f 7365 7475 702f 7375 626d 6974  eck_setup/submit
-00005c80: 5f74 6573 745f 6a6f 625f 7465 6d70 6c61  _test_job_templa
-00005c90: 7465 2e79 616d 6c22 5d2c 0a20 2020 2020  te.yaml"],.     
-00005ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cb0: 2020 2020 206d 6573 7361 6765 3d22 5465       message="Te
-00005cc0: 6d70 6c61 7465 2066 6f72 206a 6f62 2073  mplate for job s
-00005cd0: 7562 6d69 7373 696f 6e22 290a 0a20 2020  ubmission")..   
-00005ce0: 2020 2020 2023 2046 696e 6973 6820 7570       # Finish up
-00005cf0: 2061 6e64 2067 6574 2072 6561 6479 2066   and get ready f
-00005d00: 6f72 2063 6c75 7374 6572 7320 7275 6e6e  or clusters runn
-00005d10: 696e 673a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  ing: -----------
-00005d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-00005d30: 2020 2020 2023 2063 7265 6174 6520 666f       # create fo
-00005d40: 6c64 6572 2060 6c6f 6773 6020 696e 2060  lder `logs` in `
-00005d50: 616e 616c 7973 6973 603b 2066 7574 7572  analysis`; futur
-00005d60: 6520 6c6f 6720 6669 6c65 7320 676f 2068  e log files go h
-00005d70: 6572 650a 2020 2020 2020 2020 2320 2020  ere.        #   
-00005d80: 7468 6973 2077 6f6e 2774 2062 6520 7472  this won't be tr
-00005d90: 6163 6b65 6420 6279 2067 6974 2028 6173  acked by git (as
-00005da0: 2061 6c72 6561 6479 2061 6464 6564 2074   already added t
-00005db0: 6f20 602e 6769 7469 676e 6f72 6560 290a  o `.gitignore`).
-00005dc0: 2020 2020 2020 2020 6c6f 675f 7061 7468          log_path
-00005dd0: 203d 206f 702e 6a6f 696e 2873 656c 662e   = op.join(self.
-00005de0: 616e 616c 7973 6973 5f70 6174 682c 2022  analysis_path, "
-00005df0: 6c6f 6773 2229 0a20 2020 2020 2020 2069  logs").        i
-00005e00: 6620 6e6f 7420 6f70 2e65 7869 7374 7328  f not op.exists(
-00005e10: 6c6f 675f 7061 7468 293a 0a20 2020 2020  log_path):.     
-00005e20: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-00005e30: 7273 286c 6f67 5f70 6174 6829 0a0a 2020  rs(log_path)..  
-00005e40: 2020 2020 2020 2320 696e 2063 6173 6520        # in case 
-00005e50: 616e 7974 6869 6e67 2069 6e20 6063 6f64  anything in `cod
-00005e60: 652f 6020 7761 7320 6e6f 7420 7361 7665  e/` was not save
-00005e70: 643a 0a20 2020 2020 2020 2023 2020 2049  d:.        #   I
-00005e80: 6620 7468 6572 6520 6973 2061 6e79 7468  f there is anyth
-00005e90: 696e 6720 6e6f 7420 7361 7665 6420 7965  ing not saved ye
-00005ea0: 742c 2070 726f 6261 626c 7920 7368 6f75  t, probably shou
-00005eb0: 6c64 2062 6520 6164 6465 6420 746f 2060  ld be added to `
-00005ec0: 2e67 6974 6967 6e6f 7265 600a 2020 2020  .gitignore`.    
-00005ed0: 2020 2020 2320 2020 6174 2074 6865 2062      #   at the b
-00005ee0: 6567 696e 6e69 6e67 206f 6620 6062 6162  eginning of `bab
-00005ef0: 732d 696e 6974 602e 0a20 2020 2020 2020  s-init`..       
-00005f00: 2073 656c 662e 6461 7461 6c61 645f 7361   self.datalad_sa
-00005f10: 7665 2870 6174 683d 2263 6f64 652f 222c  ve(path="code/",
-00005f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005f30: 2020 2020 2020 2020 2020 206d 6573 7361             messa
-00005f40: 6765 3d22 5361 7665 2061 6e79 7468 696e  ge="Save anythin
-00005f50: 6720 696e 2066 6f6c 6465 7220 636f 6465  g in folder code
-00005f60: 2f20 7468 6174 2068 6173 6e27 7420 6265  / that hasn't be
-00005f70: 656e 2073 6176 6564 2229 0a0a 2020 2020  en saved")..    
-00005f80: 2020 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d      # ==========
-00005f90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005fa0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005fb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00005fc0: 3d3d 3d3d 0a20 2020 2020 2020 2023 2046  ====.        # F
-00005fd0: 696e 616c 2073 7465 7073 2069 6e20 626f  inal steps in bo
-00005fe0: 6f74 7374 7261 7070 696e 673a 0a20 2020  otstrapping:.   
-00005ff0: 2020 2020 2023 203d 3d3d 3d3d 3d3d 3d3d       # =========
-00006000: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00006010: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00006020: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00006030: 3d3d 3d3d 3d0a 0a20 2020 2020 2020 2070  =====..        p
-00006040: 7269 6e74 2822 5c6e 4669 6e61 6c20 7374  rint("\nFinal st
-00006050: 6570 732e 2e2e 2229 0a20 2020 2020 2020  eps...").       
-00006060: 2023 204e 6f20 6e65 6564 2074 6f20 6b65   # No need to ke
-00006070: 6570 2074 6865 2069 6e70 7574 2064 6174  ep the input dat
-00006080: 6173 6574 2873 293a 0a20 2020 2020 2020  aset(s):.       
-00006090: 2023 2020 206f 6c64 2076 6572 7369 6f6e   #   old version
-000060a0: 3a20 6461 7461 6c61 6420 756e 696e 7374  : datalad uninst
-000060b0: 616c 6c20 2d72 202d 2d6e 6f63 6865 636b  all -r --nocheck
-000060c0: 2069 6e70 7574 732f 6461 7461 0a20 2020   inputs/data.   
-000060d0: 2020 2020 2070 7269 6e74 2822 4461 7461       print("Data
-000060e0: 4c61 6420 6472 6f70 7069 6e67 2069 6e70  Lad dropping inp
-000060f0: 7574 2064 6174 6173 6574 2773 2063 6f6e  ut dataset's con
-00006100: 7465 6e74 732e 2e2e 2229 0a20 2020 2020  tents...").     
-00006110: 2020 2066 6f72 2069 5f64 7320 696e 2072     for i_ds in r
-00006120: 616e 6765 2830 2c20 696e 7075 745f 6473  ange(0, input_ds
-00006130: 2e6e 756d 5f64 7329 3a0a 2020 2020 2020  .num_ds):.      
-00006140: 2020 2020 2020 5f20 3d20 7365 6c66 2e61        _ = self.a
-00006150: 6e61 6c79 7369 735f 6461 7461 6c61 645f  nalysis_datalad_
-00006160: 6861 6e64 6c65 2e64 726f 7028 0a20 2020  handle.drop(.   
-00006170: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00006180: 683d 696e 7075 745f 6473 2e64 665b 2270  h=input_ds.df["p
-00006190: 6174 685f 6e6f 775f 7265 6c22 5d5b 695f  ath_now_rel"][i_
-000061a0: 6473 5d2c 0a20 2020 2020 2020 2020 2020  ds],.           
-000061b0: 2020 2020 2072 6563 7572 7369 7665 3d54       recursive=T
-000061c0: 7275 652c 2020 2023 2061 6e64 2070 6f74  rue,   # and pot
-000061d0: 656e 7469 616c 2073 7562 6461 7461 7365  ential subdatase
-000061e0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-000061f0: 2020 7265 636b 6c65 7373 3d27 6176 6169    reckless='avai
-00006200: 6c61 6269 6c69 7479 2729 0a20 2020 2020  lability').     
-00006210: 2020 2020 2020 2023 206e 6f74 2074 6f20         # not to 
-00006220: 6368 6563 6b20 6176 6169 6c61 6269 6c69  check availabili
-00006230: 7479 0a20 2020 2020 2020 2020 2020 2023  ty.            #
-00006240: 2073 6565 6d73 2068 6176 6520 746f 2073   seems have to s
-00006250: 7065 6369 6679 2074 6865 2064 6174 6173  pecify the datas
-00006260: 6574 2028 6279 2061 626f 7665 2060 6861  et (by above `ha
-00006270: 6e64 6c65 6029 3b0a 2020 2020 2020 2020  ndle`);.        
-00006280: 2020 2020 2320 6f74 6865 7277 6973 652c      # otherwise,
-00006290: 2064 6c20 7468 696e 6b73 2074 6865 2064   dl thinks the d
-000062a0: 6174 6173 6574 2069 7320 7768 6572 6520  ataset is where 
-000062b0: 6375 7272 656e 7420 7079 7468 6f6e 2069  current python i
-000062c0: 7320 7275 6e6e 696e 670a 0a20 2020 2020  s running..     
-000062d0: 2020 2023 2055 7064 6174 6520 696e 7075     # Update inpu
-000062e0: 7420 616e 6420 6f75 7470 7574 2052 4941  t and output RIA
-000062f0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00006300: 2255 7064 6174 696e 6720 696e 7075 7420  "Updating input 
-00006310: 616e 6420 6f75 7470 7574 2052 4941 2e2e  and output RIA..
-00006320: 2e22 290a 2020 2020 2020 2020 2320 2020  .").        #   
-00006330: 6461 7461 6c61 6420 7075 7368 202d 2d74  datalad push --t
-00006340: 6f20 696e 7075 740a 2020 2020 2020 2020  o input.        
-00006350: 2320 2020 6461 7461 6c61 6420 7075 7368  #   datalad push
-00006360: 202d 2d74 6f20 6f75 7470 7574 0a20 2020   --to output.   
-00006370: 2020 2020 2073 656c 662e 616e 616c 7973       self.analys
-00006380: 6973 5f64 6174 616c 6164 5f68 616e 646c  is_datalad_handl
-00006390: 652e 7075 7368 2874 6f3d 2269 6e70 7574  e.push(to="input
-000063a0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-000063b0: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
-000063c0: 5f68 616e 646c 652e 7075 7368 2874 6f3d  _handle.push(to=
-000063d0: 226f 7574 7075 7422 290a 0a20 2020 2020  "output")..     
-000063e0: 2020 2023 2041 6464 2061 6e20 616c 6961     # Add an alia
-000063f0: 7320 746f 2074 6865 2064 6174 6120 696e  s to the data in
-00006400: 206f 7574 7075 7420 5249 4120 7374 6f72   output RIA stor
-00006410: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
-00006420: 2822 4164 6469 6e67 2061 6e20 616c 6961  ("Adding an alia
-00006430: 7320 2764 6174 6127 2074 6f20 6f75 7470  s 'data' to outp
-00006440: 7574 2052 4941 2073 746f 7265 2e2e 2e22  ut RIA store..."
-00006450: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00006460: 2020 2020 2020 5249 415f 4449 523d 2428        RIA_DIR=$(
-00006470: 6669 6e64 2024 5052 4f4a 4543 5452 4f4f  find $PROJECTROO
-00006480: 542f 6f75 7470 7574 5f72 6961 2f3f 3f3f  T/output_ria/???
-00006490: 2f20 2d6d 6178 6465 7074 6820 3120 2d74  / -maxdepth 1 -t
-000064a0: 7970 6520 6420 7c20 736f 7274 207c 2074  ype d | sort | t
-000064b0: 6169 6c20 2d6e 2031 290a 2020 2020 2020  ail -n 1).      
-000064c0: 2020 6d6b 6469 7220 2d70 2024 7b50 524f    mkdir -p ${PRO
-000064d0: 4a45 4354 524f 4f54 7d2f 6f75 7470 7574  JECTROOT}/output
-000064e0: 5f72 6961 2f61 6c69 6173 0a20 2020 2020  _ria/alias.     
-000064f0: 2020 206c 6e20 2d73 2024 7b52 4941 5f44     ln -s ${RIA_D
-00006500: 4952 7d20 247b 5052 4f4a 4543 5452 4f4f  IR} ${PROJECTROO
-00006510: 547d 2f6f 7574 7075 745f 7269 612f 616c  T}/output_ria/al
-00006520: 6961 732f 6461 7461 0a20 2020 2020 2020  ias/data.       
-00006530: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00006540: 6e6f 7420 6f70 2e65 7869 7374 7328 6f70  not op.exists(op
-00006550: 2e6a 6f69 6e28 7365 6c66 2e6f 7574 7075  .join(self.outpu
-00006560: 745f 7269 615f 7061 7468 2c0a 2020 2020  t_ria_path,.    
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2020 2020 2020 2020 2020 2020 2022 616c               "al
-00006590: 6961 7322 2929 3a0a 2020 2020 2020 2020  ias")):.        
-000065a0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-000065b0: 6f70 2e6a 6f69 6e28 7365 6c66 2e6f 7574  op.join(self.out
-000065c0: 7075 745f 7269 615f 7061 7468 2c0a 2020  put_ria_path,.  
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065e0: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-000065f0: 6c69 6173 2229 290a 2020 2020 2020 2020  lias")).        
-00006600: 2320 6372 6561 7465 2061 2073 796d 626f  # create a symbo
-00006610: 6c69 6320 6c69 6e6b 3a0a 2020 2020 2020  lic link:.      
-00006620: 2020 7468 655f 7379 6d6c 696e 6b20 3d20    the_symlink = 
-00006630: 6f70 2e6a 6f69 6e28 7365 6c66 2e6f 7574  op.join(self.out
-00006640: 7075 745f 7269 615f 7061 7468 2c0a 2020  put_ria_path,.  
-00006650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006660: 2020 2020 2020 2020 2020 2020 2261 6c69              "ali
-00006670: 6173 222c 2022 6461 7461 2229 0a20 2020  as", "data").   
-00006680: 2020 2020 2069 6620 6f70 2e65 7869 7374       if op.exist
-00006690: 7328 7468 655f 7379 6d6c 696e 6b29 2026  s(the_symlink) &
-000066a0: 206f 702e 6973 6c69 6e6b 2874 6865 5f73   op.islink(the_s
-000066b0: 796d 6c69 6e6b 293a 0a20 2020 2020 2020  ymlink):.       
-000066c0: 2020 2020 2023 2065 7869 7374 7320 616e       # exists an
-000066d0: 6420 6973 2061 2073 796d 6c69 6e6b 3a20  d is a symlink: 
-000066e0: 7265 6d6f 7665 2066 6972 7374 0a20 2020  remove first.   
-000066f0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
-00006700: 7665 2874 6865 5f73 796d 6c69 6e6b 290a  ve(the_symlink).
-00006710: 2020 2020 2020 2020 6f73 2e73 796d 6c69          os.symli
-00006720: 6e6b 2873 656c 662e 6f75 7470 7574 5f72  nk(self.output_r
-00006730: 6961 5f64 6174 615f 6469 722c 0a20 2020  ia_data_dir,.   
-00006740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006750: 7468 655f 7379 6d6c 696e 6b29 0a20 2020  the_symlink).   
-00006760: 2020 2020 2023 2074 6f20 6368 6563 6b20       # to check 
-00006770: 7468 6973 2073 796d 626f 6c69 6320 6c69  this symbolic li
-00006780: 6e6b 2c20 6a75 7374 3a20 2420 6c73 202d  nk, just: $ ls -
-00006790: 6c20 3c6f 7574 7075 745f 7269 612f 616c  l <output_ria/al
-000067a0: 6961 732f 6461 7461 3e0a 2020 2020 2020  ias/data>.      
-000067b0: 2020 2320 2020 6974 2073 686f 756c 6420    #   it should 
-000067c0: 706f 696e 7420 746f 202f 6675 6c6c 2f70  point to /full/p
-000067d0: 6174 682f 6f75 7470 7574 5f72 6961 2f78  ath/output_ria/x
-000067e0: 7878 2f78 7878 2d78 7878 2d78 7878 2d78  xx/xxx-xxx-xxx-x
-000067f0: 7878 0a0a 2020 2020 2020 2020 2320 5355  xx..        # SU
-00006800: 4343 4553 5321 0a20 2020 2020 2020 2070  CCESS!.        p
-00006810: 7269 6e74 2822 5c6e 2229 0a20 2020 2020  rint("\n").     
-00006820: 2020 2070 7269 6e74 2822 4241 4253 2070     print("BABS p
-00006830: 726f 6a65 6374 2068 6173 2062 6565 6e20  roject has been 
-00006840: 696e 6974 6961 6c69 7a65 6421 220a 2020  initialized!".  
-00006850: 2020 2020 2020 2020 2020 2020 2220 5061              " Pa
-00006860: 7468 2074 6f20 7468 6973 2042 4142 5320  th to this BABS 
-00006870: 7072 6f6a 6563 743a 2027 2220 2b20 7365  project: '" + se
-00006880: 6c66 2e70 726f 6a65 6374 5f72 6f6f 7420  lf.project_root 
-00006890: 2b20 2227 2229 0a20 2020 2020 2020 2070  + "'").        p
-000068a0: 7269 6e74 2822 6062 6162 732d 696e 6974  rint("`babs-init
-000068b0: 6020 7761 7320 7375 6363 6573 7366 756c  ` was successful
-000068c0: 2122 290a 0a20 2020 2064 6566 2063 6c65  !")..    def cle
-000068d0: 616e 5f75 7028 7365 6c66 2c20 696e 7075  an_up(self, inpu
-000068e0: 745f 6473 293a 0a20 2020 2020 2020 2022  t_ds):.        "
-000068f0: 2222 0a20 2020 2020 2020 2049 6620 6062  "".        If `b
-00006900: 6162 732d 696e 6974 6020 6661 696c 6564  abs-init` failed
-00006910: 2c20 7468 6973 2066 756e 6374 696f 6e20  , this function 
-00006920: 636c 6561 6e73 2075 7020 7468 6520 4241  cleans up the BA
-00006930: 4253 2070 726f 6a65 6374 2060 6261 6273  BS project `babs
-00006940: 2d69 6e69 7460 2063 7265 6174 6573 2e0a  -init` creates..
-00006950: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00006960: 6572 733a 0a20 2020 2020 2020 202d 2d2d  ers:.        ---
-00006970: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00006980: 2020 2020 696e 7075 745f 6473 3a20 636c      input_ds: cl
-00006990: 6173 7320 6049 6e70 7574 5f64 7360 0a20  ass `Input_ds`. 
-000069a0: 2020 2020 2020 2020 2020 2069 6e66 6f72             infor
-000069b0: 6d61 7469 6f6e 206f 6620 696e 7075 7420  mation of input 
-000069c0: 6461 7461 7365 7428 7329 0a0a 2020 2020  dataset(s)..    
-000069d0: 2020 2020 4e6f 7465 733a 0a20 2020 2020      Notes:.     
-000069e0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-000069f0: 2020 2020 5374 6570 7320 696e 2060 6261      Steps in `ba
-00006a00: 6273 2d69 6e69 7460 3a0a 2020 2020 2020  bs-init`:.      
-00006a10: 2020 2a20 6372 6561 7465 2060 616e 616c    * create `anal
-00006a20: 7973 6973 6020 6461 7461 6c61 6420 6461  ysis` datalad da
-00006a30: 7461 7365 740a 2020 2020 2020 2020 2a20  taset.        * 
-00006a40: 6372 6561 7465 2069 6e70 7574 2061 6e64  create input and
-00006a50: 206f 7574 7075 7420 5249 410a 2020 2020   output RIA.    
-00006a60: 2020 2020 2a20 636c 6f6e 6520 696e 7075      * clone inpu
-00006a70: 7420 6461 7461 7365 7428 7329 0a20 2020  t dataset(s).   
-00006a80: 2020 2020 202a 2067 656e 6572 6174 6520       * generate 
-00006a90: 626f 6f74 7374 7261 7070 6564 2073 6372  bootstrapped scr
-00006aa0: 6970 7473 0a20 2020 2020 2020 202a 2066  ipts.        * f
-00006ab0: 696e 6973 6820 7570 0a20 2020 2020 2020  inish up.       
-00006ac0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00006ad0: 6f70 2e65 7869 7374 7328 7365 6c66 2e70  op.exists(self.p
-00006ae0: 726f 6a65 6374 5f72 6f6f 7429 3a20 2020  roject_root):   
-00006af0: 2320 6966 2042 4142 5320 7072 6f6a 6563  # if BABS projec
-00006b00: 7420 726f 6f74 2066 6f6c 6465 7220 6861  t root folder ha
-00006b10: 7320 6265 656e 2063 7265 6174 6564 3a0a  s been created:.
-00006b20: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00006b30: 702e 6578 6973 7473 2873 656c 662e 616e  p.exists(self.an
-00006b40: 616c 7973 6973 5f70 6174 6829 3a20 2020  alysis_path):   
-00006b50: 2320 616e 616c 7973 6973 2066 6f6c 6465  # analysis folde
-00006b60: 7220 6973 2063 7265 6174 6564 2062 7920  r is created by 
-00006b70: 6461 7461 6c61 6420 0a20 2020 2020 2020  datalad .       
-00006b80: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
-00006b90: 616c 7973 6973 5f64 6174 616c 6164 5f68  alysis_datalad_h
-00006ba0: 616e 646c 6520 3d20 646c 6170 692e 4461  andle = dlapi.Da
-00006bb0: 7461 7365 7428 7365 6c66 2e61 6e61 6c79  taset(self.analy
-00006bc0: 7369 735f 7061 7468 290a 2020 2020 2020  sis_path).      
-00006bd0: 2020 2020 2020 2020 2020 2320 5265 6d6f            # Remo
-00006be0: 7665 2065 6163 6820 696e 7075 7420 6461  ve each input da
-00006bf0: 7461 7365 743a 0a20 2020 2020 2020 2020  taset:.         
-00006c00: 2020 2020 2020 2070 7269 6e74 2822 5265         print("Re
-00006c10: 6d6f 7669 6e67 2069 6e70 7574 2064 6174  moving input dat
-00006c20: 6173 6574 2873 2920 6966 2063 6c6f 6e65  aset(s) if clone
-00006c30: 642e 2e2e 2229 0a20 2020 2020 2020 2020  d...").         
-00006c40: 2020 2020 2020 2066 6f72 2069 5f64 7320         for i_ds 
-00006c50: 696e 2072 616e 6765 2830 2c20 696e 7075  in range(0, inpu
-00006c60: 745f 6473 2e6e 756d 5f64 7329 3a0a 2020  t_ds.num_ds):.  
-00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c80: 2020 2320 6368 6563 6b20 6966 2069 7420    # check if it 
-00006c90: 6578 6973 7473 2079 6574 3a0a 2020 2020  exists yet:.    
-00006ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cb0: 7061 7468 5f6e 6f77 5f61 6273 203d 206f  path_now_abs = o
-00006cc0: 702e 6a6f 696e 2873 656c 662e 616e 616c  p.join(self.anal
-00006cd0: 7973 6973 5f70 6174 682c 2069 6e70 7574  ysis_path, input
-00006ce0: 5f64 732e 6466 5b22 7061 7468 5f6e 6f77  _ds.df["path_now
-00006cf0: 5f72 656c 225d 5b69 5f64 735d 290a 2020  _rel"][i_ds]).  
-00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d10: 2020 6966 206f 702e 6578 6973 7473 2870    if op.exists(p
-00006d20: 6174 685f 6e6f 775f 6162 7329 3a20 2020  ath_now_abs):   
-00006d30: 2320 7468 6973 2069 6e70 7574 2064 6174  # this input dat
-00006d40: 6173 6574 2068 6173 2062 6565 6e20 636c  aset has been cl
-00006d50: 6f6e 6564 3a0a 2020 2020 2020 2020 2020  oned:.          
-00006d60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00006d70: 7573 6520 6064 6174 616c 6164 2072 656d  use `datalad rem
-00006d80: 6f76 6560 2074 6f20 7265 6d6f 7665 3a0a  ove` to remove:.
-00006d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006da0: 2020 2020 2020 2020 5f20 3d20 7365 6c66          _ = self
-00006db0: 2e61 6e61 6c79 7369 735f 6461 7461 6c61  .analysis_datala
-00006dc0: 645f 6861 6e64 6c65 2e72 656d 6f76 6528  d_handle.remove(
-00006dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006de0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00006df0: 683d 7061 7468 5f6e 6f77 5f61 6273 2c0a  h=path_now_abs,.
+00005020: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005030: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005040: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20 2020  ============.   
+00005050: 2020 2020 2023 2042 6f6f 7473 7472 6170       # Bootstrap
+00005060: 2073 6372 6970 7473 3a0a 2020 2020 2020   scripts:.      
+00005070: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
+00005080: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005090: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000050a0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000050b0: 3d3d 0a0a 2020 2020 2020 2020 2320 4765  ==..        # Ge
+000050c0: 6e65 7261 7465 2060 3c63 6f6e 7461 696e  nerate `<contain
+000050d0: 6572 4e61 6d65 3e5f 7a69 702e 7368 603a  erName>_zip.sh`:
+000050e0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+000050f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005100: 2d2d 2d0a 2020 2020 2020 2020 2320 7768  ---.        # wh
+00005110: 6963 6820 6973 2061 2062 6173 6820 7363  ich is a bash sc
+00005120: 7269 7074 206f 6620 7369 6e67 756c 6172  ript of singular
+00005130: 6974 7920 7275 6e20 2b20 7a69 700a 2020  ity run + zip.  
+00005140: 2020 2020 2020 2320 696e 2066 6f6c 6465        # in folde
+00005150: 723a 2060 616e 616c 7973 6973 2f63 6f64  r: `analysis/cod
+00005160: 6560 0a20 2020 2020 2020 2070 7269 6e74  e`.        print
+00005170: 2822 5c6e 4765 6e65 7261 7469 6e67 2061  ("\nGenerating a
+00005180: 2062 6173 6820 7363 7269 7074 2066 6f72   bash script for
+00005190: 2072 756e 6e69 6e67 2063 6f6e 7461 696e   running contain
+000051a0: 6572 2061 6e64 207a 6970 7069 6e67 2074  er and zipping t
+000051b0: 6865 206f 7574 7075 7473 2e2e 2e22 290a  he outputs...").
+000051c0: 2020 2020 2020 2020 7072 696e 7428 2254          print("T
+000051d0: 6869 7320 6261 7368 2073 6372 6970 7420  his bash script 
+000051e0: 7769 6c6c 2062 6520 6e61 6d65 6420 6173  will be named as
+000051f0: 2060 2220 2b20 636f 6e74 6169 6e65 725f   `" + container_
+00005200: 6e61 6d65 202b 2022 5f7a 6970 2e73 6860  name + "_zip.sh`
+00005210: 2229 0a20 2020 2020 2020 2062 6173 685f  ").        bash_
+00005220: 7061 7468 203d 206f 702e 6a6f 696e 2873  path = op.join(s
+00005230: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
+00005240: 682c 2022 636f 6465 222c 2063 6f6e 7461  h, "code", conta
+00005250: 696e 6572 5f6e 616d 6520 2b20 225f 7a69  iner_name + "_zi
+00005260: 702e 7368 2229 0a20 2020 2020 2020 2063  p.sh").        c
+00005270: 6f6e 7461 696e 6572 2e67 656e 6572 6174  ontainer.generat
+00005280: 655f 6261 7368 5f72 756e 5f62 6964 7361  e_bash_run_bidsa
+00005290: 7070 2862 6173 685f 7061 7468 2c20 696e  pp(bash_path, in
+000052a0: 7075 745f 6473 2c20 7365 6c66 2e74 7970  put_ds, self.typ
+000052b0: 655f 7365 7373 696f 6e29 0a20 2020 2020  e_session).     
+000052c0: 2020 2073 656c 662e 6461 7461 6c61 645f     self.datalad_
+000052d0: 7361 7665 2870 6174 683d 2263 6f64 652f  save(path="code/
+000052e0: 2220 2b20 636f 6e74 6169 6e65 725f 6e61  " + container_na
+000052f0: 6d65 202b 2022 5f7a 6970 2e73 6822 2c0a  me + "_zip.sh",.
+00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005310: 2020 2020 2020 2020 2020 6d65 7373 6167            messag
+00005320: 653d 2247 656e 6572 6174 6520 7363 7269  e="Generate scri
+00005330: 7074 206f 6620 7275 6e6e 696e 6720 636f  pt of running co
+00005340: 6e74 6169 6e65 7222 290a 0a20 2020 2020  ntainer")..     
+00005350: 2020 2023 206d 616b 6520 616e 6f74 6865     # make anothe
+00005360: 7220 666f 6c64 6572 2077 6974 6869 6e20  r folder within 
+00005370: 6063 6f64 6560 2066 6f72 2074 6573 7420  `code` for test 
+00005380: 6a6f 6273 3a0a 2020 2020 2020 2020 6f73  jobs:.        os
+00005390: 2e6d 616b 6564 6972 7328 6f70 2e6a 6f69  .makedirs(op.joi
+000053a0: 6e28 7365 6c66 2e61 6e61 6c79 7369 735f  n(self.analysis_
+000053b0: 7061 7468 2c20 2263 6f64 652f 6368 6563  path, "code/chec
+000053c0: 6b5f 7365 7475 7022 292c 2065 7869 7374  k_setup"), exist
+000053d0: 5f6f 6b3d 5472 7565 290a 0a20 2020 2020  _ok=True)..     
+000053e0: 2020 2023 2047 656e 6572 6174 6520 6070     # Generate `p
+000053f0: 6172 7469 6369 7061 6e74 5f6a 6f62 2e73  articipant_job.s
+00005400: 6860 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  h`: ------------
+00005410: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005420: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00005430: 2020 2070 7269 6e74 2822 5c6e 4765 6e65     print("\nGene
+00005440: 7261 7469 6e67 2061 2062 6173 6820 7363  rating a bash sc
+00005450: 7269 7074 2066 6f72 2072 756e 6e69 6e67  ript for running
+00005460: 206a 6f62 7320 6174 2070 6172 7469 6369   jobs at partici
+00005470: 7061 6e74 2028 6f72 2073 6573 7369 6f6e  pant (or session
+00005480: 2920 6c65 7665 6c2e 2e2e 2229 0a20 2020  ) level...").   
+00005490: 2020 2020 2070 7269 6e74 2822 5468 6973       print("This
+000054a0: 2062 6173 6820 7363 7269 7074 2077 696c   bash script wil
+000054b0: 6c20 6265 206e 616d 6564 2061 7320 6070  l be named as `p
+000054c0: 6172 7469 6369 7061 6e74 5f6a 6f62 2e73  articipant_job.s
+000054d0: 6860 2229 0a20 2020 2020 2020 2062 6173  h`").        bas
+000054e0: 685f 7061 7468 203d 206f 702e 6a6f 696e  h_path = op.join
+000054f0: 2873 656c 662e 616e 616c 7973 6973 5f70  (self.analysis_p
+00005500: 6174 682c 2022 636f 6465 222c 2022 7061  ath, "code", "pa
+00005510: 7274 6963 6970 616e 745f 6a6f 622e 7368  rticipant_job.sh
+00005520: 2229 0a20 2020 2020 2020 2063 6f6e 7461  ").        conta
+00005530: 696e 6572 2e67 656e 6572 6174 655f 6261  iner.generate_ba
+00005540: 7368 5f70 6172 7469 6369 7061 6e74 5f6a  sh_participant_j
+00005550: 6f62 2862 6173 685f 7061 7468 2c20 696e  ob(bash_path, in
+00005560: 7075 745f 6473 2c20 7365 6c66 2e74 7970  put_ds, self.typ
+00005570: 655f 7365 7373 696f 6e2c 0a20 2020 2020  e_session,.     
+00005580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055a0: 2020 2020 2020 2020 2020 2073 7973 7465             syste
+000055b0: 6d29 0a0a 2020 2020 2020 2020 2320 616c  m)..        # al
+000055c0: 736f 2c20 6765 6e65 7261 7465 2061 2062  so, generate a b
+000055d0: 6173 6820 7363 7269 7074 206f 6620 6120  ash script of a 
+000055e0: 7465 7374 206a 6f62 2075 7365 6420 6279  test job used by
+000055f0: 2060 6261 6273 2d63 6865 636b 2d73 6574   `babs-check-set
+00005600: 7570 603a 0a20 2020 2020 2020 2070 6174  up`:.        pat
+00005610: 685f 6368 6563 6b5f 7365 7475 7020 3d20  h_check_setup = 
+00005620: 6f70 2e6a 6f69 6e28 7365 6c66 2e61 6e61  op.join(self.ana
+00005630: 6c79 7369 735f 7061 7468 2c20 2263 6f64  lysis_path, "cod
+00005640: 652f 6368 6563 6b5f 7365 7475 7022 290a  e/check_setup").
+00005650: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
+00005660: 722e 6765 6e65 7261 7465 5f62 6173 685f  r.generate_bash_
+00005670: 7465 7374 5f6a 6f62 2870 6174 685f 6368  test_job(path_ch
+00005680: 6563 6b5f 7365 7475 702c 2073 7973 7465  eck_setup, syste
+00005690: 6d29 0a0a 2020 2020 2020 2020 7365 6c66  m)..        self
+000056a0: 2e64 6174 616c 6164 5f73 6176 6528 7061  .datalad_save(pa
+000056b0: 7468 3d5b 2263 6f64 652f 7061 7274 6963  th=["code/partic
+000056c0: 6970 616e 745f 6a6f 622e 7368 222c 0a20  ipant_job.sh",. 
+000056d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000056f0: 636f 6465 2f63 6865 636b 5f73 6574 7570  code/check_setup
+00005700: 2f63 616c 6c5f 7465 7374 5f6a 6f62 2e73  /call_test_job.s
+00005710: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+00005720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005730: 2020 2020 2263 6f64 652f 6368 6563 6b5f      "code/check_
+00005740: 7365 7475 702f 7465 7374 5f6a 6f62 2e70  setup/test_job.p
+00005750: 7922 5d2c 0a20 2020 2020 2020 2020 2020  y"],.           
+00005760: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005770: 6573 7361 6765 3d22 5061 7274 6963 6970  essage="Particip
+00005780: 616e 7420 636f 6d70 7574 6520 6a6f 6220  ant compute job 
+00005790: 696d 706c 656d 656e 7461 7469 6f6e 2229  implementation")
+000057a0: 0a20 2020 2020 2020 2023 204e 4f54 453a  .        # NOTE:
+000057b0: 2060 646c 6170 692e 7361 7665 2829 6020   `dlapi.save()` 
+000057c0: 646f 6573 206e 6f74 2077 6f72 6b2e 2e2e  does not work...
+000057d0: 0a20 2020 2020 2020 2023 2065 2e67 2e2c  .        # e.g.,
+000057e0: 2064 6174 616c 6164 2073 6176 6520 2d6d   datalad save -m
+000057f0: 2022 5061 7274 6963 6970 616e 7420 636f   "Participant co
+00005800: 6d70 7574 6520 6a6f 6220 696d 706c 656d  mpute job implem
+00005810: 656e 7461 7469 6f6e 220a 0a20 2020 2020  entation"..     
+00005820: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
+00005830: 6865 206c 6973 7420 6f66 2073 7562 6a65  he list of subje
+00005840: 6374 7320 746f 2061 6e61 6c79 7a65 3a20  cts to analyze: 
+00005850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00005860: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+00005870: 2020 2020 2020 7072 696e 7428 225c 6e44        print("\nD
+00005880: 6574 6572 6d69 6e69 6e67 2074 6865 206c  etermining the l
+00005890: 6973 7420 6f66 2073 7562 6a65 6374 7320  ist of subjects 
+000058a0: 2861 6e64 2073 6573 7369 6f6e 7329 2074  (and sessions) t
+000058b0: 6f20 616e 616c 797a 652e 2e2e 2229 0a20  o analyze..."). 
+000058c0: 2020 2020 2020 205f 203d 2067 6574 5f6c         _ = get_l
+000058d0: 6973 745f 7375 625f 7365 7328 696e 7075  ist_sub_ses(inpu
+000058e0: 745f 6473 2c20 636f 6e74 6169 6e65 722e  t_ds, container.
+000058f0: 636f 6e66 6967 2c20 7365 6c66 290a 2020  config, self).  
+00005900: 2020 2020 2020 7365 6c66 2e64 6174 616c        self.datal
+00005910: 6164 5f73 6176 6528 7061 7468 3d22 636f  ad_save(path="co
+00005920: 6465 2f2a 2e63 7376 222c 0a20 2020 2020  de/*.csv",.     
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2020 2020 206d 6573 7361 6765 3d22 5265       message="Re
+00005950: 636f 7264 206f 6620 696e 636c 7573 696f  cord of inclusio
+00005960: 6e2f 6578 636c 7573 696f 6e20 6f66 2070  n/exclusion of p
+00005970: 6172 7469 6369 7061 6e74 7322 290a 0a20  articipants").. 
+00005980: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
+00005990: 6520 7468 6520 7465 6d70 6c61 7465 206f  e the template o
+000059a0: 6620 6a6f 6220 7375 626d 6973 7369 6f6e  f job submission
+000059b0: 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  : --------------
+000059c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000059d0: 2d2d 0a20 2020 2020 2020 2070 7269 6e74  --.        print
+000059e0: 2822 5c6e 4765 6e65 7261 7469 6e67 2061  ("\nGenerating a
+000059f0: 2074 656d 706c 6174 6520 666f 7220 6a6f   template for jo
+00005a00: 6220 7375 626d 6973 7369 6f6e 2063 616c  b submission cal
+00005a10: 6c73 2e2e 2e22 290a 2020 2020 2020 2020  ls...").        
+00005a20: 7072 696e 7428 2254 6865 2074 656d 706c  print("The templ
+00005a30: 6174 6520 7465 7874 2066 696c 6520 7769  ate text file wi
+00005a40: 6c6c 2062 6520 6e61 6d65 6420 6173 2060  ll be named as `
+00005a50: 7375 626d 6974 5f6a 6f62 5f74 656d 706c  submit_job_templ
+00005a60: 6174 652e 7961 6d6c 602e 2229 0a20 2020  ate.yaml`.").   
+00005a70: 2020 2020 2079 616d 6c5f 7061 7468 203d       yaml_path =
+00005a80: 206f 702e 6a6f 696e 2873 656c 662e 616e   op.join(self.an
+00005a90: 616c 7973 6973 5f70 6174 682c 2022 636f  alysis_path, "co
+00005aa0: 6465 222c 2022 7375 626d 6974 5f6a 6f62  de", "submit_job
+00005ab0: 5f74 656d 706c 6174 652e 7961 6d6c 2229  _template.yaml")
+00005ac0: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
+00005ad0: 6572 2e67 656e 6572 6174 655f 6a6f 625f  er.generate_job_
+00005ae0: 7375 626d 6974 5f74 656d 706c 6174 6528  submit_template(
+00005af0: 7961 6d6c 5f70 6174 682c 2073 656c 662c  yaml_path, self,
+00005b00: 2073 7973 7465 6d29 0a0a 2020 2020 2020   system)..      
+00005b10: 2020 2320 616c 736f 2c20 6765 6e65 7261    # also, genera
+00005b20: 7465 2074 656d 706c 6174 6520 666f 7220  te template for 
+00005b30: 7465 7374 696e 6720 6a6f 6220 7573 6564  testing job used
+00005b40: 2062 7920 6062 6162 732d 6368 6563 6b2d   by `babs-check-
+00005b50: 7365 7475 7060 3a0a 2020 2020 2020 2020  setup`:.        
+00005b60: 7961 6d6c 5f74 6573 745f 7061 7468 203d  yaml_test_path =
+00005b70: 206f 702e 6a6f 696e 2873 656c 662e 616e   op.join(self.an
+00005b80: 616c 7973 6973 5f70 6174 682c 2022 636f  alysis_path, "co
+00005b90: 6465 2f63 6865 636b 5f73 6574 7570 222c  de/check_setup",
+00005ba0: 2022 7375 626d 6974 5f74 6573 745f 6a6f   "submit_test_jo
+00005bb0: 625f 7465 6d70 6c61 7465 2e79 616d 6c22  b_template.yaml"
+00005bc0: 290a 2020 2020 2020 2020 636f 6e74 6169  ).        contai
+00005bd0: 6e65 722e 6765 6e65 7261 7465 5f6a 6f62  ner.generate_job
+00005be0: 5f73 7562 6d69 745f 7465 6d70 6c61 7465  _submit_template
+00005bf0: 2879 616d 6c5f 7465 7374 5f70 6174 682c  (yaml_test_path,
+00005c00: 2073 656c 662c 2073 7973 7465 6d2c 2074   self, system, t
+00005c10: 6573 743d 5472 7565 290a 0a20 2020 2020  est=True)..     
+00005c20: 2020 2023 2064 6174 616c 6164 2073 6176     # datalad sav
+00005c30: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+00005c40: 6461 7461 6c61 645f 7361 7665 2870 6174  datalad_save(pat
+00005c50: 683d 5b22 636f 6465 2f73 7562 6d69 745f  h=["code/submit_
+00005c60: 6a6f 625f 7465 6d70 6c61 7465 2e79 616d  job_template.yam
+00005c70: 6c22 2c0a 2020 2020 2020 2020 2020 2020  l",.            
+00005c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c90: 2020 2020 2263 6f64 652f 6368 6563 6b5f      "code/check_
+00005ca0: 7365 7475 702f 7375 626d 6974 5f74 6573  setup/submit_tes
+00005cb0: 745f 6a6f 625f 7465 6d70 6c61 7465 2e79  t_job_template.y
+00005cc0: 616d 6c22 5d2c 0a20 2020 2020 2020 2020  aml"],.         
+00005cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ce0: 206d 6573 7361 6765 3d22 5465 6d70 6c61   message="Templa
+00005cf0: 7465 2066 6f72 206a 6f62 2073 7562 6d69  te for job submi
+00005d00: 7373 696f 6e22 290a 0a20 2020 2020 2020  ssion")..       
+00005d10: 2023 2046 696e 6973 6820 7570 2061 6e64   # Finish up and
+00005d20: 2067 6574 2072 6561 6479 2066 6f72 2063   get ready for c
+00005d30: 6c75 7374 6572 7320 7275 6e6e 696e 673a  lusters running:
+00005d40: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+00005d50: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00005d60: 2023 2063 7265 6174 6520 666f 6c64 6572   # create folder
+00005d70: 2060 6c6f 6773 6020 696e 2060 616e 616c   `logs` in `anal
+00005d80: 7973 6973 603b 2066 7574 7572 6520 6c6f  ysis`; future lo
+00005d90: 6720 6669 6c65 7320 676f 2068 6572 650a  g files go here.
+00005da0: 2020 2020 2020 2020 2320 2020 7468 6973          #   this
+00005db0: 2077 6f6e 2774 2062 6520 7472 6163 6b65   won't be tracke
+00005dc0: 6420 6279 2067 6974 2028 6173 2061 6c72  d by git (as alr
+00005dd0: 6561 6479 2061 6464 6564 2074 6f20 602e  eady added to `.
+00005de0: 6769 7469 676e 6f72 6560 290a 2020 2020  gitignore`).    
+00005df0: 2020 2020 6c6f 675f 7061 7468 203d 206f      log_path = o
+00005e00: 702e 6a6f 696e 2873 656c 662e 616e 616c  p.join(self.anal
+00005e10: 7973 6973 5f70 6174 682c 2022 6c6f 6773  ysis_path, "logs
+00005e20: 2229 0a20 2020 2020 2020 2069 6620 6e6f  ").        if no
+00005e30: 7420 6f70 2e65 7869 7374 7328 6c6f 675f  t op.exists(log_
+00005e40: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00005e50: 2020 206f 732e 6d61 6b65 6469 7273 286c     os.makedirs(l
+00005e60: 6f67 5f70 6174 6829 0a0a 2020 2020 2020  og_path)..      
+00005e70: 2020 2320 696e 2063 6173 6520 616e 7974    # in case anyt
+00005e80: 6869 6e67 2069 6e20 6063 6f64 652f 6020  hing in `code/` 
+00005e90: 7761 7320 6e6f 7420 7361 7665 643a 0a20  was not saved:. 
+00005ea0: 2020 2020 2020 2023 2020 2049 6620 7468         #   If th
+00005eb0: 6572 6520 6973 2061 6e79 7468 696e 6720  ere is anything 
+00005ec0: 6e6f 7420 7361 7665 6420 7965 742c 2070  not saved yet, p
+00005ed0: 726f 6261 626c 7920 7368 6f75 6c64 2062  robably should b
+00005ee0: 6520 6164 6465 6420 746f 2060 2e67 6974  e added to `.git
+00005ef0: 6967 6e6f 7265 600a 2020 2020 2020 2020  ignore`.        
+00005f00: 2320 2020 6174 2074 6865 2062 6567 696e  #   at the begin
+00005f10: 6e69 6e67 206f 6620 6062 6162 732d 696e  ning of `babs-in
+00005f20: 6974 602e 0a20 2020 2020 2020 2073 656c  it`..        sel
+00005f30: 662e 6461 7461 6c61 645f 7361 7665 2870  f.datalad_save(p
+00005f40: 6174 683d 2263 6f64 652f 222c 0a20 2020  ath="code/",.   
+00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f60: 2020 2020 2020 206d 6573 7361 6765 3d22         message="
+00005f70: 5361 7665 2061 6e79 7468 696e 6720 696e  Save anything in
+00005f80: 2066 6f6c 6465 7220 636f 6465 2f20 7468   folder code/ th
+00005f90: 6174 2068 6173 6e27 7420 6265 656e 2073  at hasn't been s
+00005fa0: 6176 6564 2229 0a0a 2020 2020 2020 2020  aved")..        
+00005fb0: 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  # ==============
+00005fc0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005fd0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005fe0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00005ff0: 0a20 2020 2020 2020 2023 2046 696e 616c  .        # Final
+00006000: 2073 7465 7073 2069 6e20 626f 6f74 7374   steps in bootst
+00006010: 7261 7070 696e 673a 0a20 2020 2020 2020  rapping:.       
+00006020: 2023 203d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d   # =============
+00006030: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00006040: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00006050: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00006060: 3d0a 0a20 2020 2020 2020 2070 7269 6e74  =..        print
+00006070: 2822 5c6e 4669 6e61 6c20 7374 6570 732e  ("\nFinal steps.
+00006080: 2e2e 2229 0a20 2020 2020 2020 2023 204e  ..").        # N
+00006090: 6f20 6e65 6564 2074 6f20 6b65 6570 2074  o need to keep t
+000060a0: 6865 2069 6e70 7574 2064 6174 6173 6574  he input dataset
+000060b0: 2873 293a 0a20 2020 2020 2020 2023 2020  (s):.        #  
+000060c0: 206f 6c64 2076 6572 7369 6f6e 3a20 6461   old version: da
+000060d0: 7461 6c61 6420 756e 696e 7374 616c 6c20  talad uninstall 
+000060e0: 2d72 202d 2d6e 6f63 6865 636b 2069 6e70  -r --nocheck inp
+000060f0: 7574 732f 6461 7461 0a20 2020 2020 2020  uts/data.       
+00006100: 2070 7269 6e74 2822 4461 7461 4c61 6420   print("DataLad 
+00006110: 6472 6f70 7069 6e67 2069 6e70 7574 2064  dropping input d
+00006120: 6174 6173 6574 2773 2063 6f6e 7465 6e74  ataset's content
+00006130: 732e 2e2e 2229 0a20 2020 2020 2020 2066  s...").        f
+00006140: 6f72 2069 5f64 7320 696e 2072 616e 6765  or i_ds in range
+00006150: 2830 2c20 696e 7075 745f 6473 2e6e 756d  (0, input_ds.num
+00006160: 5f64 7329 3a0a 2020 2020 2020 2020 2020  _ds):.          
+00006170: 2020 5f20 3d20 7365 6c66 2e61 6e61 6c79    _ = self.analy
+00006180: 7369 735f 6461 7461 6c61 645f 6861 6e64  sis_datalad_hand
+00006190: 6c65 2e64 726f 7028 0a20 2020 2020 2020  le.drop(.       
+000061a0: 2020 2020 2020 2020 2070 6174 683d 696e           path=in
+000061b0: 7075 745f 6473 2e64 665b 2270 6174 685f  put_ds.df["path_
+000061c0: 6e6f 775f 7265 6c22 5d5b 695f 6473 5d2c  now_rel"][i_ds],
+000061d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000061e0: 2072 6563 7572 7369 7665 3d54 7275 652c   recursive=True,
+000061f0: 2020 2023 2061 6e64 2070 6f74 656e 7469     # and potenti
+00006200: 616c 2073 7562 6461 7461 7365 740a 2020  al subdataset.  
+00006210: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00006220: 636b 6c65 7373 3d27 6176 6169 6c61 6269  ckless='availabi
+00006230: 6c69 7479 2729 0a20 2020 2020 2020 2020  lity').         
+00006240: 2020 2023 206e 6f74 2074 6f20 6368 6563     # not to chec
+00006250: 6b20 6176 6169 6c61 6269 6c69 7479 0a20  k availability. 
+00006260: 2020 2020 2020 2020 2020 2023 2073 6565             # see
+00006270: 6d73 2068 6176 6520 746f 2073 7065 6369  ms have to speci
+00006280: 6679 2074 6865 2064 6174 6173 6574 2028  fy the dataset (
+00006290: 6279 2061 626f 7665 2060 6861 6e64 6c65  by above `handle
+000062a0: 6029 3b0a 2020 2020 2020 2020 2020 2020  `);.            
+000062b0: 2320 6f74 6865 7277 6973 652c 2064 6c20  # otherwise, dl 
+000062c0: 7468 696e 6b73 2074 6865 2064 6174 6173  thinks the datas
+000062d0: 6574 2069 7320 7768 6572 6520 6375 7272  et is where curr
+000062e0: 656e 7420 7079 7468 6f6e 2069 7320 7275  ent python is ru
+000062f0: 6e6e 696e 670a 0a20 2020 2020 2020 2023  nning..        #
+00006300: 2055 7064 6174 6520 696e 7075 7420 616e   Update input an
+00006310: 6420 6f75 7470 7574 2052 4941 3a0a 2020  d output RIA:.  
+00006320: 2020 2020 2020 7072 696e 7428 2255 7064        print("Upd
+00006330: 6174 696e 6720 696e 7075 7420 616e 6420  ating input and 
+00006340: 6f75 7470 7574 2052 4941 2e2e 2e22 290a  output RIA...").
+00006350: 2020 2020 2020 2020 2320 2020 6461 7461          #   data
+00006360: 6c61 6420 7075 7368 202d 2d74 6f20 696e  lad push --to in
+00006370: 7075 740a 2020 2020 2020 2020 2320 2020  put.        #   
+00006380: 6461 7461 6c61 6420 7075 7368 202d 2d74  datalad push --t
+00006390: 6f20 6f75 7470 7574 0a20 2020 2020 2020  o output.       
+000063a0: 2073 656c 662e 616e 616c 7973 6973 5f64   self.analysis_d
+000063b0: 6174 616c 6164 5f68 616e 646c 652e 7075  atalad_handle.pu
+000063c0: 7368 2874 6f3d 2269 6e70 7574 2229 0a20  sh(to="input"). 
+000063d0: 2020 2020 2020 2073 656c 662e 616e 616c         self.anal
+000063e0: 7973 6973 5f64 6174 616c 6164 5f68 616e  ysis_datalad_han
+000063f0: 646c 652e 7075 7368 2874 6f3d 226f 7574  dle.push(to="out
+00006400: 7075 7422 290a 0a20 2020 2020 2020 2023  put")..        #
+00006410: 2041 6464 2061 6e20 616c 6961 7320 746f   Add an alias to
+00006420: 2074 6865 2064 6174 6120 696e 206f 7574   the data in out
+00006430: 7075 7420 5249 4120 7374 6f72 653a 0a20  put RIA store:. 
+00006440: 2020 2020 2020 2070 7269 6e74 2822 4164         print("Ad
+00006450: 6469 6e67 2061 6e20 616c 6961 7320 2764  ding an alias 'd
+00006460: 6174 6127 2074 6f20 6f75 7470 7574 2052  ata' to output R
+00006470: 4941 2073 746f 7265 2e2e 2e22 290a 2020  IA store...").  
+00006480: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00006490: 2020 5249 415f 4449 523d 2428 6669 6e64    RIA_DIR=$(find
+000064a0: 2024 5052 4f4a 4543 5452 4f4f 542f 6f75   $PROJECTROOT/ou
+000064b0: 7470 7574 5f72 6961 2f3f 3f3f 2f20 2d6d  tput_ria/???/ -m
+000064c0: 6178 6465 7074 6820 3120 2d74 7970 6520  axdepth 1 -type 
+000064d0: 6420 7c20 736f 7274 207c 2074 6169 6c20  d | sort | tail 
+000064e0: 2d6e 2031 290a 2020 2020 2020 2020 6d6b  -n 1).        mk
+000064f0: 6469 7220 2d70 2024 7b50 524f 4a45 4354  dir -p ${PROJECT
+00006500: 524f 4f54 7d2f 6f75 7470 7574 5f72 6961  ROOT}/output_ria
+00006510: 2f61 6c69 6173 0a20 2020 2020 2020 206c  /alias.        l
+00006520: 6e20 2d73 2024 7b52 4941 5f44 4952 7d20  n -s ${RIA_DIR} 
+00006530: 247b 5052 4f4a 4543 5452 4f4f 547d 2f6f  ${PROJECTROOT}/o
+00006540: 7574 7075 745f 7269 612f 616c 6961 732f  utput_ria/alias/
+00006550: 6461 7461 0a20 2020 2020 2020 2022 2222  data.        """
+00006560: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00006570: 6f70 2e65 7869 7374 7328 6f70 2e6a 6f69  op.exists(op.joi
+00006580: 6e28 7365 6c66 2e6f 7574 7075 745f 7269  n(self.output_ri
+00006590: 615f 7061 7468 2c0a 2020 2020 2020 2020  a_path,.        
+000065a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065b0: 2020 2020 2020 2020 2022 616c 6961 7322           "alias"
+000065c0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000065d0: 6f73 2e6d 616b 6564 6972 7328 6f70 2e6a  os.makedirs(op.j
+000065e0: 6f69 6e28 7365 6c66 2e6f 7574 7075 745f  oin(self.output_
+000065f0: 7269 615f 7061 7468 2c0a 2020 2020 2020  ria_path,.      
+00006600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006610: 2020 2020 2020 2020 2020 2261 6c69 6173            "alias
+00006620: 2229 290a 2020 2020 2020 2020 2320 6372  ")).        # cr
+00006630: 6561 7465 2061 2073 796d 626f 6c69 6320  eate a symbolic 
+00006640: 6c69 6e6b 3a0a 2020 2020 2020 2020 7468  link:.        th
+00006650: 655f 7379 6d6c 696e 6b20 3d20 6f70 2e6a  e_symlink = op.j
+00006660: 6f69 6e28 7365 6c66 2e6f 7574 7075 745f  oin(self.output_
+00006670: 7269 615f 7061 7468 2c0a 2020 2020 2020  ria_path,.      
+00006680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006690: 2020 2020 2020 2020 2261 6c69 6173 222c          "alias",
+000066a0: 2022 6461 7461 2229 0a20 2020 2020 2020   "data").       
+000066b0: 2069 6620 6f70 2e65 7869 7374 7328 7468   if op.exists(th
+000066c0: 655f 7379 6d6c 696e 6b29 2026 206f 702e  e_symlink) & op.
+000066d0: 6973 6c69 6e6b 2874 6865 5f73 796d 6c69  islink(the_symli
+000066e0: 6e6b 293a 0a20 2020 2020 2020 2020 2020  nk):.           
+000066f0: 2023 2065 7869 7374 7320 616e 6420 6973   # exists and is
+00006700: 2061 2073 796d 6c69 6e6b 3a20 7265 6d6f   a symlink: remo
+00006710: 7665 2066 6972 7374 0a20 2020 2020 2020  ve first.       
+00006720: 2020 2020 206f 732e 7265 6d6f 7665 2874       os.remove(t
+00006730: 6865 5f73 796d 6c69 6e6b 290a 2020 2020  he_symlink).    
+00006740: 2020 2020 6f73 2e73 796d 6c69 6e6b 2873      os.symlink(s
+00006750: 656c 662e 6f75 7470 7574 5f72 6961 5f64  elf.output_ria_d
+00006760: 6174 615f 6469 722c 0a20 2020 2020 2020  ata_dir,.       
+00006770: 2020 2020 2020 2020 2020 2020 7468 655f              the_
+00006780: 7379 6d6c 696e 6b29 0a20 2020 2020 2020  symlink).       
+00006790: 2023 2074 6f20 6368 6563 6b20 7468 6973   # to check this
+000067a0: 2073 796d 626f 6c69 6320 6c69 6e6b 2c20   symbolic link, 
+000067b0: 6a75 7374 3a20 2420 6c73 202d 6c20 3c6f  just: $ ls -l <o
+000067c0: 7574 7075 745f 7269 612f 616c 6961 732f  utput_ria/alias/
+000067d0: 6461 7461 3e0a 2020 2020 2020 2020 2320  data>.        # 
+000067e0: 2020 6974 2073 686f 756c 6420 706f 696e    it should poin
+000067f0: 7420 746f 202f 6675 6c6c 2f70 6174 682f  t to /full/path/
+00006800: 6f75 7470 7574 5f72 6961 2f78 7878 2f78  output_ria/xxx/x
+00006810: 7878 2d78 7878 2d78 7878 2d78 7878 0a0a  xx-xxx-xxx-xxx..
+00006820: 2020 2020 2020 2020 2320 5355 4343 4553          # SUCCES
+00006830: 5321 0a20 2020 2020 2020 2070 7269 6e74  S!.        print
+00006840: 2822 5c6e 2229 0a20 2020 2020 2020 2070  ("\n").        p
+00006850: 7269 6e74 2822 4241 4253 2070 726f 6a65  rint("BABS proje
+00006860: 6374 2068 6173 2062 6565 6e20 696e 6974  ct has been init
+00006870: 6961 6c69 7a65 6421 220a 2020 2020 2020  ialized!".      
+00006880: 2020 2020 2020 2020 2220 5061 7468 2074          " Path t
+00006890: 6f20 7468 6973 2042 4142 5320 7072 6f6a  o this BABS proj
+000068a0: 6563 743a 2027 2220 2b20 7365 6c66 2e70  ect: '" + self.p
+000068b0: 726f 6a65 6374 5f72 6f6f 7420 2b20 2227  roject_root + "'
+000068c0: 2229 0a20 2020 2020 2020 2070 7269 6e74  ").        print
+000068d0: 2822 6062 6162 732d 696e 6974 6020 7761  ("`babs-init` wa
+000068e0: 7320 7375 6363 6573 7366 756c 2122 290a  s successful!").
+000068f0: 0a20 2020 2064 6566 2063 6c65 616e 5f75  .    def clean_u
+00006900: 7028 7365 6c66 2c20 696e 7075 745f 6473  p(self, input_ds
+00006910: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00006920: 2020 2020 2020 2049 6620 6062 6162 732d         If `babs-
+00006930: 696e 6974 6020 6661 696c 6564 2c20 7468  init` failed, th
+00006940: 6973 2066 756e 6374 696f 6e20 636c 6561  is function clea
+00006950: 6e73 2075 7020 7468 6520 4241 4253 2070  ns up the BABS p
+00006960: 726f 6a65 6374 2060 6261 6273 2d69 6e69  roject `babs-ini
+00006970: 7460 2063 7265 6174 6573 2e0a 0a20 2020  t` creates...   
+00006980: 2020 2020 2050 6172 616d 6574 6572 733a       Parameters:
+00006990: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000069a0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000069b0: 696e 7075 745f 6473 3a20 636c 6173 7320  input_ds: class 
+000069c0: 6049 6e70 7574 5f64 7360 0a20 2020 2020  `Input_ds`.     
+000069d0: 2020 2020 2020 2069 6e66 6f72 6d61 7469         informati
+000069e0: 6f6e 206f 6620 696e 7075 7420 6461 7461  on of input data
+000069f0: 7365 7428 7329 0a0a 2020 2020 2020 2020  set(s)..        
+00006a00: 4e6f 7465 733a 0a20 2020 2020 2020 202d  Notes:.        -
+00006a10: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00006a20: 5374 6570 7320 696e 2060 6261 6273 2d69  Steps in `babs-i
+00006a30: 6e69 7460 3a0a 2020 2020 2020 2020 2a20  nit`:.        * 
+00006a40: 6372 6561 7465 2060 616e 616c 7973 6973  create `analysis
+00006a50: 6020 6461 7461 6c61 6420 6461 7461 7365  ` datalad datase
+00006a60: 740a 2020 2020 2020 2020 2a20 6372 6561  t.        * crea
+00006a70: 7465 2069 6e70 7574 2061 6e64 206f 7574  te input and out
+00006a80: 7075 7420 5249 410a 2020 2020 2020 2020  put RIA.        
+00006a90: 2a20 636c 6f6e 6520 696e 7075 7420 6461  * clone input da
+00006aa0: 7461 7365 7428 7329 0a20 2020 2020 2020  taset(s).       
+00006ab0: 202a 2067 656e 6572 6174 6520 626f 6f74   * generate boot
+00006ac0: 7374 7261 7070 6564 2073 6372 6970 7473  strapped scripts
+00006ad0: 0a20 2020 2020 2020 202a 2066 696e 6973  .        * finis
+00006ae0: 6820 7570 0a20 2020 2020 2020 2022 2222  h up.        """
+00006af0: 0a20 2020 2020 2020 2069 6620 6f70 2e65  .        if op.e
+00006b00: 7869 7374 7328 7365 6c66 2e70 726f 6a65  xists(self.proje
+00006b10: 6374 5f72 6f6f 7429 3a20 2020 2320 6966  ct_root):   # if
+00006b20: 2042 4142 5320 7072 6f6a 6563 7420 726f   BABS project ro
+00006b30: 6f74 2066 6f6c 6465 7220 6861 7320 6265  ot folder has be
+00006b40: 656e 2063 7265 6174 6564 3a0a 2020 2020  en created:.    
+00006b50: 2020 2020 2020 2020 6966 206f 702e 6578          if op.ex
+00006b60: 6973 7473 2873 656c 662e 616e 616c 7973  ists(self.analys
+00006b70: 6973 5f70 6174 6829 3a20 2020 2320 616e  is_path):   # an
+00006b80: 616c 7973 6973 2066 6f6c 6465 7220 6973  alysis folder is
+00006b90: 2063 7265 6174 6564 2062 7920 6461 7461   created by data
+00006ba0: 6c61 6420 0a20 2020 2020 2020 2020 2020  lad .           
+00006bb0: 2020 2020 2073 656c 662e 616e 616c 7973       self.analys
+00006bc0: 6973 5f64 6174 616c 6164 5f68 616e 646c  is_datalad_handl
+00006bd0: 6520 3d20 646c 6170 692e 4461 7461 7365  e = dlapi.Datase
+00006be0: 7428 7365 6c66 2e61 6e61 6c79 7369 735f  t(self.analysis_
+00006bf0: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+00006c00: 2020 2020 2020 2320 5265 6d6f 7665 2065        # Remove e
+00006c10: 6163 6820 696e 7075 7420 6461 7461 7365  ach input datase
+00006c20: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00006c30: 2020 2070 7269 6e74 2822 5265 6d6f 7669     print("Removi
+00006c40: 6e67 2069 6e70 7574 2064 6174 6173 6574  ng input dataset
+00006c50: 2873 2920 6966 2063 6c6f 6e65 642e 2e2e  (s) if cloned...
+00006c60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00006c70: 2020 2066 6f72 2069 5f64 7320 696e 2072     for i_ds in r
+00006c80: 616e 6765 2830 2c20 696e 7075 745f 6473  ange(0, input_ds
+00006c90: 2e6e 756d 5f64 7329 3a0a 2020 2020 2020  .num_ds):.      
+00006ca0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00006cb0: 6368 6563 6b20 6966 2069 7420 6578 6973  check if it exis
+00006cc0: 7473 2079 6574 3a0a 2020 2020 2020 2020  ts yet:.        
+00006cd0: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00006ce0: 5f6e 6f77 5f61 6273 203d 206f 702e 6a6f  _now_abs = op.jo
+00006cf0: 696e 2873 656c 662e 616e 616c 7973 6973  in(self.analysis
+00006d00: 5f70 6174 682c 2069 6e70 7574 5f64 732e  _path, input_ds.
+00006d10: 6466 5b22 7061 7468 5f6e 6f77 5f72 656c  df["path_now_rel
+00006d20: 225d 5b69 5f64 735d 290a 2020 2020 2020  "][i_ds]).      
+00006d30: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006d40: 206f 702e 6578 6973 7473 2870 6174 685f   op.exists(path_
+00006d50: 6e6f 775f 6162 7329 3a20 2020 2320 7468  now_abs):   # th
+00006d60: 6973 2069 6e70 7574 2064 6174 6173 6574  is input dataset
+00006d70: 2068 6173 2062 6565 6e20 636c 6f6e 6564   has been cloned
+00006d80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006d90: 2020 2020 2020 2020 2020 2320 7573 6520            # use 
+00006da0: 6064 6174 616c 6164 2072 656d 6f76 6560  `datalad remove`
+00006db0: 2074 6f20 7265 6d6f 7665 3a0a 2020 2020   to remove:.    
+00006dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006dd0: 2020 2020 5f20 3d20 7365 6c66 2e61 6e61      _ = self.ana
+00006de0: 6c79 7369 735f 6461 7461 6c61 645f 6861  lysis_datalad_ha
+00006df0: 6e64 6c65 2e72 656d 6f76 6528 0a20 2020  ndle.remove(.   
 00006e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e10: 2020 2020 2020 2020 2020 2020 7265 636b              reck
-00006e20: 6c65 7373 3d22 6d6f 6469 6669 6361 7469  less="modificati
-00006e30: 6f6e 2229 0a0a 2020 2020 2020 2020 2020  on")..          
-00006e40: 2020 2020 2020 2320 6067 6974 2061 6e6e        # `git ann
-00006e50: 6578 2064 6561 6420 6865 7265 603a 0a20  ex dead here`:. 
-00006e60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006e70: 7269 6e74 2822 5c6e 5275 6e6e 696e 6720  rint("\nRunning 
-00006e80: 6067 6974 2061 6e6e 6578 2064 6561 6420  `git annex dead 
-00006e90: 6865 7265 602e 2e2e 2229 0a20 2020 2020  here`...").     
-00006ea0: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
-00006eb0: 6769 745f 616e 6e65 785f 6465 6164 203d  git_annex_dead =
-00006ec0: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
-00006ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006ee0: 2020 2020 205b 2267 6974 222c 2022 616e       ["git", "an
-00006ef0: 6e65 7822 2c20 2264 6561 6422 2c20 2268  nex", "dead", "h
-00006f00: 6572 6522 5d2c 0a20 2020 2020 2020 2020  ere"],.         
-00006f10: 2020 2020 2020 2020 2020 2063 7764 3d73             cwd=s
-00006f20: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
-00006f30: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
-00006f40: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
-00006f50: 6270 726f 6365 7373 2e50 4950 4529 0a20  bprocess.PIPE). 
-00006f60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006f70: 726f 635f 6769 745f 616e 6e65 785f 6465  roc_git_annex_de
-00006f80: 6164 2e63 6865 636b 5f72 6574 7572 6e63  ad.check_returnc
-00006f90: 6f64 6528 290a 0a20 2020 2020 2020 2020  ode()..         
-00006fa0: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
-00006fb0: 696e 7075 7420 616e 6420 6f75 7470 7574  input and output
-00006fc0: 2052 4941 3a0a 2020 2020 2020 2020 2020   RIA:.          
-00006fd0: 2020 2020 2020 7072 696e 7428 225c 6e55        print("\nU
-00006fe0: 7064 6174 696e 6720 696e 7075 7420 616e  pdating input an
-00006ff0: 6420 6f75 7470 7574 2052 4941 2069 6620  d output RIA if 
-00007000: 6372 6561 7465 642e 2e2e 2229 0a20 2020  created...").   
-00007010: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00007020: 2064 6174 616c 6164 2070 7573 6820 2d2d   datalad push --
-00007030: 746f 2069 6e70 7574 0a20 2020 2020 2020  to input.       
+00006e10: 2020 2020 2020 2020 2070 6174 683d 7061           path=pa
+00006e20: 7468 5f6e 6f77 5f61 6273 2c0a 2020 2020  th_now_abs,.    
+00006e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e40: 2020 2020 2020 2020 7265 636b 6c65 7373          reckless
+00006e50: 3d22 6d6f 6469 6669 6361 7469 6f6e 2229  ="modification")
+00006e60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006e70: 2020 2320 6067 6974 2061 6e6e 6578 2064    # `git annex d
+00006e80: 6561 6420 6865 7265 603a 0a20 2020 2020  ead here`:.     
+00006e90: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00006ea0: 2822 5c6e 5275 6e6e 696e 6720 6067 6974  ("\nRunning `git
+00006eb0: 2061 6e6e 6578 2064 6561 6420 6865 7265   annex dead here
+00006ec0: 602e 2e2e 2229 0a20 2020 2020 2020 2020  `...").         
+00006ed0: 2020 2020 2020 2070 726f 635f 6769 745f         proc_git_
+00006ee0: 616e 6e65 785f 6465 6164 203d 2073 7562  annex_dead = sub
+00006ef0: 7072 6f63 6573 732e 7275 6e28 0a20 2020  process.run(.   
+00006f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f10: 205b 2267 6974 222c 2022 616e 6e65 7822   ["git", "annex"
+00006f20: 2c20 2264 6561 6422 2c20 2268 6572 6522  , "dead", "here"
+00006f30: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00006f40: 2020 2020 2020 2063 7764 3d73 656c 662e         cwd=self.
+00006f50: 616e 616c 7973 6973 5f70 6174 682c 0a20  analysis_path,. 
+00006f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f70: 2020 2073 7464 6f75 743d 7375 6270 726f     stdout=subpro
+00006f80: 6365 7373 2e50 4950 4529 0a20 2020 2020  cess.PIPE).     
+00006f90: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
+00006fa0: 6769 745f 616e 6e65 785f 6465 6164 2e63  git_annex_dead.c
+00006fb0: 6865 636b 5f72 6574 7572 6e63 6f64 6528  heck_returncode(
+00006fc0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00006fd0: 2020 2023 2055 7064 6174 6520 696e 7075     # Update inpu
+00006fe0: 7420 616e 6420 6f75 7470 7574 2052 4941  t and output RIA
+00006ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007000: 2020 7072 696e 7428 225c 6e55 7064 6174    print("\nUpdat
+00007010: 696e 6720 696e 7075 7420 616e 6420 6f75  ing input and ou
+00007020: 7470 7574 2052 4941 2069 6620 6372 6561  tput RIA if crea
+00007030: 7465 642e 2e2e 2229 0a20 2020 2020 2020  ted...").       
 00007040: 2020 2020 2020 2020 2023 2020 2064 6174           #   dat
-00007050: 616c 6164 2070 7573 6820 2d2d 746f 206f  alad push --to o
-00007060: 7574 7075 740a 2020 2020 2020 2020 2020  utput.          
-00007070: 2020 2020 2020 6966 206f 702e 6578 6973        if op.exis
-00007080: 7473 2873 656c 662e 696e 7075 745f 7269  ts(self.input_ri
-00007090: 615f 7061 7468 293a 0a20 2020 2020 2020  a_path):.       
-000070a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000070b0: 662e 616e 616c 7973 6973 5f64 6174 616c  f.analysis_datal
-000070c0: 6164 5f68 616e 646c 652e 7075 7368 2874  ad_handle.push(t
-000070d0: 6f3d 2269 6e70 7574 2229 0a20 2020 2020  o="input").     
-000070e0: 2020 2020 2020 2020 2020 2069 6620 6f70             if op
-000070f0: 2e65 7869 7374 7328 7365 6c66 2e6f 7574  .exists(self.out
-00007100: 7075 745f 7269 615f 7061 7468 293a 0a20  put_ria_path):. 
-00007110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007120: 2020 2073 656c 662e 616e 616c 7973 6973     self.analysis
-00007130: 5f64 6174 616c 6164 5f68 616e 646c 652e  _datalad_handle.
-00007140: 7075 7368 2874 6f3d 226f 7574 7075 7422  push(to="output"
-00007150: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00007160: 204e 6f77 2077 6520 6361 6e20 6465 6c65   Now we can dele
-00007170: 7465 2074 6869 7320 7072 6f6a 6563 7420  te this project 
-00007180: 666f 6c64 6572 3a0a 2020 2020 2020 2020  folder:.        
-00007190: 2020 2020 7072 696e 7428 225c 6e44 656c      print("\nDel
-000071a0: 6574 696e 6720 6372 6561 7465 6420 4241  eting created BA
-000071b0: 4253 2070 726f 6a65 6374 2066 6f6c 6465  BS project folde
-000071c0: 722e 2e2e 2229 0a20 2020 2020 2020 2020  r...").         
-000071d0: 2020 2070 726f 635f 726d 5f70 726f 6a65     proc_rm_proje
-000071e0: 6374 5f66 6f6c 6465 7220 3d20 7375 6270  ct_folder = subp
-000071f0: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
-00007200: 2020 2020 2020 2020 2020 2020 5b22 726d              ["rm
-00007210: 222c 2022 2d72 6622 2c20 7365 6c66 2e70  ", "-rf", self.p
-00007220: 726f 6a65 6374 5f72 6f6f 745d 2c0a 2020  roject_root],.  
-00007230: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00007240: 646f 7574 3d73 7562 7072 6f63 6573 732e  dout=subprocess.
-00007250: 5049 5045 290a 2020 2020 2020 2020 2020  PIPE).          
-00007260: 2020 7072 6f63 5f72 6d5f 7072 6f6a 6563    proc_rm_projec
-00007270: 745f 666f 6c64 6572 2e63 6865 636b 5f72  t_folder.check_r
-00007280: 6574 7572 6e63 6f64 6528 290a 0a20 2020  eturncode()..   
-00007290: 2020 2020 2023 2063 6f6e 6669 726d 2074       # confirm t
-000072a0: 6865 2042 4142 5320 7072 6f6a 6563 7420  he BABS project 
-000072b0: 6861 7320 6265 656e 2072 656d 6f76 6564  has been removed
-000072c0: 3a0a 2020 2020 2020 2020 6173 7365 7274  :.        assert
-000072d0: 2028 6e6f 7420 6f70 2e65 7869 7374 7328   (not op.exists(
-000072e0: 7365 6c66 2e70 726f 6a65 6374 5f72 6f6f  self.project_roo
-000072f0: 7429 292c 205c 0a20 2020 2020 2020 2020  t)), \.         
-00007300: 2020 2022 4372 6561 7465 6420 4241 4253     "Created BABS
-00007310: 2070 726f 6a65 6374 2077 6173 206e 6f74   project was not
-00007320: 2063 6f6d 706c 6574 656c 7920 6465 6c65   completely dele
-00007330: 7465 6421 2220 5c0a 2020 2020 2020 2020  ted!" \.        
-00007340: 2020 2020 2b20 2220 5061 7468 2074 6f20      + " Path to 
-00007350: 6372 6561 7465 6420 4241 4253 2070 726f  created BABS pro
-00007360: 6a65 6374 3a20 2722 202b 2073 656c 662e  ject: '" + self.
-00007370: 7072 6f6a 6563 745f 726f 6f74 202b 2022  project_root + "
-00007380: 2722 0a0a 2020 2020 2020 2020 7072 696e  '"..        prin
-00007390: 7428 225c 6e43 7265 6174 6564 2042 4142  t("\nCreated BAB
-000073a0: 5320 7072 6f6a 6563 7420 6861 7320 6265  S project has be
-000073b0: 656e 2063 6c65 616e 6564 2075 702e 2229  en cleaned up.")
-000073c0: 0a0a 2020 2020 6465 6620 6261 6273 5f63  ..    def babs_c
-000073d0: 6865 636b 5f73 6574 7570 2873 656c 662c  heck_setup(self,
-000073e0: 2069 6e70 7574 5f64 732c 2066 6c61 675f   input_ds, flag_
-000073f0: 6a6f 625f 7465 7374 293a 0a20 2020 2020  job_test):.     
-00007400: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-00007410: 6869 7320 6675 6e63 7469 6f6e 2076 616c  his function val
-00007420: 6964 6174 6573 2074 6865 2073 6574 7570  idates the setup
-00007430: 7320 6279 2062 6162 732d 696e 6974 2e0a  s by babs-init..
-00007440: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00007450: 6572 733a 0a20 2020 2020 2020 202d 2d2d  ers:.        ---
-00007460: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00007470: 2020 2020 696e 7075 745f 6473 3a20 636c      input_ds: cl
-00007480: 6173 7320 6049 6e70 7574 5f64 7360 0a20  ass `Input_ds`. 
-00007490: 2020 2020 2020 2020 2020 2069 6e66 6f72             infor
-000074a0: 6d61 7469 6f6e 206f 6620 696e 7075 7420  mation of input 
-000074b0: 6461 7461 7365 7428 7329 0a20 2020 2020  dataset(s).     
-000074c0: 2020 2066 6c61 675f 6a6f 625f 7465 7374     flag_job_test
-000074d0: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-000074e0: 2020 2057 6865 7468 6572 2074 6f20 7375     Whether to su
-000074f0: 626d 6974 2061 6e64 2072 756e 2061 2074  bmit and run a t
-00007500: 6573 7420 6a6f 622e 0a20 2020 2020 2020  est job..       
-00007510: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00007520: 6d20 2e63 6f6e 7374 616e 7473 2069 6d70  m .constants imp
-00007530: 6f72 7420 4348 4543 4b5f 4d41 524b 0a0a  ort CHECK_MARK..
-00007540: 2020 2020 2020 2020 6261 6273 5f70 726f          babs_pro
-00007550: 6a5f 636f 6e66 6967 203d 2072 6561 645f  j_config = read_
-00007560: 7961 6d6c 2873 656c 662e 636f 6e66 6967  yaml(self.config
-00007570: 5f70 6174 682c 2069 665f 6669 6c65 6c6f  _path, if_filelo
-00007580: 636b 3d54 7275 6529 0a0a 2020 2020 2020  ck=True)..      
-00007590: 2020 7072 696e 7428 2257 696c 6c20 6368    print("Will ch
-000075a0: 6563 6b20 7365 7475 7073 206f 6620 4241  eck setups of BA
-000075b0: 4253 2070 726f 6a65 6374 206c 6f63 6174  BS project locat
-000075c0: 6564 2061 743a 2022 202b 2073 656c 662e  ed at: " + self.
-000075d0: 7072 6f6a 6563 745f 726f 6f74 290a 2020  project_root).  
-000075e0: 2020 2020 2020 6966 2066 6c61 675f 6a6f        if flag_jo
-000075f0: 625f 7465 7374 3a0a 2020 2020 2020 2020  b_test:.        
-00007600: 2020 2020 7072 696e 7428 2257 696c 6c20      print("Will 
-00007610: 7375 626d 6974 2061 2074 6573 7420 6a6f  submit a test jo
-00007620: 6220 666f 7220 7465 7374 696e 673b 2077  b for testing; w
-00007630: 696c 6c20 7461 6b65 206c 6f6e 6765 7220  ill take longer 
-00007640: 7469 6d65 2e22 290a 2020 2020 2020 2020  time.").        
-00007650: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00007660: 2020 7072 696e 7428 2244 6964 206e 6f74    print("Did not
-00007670: 2072 6571 7565 7374 2060 2d2d 6a6f 622d   request `--job-
-00007680: 7465 7374 603b 2077 696c 6c20 6e6f 7420  test`; will not 
-00007690: 7375 626d 6974 2061 2074 6573 7420 6a6f  submit a test jo
-000076a0: 622e 2229 0a0a 2020 2020 2020 2020 2320  b.")..        # 
-000076b0: 5072 696e 7420 6f75 7420 7468 6520 7361  Print out the sa
-000076c0: 7665 6420 636f 6e66 6967 7572 6174 696f  ved configuratio
-000076d0: 6e20 696e 666f 3a20 2d2d 2d2d 2d2d 2d2d  n info: --------
-000076e0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-000076f0: 2070 7269 6e74 2822 4265 6c6f 7720 6973   print("Below is
-00007700: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00007710: 6f6e 2069 6e66 6f72 6d61 7469 6f6e 2073  on information s
-00007720: 6176 6564 2064 7572 696e 6720 6062 6162  aved during `bab
-00007730: 732d 696e 6974 6022 0a20 2020 2020 2020  s-init`".       
-00007740: 2020 2020 2020 202b 2022 2069 6e20 6669         + " in fi
-00007750: 6c65 2027 616e 616c 7973 6973 2f63 6f64  le 'analysis/cod
-00007760: 652f 6261 6273 5f70 726f 6a5f 636f 6e66  e/babs_proj_conf
-00007770: 6967 2e79 616d 6c27 3a5c 6e22 290a 2020  ig.yaml':\n").  
-00007780: 2020 2020 2020 6620 3d20 6f70 656e 286f        f = open(o
-00007790: 702e 6a6f 696e 2873 656c 662e 616e 616c  p.join(self.anal
-000077a0: 7973 6973 5f70 6174 682c 2022 636f 6465  ysis_path, "code
-000077b0: 2f62 6162 735f 7072 6f6a 5f63 6f6e 6669  /babs_proj_confi
-000077c0: 672e 7961 6d6c 2229 2c20 2772 2729 0a20  g.yaml"), 'r'). 
-000077d0: 2020 2020 2020 2066 696c 655f 636f 6e74         file_cont
-000077e0: 656e 7473 203d 2066 2e72 6561 6428 290a  ents = f.read().
-000077f0: 2020 2020 2020 2020 7072 696e 7428 6669          print(fi
-00007800: 6c65 5f63 6f6e 7465 6e74 7329 0a20 2020  le_contents).   
-00007810: 2020 2020 2066 2e63 6c6f 7365 2829 0a0a       f.close()..
-00007820: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-00007830: 7468 6520 7072 6f6a 6563 7420 6974 7365  the project itse
-00007840: 6c66 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  lf: ------------
-00007850: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00007860: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
-00007870: 6865 636b 696e 6720 7468 6520 4241 4253  hecking the BABS
-00007880: 2070 726f 6a65 6374 2069 7473 656c 662e   project itself.
-00007890: 2e2e 2229 0a20 2020 2020 2020 2023 2063  ..").        # c
-000078a0: 6865 636b 2069 6620 6061 6e61 6c79 7369  heck if `analysi
-000078b0: 735f 7061 7468 6020 6578 6973 7473 0a20  s_path` exists. 
-000078c0: 2020 2020 2020 2023 2020 2028 5e5e 2074         #   (^^ t
-000078d0: 686f 7567 6820 7368 6f75 6c64 2062 6520  hough should be 
-000078e0: 6368 6563 6b65 6420 696e 2060 6765 745f  checked in `get_
-000078f0: 6578 6973 7469 6e67 5f62 6162 735f 7072  existing_babs_pr
-00007900: 6f6a 2829 6020 696e 2063 6c69 2e70 7929  oj()` in cli.py)
-00007910: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00007920: 6f70 2e65 7869 7374 7328 7365 6c66 2e61  op.exists(self.a
-00007930: 6e61 6c79 7369 735f 7061 7468 292c 205c  nalysis_path), \
-00007940: 0a20 2020 2020 2020 2020 2020 2022 466f  .            "Fo
-00007950: 6c64 6572 2027 616e 616c 7973 6973 2720  lder 'analysis' 
-00007960: 646f 6573 206e 6f74 2065 7869 7374 2069  does not exist i
-00007970: 6e20 7468 6973 2042 4142 5320 7072 6f6a  n this BABS proj
-00007980: 6563 7421 2220 5c0a 2020 2020 2020 2020  ect!" \.        
-00007990: 2020 2020 2b20 2220 4375 7272 656e 7420      + " Current 
-000079a0: 7061 7468 2074 6f20 616e 616c 7973 6973  path to analysis
-000079b0: 2066 6f6c 6465 723a 2022 202b 2073 656c   folder: " + sel
-000079c0: 662e 616e 616c 7973 6973 5f70 6174 680a  f.analysis_path.
-000079d0: 2020 2020 2020 2020 2320 6966 2074 6865          # if the
-000079e0: 7265 2069 7320 6061 6e61 6c79 7369 7360  re is `analysis`
-000079f0: 3a0a 2020 2020 2020 2020 2320 7570 6461  :.        # upda
-00007a00: 7465 2060 616e 616c 7973 6973 5f64 6174  te `analysis_dat
-00007a10: 616c 6164 5f68 616e 646c 6560 3a0a 2020  alad_handle`:.  
-00007a20: 2020 2020 2020 6966 2073 656c 662e 616e        if self.an
-00007a30: 616c 7973 6973 5f64 6174 616c 6164 5f68  alysis_datalad_h
-00007a40: 616e 646c 6520 6973 204e 6f6e 653a 0a20  andle is None:. 
-00007a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007a60: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
-00007a70: 5f68 616e 646c 6520 3d20 646c 6170 692e  _handle = dlapi.
-00007a80: 4461 7461 7365 7428 7365 6c66 2e61 6e61  Dataset(self.ana
-00007a90: 6c79 7369 735f 7061 7468 290a 2020 2020  lysis_path).    
-00007aa0: 2020 2020 7072 696e 7428 4348 4543 4b5f      print(CHECK_
-00007ab0: 4d41 524b 202b 2022 2041 6c6c 2067 6f6f  MARK + " All goo
-00007ac0: 6421 2229 0a0a 2020 2020 2020 2020 2320  d!")..        # 
-00007ad0: 4368 6563 6b20 6061 6e61 6c79 7369 7360  Check `analysis`
-00007ae0: 2064 6174 616c 6164 2064 6174 6173 6574   datalad dataset
-00007af0: 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  : --------------
-00007b00: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00007b10: 2070 7269 6e74 2822 5c6e 4368 6563 6b20   print("\nCheck 
-00007b20: 7374 6174 7573 206f 6620 2761 6e61 6c79  status of 'analy
-00007b30: 7369 7327 2044 6174 614c 6164 2064 6174  sis' DataLad dat
-00007b40: 6173 6574 2e2e 2e22 290a 2020 2020 2020  aset...").      
-00007b50: 2020 2320 4172 6520 7468 6572 6520 616e    # Are there an
-00007b60: 7974 6869 6e67 2075 6e73 6176 6564 3f20  ything unsaved? 
-00007b70: 7265 663a 2043 7542 4944 5320 6675 6e63  ref: CuBIDS func
-00007b80: 7469 6f6e 0a20 2020 2020 2020 2061 6e61  tion.        ana
-00007b90: 6c79 7369 735f 7374 6174 7573 6573 203d  lysis_statuses =
-00007ba0: 2073 6574 285b 7374 6174 7573 5b27 7374   set([status['st
-00007bb0: 6174 6527 5d20 666f 7220 7374 6174 7573  ate'] for status
-00007bc0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-00007bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007be0: 2020 2020 7365 6c66 2e61 6e61 6c79 7369      self.analysi
-00007bf0: 735f 6461 7461 6c61 645f 6861 6e64 6c65  s_datalad_handle
-00007c00: 2e73 7461 7475 7328 0a20 2020 2020 2020  .status(.       
-00007c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c20: 2020 2020 2020 2020 2020 2020 2065 7661               eva
-00007c30: 6c5f 7375 6264 6174 6173 6574 5f73 7461  l_subdataset_sta
-00007c40: 7465 3d27 636f 6d6d 6974 270a 2020 2020  te='commit'.    
-00007c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c70: 2320 6e6f 7420 746f 2066 756c 6c79 2065  # not to fully e
-00007c80: 7661 6c20 7375 6264 6174 6173 6574 2028  val subdataset (
-00007c90: 652e 672e 2069 6e70 7574 2064 7329 2073  e.g. input ds) s
-00007ca0: 7461 7475 730a 2020 2020 2020 2020 2020  tatus.          
-00007cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cc0: 2020 2020 2020 2020 2020 2320 6f74 6865            # othe
-00007cd0: 7277 6973 652c 2077 6f75 6c64 2074 616b  rwise, would tak
-00007ce0: 6520 746f 6f20 6c6f 6e67 2e2e 0a20 2020  e too long...   
-00007cf0: 2020 2020 2020 2020 2029 5d29 0a20 2020           )]).   
-00007d00: 2020 2020 2023 2073 7461 7475 7365 7320       # statuses 
-00007d10: 7368 6f75 6c64 2062 6520 616c 6c20 2263  should be all "c
-00007d20: 6c65 616e 222c 2077 6974 686f 7574 2061  lean", without a
-00007d30: 6e79 7468 696e 6720 656c 7365 2065 2e67  nything else e.g
-00007d40: 2e2c 2022 6d6f 6469 6669 6564 223a 0a20  ., "modified":. 
-00007d50: 2020 2020 2020 2061 7373 6572 7420 616e         assert an
-00007d60: 616c 7973 6973 5f73 7461 7475 7365 7320  alysis_statuses 
-00007d70: 3d3d 2073 6574 285b 2263 6c65 616e 225d  == set(["clean"]
-00007d80: 292c 205c 0a20 2020 2020 2020 2020 2020  ), \.           
-00007d90: 2022 416e 616c 7973 6973 2044 6174 614c   "Analysis DataL
-00007da0: 6164 2064 6174 6173 6574 2773 2073 7461  ad dataset's sta
-00007db0: 7475 7320 6973 206e 6f74 2063 6c65 616e  tus is not clean
-00007dc0: 2e22 205c 0a20 2020 2020 2020 2020 2020  ." \.           
-00007dd0: 202b 2022 2054 6865 7265 206d 6967 6874   + " There might
-00007de0: 2062 6520 756e 7472 6163 6b65 6420 6f72   be untracked or
-00007df0: 206d 6f64 6966 6965 6420 6669 6c65 7320   modified files 
-00007e00: 696e 2066 6f6c 6465 7220 2761 6e61 6c79  in folder 'analy
-00007e10: 7369 7327 2e22 205c 0a20 2020 2020 2020  sis'." \.       
-00007e20: 2020 2020 202b 2022 2050 6c65 6173 6520       + " Please 
-00007e30: 676f 2074 6f20 7468 6973 2064 6972 6563  go to this direc
-00007e40: 746f 7279 3a20 2722 202b 2073 656c 662e  tory: '" + self.
-00007e50: 616e 616c 7973 6973 5f70 6174 6820 2b20  analysis_path + 
-00007e60: 2227 5c6e 2220 5c0a 2020 2020 2020 2020  "'\n" \.        
-00007e70: 2020 2020 2b20 2220 616e 6420 7275 6e20      + " and run 
-00007e80: 6064 6174 616c 6164 2073 7461 7475 7360  `datalad status`
-00007e90: 2074 6f20 6368 6563 6b20 7768 6174 2077   to check what w
-00007ea0: 6572 6520 6368 616e 6765 642c 2220 5c0a  ere changed," \.
-00007eb0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-00007ec0: 7468 656e 2072 756e 2060 6461 7461 6c61  then run `datala
-00007ed0: 6420 7361 7665 202d 6d20 2779 6f75 7220  d save -m 'your 
-00007ee0: 6d65 7373 6167 6527 602c 2220 5c0a 2020  message'`," \.  
-00007ef0: 2020 2020 2020 2020 2020 2b20 2220 7468            + " th
-00007f00: 656e 2072 756e 2060 6461 7461 6c61 6420  en run `datalad 
-00007f10: 7075 7368 202d 2d74 6f20 696e 7075 7460  push --to input`
-00007f20: 3b22 205c 0a20 2020 2020 2020 2020 2020  ;" \.           
-00007f30: 202b 2022 2046 696e 616c 6c79 2c20 6966   + " Finally, if
-00007f40: 2079 6f75 2772 6520 7375 7265 2074 6865   you're sure the
-00007f50: 7265 2069 7320 6e6f 2073 7563 6365 7373  re is no success
-00007f60: 6675 6c20 6a6f 6273 2066 696e 6973 6865  ful jobs finishe
-00007f70: 642c 2079 6f75 2063 616e 2220 5c0a 2020  d, you can" \.  
-00007f80: 2020 2020 2020 2020 2020 2b20 2220 7275            + " ru
-00007f90: 6e20 6064 6174 616c 6164 2070 7573 6820  n `datalad push 
-00007fa0: 2d2d 746f 206f 7574 7075 7460 2e22 0a20  --to output`.". 
-00007fb0: 2020 2020 2020 2070 7269 6e74 2843 4845         print(CHE
-00007fc0: 434b 5f4d 4152 4b20 2b20 2220 416c 6c20  CK_MARK + " All 
-00007fd0: 676f 6f64 2122 290a 0a20 2020 2020 2020  good!")..       
-00007fe0: 2023 2043 6865 636b 2069 6e70 7574 2064   # Check input d
-00007ff0: 6174 6173 6574 2873 293a 202d 2d2d 2d2d  ataset(s): -----
-00008000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00008010: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
-00008020: 7269 6e74 2822 5c6e 4368 6563 6b69 6e67  rint("\nChecking
-00008030: 2069 6e70 7574 2064 6174 6173 6574 2873   input dataset(s
-00008040: 292e 2e2e 2229 0a20 2020 2020 2020 2023  )...").        #
-00008050: 2063 6865 636b 2069 6620 7468 6572 6520   check if there 
-00008060: 6973 2061 7420 6c65 6173 7420 6f6e 6520  is at least one 
-00008070: 666f 6c64 6572 2069 6e20 7468 6520 6069  folder in the `i
-00008080: 6e70 7574 732f 6461 7461 6020 6469 723a  nputs/data` dir:
-00008090: 0a20 2020 2020 2020 2074 656d 705f 6c69  .        temp_li
-000080a0: 7374 203d 2067 6574 5f69 6d6d 6564 6961  st = get_immedia
-000080b0: 7465 5f73 7562 6469 7265 6374 6f72 6965  te_subdirectorie
-000080c0: 7328 6f70 2e6a 6f69 6e28 7365 6c66 2e61  s(op.join(self.a
-000080d0: 6e61 6c79 7369 735f 7061 7468 2c20 2269  nalysis_path, "i
-000080e0: 6e70 7574 732f 6461 7461 2229 290a 2020  nputs/data")).  
-000080f0: 2020 2020 2020 6173 7365 7274 206c 656e        assert len
-00008100: 2874 656d 705f 6c69 7374 2920 3e20 302c  (temp_list) > 0,
-00008110: 205c 0a20 2020 2020 2020 2020 2020 2022   \.            "
-00008120: 5468 6572 6520 6973 206e 6f20 7375 622d  There is no sub-
-00008130: 6469 7265 6374 6f72 7920 2869 2e65 2e2c  directory (i.e.,
-00008140: 206e 6f20 696e 7075 7420 6461 7461 7365   no input datase
-00008150: 7429 2069 6e20 2769 6e70 7574 732f 6461  t) in 'inputs/da
-00008160: 7461 2721 2220 5c0a 2020 2020 2020 2020  ta'!" \.        
-00008170: 2020 2020 2b20 2220 4675 6c6c 2070 6174      + " Full pat
-00008180: 6820 746f 2066 6f6c 6465 7220 2769 6e70  h to folder 'inp
-00008190: 7574 732f 6461 7461 273a 2022 202b 206f  uts/data': " + o
-000081a0: 702e 6a6f 696e 2873 656c 662e 616e 616c  p.join(self.anal
-000081b0: 7973 6973 5f70 6174 682c 2022 696e 7075  ysis_path, "inpu
-000081c0: 7473 2f64 6174 6122 290a 0a20 2020 2020  ts/data")..     
-000081d0: 2020 2023 2063 6865 636b 2065 6163 6820     # check each 
-000081e0: 696e 7075 7420 6473 3a0a 2020 2020 2020  input ds:.      
-000081f0: 2020 666f 7220 695f 6473 2069 6e20 7261    for i_ds in ra
-00008200: 6e67 6528 302c 2069 6e70 7574 5f64 732e  nge(0, input_ds.
-00008210: 6e75 6d5f 6473 293a 0a20 2020 2020 2020  num_ds):.       
-00008220: 2020 2020 2070 6174 685f 6e6f 775f 6162       path_now_ab
-00008230: 7320 3d20 696e 7075 745f 6473 2e64 665b  s = input_ds.df[
-00008240: 2270 6174 685f 6e6f 775f 6162 7322 5d5b  "path_now_abs"][
-00008250: 695f 6473 5d0a 0a20 2020 2020 2020 2020  i_ds]..         
-00008260: 2020 2023 2063 6865 636b 2069 6620 7468     # check if th
-00008270: 6520 6469 7220 6f66 2074 6869 7320 696e  e dir of this in
-00008280: 7075 7420 6473 2065 7869 7374 733a 0a20  put ds exists:. 
-00008290: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-000082a0: 7420 6f70 2e65 7869 7374 7328 7061 7468  t op.exists(path
-000082b0: 5f6e 6f77 5f61 6273 292c 205c 0a20 2020  _now_abs), \.   
-000082c0: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-000082d0: 6520 7061 7468 2074 6f20 7468 6520 636c  e path to the cl
-000082e0: 6f6e 6564 2069 6e70 7574 2064 6174 6173  oned input datas
-000082f0: 6574 2023 2220 2b20 7374 7228 695f 6473  et #" + str(i_ds
-00008300: 202b 2031 2920 5c0a 2020 2020 2020 2020   + 1) \.        
-00008310: 2020 2020 2020 2020 2b20 2220 2722 202b          + " '" +
-00008320: 2069 6e70 7574 5f64 732e 6466 5b22 6e61   input_ds.df["na
-00008330: 6d65 225d 5b69 5f64 735d 202b 2022 2720  me"][i_ds] + "' 
-00008340: 646f 6573 206e 6f74 2065 7869 7374 3a20  does not exist: 
-00008350: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
-00008360: 2020 2020 2b20 7061 7468 5f6e 6f77 5f61      + path_now_a
-00008370: 6273 0a0a 2020 2020 2020 2020 2020 2020  bs..            
-00008380: 2320 6368 6563 6b20 6966 2064 6972 206f  # check if dir o
-00008390: 6620 696e 7075 7420 6473 2069 7320 6120  f input ds is a 
-000083a0: 6461 7461 6c61 6420 6461 7461 7365 743a  datalad dataset:
-000083b0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000083c0: 6572 7420 6f70 2e65 7869 7374 7328 6f70  ert op.exists(op
-000083d0: 2e6a 6f69 6e28 7061 7468 5f6e 6f77 5f61  .join(path_now_a
-000083e0: 6273 2c20 222e 6461 7461 6c61 642f 636f  bs, ".datalad/co
-000083f0: 6e66 6967 2229 292c 205c 0a20 2020 2020  nfig")), \.     
-00008400: 2020 2020 2020 2020 2020 2022 5468 6520             "The 
-00008410: 696e 7075 7420 6461 7461 7365 7420 2322  input dataset #"
-00008420: 202b 2073 7472 2869 5f64 7320 2b20 3129   + str(i_ds + 1)
-00008430: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00008440: 2020 202b 2022 2027 2220 2b20 696e 7075     + " '" + inpu
-00008450: 745f 6473 2e64 665b 226e 616d 6522 5d5b  t_ds.df["name"][
-00008460: 695f 6473 5d20 2b20 2227 2069 7320 6e6f  i_ds] + "' is no
-00008470: 7420 6120 7661 6c69 6420 4461 7461 4c61  t a valid DataLa
-00008480: 6420 6461 7461 7365 743a 2220 5c0a 2020  d dataset:" \.  
-00008490: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000084a0: 2220 5468 6572 6520 6973 206e 6f20 6669  " There is no fi
-000084b0: 6c65 2027 2e64 6174 616c 6164 2f63 6f6e  le '.datalad/con
-000084c0: 6669 6727 2069 6e20 6974 7320 6469 7265  fig' in its dire
-000084d0: 6374 6f72 793a 2022 202b 2070 6174 685f  ctory: " + path_
-000084e0: 6e6f 775f 6162 730a 0a20 2020 2020 2020  now_abs..       
-000084f0: 2020 2020 2023 2052 4f41 444d 4150 3a20       # ROADMAP: 
-00008500: 6368 6563 6b20 6966 2069 6e70 7574 2064  check if input d
-00008510: 6174 6173 6574 2049 4420 7361 7665 6420  ataset ID saved 
-00008520: 696e 2059 414d 4c20 6669 6c65 0a20 2020  in YAML file.   
-00008530: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-00008540: 2020 2020 2028 6e6f 7420 7361 7665 6420       (not saved 
-00008550: 7965 742c 2061 6c73 6f20 6e65 6564 2074  yet, also need t
-00008560: 6f20 6164 6420 746f 2049 6e70 7574 5f64  o add to Input_d
-00008570: 7320 636c 6173 7320 746f 6f29 0a20 2020  s class too).   
-00008580: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-00008590: 2020 2020 203d 2074 6861 7420 696e 2060       = that in `
-000085a0: 2e67 6974 6d6f 6475 6c65 7360 2069 6e20  .gitmodules` in 
-000085b0: 636c 6f6e 6564 2064 730a 2020 2020 2020  cloned ds.      
-000085c0: 2020 2020 2020 2320 2020 486f 7765 7665        #   Howeve
-000085d0: 722c 2049 7427 7320 7072 6574 7479 2075  r, It's pretty u
-000085e0: 6e6c 696b 656c 7920 7468 6174 2073 6f6d  nlikely that som
-000085f0: 656f 6e65 2063 6861 6e67 6573 2069 6e70  eone changes inp
-00008600: 7574 732f 6461 7461 206f 6e20 7468 6569  uts/data on thei
-00008610: 7220 6f77 6e0a 2020 2020 2020 2020 2020  r own.          
-00008620: 2020 2320 2020 2020 2020 6966 2074 6865    #       if the
-00008630: 7927 7265 2075 7369 6e67 2042 4142 530a  y're using BABS.
-00008640: 0a20 2020 2020 2020 2070 7269 6e74 2843  .        print(C
-00008650: 4845 434b 5f4d 4152 4b20 2b20 2220 416c  HECK_MARK + " Al
-00008660: 6c20 676f 6f64 2122 290a 0a20 2020 2020  l good!")..     
-00008670: 2020 2023 2043 6865 636b 2063 6f6e 7461     # Check conta
-00008680: 696e 6572 2064 6174 616c 6164 2064 6174  iner datalad dat
-00008690: 6173 6574 3a20 2d2d 2d2d 2d2d 2d2d 2d2d  aset: ----------
-000086a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000086b0: 2d0a 2020 2020 2020 2020 7072 696e 7428  -.        print(
-000086c0: 225c 6e43 6865 636b 696e 6720 636f 6e74  "\nChecking cont
-000086d0: 6169 6e65 7220 6461 7461 6c61 6420 6461  ainer datalad da
-000086e0: 7461 7365 742e 2e2e 2229 0a20 2020 2020  taset...").     
-000086f0: 2020 2066 6f6c 6465 725f 636f 6e74 6169     folder_contai
-00008700: 6e65 7220 3d20 6f70 2e6a 6f69 6e28 7365  ner = op.join(se
-00008710: 6c66 2e61 6e61 6c79 7369 735f 7061 7468  lf.analysis_path
-00008720: 2c20 2263 6f6e 7461 696e 6572 7322 290a  , "containers").
-00008730: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-00008740: 725f 6e61 6d65 203d 2062 6162 735f 7072  r_name = babs_pr
-00008750: 6f6a 5f63 6f6e 6669 675b 2263 6f6e 7461  oj_config["conta
-00008760: 696e 6572 225d 5b22 6e61 6d65 225d 0a20  iner"]["name"]. 
-00008770: 2020 2020 2020 2023 2061 7373 6572 7420         # assert 
-00008780: 6974 2773 2061 2064 6174 616c 6164 2064  it's a datalad d
-00008790: 7320 696e 2060 636f 6e74 6169 6e65 7273  s in `containers
-000087a0: 6020 666f 6c64 6572 3a0a 2020 2020 2020  ` folder:.      
-000087b0: 2020 6173 7365 7274 206f 702e 6578 6973    assert op.exis
-000087c0: 7473 286f 702e 6a6f 696e 2866 6f6c 6465  ts(op.join(folde
-000087d0: 725f 636f 6e74 6169 6e65 722c 2022 2e64  r_container, ".d
-000087e0: 6174 616c 6164 2f63 6f6e 6669 6722 2929  atalad/config"))
-000087f0: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
-00008800: 2254 6865 7265 2069 7320 6e6f 2063 6f6e  "There is no con
-00008810: 7461 696e 6572 7320 4461 7461 4c61 6420  tainers DataLad 
-00008820: 6461 7461 7365 7420 696e 2066 6f6c 6465  dataset in folde
-00008830: 723a 2022 202b 2066 6f6c 6465 725f 636f  r: " + folder_co
-00008840: 6e74 6169 6e65 720a 0a20 2020 2020 2020  ntainer..       
-00008850: 2023 2052 4f41 444d 4150 3a20 6368 6563   # ROADMAP: chec
-00008860: 6b20 6966 2063 6f6e 7461 696e 6572 2064  k if container d
-00008870: 6174 6173 6574 2049 4420 7361 7665 6420  ataset ID saved 
-00008880: 696e 2059 414d 4c20 6669 6c65 2028 6e6f  in YAML file (no
-00008890: 7420 7361 7665 6420 7965 7429 0a20 2020  t saved yet).   
-000088a0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-000088b0: 2028 6e6f 7420 7361 7665 6420 7965 742c   (not saved yet,
-000088c0: 2070 726f 6261 626c 7920 6265 7474 6572   probably better
-000088d0: 2074 6f20 6164 6420 746f 2043 6f6e 7461   to add to Conta
-000088e0: 696e 6572 2063 6c61 7373 3f29 0a20 2020  iner class?).   
-000088f0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-00008900: 203d 2074 6861 7420 696e 2060 2e67 6974   = that in `.git
-00008910: 6d6f 6475 6c65 7360 2069 6e20 636c 6f6e  modules` in clon
-00008920: 6564 2064 730a 2020 2020 2020 2020 2320  ed ds.        # 
-00008930: 2020 486f 7765 7665 722c 2049 7427 7320    However, It's 
-00008940: 7072 6574 7479 2075 6e6c 696b 656c 7920  pretty unlikely 
-00008950: 7468 6174 2073 6f6d 656f 6e65 2063 6861  that someone cha
-00008960: 6e67 6573 2069 7420 6f6e 2074 6865 6972  nges it on their
-00008970: 206f 776e 0a20 2020 2020 2020 2023 2020   own.        #  
-00008980: 2020 2020 2069 6620 7468 6579 2772 6520       if they're 
-00008990: 7573 696e 6720 4241 4253 0a0a 2020 2020  using BABS..    
-000089a0: 2020 2020 2320 6e6f 2061 6374 696f 6e20      # no action 
-000089b0: 6e6f 773b 2077 6865 6e20 6062 6162 732d  now; when `babs-
-000089c0: 696e 6974 602c 2068 6173 2064 6f6e 6520  init`, has done 
-000089d0: 6043 6f6e 7461 696e 6572 2e73 616e 6974  `Container.sanit
-000089e0: 795f 6368 6563 6b28 2960 0a20 2020 2020  y_check()`.     
-000089f0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00008a00: 2020 2074 6f20 6d61 6b65 2073 7572 6520     to make sure 
-00008a10: 7468 6520 636f 6e74 6169 6e65 7220 6e61  the container na
-00008a20: 6d65 6420 6063 6f6e 7461 696e 6572 5f6e  med `container_n
-00008a30: 616d 6560 2065 7869 7374 732e 0a20 2020  ame` exists..   
-00008a40: 2020 2020 2070 7269 6e74 2843 4845 434b       print(CHECK
-00008a50: 5f4d 4152 4b20 2b20 2220 416c 6c20 676f  _MARK + " All go
-00008a60: 6f64 2122 290a 0a20 2020 2020 2020 2023  od!")..        #
-00008a70: 2043 6865 636b 2060 616e 616c 7973 6973   Check `analysis
-00008a80: 2f63 6f64 6560 3a20 2d2d 2d2d 2d2d 2d2d  /code`: --------
-00008a90: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00008aa0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-00008ab0: 2020 7072 696e 7428 225c 6e43 6865 636b    print("\nCheck
-00008ac0: 696e 6720 6061 6e61 6c79 7369 732f 636f  ing `analysis/co
-00008ad0: 6465 2f60 2066 6f6c 6465 722e 2e2e 2229  de/` folder...")
-00008ae0: 0a20 2020 2020 2020 2023 2066 6f6c 6465  .        # folde
-00008af0: 7220 6061 6e61 6c79 7369 732f 636f 6465  r `analysis/code
-00008b00: 6020 7368 6f75 6c64 2065 7869 7374 3a0a  ` should exist:.
-00008b10: 2020 2020 2020 2020 6173 7365 7274 206f          assert o
-00008b20: 702e 6578 6973 7473 286f 702e 6a6f 696e  p.exists(op.join
-00008b30: 2873 656c 662e 616e 616c 7973 6973 5f70  (self.analysis_p
-00008b40: 6174 682c 2022 636f 6465 2229 292c 205c  ath, "code")), \
-00008b50: 0a20 2020 2020 2020 2020 2020 2022 466f  .            "Fo
-00008b60: 6c64 6572 2027 636f 6465 2720 646f 6573  lder 'code' does
-00008b70: 206e 6f74 2065 7869 7374 2069 6e20 2761   not exist in 'a
-00008b80: 6e61 6c79 7369 7327 2066 6f6c 6465 7221  nalysis' folder!
-00008b90: 220a 0a20 2020 2020 2020 2023 2061 7373  "..        # ass
-00008ba0: 6572 7420 7468 6520 6c69 7374 206f 6620  ert the list of 
-00008bb0: 6669 6c65 7320 696e 2074 6865 2060 636f  files in the `co
-00008bc0: 6465 6020 666f 6c64 6572 2c0a 2020 2020  de` folder,.    
-00008bd0: 2020 2020 2320 2020 616e 6420 6261 7368      #   and bash
-00008be0: 2066 696c 6573 2073 686f 756c 6420 6265   files should be
-00008bf0: 2065 7865 6375 7461 626c 653a 0a20 2020   executable:.   
-00008c00: 2020 2020 206c 6973 745f 6669 6c65 735f       list_files_
-00008c10: 636f 6465 203d 205b 0a20 2020 2020 2020  code = [.       
-00008c20: 2020 2020 2022 6261 6273 5f70 726f 6a5f       "babs_proj_
-00008c30: 636f 6e66 6967 2e79 616d 6c22 2c0a 2020  config.yaml",.  
-00008c40: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
-00008c50: 6e65 725f 6e61 6d65 202b 2022 5f7a 6970  ner_name + "_zip
-00008c60: 2e73 6822 2c0a 2020 2020 2020 2020 2020  .sh",.          
-00008c70: 2020 2270 6172 7469 6369 7061 6e74 5f6a    "participant_j
-00008c80: 6f62 2e73 6822 2c0a 2020 2020 2020 2020  ob.sh",.        
-00008c90: 2020 2020 2273 7562 6d69 745f 6a6f 625f      "submit_job_
-00008ca0: 7465 6d70 6c61 7465 2e79 616d 6c22 0a20  template.yaml". 
-00008cb0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-00008cc0: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-00008cd0: 655f 7365 7373 696f 6e20 3d3d 2022 7369  e_session == "si
-00008ce0: 6e67 6c65 2d73 6573 223a 0a20 2020 2020  ngle-ses":.     
-00008cf0: 2020 2020 2020 206c 6973 745f 6669 6c65         list_file
-00008d00: 735f 636f 6465 2e61 7070 656e 6428 2273  s_code.append("s
-00008d10: 7562 5f66 696e 616c 5f69 6e63 6c75 2e63  ub_final_inclu.c
-00008d20: 7376 2229 0a20 2020 2020 2020 2065 6c73  sv").        els
-00008d30: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
-00008d40: 6973 745f 6669 6c65 735f 636f 6465 2e61  ist_files_code.a
-00008d50: 7070 656e 6428 2273 7562 5f73 6573 5f66  ppend("sub_ses_f
-00008d60: 696e 616c 5f69 6e63 6c75 2e63 7376 2229  inal_inclu.csv")
-00008d70: 0a0a 2020 2020 2020 2020 666f 7220 7465  ..        for te
-00008d80: 6d70 5f66 696c 656e 616d 6520 696e 206c  mp_filename in l
-00008d90: 6973 745f 6669 6c65 735f 636f 6465 3a0a  ist_files_code:.
-00008da0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-00008db0: 5f66 6e20 3d20 6f70 2e6a 6f69 6e28 7365  _fn = op.join(se
-00008dc0: 6c66 2e61 6e61 6c79 7369 735f 7061 7468  lf.analysis_path
-00008dd0: 2c20 2263 6f64 6522 2c20 7465 6d70 5f66  , "code", temp_f
-00008de0: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00008df0: 2020 2020 2023 2074 6865 2066 696c 6520       # the file 
-00008e00: 7368 6f75 6c64 2065 7869 7374 3a0a 2020  should exist:.  
-00008e10: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00008e20: 206f 702e 6973 6669 6c65 2874 656d 705f   op.isfile(temp_
-00008e30: 666e 292c 205c 0a20 2020 2020 2020 2020  fn), \.         
-00008e40: 2020 2020 2020 2022 5265 7175 6972 6564         "Required
-00008e50: 2066 696c 6520 2722 202b 2074 656d 705f   file '" + temp_
-00008e60: 6669 6c65 6e61 6d65 202b 2022 2720 646f  filename + "' do
-00008e70: 6573 206e 6f74 2065 7869 7374 2220 5c0a  es not exist" \.
-00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e90: 2b20 2220 696e 2027 616e 616c 7973 6973  + " in 'analysis
-00008ea0: 2f63 6f64 6527 2066 6f6c 6465 7220 696e  /code' folder in
-00008eb0: 2074 6869 7320 4241 4253 2070 726f 6a65   this BABS proje
-00008ec0: 6374 2122 0a20 2020 2020 2020 2020 2020  ct!".           
-00008ed0: 2023 2063 6865 636b 2069 6620 6261 7368   # check if bash
-00008ee0: 2066 696c 6573 2061 7265 2065 7865 6375   files are execu
-00008ef0: 7461 626c 653a 0a20 2020 2020 2020 2020  table:.         
-00008f00: 2020 2069 6620 6f70 2e73 706c 6974 6578     if op.splitex
-00008f10: 7428 7465 6d70 5f66 6e29 5b31 5d20 3d3d  t(temp_fn)[1] ==
-00008f20: 2022 2e73 6822 3a20 2020 2320 6578 7465   ".sh":   # exte
-00008f30: 6e73 696f 6e20 6973 2027 2e73 6827 3a0a  nsion is '.sh':.
-00008f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f50: 6173 7365 7274 206f 732e 6163 6365 7373  assert os.access
-00008f60: 2874 656d 705f 666e 2c20 6f73 2e58 5f4f  (temp_fn, os.X_O
-00008f70: 4b29 2c20 5c0a 2020 2020 2020 2020 2020  K), \.          
-00008f80: 2020 2020 2020 2020 2020 2254 6869 7320            "This 
-00008f90: 636f 6465 2066 696c 6520 7368 6f75 6c64  code file should
-00008fa0: 2062 6520 6578 6563 7574 6162 6c65 3a20   be executable: 
-00008fb0: 2220 2b20 7465 6d70 5f66 6e0a 2020 2020  " + temp_fn.    
-00008fc0: 2020 2020 7072 696e 7428 4348 4543 4b5f      print(CHECK_
-00008fd0: 4d41 524b 202b 2022 2041 6c6c 2067 6f6f  MARK + " All goo
-00008fe0: 6421 2229 0a0a 2020 2020 2020 2020 2320  d!")..        # 
-00008ff0: 4368 6563 6b20 696e 7075 7420 616e 6420  Check input and 
-00009000: 6f75 7470 7574 2052 4941 3a20 2d2d 2d2d  output RIA: ----
-00009010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00009020: 2d2d 0a20 2020 2020 2020 2070 7269 6e74  --.        print
-00009030: 2822 5c6e 4368 6563 6b69 6e67 2069 6e70  ("\nChecking inp
-00009040: 7574 2061 6e64 206f 7574 7075 7420 5249  ut and output RI
-00009050: 412e 2e2e 2229 0a0a 2020 2020 2020 2020  A...")..        
-00009060: 2320 6368 6563 6b20 6966 2074 6865 7920  # check if they 
-00009070: 6172 6520 7369 626c 696e 6773 206f 6620  are siblings of 
-00009080: 6061 6e61 6c79 7369 7360 3a0a 2020 2020  `analysis`:.    
-00009090: 2020 2020 7072 696e 7428 225c 7444 6174      print("\tDat
-000090a0: 616c 6164 2064 6174 6173 6574 2060 616e  alad dataset `an
-000090b0: 616c 7973 6973 6027 7320 7369 626c 696e  alysis`'s siblin
-000090c0: 6773 3a22 290a 2020 2020 2020 2020 616e  gs:").        an
-000090d0: 616c 7973 6973 5f73 6962 6c69 6e67 7320  alysis_siblings 
-000090e0: 3d20 7365 6c66 2e61 6e61 6c79 7369 735f  = self.analysis_
-000090f0: 6461 7461 6c61 645f 6861 6e64 6c65 2e73  datalad_handle.s
-00009100: 6962 6c69 6e67 7328 6163 7469 6f6e 3d27  iblings(action='
-00009110: 7175 6572 7927 290a 2020 2020 2020 2020  query').        
-00009120: 2320 6765 7420 7468 6520 6163 7475 616c  # get the actual
-00009130: 2060 6f75 7470 7574 5f72 6961 5f64 6174   `output_ria_dat
-00009140: 615f 6469 7260 3b0a 2020 2020 2020 2020  a_dir`;.        
-00009150: 2320 2020 7468 6520 6f6e 6520 696e 2060  #   the one in `
-00009160: 7365 6c66 6020 6174 7472 2069 7320 6469  self` attr is di
-00009170: 7265 6374 6c79 2067 6f74 2066 726f 6d20  rectly got from 
-00009180: 6061 6e61 6c79 7369 7360 2072 656d 6f74  `analysis` remot
-00009190: 652c 0a20 2020 2020 2020 2023 2020 2073  e,.        #   s
-000091a0: 6f20 7368 6f75 6c64 206e 6f74 2075 7365  o should not use
-000091b0: 2074 6861 7420 6865 7265 2e0a 2020 2020   that here..    
-000091c0: 2020 2020 2320 6f75 7470 7574 5f72 6961      # output_ria
-000091d0: 3a0a 2020 2020 2020 2020 6163 7475 616c  :.        actual
-000091e0: 5f6f 7574 7075 745f 7269 615f 6461 7461  _output_ria_data
-000091f0: 5f64 6972 203d 206f 732e 7265 6164 6c69  _dir = os.readli
-00009200: 6e6b 280a 2020 2020 2020 2020 2020 2020  nk(.            
-00009210: 6f70 2e6a 6f69 6e28 7365 6c66 2e6f 7574  op.join(self.out
-00009220: 7075 745f 7269 615f 7061 7468 2c20 2261  put_ria_path, "a
-00009230: 6c69 6173 2f64 6174 6122 2929 2020 2023  lias/data"))   #
-00009240: 2067 6574 2074 6865 2073 796d 6c69 6e6b   get the symlink
-00009250: 206f 6620 6061 6c69 6173 2f64 6174 6160   of `alias/data`
-00009260: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-00009270: 6f70 2e65 7869 7374 7328 6163 7475 616c  op.exists(actual
-00009280: 5f6f 7574 7075 745f 7269 615f 6461 7461  _output_ria_data
-00009290: 5f64 6972 2920 2020 2023 206d 616b 6520  _dir)    # make 
-000092a0: 7375 7265 2074 6869 7320 6578 6973 7473  sure this exists
-000092b0: 0a20 2020 2020 2020 2023 2067 6574 2027  .        # get '
-000092c0: 3030 302f 3030 3030 2d30 3030 302d 3030  000/0000-0000-00
-000092d0: 3030 2d30 3030 3027 3a0a 2020 2020 2020  00-0000':.      
-000092e0: 2020 6461 7461 5f66 6f6c 6465 726e 616d    data_foldernam
-000092f0: 6520 3d20 6f70 2e6a 6f69 6e28 0a20 2020  e = op.join(.   
-00009300: 2020 2020 2020 2020 206f 702e 6261 7365           op.base
-00009310: 6e61 6d65 286f 702e 6469 726e 616d 6528  name(op.dirname(
-00009320: 6163 7475 616c 5f6f 7574 7075 745f 7269  actual_output_ri
-00009330: 615f 6461 7461 5f64 6972 2929 2c0a 2020  a_data_dir)),.  
-00009340: 2020 2020 2020 2020 2020 6f70 2e62 6173            op.bas
-00009350: 656e 616d 6528 6163 7475 616c 5f6f 7574  ename(actual_out
-00009360: 7075 745f 7269 615f 6461 7461 5f64 6972  put_ria_data_dir
-00009370: 2929 0a20 2020 2020 2020 2023 2069 6e70  )).        # inp
-00009380: 7574 5f72 6961 3a0a 2020 2020 2020 2020  ut_ria:.        
-00009390: 6163 7475 616c 5f69 6e70 7574 5f72 6961  actual_input_ria
-000093a0: 5f64 6174 615f 6469 7220 3d20 6f70 2e6a  _data_dir = op.j
-000093b0: 6f69 6e28 7365 6c66 2e69 6e70 7574 5f72  oin(self.input_r
-000093c0: 6961 5f70 6174 682c 2064 6174 615f 666f  ia_path, data_fo
-000093d0: 6c64 6572 6e61 6d65 290a 2020 2020 2020  ldername).      
-000093e0: 2020 6173 7365 7274 206f 702e 6578 6973    assert op.exis
-000093f0: 7473 2861 6374 7561 6c5f 696e 7075 745f  ts(actual_input_
-00009400: 7269 615f 6461 7461 5f64 6972 2920 2020  ria_data_dir)   
-00009410: 2023 206d 616b 6520 7375 7265 2074 6869   # make sure thi
-00009420: 7320 6578 6973 7473 0a0a 2020 2020 2020  s exists..      
-00009430: 2020 6966 5f66 6f75 6e64 5f73 6962 6c69    if_found_sibli
-00009440: 6e67 5f69 6e70 7574 203d 2046 616c 7365  ng_input = False
-00009450: 0a20 2020 2020 2020 2069 665f 666f 756e  .        if_foun
-00009460: 645f 7369 626c 696e 675f 6f75 7470 7574  d_sibling_output
-00009470: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00009480: 2066 6f72 2069 5f73 6962 6c69 6e67 2069   for i_sibling i
-00009490: 6e20 7261 6e67 6528 302c 206c 656e 2861  n range(0, len(a
-000094a0: 6e61 6c79 7369 735f 7369 626c 696e 6773  nalysis_siblings
-000094b0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000094c0: 7468 655f 7369 626c 696e 6720 3d20 616e  the_sibling = an
-000094d0: 616c 7973 6973 5f73 6962 6c69 6e67 735b  alysis_siblings[
-000094e0: 695f 7369 626c 696e 675d 0a20 2020 2020  i_sibling].     
-000094f0: 2020 2020 2020 2069 6620 7468 655f 7369         if the_si
-00009500: 626c 696e 675b 226e 616d 6522 5d20 3d3d  bling["name"] ==
-00009510: 2022 6f75 7470 7574 223a 2020 2023 206f   "output":   # o
-00009520: 7574 7075 7420 7269 613a 0a20 2020 2020  utput ria:.     
-00009530: 2020 2020 2020 2020 2020 2069 665f 666f             if_fo
-00009540: 756e 645f 7369 626c 696e 675f 6f75 7470  und_sibling_outp
-00009550: 7574 203d 2054 7275 650a 2020 2020 2020  ut = True.      
-00009560: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00009570: 2074 6865 5f73 6962 6c69 6e67 5b22 7572   the_sibling["ur
-00009580: 6c22 5d20 3d3d 2061 6374 7561 6c5f 6f75  l"] == actual_ou
-00009590: 7470 7574 5f72 6961 5f64 6174 615f 6469  tput_ria_data_di
-000095a0: 722c 205c 0a20 2020 2020 2020 2020 2020  r, \.           
-000095b0: 2020 2020 2020 2020 2022 5468 6520 6061           "The `a
-000095c0: 6e61 6c79 7369 7360 2064 6174 616c 6164  nalysis` datalad
-000095d0: 2064 6174 6173 6574 2773 2073 6962 6c69   dataset's sibli
-000095e0: 6e67 2027 6f75 7470 7574 2720 7572 6c20  ng 'output' url 
-000095f0: 646f 6573 206e 6f74 206d 6174 6368 2220  does not match" 
-00009600: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00009610: 2020 2020 2020 2b20 2220 7468 6520 7061        + " the pa
-00009620: 7468 2074 6f20 7468 6520 6f75 7470 7574  th to the output
-00009630: 2052 4941 2e22 205c 0a20 2020 2020 2020   RIA." \.       
-00009640: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00009650: 2046 6f72 6d65 7220 3d20 2220 2b20 7468   Former = " + th
-00009660: 655f 7369 626c 696e 675b 2275 726c 225d  e_sibling["url"]
-00009670: 202b 2022 3b22 205c 0a20 2020 2020 2020   + ";" \.       
-00009680: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00009690: 204c 6174 7465 7220 3d20 2220 2b20 6163   Latter = " + ac
-000096a0: 7475 616c 5f6f 7574 7075 745f 7269 615f  tual_output_ria_
-000096b0: 6461 7461 5f64 6972 0a20 2020 2020 2020  data_dir.       
-000096c0: 2020 2020 2069 6620 7468 655f 7369 626c       if the_sibl
-000096d0: 696e 675b 226e 616d 6522 5d20 3d3d 2022  ing["name"] == "
-000096e0: 696e 7075 7422 3a20 2020 2320 696e 7075  input":   # inpu
-000096f0: 7420 7269 613a 0a20 2020 2020 2020 2020  t ria:.         
-00009700: 2020 2020 2020 2069 665f 666f 756e 645f         if_found_
-00009710: 7369 626c 696e 675f 696e 7075 7420 3d20  sibling_input = 
-00009720: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00009730: 2020 2020 2061 7373 6572 7420 7468 655f       assert the_
-00009740: 7369 626c 696e 675b 2275 726c 225d 203d  sibling["url"] =
-00009750: 3d20 6163 7475 616c 5f69 6e70 7574 5f72  = actual_input_r
-00009760: 6961 5f64 6174 615f 6469 722c 205c 0a20  ia_data_dir, \. 
-00009770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009780: 2020 2022 5468 6520 6061 6e61 6c79 7369     "The `analysi
-00009790: 7360 2064 6174 616c 6164 2064 6174 6173  s` datalad datas
-000097a0: 6574 2773 2073 6962 6c69 6e67 2027 696e  et's sibling 'in
-000097b0: 7075 7427 2075 726c 2064 6f65 7320 6e6f  put' url does no
-000097c0: 7420 6d61 7463 6822 205c 0a20 2020 2020  t match" \.     
-000097d0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-000097e0: 2022 2074 6865 2070 6174 6820 746f 2074   " the path to t
-000097f0: 6865 2069 6e70 7574 2052 4941 2e22 205c  he input RIA." \
-00009800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009810: 2020 2020 202b 2022 2046 6f72 6d65 7220       + " Former 
-00009820: 3d20 2220 2b20 7468 655f 7369 626c 696e  = " + the_siblin
-00009830: 675b 2275 726c 225d 202b 2022 3b22 205c  g["url"] + ";" \
-00009840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009850: 2020 2020 202b 2022 204c 6174 7465 7220       + " Latter 
-00009860: 3d20 2220 2b20 6163 7475 616c 5f69 6e70  = " + actual_inp
-00009870: 7574 5f72 6961 5f64 6174 615f 6469 720a  ut_ria_data_dir.
-00009880: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00009890: 665f 666f 756e 645f 7369 626c 696e 675f  f_found_sibling_
-000098a0: 696e 7075 743a 0a20 2020 2020 2020 2020  input:.         
-000098b0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000098c0: 6f6e 2822 4469 6420 6e6f 7420 6669 6e64  on("Did not find
-000098d0: 2061 2073 6962 6c69 6e67 206f 6620 2761   a sibling of 'a
-000098e0: 6e61 6c79 7369 7327 2044 6174 614c 6164  nalysis' DataLad
-000098f0: 2064 6174 6173 6574 220a 2020 2020 2020   dataset".      
-00009900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009910: 2020 2020 2020 2b20 2220 7468 6174 2773        + " that's
-00009920: 2063 616c 6c65 6420 2769 6e70 7574 272e   called 'input'.
-00009930: 2054 6865 7265 206d 6179 2062 6520 736f   There may be so
-00009940: 6d65 7468 696e 6720 7772 6f6e 6720 7768  mething wrong wh
-00009950: 656e 220a 2020 2020 2020 2020 2020 2020  en".            
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 2b20 2220 7365 7474 696e 6720 7570 2069  + " setting up i
-00009980: 6e70 7574 2052 4941 2122 290a 2020 2020  nput RIA!").    
-00009990: 2020 2020 6966 206e 6f74 2069 665f 666f      if not if_fo
-000099a0: 756e 645f 7369 626c 696e 675f 6f75 7470  und_sibling_outp
-000099b0: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
-000099c0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-000099d0: 2244 6964 206e 6f74 2066 696e 6420 6120  "Did not find a 
-000099e0: 7369 626c 696e 6720 6f66 2027 616e 616c  sibling of 'anal
-000099f0: 7973 6973 2720 4461 7461 4c61 6420 6461  ysis' DataLad da
-00009a00: 7461 7365 7422 0a20 2020 2020 2020 2020  taset".         
-00009a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a20: 2020 202b 2022 2074 6861 7427 7320 6361     + " that's ca
-00009a30: 6c6c 6564 2027 6f75 7470 7574 272e 2054  lled 'output'. T
-00009a40: 6865 7265 206d 6179 2062 6520 736f 6d65  here may be some
-00009a50: 7468 696e 6720 7772 6f6e 6720 7768 656e  thing wrong when
-00009a60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00009a70: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00009a80: 2220 7365 7474 696e 6720 7570 206f 7574  " setting up out
-00009a90: 7075 7420 5249 4121 2229 0a0a 2020 2020  put RIA!")..    
-00009aa0: 2020 2020 2320 6f75 7470 7574 5f72 6961      # output_ria
-00009ab0: 5f64 6174 616c 6164 5f68 616e 646c 6520  _datalad_handle 
-00009ac0: 3d20 646c 6170 692e 4461 7461 7365 7428  = dlapi.Dataset(
-00009ad0: 7365 6c66 2e6f 7574 7075 745f 7269 615f  self.output_ria_
-00009ae0: 6461 7461 5f64 6972 290a 0a20 2020 2020  data_dir)..     
-00009af0: 2020 2023 2063 6865 636b 2069 6620 7468     # check if th
-00009b00: 6520 6375 7272 656e 7420 636f 6d6d 6974  e current commit
-00009b10: 2069 6e20 6061 6e61 6c79 7369 7360 2068   in `analysis` h
-00009b20: 6173 2062 6565 6e20 7075 7368 6564 2074  as been pushed t
-00009b30: 6f20 5249 413a 0a20 2020 2020 2020 2023  o RIA:.        #
-00009b40: 2020 2069 2e65 2e2c 2069 6620 636f 6d6d     i.e., if comm
-00009b50: 6974 2068 6173 6820 6172 6520 6d61 7463  it hash are matc
-00009b60: 6865 643a 0a20 2020 2020 2020 2023 2061  hed:.        # a
-00009b70: 6e61 6c79 7369 7327 2063 6f6d 6d69 7420  nalysis' commit 
-00009b80: 6861 7368 3a0a 2020 2020 2020 2020 7072  hash:.        pr
-00009b90: 6f63 5f68 6173 685f 616e 616c 7973 6973  oc_hash_analysis
-00009ba0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
-00009bb0: 6e28 0a20 2020 2020 2020 2020 2020 205b  n(.            [
-00009bc0: 2267 6974 222c 2022 7265 762d 7061 7273  "git", "rev-pars
-00009bd0: 6522 2c20 2248 4541 4422 5d2c 0a20 2020  e", "HEAD"],.   
-00009be0: 2020 2020 2020 2020 2063 7764 3d73 656c           cwd=sel
-00009bf0: 662e 616e 616c 7973 6973 5f70 6174 682c  f.analysis_path,
-00009c00: 0a20 2020 2020 2020 2020 2020 2073 7464  .            std
-00009c10: 6f75 743d 7375 6270 726f 6365 7373 2e50  out=subprocess.P
-00009c20: 4950 4529 0a20 2020 2020 2020 2070 726f  IPE).        pro
-00009c30: 635f 6861 7368 5f61 6e61 6c79 7369 732e  c_hash_analysis.
-00009c40: 6368 6563 6b5f 7265 7475 726e 636f 6465  check_returncode
-00009c50: 2829 0a20 2020 2020 2020 2068 6173 685f  ().        hash_
-00009c60: 616e 616c 7973 6973 203d 2070 726f 635f  analysis = proc_
-00009c70: 6861 7368 5f61 6e61 6c79 7369 732e 7374  hash_analysis.st
-00009c80: 646f 7574 2e64 6563 6f64 6528 2775 7466  dout.decode('utf
-00009c90: 2d38 2729 2e72 6570 6c61 6365 2822 5c6e  -8').replace("\n
-00009ca0: 222c 2022 2229 0a0a 2020 2020 2020 2020  ", "")..        
-00009cb0: 2320 696e 7075 7420 7269 6127 7320 636f  # input ria's co
-00009cc0: 6d6d 6974 2068 6173 683a 0a20 2020 2020  mmit hash:.     
-00009cd0: 2020 2070 726f 635f 6861 7368 5f69 6e70     proc_hash_inp
-00009ce0: 7574 5f72 6961 203d 2073 7562 7072 6f63  ut_ria = subproc
-00009cf0: 6573 732e 7275 6e28 0a20 2020 2020 2020  ess.run(.       
-00009d00: 2020 2020 205b 2267 6974 222c 2022 7265       ["git", "re
-00009d10: 762d 7061 7273 6522 2c20 2248 4541 4422  v-parse", "HEAD"
-00009d20: 5d2c 0a20 2020 2020 2020 2020 2020 2063  ],.            c
-00009d30: 7764 3d61 6374 7561 6c5f 696e 7075 745f  wd=actual_input_
-00009d40: 7269 615f 6461 7461 5f64 6972 2c20 2020  ria_data_dir,   
-00009d50: 2320 7573 696e 6720 7468 6520 6163 7475  # using the actu
-00009d60: 616c 206f 6e65 2077 6520 6a75 7374 2067  al one we just g
-00009d70: 6f74 0a20 2020 2020 2020 2020 2020 2073  ot.            s
-00009d80: 7464 6f75 743d 7375 6270 726f 6365 7373  tdout=subprocess
-00009d90: 2e50 4950 4529 0a20 2020 2020 2020 2070  .PIPE).        p
-00009da0: 726f 635f 6861 7368 5f69 6e70 7574 5f72  roc_hash_input_r
-00009db0: 6961 2e63 6865 636b 5f72 6574 7572 6e63  ia.check_returnc
-00009dc0: 6f64 6528 290a 2020 2020 2020 2020 6861  ode().        ha
-00009dd0: 7368 5f69 6e70 7574 5f72 6961 203d 2070  sh_input_ria = p
-00009de0: 726f 635f 6861 7368 5f69 6e70 7574 5f72  roc_hash_input_r
-00009df0: 6961 2e73 7464 6f75 742e 6465 636f 6465  ia.stdout.decode
-00009e00: 2827 7574 662d 3827 292e 7265 706c 6163  ('utf-8').replac
-00009e10: 6528 225c 6e22 2c20 2222 290a 2020 2020  e("\n", "").    
-00009e20: 2020 2020 6173 7365 7274 2068 6173 685f      assert hash_
-00009e30: 616e 616c 7973 6973 203d 3d20 6861 7368  analysis == hash
-00009e40: 5f69 6e70 7574 5f72 6961 2c20 5c0a 2020  _input_ria, \.  
-00009e50: 2020 2020 2020 2020 2020 2254 6865 2068            "The h
-00009e60: 6173 6820 6f66 2063 7572 7265 6e74 2063  ash of current c
-00009e70: 6f6d 6d69 7420 6f66 2060 616e 616c 7973  ommit of `analys
-00009e80: 6973 6020 6461 7461 6c61 6420 6461 7461  is` datalad data
-00009e90: 7365 7420 646f 6573 206e 6f74 206d 6174  set does not mat
-00009ea0: 6368 2220 5c0a 2020 2020 2020 2020 2020  ch" \.          
-00009eb0: 2020 2b20 2220 7769 7468 2074 6861 7420    + " with that 
-00009ec0: 6f66 2069 6e70 7574 2052 4941 2e22 205c  of input RIA." \
-00009ed0: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
-00009ee0: 2046 6f72 6d65 7220 3d20 2220 2b20 6861   Former = " + ha
-00009ef0: 7368 5f61 6e61 6c79 7369 7320 2b20 223b  sh_analysis + ";
-00009f00: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
-00009f10: 2b20 2220 4c61 7474 6572 203d 2022 202b  + " Latter = " +
-00009f20: 2068 6173 685f 696e 7075 745f 7269 6120   hash_input_ria 
-00009f30: 2b20 222e 2220 2b20 225c 6e22 205c 0a20  + "." + "\n" \. 
-00009f40: 2020 2020 2020 2020 2020 202b 2022 4974             + "It
-00009f50: 206d 6967 6874 2062 6520 6265 6361 7573   might be becaus
-00009f60: 6520 7468 6174 206c 6174 6573 7420 636f  e that latest co
-00009f70: 6d6d 6974 7320 696e 2220 5c0a 2020 2020  mmits in" \.    
-00009f80: 2020 2020 2020 2020 2b20 2220 6061 6e61          + " `ana
-00009f90: 6c79 7369 7360 2077 6572 6520 6e6f 7420  lysis` were not 
-00009fa0: 7075 7368 6564 2074 6f20 696e 7075 7420  pushed to input 
-00009fb0: 5249 412e 2220 5c0a 2020 2020 2020 2020  RIA." \.        
-00009fc0: 2020 2020 2b20 2220 5472 7920 7275 6e6e      + " Try runn
-00009fd0: 696e 6720 7468 6973 2063 6f6d 6d61 6e64  ing this command
-00009fe0: 2061 7420 6469 7265 6374 6f72 7920 2722   at directory '"
-00009ff0: 202b 2073 656c 662e 616e 616c 7973 6973   + self.analysis
-0000a000: 5f70 6174 6820 2b20 2227 3a20 5c6e 2220  _path + "': \n" 
-0000a010: 5c0a 2020 2020 2020 2020 2020 2020 2b20  \.            + 
-0000a020: 2224 2064 6174 616c 6164 2070 7573 6820  "$ datalad push 
-0000a030: 2d2d 746f 2069 6e70 7574 220a 0a20 2020  --to input"..   
-0000a040: 2020 2020 2023 206f 7574 7075 7420 7269       # output ri
-0000a050: 6127 7320 636f 6d6d 6974 2068 6173 683a  a's commit hash:
-0000a060: 0a20 2020 2020 2020 2070 726f 635f 6861  .        proc_ha
-0000a070: 7368 5f6f 7574 7075 745f 7269 6120 3d20  sh_output_ria = 
-0000a080: 7375 6270 726f 6365 7373 2e72 756e 280a  subprocess.run(.
-0000a090: 2020 2020 2020 2020 2020 2020 5b22 6769              ["gi
-0000a0a0: 7422 2c20 2272 6576 2d70 6172 7365 222c  t", "rev-parse",
-0000a0b0: 2022 4845 4144 225d 2c0a 2020 2020 2020   "HEAD"],.      
-0000a0c0: 2020 2020 2020 6377 643d 6163 7475 616c        cwd=actual
-0000a0d0: 5f6f 7574 7075 745f 7269 615f 6461 7461  _output_ria_data
-0000a0e0: 5f64 6972 2c20 2020 2320 7573 696e 6720  _dir,   # using 
-0000a0f0: 7468 6520 6163 7475 616c 206f 6e65 2077  the actual one w
-0000a100: 6520 6a75 7374 2067 6f74 0a20 2020 2020  e just got.     
-0000a110: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
-0000a120: 6270 726f 6365 7373 2e50 4950 4529 0a20  bprocess.PIPE). 
-0000a130: 2020 2020 2020 2070 726f 635f 6861 7368         proc_hash
-0000a140: 5f6f 7574 7075 745f 7269 612e 6368 6563  _output_ria.chec
-0000a150: 6b5f 7265 7475 726e 636f 6465 2829 0a20  k_returncode(). 
-0000a160: 2020 2020 2020 2068 6173 685f 6f75 7470         hash_outp
-0000a170: 7574 5f72 6961 203d 2070 726f 635f 6861  ut_ria = proc_ha
-0000a180: 7368 5f6f 7574 7075 745f 7269 612e 7374  sh_output_ria.st
-0000a190: 646f 7574 2e64 6563 6f64 6528 2775 7466  dout.decode('utf
-0000a1a0: 2d38 2729 2e72 6570 6c61 6365 2822 5c6e  -8').replace("\n
-0000a1b0: 222c 2022 2229 0a20 2020 2020 2020 2023  ", "").        #
-0000a1c0: 206f 6e6c 7920 7468 726f 7720 6f75 7420   only throw out 
-0000a1d0: 6120 7761 726e 696e 6720 6966 206e 6f74  a warning if not
-0000a1e0: 206d 6174 6368 6564 2c20 6173 2061 6674   matched, as aft
-0000a1f0: 6572 2074 6865 7265 2069 7320 6272 616e  er there is bran
-0000a200: 6368 2069 6e20 6f75 7470 7574 2052 4941  ch in output RIA
-0000a210: 2c0a 2020 2020 2020 2020 2320 2020 6e6f  ,.        #   no
-0000a220: 7420 7265 636f 6d6d 656e 6420 746f 2070  t recommend to p
-0000a230: 7573 6820 7570 6461 7465 7320 6672 6f6d  ush updates from
-0000a240: 2061 6e61 6c79 7369 7320 746f 206f 7574   analysis to out
-0000a250: 7075 7420 5249 413a 0a20 2020 2020 2020  put RIA:.       
-0000a260: 2069 6620 6861 7368 5f61 6e61 6c79 7369   if hash_analysi
-0000a270: 7320 213d 2068 6173 685f 6f75 7470 7574  s != hash_output
-0000a280: 5f72 6961 3a0a 2020 2020 2020 2020 2020  _ria:.          
-0000a290: 2020 666c 6167 5f77 6172 6e69 6e67 5f6f    flag_warning_o
-0000a2a0: 7574 7075 745f 7269 6120 3d20 5472 7565  utput_ria = True
-0000a2b0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-0000a2c0: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
-0000a2d0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-0000a2e0: 2068 6173 6820 6f66 2063 7572 7265 6e74   hash of current
-0000a2f0: 2063 6f6d 6d69 7420 6f66 2060 616e 616c   commit of `anal
-0000a300: 7973 6973 6020 6461 7461 6c61 6420 6461  ysis` datalad da
-0000a310: 7461 7365 7420 646f 6573 206e 6f74 206d  taset does not m
-0000a320: 6174 6368 220a 2020 2020 2020 2020 2020  atch".          
-0000a330: 2020 2020 2020 2b20 2220 7769 7468 2074        + " with t
-0000a340: 6861 7420 6f66 206f 7574 7075 7420 5249  hat of output RI
-0000a350: 412e 220a 2020 2020 2020 2020 2020 2020  A.".            
-0000a360: 2020 2020 2b20 2220 466f 726d 6572 203d      + " Former =
-0000a370: 2022 202b 2068 6173 685f 616e 616c 7973   " + hash_analys
-0000a380: 6973 202b 2022 3b22 0a20 2020 2020 2020  is + ";".       
-0000a390: 2020 2020 2020 2020 202b 2022 204c 6174           + " Lat
-0000a3a0: 7465 7220 3d20 2220 2b20 6861 7368 5f6f  ter = " + hash_o
-0000a3b0: 7574 7075 745f 7269 6120 2b20 222e 5c6e  utput_ria + ".\n
-0000a3c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a3d0: 2020 2b20 2249 7420 6d69 6768 7420 6265    + "It might be
-0000a3e0: 2062 6563 6175 7365 2074 6861 7420 6c61   because that la
-0000a3f0: 7465 7374 2063 6f6d 6d69 7473 2069 6e22  test commits in"
-0000a400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a410: 202b 2022 2060 616e 616c 7973 6973 6020   + " `analysis` 
-0000a420: 7765 7265 206e 6f74 2070 7573 6865 6420  were not pushed 
-0000a430: 746f 206f 7574 7075 7420 5249 412e 5c6e  to output RIA.\n
-0000a440: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a450: 2020 2b20 2249 6620 7468 6572 6520 6172    + "If there ar
-0000a460: 6520 616c 7265 6164 7920 7375 6363 6573  e already succes
-0000a470: 7366 756c 206a 6f62 2873 2920 6669 6e69  sful job(s) fini
-0000a480: 7368 6564 2c20 706c 6561 7365 2064 6f20  shed, please do 
-0000a490: 4e4f 5420 7075 7368 2075 7064 6174 6573  NOT push updates
-0000a4a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a4b0: 2020 2b20 2220 6672 6f6d 2060 616e 616c    + " from `anal
-0000a4c0: 7973 6973 6020 746f 206f 7574 7075 7420  ysis` to output 
-0000a4d0: 5249 412e 5c6e 220a 2020 2020 2020 2020  RIA.\n".        
-0000a4e0: 2020 2020 2020 2020 2b20 2249 6620 796f          + "If yo
-0000a4f0: 7527 7265 2073 7572 6520 7468 6572 6520  u're sure there 
-0000a500: 6973 206e 6f20 7375 6363 6573 7366 756c  is no successful
-0000a510: 206a 6f62 2066 696e 6973 6865 642c 2079   job finished, y
-0000a520: 6f75 206d 6179 2074 7279 2072 756e 6e69  ou may try runni
-0000a530: 6e67 220a 2020 2020 2020 2020 2020 2020  ng".            
-0000a540: 2020 2020 2b20 2220 7468 6973 2063 6f6d      + " this com
-0000a550: 6d61 6e64 2061 7420 6469 7265 6374 6f72  mand at director
-0000a560: 7920 2722 202b 2073 656c 662e 616e 616c  y '" + self.anal
-0000a570: 7973 6973 5f70 6174 6820 2b20 2227 3a20  ysis_path + "': 
-0000a580: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-0000a590: 2020 2020 2b20 2224 2064 6174 616c 6164      + "$ datalad
-0000a5a0: 2070 7573 6820 2d2d 746f 206f 7574 7075   push --to outpu
-0000a5b0: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
-0000a5c0: 2020 2029 0a20 2020 2020 2020 2065 6c73     ).        els
-0000a5d0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
-0000a5e0: 6c61 675f 7761 726e 696e 675f 6f75 7470  lag_warning_outp
-0000a5f0: 7574 5f72 6961 203d 2046 616c 7365 0a0a  ut_ria = False..
-0000a600: 2020 2020 2020 2020 6966 2066 6c61 675f          if flag_
+00007050: 616c 6164 2070 7573 6820 2d2d 746f 2069  alad push --to i
+00007060: 6e70 7574 0a20 2020 2020 2020 2020 2020  nput.           
+00007070: 2020 2020 2023 2020 2064 6174 616c 6164       #   datalad
+00007080: 2070 7573 6820 2d2d 746f 206f 7574 7075   push --to outpu
+00007090: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000070a0: 2020 6966 206f 702e 6578 6973 7473 2873    if op.exists(s
+000070b0: 656c 662e 696e 7075 745f 7269 615f 7061  elf.input_ria_pa
+000070c0: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+000070d0: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
+000070e0: 616c 7973 6973 5f64 6174 616c 6164 5f68  alysis_datalad_h
+000070f0: 616e 646c 652e 7075 7368 2874 6f3d 2269  andle.push(to="i
+00007100: 6e70 7574 2229 0a20 2020 2020 2020 2020  nput").         
+00007110: 2020 2020 2020 2069 6620 6f70 2e65 7869         if op.exi
+00007120: 7374 7328 7365 6c66 2e6f 7574 7075 745f  sts(self.output_
+00007130: 7269 615f 7061 7468 293a 0a20 2020 2020  ria_path):.     
+00007140: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007150: 656c 662e 616e 616c 7973 6973 5f64 6174  elf.analysis_dat
+00007160: 616c 6164 5f68 616e 646c 652e 7075 7368  alad_handle.push
+00007170: 2874 6f3d 226f 7574 7075 7422 290a 0a20  (to="output").. 
+00007180: 2020 2020 2020 2020 2020 2023 204e 6f77             # Now
+00007190: 2077 6520 6361 6e20 6465 6c65 7465 2074   we can delete t
+000071a0: 6869 7320 7072 6f6a 6563 7420 666f 6c64  his project fold
+000071b0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+000071c0: 7072 696e 7428 225c 6e44 656c 6574 696e  print("\nDeletin
+000071d0: 6720 6372 6561 7465 6420 4241 4253 2070  g created BABS p
+000071e0: 726f 6a65 6374 2066 6f6c 6465 722e 2e2e  roject folder...
+000071f0: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00007200: 726f 635f 726d 5f70 726f 6a65 6374 5f66  roc_rm_project_f
+00007210: 6f6c 6465 7220 3d20 7375 6270 726f 6365  older = subproce
+00007220: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
+00007230: 2020 2020 2020 2020 5b22 726d 222c 2022          ["rm", "
+00007240: 2d72 6622 2c20 7365 6c66 2e70 726f 6a65  -rf", self.proje
+00007250: 6374 5f72 6f6f 745d 2c0a 2020 2020 2020  ct_root],.      
+00007260: 2020 2020 2020 2020 2020 7374 646f 7574            stdout
+00007270: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
+00007280: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+00007290: 6f63 5f72 6d5f 7072 6f6a 6563 745f 666f  oc_rm_project_fo
+000072a0: 6c64 6572 2e63 6865 636b 5f72 6574 7572  lder.check_retur
+000072b0: 6e63 6f64 6528 290a 0a20 2020 2020 2020  ncode()..       
+000072c0: 2023 2063 6f6e 6669 726d 2074 6865 2042   # confirm the B
+000072d0: 4142 5320 7072 6f6a 6563 7420 6861 7320  ABS project has 
+000072e0: 6265 656e 2072 656d 6f76 6564 3a0a 2020  been removed:.  
+000072f0: 2020 2020 2020 6173 7365 7274 2028 6e6f        assert (no
+00007300: 7420 6f70 2e65 7869 7374 7328 7365 6c66  t op.exists(self
+00007310: 2e70 726f 6a65 6374 5f72 6f6f 7429 292c  .project_root)),
+00007320: 205c 0a20 2020 2020 2020 2020 2020 2022   \.            "
+00007330: 4372 6561 7465 6420 4241 4253 2070 726f  Created BABS pro
+00007340: 6a65 6374 2077 6173 206e 6f74 2063 6f6d  ject was not com
+00007350: 706c 6574 656c 7920 6465 6c65 7465 6421  pletely deleted!
+00007360: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+00007370: 2b20 2220 5061 7468 2074 6f20 6372 6561  + " Path to crea
+00007380: 7465 6420 4241 4253 2070 726f 6a65 6374  ted BABS project
+00007390: 3a20 2722 202b 2073 656c 662e 7072 6f6a  : '" + self.proj
+000073a0: 6563 745f 726f 6f74 202b 2022 2722 0a0a  ect_root + "'"..
+000073b0: 2020 2020 2020 2020 7072 696e 7428 225c          print("\
+000073c0: 6e43 7265 6174 6564 2042 4142 5320 7072  nCreated BABS pr
+000073d0: 6f6a 6563 7420 6861 7320 6265 656e 2063  oject has been c
+000073e0: 6c65 616e 6564 2075 702e 2229 0a0a 2020  leaned up.")..  
+000073f0: 2020 6465 6620 6261 6273 5f63 6865 636b    def babs_check
+00007400: 5f73 6574 7570 2873 656c 662c 2069 6e70  _setup(self, inp
+00007410: 7574 5f64 732c 2066 6c61 675f 6a6f 625f  ut_ds, flag_job_
+00007420: 7465 7374 293a 0a20 2020 2020 2020 2022  test):.        "
+00007430: 2222 0a20 2020 2020 2020 2054 6869 7320  "".        This 
+00007440: 6675 6e63 7469 6f6e 2076 616c 6964 6174  function validat
+00007450: 6573 2074 6865 2073 6574 7570 7320 6279  es the setups by
+00007460: 2062 6162 732d 696e 6974 2e0a 0a20 2020   babs-init...   
+00007470: 2020 2020 2050 6172 616d 6574 6572 733a       Parameters:
+00007480: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00007490: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000074a0: 696e 7075 745f 6473 3a20 636c 6173 7320  input_ds: class 
+000074b0: 6049 6e70 7574 5f64 7360 0a20 2020 2020  `Input_ds`.     
+000074c0: 2020 2020 2020 2069 6e66 6f72 6d61 7469         informati
+000074d0: 6f6e 206f 6620 696e 7075 7420 6461 7461  on of input data
+000074e0: 7365 7428 7329 0a20 2020 2020 2020 2066  set(s).        f
+000074f0: 6c61 675f 6a6f 625f 7465 7374 3a20 626f  lag_job_test: bo
+00007500: 6f6c 0a20 2020 2020 2020 2020 2020 2057  ol.            W
+00007510: 6865 7468 6572 2074 6f20 7375 626d 6974  hether to submit
+00007520: 2061 6e64 2072 756e 2061 2074 6573 7420   and run a test 
+00007530: 6a6f 622e 0a20 2020 2020 2020 2022 2222  job..        """
+00007540: 0a20 2020 2020 2020 2066 726f 6d20 2e63  .        from .c
+00007550: 6f6e 7374 616e 7473 2069 6d70 6f72 7420  onstants import 
+00007560: 4348 4543 4b5f 4d41 524b 0a0a 2020 2020  CHECK_MARK..    
+00007570: 2020 2020 6261 6273 5f70 726f 6a5f 636f      babs_proj_co
+00007580: 6e66 6967 203d 2072 6561 645f 7961 6d6c  nfig = read_yaml
+00007590: 2873 656c 662e 636f 6e66 6967 5f70 6174  (self.config_pat
+000075a0: 682c 2069 665f 6669 6c65 6c6f 636b 3d54  h, if_filelock=T
+000075b0: 7275 6529 0a0a 2020 2020 2020 2020 7072  rue)..        pr
+000075c0: 696e 7428 2257 696c 6c20 6368 6563 6b20  int("Will check 
+000075d0: 7365 7475 7073 206f 6620 4241 4253 2070  setups of BABS p
+000075e0: 726f 6a65 6374 206c 6f63 6174 6564 2061  roject located a
+000075f0: 743a 2022 202b 2073 656c 662e 7072 6f6a  t: " + self.proj
+00007600: 6563 745f 726f 6f74 290a 2020 2020 2020  ect_root).      
+00007610: 2020 6966 2066 6c61 675f 6a6f 625f 7465    if flag_job_te
+00007620: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00007630: 7072 696e 7428 2257 696c 6c20 7375 626d  print("Will subm
+00007640: 6974 2061 2074 6573 7420 6a6f 6220 666f  it a test job fo
+00007650: 7220 7465 7374 696e 673b 2077 696c 6c20  r testing; will 
+00007660: 7461 6b65 206c 6f6e 6765 7220 7469 6d65  take longer time
+00007670: 2e22 290a 2020 2020 2020 2020 656c 7365  .").        else
+00007680: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00007690: 696e 7428 2244 6964 206e 6f74 2072 6571  int("Did not req
+000076a0: 7565 7374 2060 2d2d 6a6f 622d 7465 7374  uest `--job-test
+000076b0: 603b 2077 696c 6c20 6e6f 7420 7375 626d  `; will not subm
+000076c0: 6974 2061 2074 6573 7420 6a6f 622e 2229  it a test job.")
+000076d0: 0a0a 2020 2020 2020 2020 2320 5072 696e  ..        # Prin
+000076e0: 7420 6f75 7420 7468 6520 7361 7665 6420  t out the saved 
+000076f0: 636f 6e66 6967 7572 6174 696f 6e20 696e  configuration in
+00007700: 666f 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  fo: ------------
+00007710: 2d2d 2d2d 0a20 2020 2020 2020 2070 7269  ----.        pri
+00007720: 6e74 2822 4265 6c6f 7720 6973 2074 6865  nt("Below is the
+00007730: 2063 6f6e 6669 6775 7261 7469 6f6e 2069   configuration i
+00007740: 6e66 6f72 6d61 7469 6f6e 2073 6176 6564  nformation saved
+00007750: 2064 7572 696e 6720 6062 6162 732d 696e   during `babs-in
+00007760: 6974 6022 0a20 2020 2020 2020 2020 2020  it`".           
+00007770: 2020 202b 2022 2069 6e20 6669 6c65 2027     + " in file '
+00007780: 616e 616c 7973 6973 2f63 6f64 652f 6261  analysis/code/ba
+00007790: 6273 5f70 726f 6a5f 636f 6e66 6967 2e79  bs_proj_config.y
+000077a0: 616d 6c27 3a5c 6e22 290a 2020 2020 2020  aml':\n").      
+000077b0: 2020 6620 3d20 6f70 656e 286f 702e 6a6f    f = open(op.jo
+000077c0: 696e 2873 656c 662e 616e 616c 7973 6973  in(self.analysis
+000077d0: 5f70 6174 682c 2022 636f 6465 2f62 6162  _path, "code/bab
+000077e0: 735f 7072 6f6a 5f63 6f6e 6669 672e 7961  s_proj_config.ya
+000077f0: 6d6c 2229 2c20 2772 2729 0a20 2020 2020  ml"), 'r').     
+00007800: 2020 2066 696c 655f 636f 6e74 656e 7473     file_contents
+00007810: 203d 2066 2e72 6561 6428 290a 2020 2020   = f.read().    
+00007820: 2020 2020 7072 696e 7428 6669 6c65 5f63      print(file_c
+00007830: 6f6e 7465 6e74 7329 0a20 2020 2020 2020  ontents).       
+00007840: 2066 2e63 6c6f 7365 2829 0a0a 2020 2020   f.close()..    
+00007850: 2020 2020 2320 4368 6563 6b20 7468 6520      # Check the 
+00007860: 7072 6f6a 6563 7420 6974 7365 6c66 3a20  project itself: 
+00007870: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00007880: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00007890: 2020 2020 7072 696e 7428 2243 6865 636b      print("Check
+000078a0: 696e 6720 7468 6520 4241 4253 2070 726f  ing the BABS pro
+000078b0: 6a65 6374 2069 7473 656c 662e 2e2e 2229  ject itself...")
+000078c0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+000078d0: 2069 6620 6061 6e61 6c79 7369 735f 7061   if `analysis_pa
+000078e0: 7468 6020 6578 6973 7473 0a20 2020 2020  th` exists.     
+000078f0: 2020 2023 2020 2028 5e5e 2074 686f 7567     #   (^^ thoug
+00007900: 6820 7368 6f75 6c64 2062 6520 6368 6563  h should be chec
+00007910: 6b65 6420 696e 2060 6765 745f 6578 6973  ked in `get_exis
+00007920: 7469 6e67 5f62 6162 735f 7072 6f6a 2829  ting_babs_proj()
+00007930: 6020 696e 2063 6c69 2e70 7929 0a20 2020  ` in cli.py).   
+00007940: 2020 2020 2061 7373 6572 7420 6f70 2e65       assert op.e
+00007950: 7869 7374 7328 7365 6c66 2e61 6e61 6c79  xists(self.analy
+00007960: 7369 735f 7061 7468 292c 205c 0a20 2020  sis_path), \.   
+00007970: 2020 2020 2020 2020 2022 466f 6c64 6572           "Folder
+00007980: 2027 616e 616c 7973 6973 2720 646f 6573   'analysis' does
+00007990: 206e 6f74 2065 7869 7374 2069 6e20 7468   not exist in th
+000079a0: 6973 2042 4142 5320 7072 6f6a 6563 7421  is BABS project!
+000079b0: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+000079c0: 2b20 2220 4375 7272 656e 7420 7061 7468  + " Current path
+000079d0: 2074 6f20 616e 616c 7973 6973 2066 6f6c   to analysis fol
+000079e0: 6465 723a 2022 202b 2073 656c 662e 616e  der: " + self.an
+000079f0: 616c 7973 6973 5f70 6174 680a 2020 2020  alysis_path.    
+00007a00: 2020 2020 2320 6966 2074 6865 7265 2069      # if there i
+00007a10: 7320 6061 6e61 6c79 7369 7360 3a0a 2020  s `analysis`:.  
+00007a20: 2020 2020 2020 2320 7570 6461 7465 2060        # update `
+00007a30: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
+00007a40: 5f68 616e 646c 6560 3a0a 2020 2020 2020  _handle`:.      
+00007a50: 2020 6966 2073 656c 662e 616e 616c 7973    if self.analys
+00007a60: 6973 5f64 6174 616c 6164 5f68 616e 646c  is_datalad_handl
+00007a70: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00007a80: 2020 2020 2020 2073 656c 662e 616e 616c         self.anal
+00007a90: 7973 6973 5f64 6174 616c 6164 5f68 616e  ysis_datalad_han
+00007aa0: 646c 6520 3d20 646c 6170 692e 4461 7461  dle = dlapi.Data
+00007ab0: 7365 7428 7365 6c66 2e61 6e61 6c79 7369  set(self.analysi
+00007ac0: 735f 7061 7468 290a 2020 2020 2020 2020  s_path).        
+00007ad0: 7072 696e 7428 4348 4543 4b5f 4d41 524b  print(CHECK_MARK
+00007ae0: 202b 2022 2041 6c6c 2067 6f6f 6421 2229   + " All good!")
+00007af0: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+00007b00: 6b20 6061 6e61 6c79 7369 7360 2064 6174  k `analysis` dat
+00007b10: 616c 6164 2064 6174 6173 6574 3a20 2d2d  alad dataset: --
+00007b20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00007b30: 2d2d 2d2d 0a20 2020 2020 2020 2070 7269  ----.        pri
+00007b40: 6e74 2822 5c6e 4368 6563 6b20 7374 6174  nt("\nCheck stat
+00007b50: 7573 206f 6620 2761 6e61 6c79 7369 7327  us of 'analysis'
+00007b60: 2044 6174 614c 6164 2064 6174 6173 6574   DataLad dataset
+00007b70: 2e2e 2e22 290a 2020 2020 2020 2020 2320  ...").        # 
+00007b80: 4172 6520 7468 6572 6520 616e 7974 6869  Are there anythi
+00007b90: 6e67 2075 6e73 6176 6564 3f20 7265 663a  ng unsaved? ref:
+00007ba0: 2043 7542 4944 5320 6675 6e63 7469 6f6e   CuBIDS function
+00007bb0: 0a20 2020 2020 2020 2061 6e61 6c79 7369  .        analysi
+00007bc0: 735f 7374 6174 7573 6573 203d 2073 6574  s_statuses = set
+00007bd0: 285b 7374 6174 7573 5b27 7374 6174 6527  ([status['state'
+00007be0: 5d20 666f 7220 7374 6174 7573 2069 6e0a  ] for status in.
+00007bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c10: 7365 6c66 2e61 6e61 6c79 7369 735f 6461  self.analysis_da
+00007c20: 7461 6c61 645f 6861 6e64 6c65 2e73 7461  talad_handle.sta
+00007c30: 7475 7328 0a20 2020 2020 2020 2020 2020  tus(.           
+00007c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c50: 2020 2020 2020 2020 2065 7661 6c5f 7375           eval_su
+00007c60: 6264 6174 6173 6574 5f73 7461 7465 3d27  bdataset_state='
+00007c70: 636f 6d6d 6974 270a 2020 2020 2020 2020  commit'.        
+00007c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c90: 2020 2020 2020 2020 2020 2020 2320 6e6f              # no
+00007ca0: 7420 746f 2066 756c 6c79 2065 7661 6c20  t to fully eval 
+00007cb0: 7375 6264 6174 6173 6574 2028 652e 672e  subdataset (e.g.
+00007cc0: 2069 6e70 7574 2064 7329 2073 7461 7475   input ds) statu
+00007cd0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00007ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007cf0: 2020 2020 2020 2320 6f74 6865 7277 6973        # otherwis
+00007d00: 652c 2077 6f75 6c64 2074 616b 6520 746f  e, would take to
+00007d10: 6f20 6c6f 6e67 2e2e 0a20 2020 2020 2020  o long...       
+00007d20: 2020 2020 2029 5d29 0a20 2020 2020 2020       )]).       
+00007d30: 2023 2073 7461 7475 7365 7320 7368 6f75   # statuses shou
+00007d40: 6c64 2062 6520 616c 6c20 2263 6c65 616e  ld be all "clean
+00007d50: 222c 2077 6974 686f 7574 2061 6e79 7468  ", without anyth
+00007d60: 696e 6720 656c 7365 2065 2e67 2e2c 2022  ing else e.g., "
+00007d70: 6d6f 6469 6669 6564 223a 0a20 2020 2020  modified":.     
+00007d80: 2020 2061 7373 6572 7420 616e 616c 7973     assert analys
+00007d90: 6973 5f73 7461 7475 7365 7320 3d3d 2073  is_statuses == s
+00007da0: 6574 285b 2263 6c65 616e 225d 292c 205c  et(["clean"]), \
+00007db0: 0a20 2020 2020 2020 2020 2020 2022 416e  .            "An
+00007dc0: 616c 7973 6973 2044 6174 614c 6164 2064  alysis DataLad d
+00007dd0: 6174 6173 6574 2773 2073 7461 7475 7320  ataset's status 
+00007de0: 6973 206e 6f74 2063 6c65 616e 2e22 205c  is not clean." \
+00007df0: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
+00007e00: 2054 6865 7265 206d 6967 6874 2062 6520   There might be 
+00007e10: 756e 7472 6163 6b65 6420 6f72 206d 6f64  untracked or mod
+00007e20: 6966 6965 6420 6669 6c65 7320 696e 2066  ified files in f
+00007e30: 6f6c 6465 7220 2761 6e61 6c79 7369 7327  older 'analysis'
+00007e40: 2e22 205c 0a20 2020 2020 2020 2020 2020  ." \.           
+00007e50: 202b 2022 2050 6c65 6173 6520 676f 2074   + " Please go t
+00007e60: 6f20 7468 6973 2064 6972 6563 746f 7279  o this directory
+00007e70: 3a20 2722 202b 2073 656c 662e 616e 616c  : '" + self.anal
+00007e80: 7973 6973 5f70 6174 6820 2b20 2227 5c6e  ysis_path + "'\n
+00007e90: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+00007ea0: 2b20 2220 616e 6420 7275 6e20 6064 6174  + " and run `dat
+00007eb0: 616c 6164 2073 7461 7475 7360 2074 6f20  alad status` to 
+00007ec0: 6368 6563 6b20 7768 6174 2077 6572 6520  check what were 
+00007ed0: 6368 616e 6765 642c 2220 5c0a 2020 2020  changed," \.    
+00007ee0: 2020 2020 2020 2020 2b20 2220 7468 656e          + " then
+00007ef0: 2072 756e 2060 6461 7461 6c61 6420 7361   run `datalad sa
+00007f00: 7665 202d 6d20 2779 6f75 7220 6d65 7373  ve -m 'your mess
+00007f10: 6167 6527 602c 2220 5c0a 2020 2020 2020  age'`," \.      
+00007f20: 2020 2020 2020 2b20 2220 7468 656e 2072        + " then r
+00007f30: 756e 2060 6461 7461 6c61 6420 7075 7368  un `datalad push
+00007f40: 202d 2d74 6f20 696e 7075 7460 3b22 205c   --to input`;" \
+00007f50: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
+00007f60: 2046 696e 616c 6c79 2c20 6966 2079 6f75   Finally, if you
+00007f70: 2772 6520 7375 7265 2074 6865 7265 2069  're sure there i
+00007f80: 7320 6e6f 2073 7563 6365 7373 6675 6c20  s no successful 
+00007f90: 6a6f 6273 2066 696e 6973 6865 642c 2079  jobs finished, y
+00007fa0: 6f75 2063 616e 2220 5c0a 2020 2020 2020  ou can" \.      
+00007fb0: 2020 2020 2020 2b20 2220 7275 6e20 6064        + " run `d
+00007fc0: 6174 616c 6164 2070 7573 6820 2d2d 746f  atalad push --to
+00007fd0: 206f 7574 7075 7460 2e22 0a20 2020 2020   output`.".     
+00007fe0: 2020 2070 7269 6e74 2843 4845 434b 5f4d     print(CHECK_M
+00007ff0: 4152 4b20 2b20 2220 416c 6c20 676f 6f64  ARK + " All good
+00008000: 2122 290a 0a20 2020 2020 2020 2023 2043  !")..        # C
+00008010: 6865 636b 2069 6e70 7574 2064 6174 6173  heck input datas
+00008020: 6574 2873 293a 202d 2d2d 2d2d 2d2d 2d2d  et(s): ---------
+00008030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00008040: 2d2d 0a20 2020 2020 2020 2070 7269 6e74  --.        print
+00008050: 2822 5c6e 4368 6563 6b69 6e67 2069 6e70  ("\nChecking inp
+00008060: 7574 2064 6174 6173 6574 2873 292e 2e2e  ut dataset(s)...
+00008070: 2229 0a20 2020 2020 2020 2023 2063 6865  ").        # che
+00008080: 636b 2069 6620 7468 6572 6520 6973 2061  ck if there is a
+00008090: 7420 6c65 6173 7420 6f6e 6520 666f 6c64  t least one fold
+000080a0: 6572 2069 6e20 7468 6520 6069 6e70 7574  er in the `input
+000080b0: 732f 6461 7461 6020 6469 723a 0a20 2020  s/data` dir:.   
+000080c0: 2020 2020 2074 656d 705f 6c69 7374 203d       temp_list =
+000080d0: 2067 6574 5f69 6d6d 6564 6961 7465 5f73   get_immediate_s
+000080e0: 7562 6469 7265 6374 6f72 6965 7328 6f70  ubdirectories(op
+000080f0: 2e6a 6f69 6e28 7365 6c66 2e61 6e61 6c79  .join(self.analy
+00008100: 7369 735f 7061 7468 2c20 2269 6e70 7574  sis_path, "input
+00008110: 732f 6461 7461 2229 290a 2020 2020 2020  s/data")).      
+00008120: 2020 6173 7365 7274 206c 656e 2874 656d    assert len(tem
+00008130: 705f 6c69 7374 2920 3e20 302c 205c 0a20  p_list) > 0, \. 
+00008140: 2020 2020 2020 2020 2020 2022 5468 6572             "Ther
+00008150: 6520 6973 206e 6f20 7375 622d 6469 7265  e is no sub-dire
+00008160: 6374 6f72 7920 2869 2e65 2e2c 206e 6f20  ctory (i.e., no 
+00008170: 696e 7075 7420 6461 7461 7365 7429 2069  input dataset) i
+00008180: 6e20 2769 6e70 7574 732f 6461 7461 2721  n 'inputs/data'!
+00008190: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+000081a0: 2b20 2220 4675 6c6c 2070 6174 6820 746f  + " Full path to
+000081b0: 2066 6f6c 6465 7220 2769 6e70 7574 732f   folder 'inputs/
+000081c0: 6461 7461 273a 2022 202b 206f 702e 6a6f  data': " + op.jo
+000081d0: 696e 2873 656c 662e 616e 616c 7973 6973  in(self.analysis
+000081e0: 5f70 6174 682c 2022 696e 7075 7473 2f64  _path, "inputs/d
+000081f0: 6174 6122 290a 0a20 2020 2020 2020 2023  ata")..        #
+00008200: 2063 6865 636b 2065 6163 6820 696e 7075   check each inpu
+00008210: 7420 6473 3a0a 2020 2020 2020 2020 666f  t ds:.        fo
+00008220: 7220 695f 6473 2069 6e20 7261 6e67 6528  r i_ds in range(
+00008230: 302c 2069 6e70 7574 5f64 732e 6e75 6d5f  0, input_ds.num_
+00008240: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
+00008250: 2070 6174 685f 6e6f 775f 6162 7320 3d20   path_now_abs = 
+00008260: 696e 7075 745f 6473 2e64 665b 2270 6174  input_ds.df["pat
+00008270: 685f 6e6f 775f 6162 7322 5d5b 695f 6473  h_now_abs"][i_ds
+00008280: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+00008290: 2063 6865 636b 2069 6620 7468 6520 6469   check if the di
+000082a0: 7220 6f66 2074 6869 7320 696e 7075 7420  r of this input 
+000082b0: 6473 2065 7869 7374 733a 0a20 2020 2020  ds exists:.     
+000082c0: 2020 2020 2020 2061 7373 6572 7420 6f70         assert op
+000082d0: 2e65 7869 7374 7328 7061 7468 5f6e 6f77  .exists(path_now
+000082e0: 5f61 6273 292c 205c 0a20 2020 2020 2020  _abs), \.       
+000082f0: 2020 2020 2020 2020 2022 5468 6520 7061           "The pa
+00008300: 7468 2074 6f20 7468 6520 636c 6f6e 6564  th to the cloned
+00008310: 2069 6e70 7574 2064 6174 6173 6574 2023   input dataset #
+00008320: 2220 2b20 7374 7228 695f 6473 202b 2031  " + str(i_ds + 1
+00008330: 2920 5c0a 2020 2020 2020 2020 2020 2020  ) \.            
+00008340: 2020 2020 2b20 2220 2722 202b 2069 6e70      + " '" + inp
+00008350: 7574 5f64 732e 6466 5b22 6e61 6d65 225d  ut_ds.df["name"]
+00008360: 5b69 5f64 735d 202b 2022 2720 646f 6573  [i_ds] + "' does
+00008370: 206e 6f74 2065 7869 7374 3a20 2220 5c0a   not exist: " \.
+00008380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008390: 2b20 7061 7468 5f6e 6f77 5f61 6273 0a0a  + path_now_abs..
+000083a0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
+000083b0: 6563 6b20 6966 2064 6972 206f 6620 696e  eck if dir of in
+000083c0: 7075 7420 6473 2069 7320 6120 6461 7461  put ds is a data
+000083d0: 6c61 6420 6461 7461 7365 743a 0a20 2020  lad dataset:.   
+000083e0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000083f0: 6f70 2e65 7869 7374 7328 6f70 2e6a 6f69  op.exists(op.joi
+00008400: 6e28 7061 7468 5f6e 6f77 5f61 6273 2c20  n(path_now_abs, 
+00008410: 222e 6461 7461 6c61 642f 636f 6e66 6967  ".datalad/config
+00008420: 2229 292c 205c 0a20 2020 2020 2020 2020  ")), \.         
+00008430: 2020 2020 2020 2022 5468 6520 696e 7075         "The inpu
+00008440: 7420 6461 7461 7365 7420 2322 202b 2073  t dataset #" + s
+00008450: 7472 2869 5f64 7320 2b20 3129 205c 0a20  tr(i_ds + 1) \. 
+00008460: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00008470: 2022 2027 2220 2b20 696e 7075 745f 6473   " '" + input_ds
+00008480: 2e64 665b 226e 616d 6522 5d5b 695f 6473  .df["name"][i_ds
+00008490: 5d20 2b20 2227 2069 7320 6e6f 7420 6120  ] + "' is not a 
+000084a0: 7661 6c69 6420 4461 7461 4c61 6420 6461  valid DataLad da
+000084b0: 7461 7365 743a 2220 5c0a 2020 2020 2020  taset:" \.      
+000084c0: 2020 2020 2020 2020 2020 2b20 2220 5468            + " Th
+000084d0: 6572 6520 6973 206e 6f20 6669 6c65 2027  ere is no file '
+000084e0: 2e64 6174 616c 6164 2f63 6f6e 6669 6727  .datalad/config'
+000084f0: 2069 6e20 6974 7320 6469 7265 6374 6f72   in its director
+00008500: 793a 2022 202b 2070 6174 685f 6e6f 775f  y: " + path_now_
+00008510: 6162 730a 0a20 2020 2020 2020 2020 2020  abs..           
+00008520: 2023 2052 4f41 444d 4150 3a20 6368 6563   # ROADMAP: chec
+00008530: 6b20 6966 2069 6e70 7574 2064 6174 6173  k if input datas
+00008540: 6574 2049 4420 7361 7665 6420 696e 2059  et ID saved in Y
+00008550: 414d 4c20 6669 6c65 0a20 2020 2020 2020  AML file.       
+00008560: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+00008570: 2028 6e6f 7420 7361 7665 6420 7965 742c   (not saved yet,
+00008580: 2061 6c73 6f20 6e65 6564 2074 6f20 6164   also need to ad
+00008590: 6420 746f 2049 6e70 7574 5f64 7320 636c  d to Input_ds cl
+000085a0: 6173 7320 746f 6f29 0a20 2020 2020 2020  ass too).       
+000085b0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+000085c0: 203d 2074 6861 7420 696e 2060 2e67 6974   = that in `.git
+000085d0: 6d6f 6475 6c65 7360 2069 6e20 636c 6f6e  modules` in clon
+000085e0: 6564 2064 730a 2020 2020 2020 2020 2020  ed ds.          
+000085f0: 2020 2320 2020 486f 7765 7665 722c 2049    #   However, I
+00008600: 7427 7320 7072 6574 7479 2075 6e6c 696b  t's pretty unlik
+00008610: 656c 7920 7468 6174 2073 6f6d 656f 6e65  ely that someone
+00008620: 2063 6861 6e67 6573 2069 6e70 7574 732f   changes inputs/
+00008630: 6461 7461 206f 6e20 7468 6569 7220 6f77  data on their ow
+00008640: 6e0a 2020 2020 2020 2020 2020 2020 2320  n.            # 
+00008650: 2020 2020 2020 6966 2074 6865 7927 7265        if they're
+00008660: 2075 7369 6e67 2042 4142 530a 0a20 2020   using BABS..   
+00008670: 2020 2020 2070 7269 6e74 2843 4845 434b       print(CHECK
+00008680: 5f4d 4152 4b20 2b20 2220 416c 6c20 676f  _MARK + " All go
+00008690: 6f64 2122 290a 0a20 2020 2020 2020 2023  od!")..        #
+000086a0: 2043 6865 636b 2063 6f6e 7461 696e 6572   Check container
+000086b0: 2064 6174 616c 6164 2064 6174 6173 6574   datalad dataset
+000086c0: 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  : --------------
+000086d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
+000086e0: 2020 2020 2020 7072 696e 7428 225c 6e43        print("\nC
+000086f0: 6865 636b 696e 6720 636f 6e74 6169 6e65  hecking containe
+00008700: 7220 6461 7461 6c61 6420 6461 7461 7365  r datalad datase
+00008710: 742e 2e2e 2229 0a20 2020 2020 2020 2066  t...").        f
+00008720: 6f6c 6465 725f 636f 6e74 6169 6e65 7220  older_container 
+00008730: 3d20 6f70 2e6a 6f69 6e28 7365 6c66 2e61  = op.join(self.a
+00008740: 6e61 6c79 7369 735f 7061 7468 2c20 2263  nalysis_path, "c
+00008750: 6f6e 7461 696e 6572 7322 290a 2020 2020  ontainers").    
+00008760: 2020 2020 636f 6e74 6169 6e65 725f 6e61      container_na
+00008770: 6d65 203d 2062 6162 735f 7072 6f6a 5f63  me = babs_proj_c
+00008780: 6f6e 6669 675b 2263 6f6e 7461 696e 6572  onfig["container
+00008790: 225d 5b22 6e61 6d65 225d 0a20 2020 2020  "]["name"].     
+000087a0: 2020 2023 2061 7373 6572 7420 6974 2773     # assert it's
+000087b0: 2061 2064 6174 616c 6164 2064 7320 696e   a datalad ds in
+000087c0: 2060 636f 6e74 6169 6e65 7273 6020 666f   `containers` fo
+000087d0: 6c64 6572 3a0a 2020 2020 2020 2020 6173  lder:.        as
+000087e0: 7365 7274 206f 702e 6578 6973 7473 286f  sert op.exists(o
+000087f0: 702e 6a6f 696e 2866 6f6c 6465 725f 636f  p.join(folder_co
+00008800: 6e74 6169 6e65 722c 2022 2e64 6174 616c  ntainer, ".datal
+00008810: 6164 2f63 6f6e 6669 6722 2929 2c20 5c0a  ad/config")), \.
+00008820: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+00008830: 7265 2069 7320 6e6f 2063 6f6e 7461 696e  re is no contain
+00008840: 6572 7320 4461 7461 4c61 6420 6461 7461  ers DataLad data
+00008850: 7365 7420 696e 2066 6f6c 6465 723a 2022  set in folder: "
+00008860: 202b 2066 6f6c 6465 725f 636f 6e74 6169   + folder_contai
+00008870: 6e65 720a 0a20 2020 2020 2020 2023 2052  ner..        # R
+00008880: 4f41 444d 4150 3a20 6368 6563 6b20 6966  OADMAP: check if
+00008890: 2063 6f6e 7461 696e 6572 2064 6174 6173   container datas
+000088a0: 6574 2049 4420 7361 7665 6420 696e 2059  et ID saved in Y
+000088b0: 414d 4c20 6669 6c65 2028 6e6f 7420 7361  AML file (not sa
+000088c0: 7665 6420 7965 7429 0a20 2020 2020 2020  ved yet).       
+000088d0: 2023 2020 2020 2020 2020 2020 2028 6e6f   #           (no
+000088e0: 7420 7361 7665 6420 7965 742c 2070 726f  t saved yet, pro
+000088f0: 6261 626c 7920 6265 7474 6572 2074 6f20  bably better to 
+00008900: 6164 6420 746f 2043 6f6e 7461 696e 6572  add to Container
+00008910: 2063 6c61 7373 3f29 0a20 2020 2020 2020   class?).       
+00008920: 2023 2020 2020 2020 2020 2020 203d 2074   #           = t
+00008930: 6861 7420 696e 2060 2e67 6974 6d6f 6475  hat in `.gitmodu
+00008940: 6c65 7360 2069 6e20 636c 6f6e 6564 2064  les` in cloned d
+00008950: 730a 2020 2020 2020 2020 2320 2020 486f  s.        #   Ho
+00008960: 7765 7665 722c 2049 7427 7320 7072 6574  wever, It's pret
+00008970: 7479 2075 6e6c 696b 656c 7920 7468 6174  ty unlikely that
+00008980: 2073 6f6d 656f 6e65 2063 6861 6e67 6573   someone changes
+00008990: 2069 7420 6f6e 2074 6865 6972 206f 776e   it on their own
+000089a0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+000089b0: 2069 6620 7468 6579 2772 6520 7573 696e   if they're usin
+000089c0: 6720 4241 4253 0a0a 2020 2020 2020 2020  g BABS..        
+000089d0: 2320 6e6f 2061 6374 696f 6e20 6e6f 773b  # no action now;
+000089e0: 2077 6865 6e20 6062 6162 732d 696e 6974   when `babs-init
+000089f0: 602c 2068 6173 2064 6f6e 6520 6043 6f6e  `, has done `Con
+00008a00: 7461 696e 6572 2e73 616e 6974 795f 6368  tainer.sanity_ch
+00008a10: 6563 6b28 2960 0a20 2020 2020 2020 2023  eck()`.        #
+00008a20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00008a30: 6f20 6d61 6b65 2073 7572 6520 7468 6520  o make sure the 
+00008a40: 636f 6e74 6169 6e65 7220 6e61 6d65 6420  container named 
+00008a50: 6063 6f6e 7461 696e 6572 5f6e 616d 6560  `container_name`
+00008a60: 2065 7869 7374 732e 0a20 2020 2020 2020   exists..       
+00008a70: 2070 7269 6e74 2843 4845 434b 5f4d 4152   print(CHECK_MAR
+00008a80: 4b20 2b20 2220 416c 6c20 676f 6f64 2122  K + " All good!"
+00008a90: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
+00008aa0: 636b 2060 616e 616c 7973 6973 2f63 6f64  ck `analysis/cod
+00008ab0: 6560 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  e`: ------------
+00008ac0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00008ad0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7072  -----.        pr
+00008ae0: 696e 7428 225c 6e43 6865 636b 696e 6720  int("\nChecking 
+00008af0: 6061 6e61 6c79 7369 732f 636f 6465 2f60  `analysis/code/`
+00008b00: 2066 6f6c 6465 722e 2e2e 2229 0a20 2020   folder...").   
+00008b10: 2020 2020 2023 2066 6f6c 6465 7220 6061       # folder `a
+00008b20: 6e61 6c79 7369 732f 636f 6465 6020 7368  nalysis/code` sh
+00008b30: 6f75 6c64 2065 7869 7374 3a0a 2020 2020  ould exist:.    
+00008b40: 2020 2020 6173 7365 7274 206f 702e 6578      assert op.ex
+00008b50: 6973 7473 286f 702e 6a6f 696e 2873 656c  ists(op.join(sel
+00008b60: 662e 616e 616c 7973 6973 5f70 6174 682c  f.analysis_path,
+00008b70: 2022 636f 6465 2229 292c 205c 0a20 2020   "code")), \.   
+00008b80: 2020 2020 2020 2020 2022 466f 6c64 6572           "Folder
+00008b90: 2027 636f 6465 2720 646f 6573 206e 6f74   'code' does not
+00008ba0: 2065 7869 7374 2069 6e20 2761 6e61 6c79   exist in 'analy
+00008bb0: 7369 7327 2066 6f6c 6465 7221 220a 0a20  sis' folder!".. 
+00008bc0: 2020 2020 2020 2023 2061 7373 6572 7420         # assert 
+00008bd0: 7468 6520 6c69 7374 206f 6620 6669 6c65  the list of file
+00008be0: 7320 696e 2074 6865 2060 636f 6465 6020  s in the `code` 
+00008bf0: 666f 6c64 6572 2c0a 2020 2020 2020 2020  folder,.        
+00008c00: 2320 2020 616e 6420 6261 7368 2066 696c  #   and bash fil
+00008c10: 6573 2073 686f 756c 6420 6265 2065 7865  es should be exe
+00008c20: 6375 7461 626c 653a 0a20 2020 2020 2020  cutable:.       
+00008c30: 206c 6973 745f 6669 6c65 735f 636f 6465   list_files_code
+00008c40: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00008c50: 2022 6261 6273 5f70 726f 6a5f 636f 6e66   "babs_proj_conf
+00008c60: 6967 2e79 616d 6c22 2c0a 2020 2020 2020  ig.yaml",.      
+00008c70: 2020 2020 2020 636f 6e74 6169 6e65 725f        container_
+00008c80: 6e61 6d65 202b 2022 5f7a 6970 2e73 6822  name + "_zip.sh"
+00008c90: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
+00008ca0: 6172 7469 6369 7061 6e74 5f6a 6f62 2e73  articipant_job.s
+00008cb0: 6822 2c0a 2020 2020 2020 2020 2020 2020  h",.            
+00008cc0: 2273 7562 6d69 745f 6a6f 625f 7465 6d70  "submit_job_temp
+00008cd0: 6c61 7465 2e79 616d 6c22 0a20 2020 2020  late.yaml".     
+00008ce0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00008cf0: 2069 6620 7365 6c66 2e74 7970 655f 7365   if self.type_se
+00008d00: 7373 696f 6e20 3d3d 2022 7369 6e67 6c65  ssion == "single
+00008d10: 2d73 6573 223a 0a20 2020 2020 2020 2020  -ses":.         
+00008d20: 2020 206c 6973 745f 6669 6c65 735f 636f     list_files_co
+00008d30: 6465 2e61 7070 656e 6428 2273 7562 5f66  de.append("sub_f
+00008d40: 696e 616c 5f69 6e63 6c75 2e63 7376 2229  inal_inclu.csv")
+00008d50: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00008d60: 2020 2020 2020 2020 2020 206c 6973 745f             list_
+00008d70: 6669 6c65 735f 636f 6465 2e61 7070 656e  files_code.appen
+00008d80: 6428 2273 7562 5f73 6573 5f66 696e 616c  d("sub_ses_final
+00008d90: 5f69 6e63 6c75 2e63 7376 2229 0a0a 2020  _inclu.csv")..  
+00008da0: 2020 2020 2020 666f 7220 7465 6d70 5f66        for temp_f
+00008db0: 696c 656e 616d 6520 696e 206c 6973 745f  ilename in list_
+00008dc0: 6669 6c65 735f 636f 6465 3a0a 2020 2020  files_code:.    
+00008dd0: 2020 2020 2020 2020 7465 6d70 5f66 6e20          temp_fn 
+00008de0: 3d20 6f70 2e6a 6f69 6e28 7365 6c66 2e61  = op.join(self.a
+00008df0: 6e61 6c79 7369 735f 7061 7468 2c20 2263  nalysis_path, "c
+00008e00: 6f64 6522 2c20 7465 6d70 5f66 696c 656e  ode", temp_filen
+00008e10: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00008e20: 2023 2074 6865 2066 696c 6520 7368 6f75   # the file shou
+00008e30: 6c64 2065 7869 7374 3a0a 2020 2020 2020  ld exist:.      
+00008e40: 2020 2020 2020 6173 7365 7274 206f 702e        assert op.
+00008e50: 6973 6669 6c65 2874 656d 705f 666e 292c  isfile(temp_fn),
+00008e60: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00008e70: 2020 2022 5265 7175 6972 6564 2066 696c     "Required fil
+00008e80: 6520 2722 202b 2074 656d 705f 6669 6c65  e '" + temp_file
+00008e90: 6e61 6d65 202b 2022 2720 646f 6573 206e  name + "' does n
+00008ea0: 6f74 2065 7869 7374 2220 5c0a 2020 2020  ot exist" \.    
+00008eb0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+00008ec0: 696e 2027 616e 616c 7973 6973 2f63 6f64  in 'analysis/cod
+00008ed0: 6527 2066 6f6c 6465 7220 696e 2074 6869  e' folder in thi
+00008ee0: 7320 4241 4253 2070 726f 6a65 6374 2122  s BABS project!"
+00008ef0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+00008f00: 6865 636b 2069 6620 6261 7368 2066 696c  heck if bash fil
+00008f10: 6573 2061 7265 2065 7865 6375 7461 626c  es are executabl
+00008f20: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00008f30: 6620 6f70 2e73 706c 6974 6578 7428 7465  f op.splitext(te
+00008f40: 6d70 5f66 6e29 5b31 5d20 3d3d 2022 2e73  mp_fn)[1] == ".s
+00008f50: 6822 3a20 2020 2320 6578 7465 6e73 696f  h":   # extensio
+00008f60: 6e20 6973 2027 2e73 6827 3a0a 2020 2020  n is '.sh':.    
+00008f70: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00008f80: 7274 206f 732e 6163 6365 7373 2874 656d  rt os.access(tem
+00008f90: 705f 666e 2c20 6f73 2e58 5f4f 4b29 2c20  p_fn, os.X_OK), 
+00008fa0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00008fb0: 2020 2020 2020 2254 6869 7320 636f 6465        "This code
+00008fc0: 2066 696c 6520 7368 6f75 6c64 2062 6520   file should be 
+00008fd0: 6578 6563 7574 6162 6c65 3a20 2220 2b20  executable: " + 
+00008fe0: 7465 6d70 5f66 6e0a 2020 2020 2020 2020  temp_fn.        
+00008ff0: 7072 696e 7428 4348 4543 4b5f 4d41 524b  print(CHECK_MARK
+00009000: 202b 2022 2041 6c6c 2067 6f6f 6421 2229   + " All good!")
+00009010: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+00009020: 6b20 696e 7075 7420 616e 6420 6f75 7470  k input and outp
+00009030: 7574 2052 4941 3a20 2d2d 2d2d 2d2d 2d2d  ut RIA: --------
+00009040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+00009050: 2020 2020 2020 2070 7269 6e74 2822 5c6e         print("\n
+00009060: 4368 6563 6b69 6e67 2069 6e70 7574 2061  Checking input a
+00009070: 6e64 206f 7574 7075 7420 5249 412e 2e2e  nd output RIA...
+00009080: 2229 0a0a 2020 2020 2020 2020 2320 6368  ")..        # ch
+00009090: 6563 6b20 6966 2074 6865 7920 6172 6520  eck if they are 
+000090a0: 7369 626c 696e 6773 206f 6620 6061 6e61  siblings of `ana
+000090b0: 6c79 7369 7360 3a0a 2020 2020 2020 2020  lysis`:.        
+000090c0: 7072 696e 7428 225c 7444 6174 616c 6164  print("\tDatalad
+000090d0: 2064 6174 6173 6574 2060 616e 616c 7973   dataset `analys
+000090e0: 6973 6027 7320 7369 626c 696e 6773 3a22  is`'s siblings:"
+000090f0: 290a 2020 2020 2020 2020 616e 616c 7973  ).        analys
+00009100: 6973 5f73 6962 6c69 6e67 7320 3d20 7365  is_siblings = se
+00009110: 6c66 2e61 6e61 6c79 7369 735f 6461 7461  lf.analysis_data
+00009120: 6c61 645f 6861 6e64 6c65 2e73 6962 6c69  lad_handle.sibli
+00009130: 6e67 7328 6163 7469 6f6e 3d27 7175 6572  ngs(action='quer
+00009140: 7927 290a 2020 2020 2020 2020 2320 6765  y').        # ge
+00009150: 7420 7468 6520 6163 7475 616c 2060 6f75  t the actual `ou
+00009160: 7470 7574 5f72 6961 5f64 6174 615f 6469  tput_ria_data_di
+00009170: 7260 3b0a 2020 2020 2020 2020 2320 2020  r`;.        #   
+00009180: 7468 6520 6f6e 6520 696e 2060 7365 6c66  the one in `self
+00009190: 6020 6174 7472 2069 7320 6469 7265 6374  ` attr is direct
+000091a0: 6c79 2067 6f74 2066 726f 6d20 6061 6e61  ly got from `ana
+000091b0: 6c79 7369 7360 2072 656d 6f74 652c 0a20  lysis` remote,. 
+000091c0: 2020 2020 2020 2023 2020 2073 6f20 7368         #   so sh
+000091d0: 6f75 6c64 206e 6f74 2075 7365 2074 6861  ould not use tha
+000091e0: 7420 6865 7265 2e0a 2020 2020 2020 2020  t here..        
+000091f0: 2320 6f75 7470 7574 5f72 6961 3a0a 2020  # output_ria:.  
+00009200: 2020 2020 2020 6163 7475 616c 5f6f 7574        actual_out
+00009210: 7075 745f 7269 615f 6461 7461 5f64 6972  put_ria_data_dir
+00009220: 203d 206f 732e 7265 6164 6c69 6e6b 280a   = os.readlink(.
+00009230: 2020 2020 2020 2020 2020 2020 6f70 2e6a              op.j
+00009240: 6f69 6e28 7365 6c66 2e6f 7574 7075 745f  oin(self.output_
+00009250: 7269 615f 7061 7468 2c20 2261 6c69 6173  ria_path, "alias
+00009260: 2f64 6174 6122 2929 2020 2023 2067 6574  /data"))   # get
+00009270: 2074 6865 2073 796d 6c69 6e6b 206f 6620   the symlink of 
+00009280: 6061 6c69 6173 2f64 6174 6160 0a20 2020  `alias/data`.   
+00009290: 2020 2020 2061 7373 6572 7420 6f70 2e65       assert op.e
+000092a0: 7869 7374 7328 6163 7475 616c 5f6f 7574  xists(actual_out
+000092b0: 7075 745f 7269 615f 6461 7461 5f64 6972  put_ria_data_dir
+000092c0: 2920 2020 2023 206d 616b 6520 7375 7265  )    # make sure
+000092d0: 2074 6869 7320 6578 6973 7473 0a20 2020   this exists.   
+000092e0: 2020 2020 2023 2067 6574 2027 3030 302f       # get '000/
+000092f0: 3030 3030 2d30 3030 302d 3030 3030 2d30  0000-0000-0000-0
+00009300: 3030 3027 3a0a 2020 2020 2020 2020 6461  000':.        da
+00009310: 7461 5f66 6f6c 6465 726e 616d 6520 3d20  ta_foldername = 
+00009320: 6f70 2e6a 6f69 6e28 0a20 2020 2020 2020  op.join(.       
+00009330: 2020 2020 206f 702e 6261 7365 6e61 6d65       op.basename
+00009340: 286f 702e 6469 726e 616d 6528 6163 7475  (op.dirname(actu
+00009350: 616c 5f6f 7574 7075 745f 7269 615f 6461  al_output_ria_da
+00009360: 7461 5f64 6972 2929 2c0a 2020 2020 2020  ta_dir)),.      
+00009370: 2020 2020 2020 6f70 2e62 6173 656e 616d        op.basenam
+00009380: 6528 6163 7475 616c 5f6f 7574 7075 745f  e(actual_output_
+00009390: 7269 615f 6461 7461 5f64 6972 2929 0a20  ria_data_dir)). 
+000093a0: 2020 2020 2020 2023 2069 6e70 7574 5f72         # input_r
+000093b0: 6961 3a0a 2020 2020 2020 2020 6163 7475  ia:.        actu
+000093c0: 616c 5f69 6e70 7574 5f72 6961 5f64 6174  al_input_ria_dat
+000093d0: 615f 6469 7220 3d20 6f70 2e6a 6f69 6e28  a_dir = op.join(
+000093e0: 7365 6c66 2e69 6e70 7574 5f72 6961 5f70  self.input_ria_p
+000093f0: 6174 682c 2064 6174 615f 666f 6c64 6572  ath, data_folder
+00009400: 6e61 6d65 290a 2020 2020 2020 2020 6173  name).        as
+00009410: 7365 7274 206f 702e 6578 6973 7473 2861  sert op.exists(a
+00009420: 6374 7561 6c5f 696e 7075 745f 7269 615f  ctual_input_ria_
+00009430: 6461 7461 5f64 6972 2920 2020 2023 206d  data_dir)    # m
+00009440: 616b 6520 7375 7265 2074 6869 7320 6578  ake sure this ex
+00009450: 6973 7473 0a0a 2020 2020 2020 2020 6966  ists..        if
+00009460: 5f66 6f75 6e64 5f73 6962 6c69 6e67 5f69  _found_sibling_i
+00009470: 6e70 7574 203d 2046 616c 7365 0a20 2020  nput = False.   
+00009480: 2020 2020 2069 665f 666f 756e 645f 7369       if_found_si
+00009490: 626c 696e 675f 6f75 7470 7574 203d 2046  bling_output = F
+000094a0: 616c 7365 0a20 2020 2020 2020 2066 6f72  alse.        for
+000094b0: 2069 5f73 6962 6c69 6e67 2069 6e20 7261   i_sibling in ra
+000094c0: 6e67 6528 302c 206c 656e 2861 6e61 6c79  nge(0, len(analy
+000094d0: 7369 735f 7369 626c 696e 6773 2929 3a0a  sis_siblings)):.
+000094e0: 2020 2020 2020 2020 2020 2020 7468 655f              the_
+000094f0: 7369 626c 696e 6720 3d20 616e 616c 7973  sibling = analys
+00009500: 6973 5f73 6962 6c69 6e67 735b 695f 7369  is_siblings[i_si
+00009510: 626c 696e 675d 0a20 2020 2020 2020 2020  bling].         
+00009520: 2020 2069 6620 7468 655f 7369 626c 696e     if the_siblin
+00009530: 675b 226e 616d 6522 5d20 3d3d 2022 6f75  g["name"] == "ou
+00009540: 7470 7574 223a 2020 2023 206f 7574 7075  tput":   # outpu
+00009550: 7420 7269 613a 0a20 2020 2020 2020 2020  t ria:.         
+00009560: 2020 2020 2020 2069 665f 666f 756e 645f         if_found_
+00009570: 7369 626c 696e 675f 6f75 7470 7574 203d  sibling_output =
+00009580: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00009590: 2020 2020 2020 6173 7365 7274 2074 6865        assert the
+000095a0: 5f73 6962 6c69 6e67 5b22 7572 6c22 5d20  _sibling["url"] 
+000095b0: 3d3d 2061 6374 7561 6c5f 6f75 7470 7574  == actual_output
+000095c0: 5f72 6961 5f64 6174 615f 6469 722c 205c  _ria_data_dir, \
+000095d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000095e0: 2020 2020 2022 5468 6520 6061 6e61 6c79       "The `analy
+000095f0: 7369 7360 2064 6174 616c 6164 2064 6174  sis` datalad dat
+00009600: 6173 6574 2773 2073 6962 6c69 6e67 2027  aset's sibling '
+00009610: 6f75 7470 7574 2720 7572 6c20 646f 6573  output' url does
+00009620: 206e 6f74 206d 6174 6368 2220 5c0a 2020   not match" \.  
+00009630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009640: 2020 2b20 2220 7468 6520 7061 7468 2074    + " the path t
+00009650: 6f20 7468 6520 6f75 7470 7574 2052 4941  o the output RIA
+00009660: 2e22 205c 0a20 2020 2020 2020 2020 2020  ." \.           
+00009670: 2020 2020 2020 2020 202b 2022 2046 6f72           + " For
+00009680: 6d65 7220 3d20 2220 2b20 7468 655f 7369  mer = " + the_si
+00009690: 626c 696e 675b 2275 726c 225d 202b 2022  bling["url"] + "
+000096a0: 3b22 205c 0a20 2020 2020 2020 2020 2020  ;" \.           
+000096b0: 2020 2020 2020 2020 202b 2022 204c 6174           + " Lat
+000096c0: 7465 7220 3d20 2220 2b20 6163 7475 616c  ter = " + actual
+000096d0: 5f6f 7574 7075 745f 7269 615f 6461 7461  _output_ria_data
+000096e0: 5f64 6972 0a20 2020 2020 2020 2020 2020  _dir.           
+000096f0: 2069 6620 7468 655f 7369 626c 696e 675b   if the_sibling[
+00009700: 226e 616d 6522 5d20 3d3d 2022 696e 7075  "name"] == "inpu
+00009710: 7422 3a20 2020 2320 696e 7075 7420 7269  t":   # input ri
+00009720: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+00009730: 2020 2069 665f 666f 756e 645f 7369 626c     if_found_sibl
+00009740: 696e 675f 696e 7075 7420 3d20 5472 7565  ing_input = True
+00009750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009760: 2061 7373 6572 7420 7468 655f 7369 626c   assert the_sibl
+00009770: 696e 675b 2275 726c 225d 203d 3d20 6163  ing["url"] == ac
+00009780: 7475 616c 5f69 6e70 7574 5f72 6961 5f64  tual_input_ria_d
+00009790: 6174 615f 6469 722c 205c 0a20 2020 2020  ata_dir, \.     
+000097a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000097b0: 5468 6520 6061 6e61 6c79 7369 7360 2064  The `analysis` d
+000097c0: 6174 616c 6164 2064 6174 6173 6574 2773  atalad dataset's
+000097d0: 2073 6962 6c69 6e67 2027 696e 7075 7427   sibling 'input'
+000097e0: 2075 726c 2064 6f65 7320 6e6f 7420 6d61   url does not ma
+000097f0: 7463 6822 205c 0a20 2020 2020 2020 2020  tch" \.         
+00009800: 2020 2020 2020 2020 2020 202b 2022 2074             + " t
+00009810: 6865 2070 6174 6820 746f 2074 6865 2069  he path to the i
+00009820: 6e70 7574 2052 4941 2e22 205c 0a20 2020  nput RIA." \.   
+00009830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009840: 202b 2022 2046 6f72 6d65 7220 3d20 2220   + " Former = " 
+00009850: 2b20 7468 655f 7369 626c 696e 675b 2275  + the_sibling["u
+00009860: 726c 225d 202b 2022 3b22 205c 0a20 2020  rl"] + ";" \.   
+00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009880: 202b 2022 204c 6174 7465 7220 3d20 2220   + " Latter = " 
+00009890: 2b20 6163 7475 616c 5f69 6e70 7574 5f72  + actual_input_r
+000098a0: 6961 5f64 6174 615f 6469 720a 2020 2020  ia_data_dir.    
+000098b0: 2020 2020 6966 206e 6f74 2069 665f 666f      if not if_fo
+000098c0: 756e 645f 7369 626c 696e 675f 696e 7075  und_sibling_inpu
+000098d0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+000098e0: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+000098f0: 4469 6420 6e6f 7420 6669 6e64 2061 2073  Did not find a s
+00009900: 6962 6c69 6e67 206f 6620 2761 6e61 6c79  ibling of 'analy
+00009910: 7369 7327 2044 6174 614c 6164 2064 6174  sis' DataLad dat
+00009920: 6173 6574 220a 2020 2020 2020 2020 2020  aset".          
+00009930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009940: 2020 2b20 2220 7468 6174 2773 2063 616c    + " that's cal
+00009950: 6c65 6420 2769 6e70 7574 272e 2054 6865  led 'input'. The
+00009960: 7265 206d 6179 2062 6520 736f 6d65 7468  re may be someth
+00009970: 696e 6720 7772 6f6e 6720 7768 656e 220a  ing wrong when".
+00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009990: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+000099a0: 7365 7474 696e 6720 7570 2069 6e70 7574  setting up input
+000099b0: 2052 4941 2122 290a 2020 2020 2020 2020   RIA!").        
+000099c0: 6966 206e 6f74 2069 665f 666f 756e 645f  if not if_found_
+000099d0: 7369 626c 696e 675f 6f75 7470 7574 3a0a  sibling_output:.
+000099e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000099f0: 6520 4578 6365 7074 696f 6e28 2244 6964  e Exception("Did
+00009a00: 206e 6f74 2066 696e 6420 6120 7369 626c   not find a sibl
+00009a10: 696e 6720 6f66 2027 616e 616c 7973 6973  ing of 'analysis
+00009a20: 2720 4461 7461 4c61 6420 6461 7461 7365  ' DataLad datase
+00009a30: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
+00009a40: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00009a50: 2022 2074 6861 7427 7320 6361 6c6c 6564   " that's called
+00009a60: 2027 6f75 7470 7574 272e 2054 6865 7265   'output'. There
+00009a70: 206d 6179 2062 6520 736f 6d65 7468 696e   may be somethin
+00009a80: 6720 7772 6f6e 6720 7768 656e 220a 2020  g wrong when".  
+00009a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009aa0: 2020 2020 2020 2020 2020 2b20 2220 7365            + " se
+00009ab0: 7474 696e 6720 7570 206f 7574 7075 7420  tting up output 
+00009ac0: 5249 4121 2229 0a0a 2020 2020 2020 2020  RIA!")..        
+00009ad0: 2320 6f75 7470 7574 5f72 6961 5f64 6174  # output_ria_dat
+00009ae0: 616c 6164 5f68 616e 646c 6520 3d20 646c  alad_handle = dl
+00009af0: 6170 692e 4461 7461 7365 7428 7365 6c66  api.Dataset(self
+00009b00: 2e6f 7574 7075 745f 7269 615f 6461 7461  .output_ria_data
+00009b10: 5f64 6972 290a 0a20 2020 2020 2020 2023  _dir)..        #
+00009b20: 2063 6865 636b 2069 6620 7468 6520 6375   check if the cu
+00009b30: 7272 656e 7420 636f 6d6d 6974 2069 6e20  rrent commit in 
+00009b40: 6061 6e61 6c79 7369 7360 2068 6173 2062  `analysis` has b
+00009b50: 6565 6e20 7075 7368 6564 2074 6f20 5249  een pushed to RI
+00009b60: 413a 0a20 2020 2020 2020 2023 2020 2069  A:.        #   i
+00009b70: 2e65 2e2c 2069 6620 636f 6d6d 6974 2068  .e., if commit h
+00009b80: 6173 6820 6172 6520 6d61 7463 6865 643a  ash are matched:
+00009b90: 0a20 2020 2020 2020 2023 2061 6e61 6c79  .        # analy
+00009ba0: 7369 7327 2063 6f6d 6d69 7420 6861 7368  sis' commit hash
+00009bb0: 3a0a 2020 2020 2020 2020 7072 6f63 5f68  :.        proc_h
+00009bc0: 6173 685f 616e 616c 7973 6973 203d 2073  ash_analysis = s
+00009bd0: 7562 7072 6f63 6573 732e 7275 6e28 0a20  ubprocess.run(. 
+00009be0: 2020 2020 2020 2020 2020 205b 2267 6974             ["git
+00009bf0: 222c 2022 7265 762d 7061 7273 6522 2c20  ", "rev-parse", 
+00009c00: 2248 4541 4422 5d2c 0a20 2020 2020 2020  "HEAD"],.       
+00009c10: 2020 2020 2063 7764 3d73 656c 662e 616e       cwd=self.an
+00009c20: 616c 7973 6973 5f70 6174 682c 0a20 2020  alysis_path,.   
+00009c30: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00009c40: 7375 6270 726f 6365 7373 2e50 4950 4529  subprocess.PIPE)
+00009c50: 0a20 2020 2020 2020 2070 726f 635f 6861  .        proc_ha
+00009c60: 7368 5f61 6e61 6c79 7369 732e 6368 6563  sh_analysis.chec
+00009c70: 6b5f 7265 7475 726e 636f 6465 2829 0a20  k_returncode(). 
+00009c80: 2020 2020 2020 2068 6173 685f 616e 616c         hash_anal
+00009c90: 7973 6973 203d 2070 726f 635f 6861 7368  ysis = proc_hash
+00009ca0: 5f61 6e61 6c79 7369 732e 7374 646f 7574  _analysis.stdout
+00009cb0: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+00009cc0: 2e72 6570 6c61 6365 2822 5c6e 222c 2022  .replace("\n", "
+00009cd0: 2229 0a0a 2020 2020 2020 2020 2320 696e  ")..        # in
+00009ce0: 7075 7420 7269 6127 7320 636f 6d6d 6974  put ria's commit
+00009cf0: 2068 6173 683a 0a20 2020 2020 2020 2070   hash:.        p
+00009d00: 726f 635f 6861 7368 5f69 6e70 7574 5f72  roc_hash_input_r
+00009d10: 6961 203d 2073 7562 7072 6f63 6573 732e  ia = subprocess.
+00009d20: 7275 6e28 0a20 2020 2020 2020 2020 2020  run(.           
+00009d30: 205b 2267 6974 222c 2022 7265 762d 7061   ["git", "rev-pa
+00009d40: 7273 6522 2c20 2248 4541 4422 5d2c 0a20  rse", "HEAD"],. 
+00009d50: 2020 2020 2020 2020 2020 2063 7764 3d61             cwd=a
+00009d60: 6374 7561 6c5f 696e 7075 745f 7269 615f  ctual_input_ria_
+00009d70: 6461 7461 5f64 6972 2c20 2020 2320 7573  data_dir,   # us
+00009d80: 696e 6720 7468 6520 6163 7475 616c 206f  ing the actual o
+00009d90: 6e65 2077 6520 6a75 7374 2067 6f74 0a20  ne we just got. 
+00009da0: 2020 2020 2020 2020 2020 2073 7464 6f75             stdou
+00009db0: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
+00009dc0: 4529 0a20 2020 2020 2020 2070 726f 635f  E).        proc_
+00009dd0: 6861 7368 5f69 6e70 7574 5f72 6961 2e63  hash_input_ria.c
+00009de0: 6865 636b 5f72 6574 7572 6e63 6f64 6528  heck_returncode(
+00009df0: 290a 2020 2020 2020 2020 6861 7368 5f69  ).        hash_i
+00009e00: 6e70 7574 5f72 6961 203d 2070 726f 635f  nput_ria = proc_
+00009e10: 6861 7368 5f69 6e70 7574 5f72 6961 2e73  hash_input_ria.s
+00009e20: 7464 6f75 742e 6465 636f 6465 2827 7574  tdout.decode('ut
+00009e30: 662d 3827 292e 7265 706c 6163 6528 225c  f-8').replace("\
+00009e40: 6e22 2c20 2222 290a 2020 2020 2020 2020  n", "").        
+00009e50: 6173 7365 7274 2068 6173 685f 616e 616c  assert hash_anal
+00009e60: 7973 6973 203d 3d20 6861 7368 5f69 6e70  ysis == hash_inp
+00009e70: 7574 5f72 6961 2c20 5c0a 2020 2020 2020  ut_ria, \.      
+00009e80: 2020 2020 2020 2254 6865 2068 6173 6820        "The hash 
+00009e90: 6f66 2063 7572 7265 6e74 2063 6f6d 6d69  of current commi
+00009ea0: 7420 6f66 2060 616e 616c 7973 6973 6020  t of `analysis` 
+00009eb0: 6461 7461 6c61 6420 6461 7461 7365 7420  datalad dataset 
+00009ec0: 646f 6573 206e 6f74 206d 6174 6368 2220  does not match" 
+00009ed0: 5c0a 2020 2020 2020 2020 2020 2020 2b20  \.            + 
+00009ee0: 2220 7769 7468 2074 6861 7420 6f66 2069  " with that of i
+00009ef0: 6e70 7574 2052 4941 2e22 205c 0a20 2020  nput RIA." \.   
+00009f00: 2020 2020 2020 2020 202b 2022 2046 6f72           + " For
+00009f10: 6d65 7220 3d20 2220 2b20 6861 7368 5f61  mer = " + hash_a
+00009f20: 6e61 6c79 7369 7320 2b20 223b 2220 5c0a  nalysis + ";" \.
+00009f30: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+00009f40: 4c61 7474 6572 203d 2022 202b 2068 6173  Latter = " + has
+00009f50: 685f 696e 7075 745f 7269 6120 2b20 222e  h_input_ria + ".
+00009f60: 2220 2b20 225c 6e22 205c 0a20 2020 2020  " + "\n" \.     
+00009f70: 2020 2020 2020 202b 2022 4974 206d 6967         + "It mig
+00009f80: 6874 2062 6520 6265 6361 7573 6520 7468  ht be because th
+00009f90: 6174 206c 6174 6573 7420 636f 6d6d 6974  at latest commit
+00009fa0: 7320 696e 2220 5c0a 2020 2020 2020 2020  s in" \.        
+00009fb0: 2020 2020 2b20 2220 6061 6e61 6c79 7369      + " `analysi
+00009fc0: 7360 2077 6572 6520 6e6f 7420 7075 7368  s` were not push
+00009fd0: 6564 2074 6f20 696e 7075 7420 5249 412e  ed to input RIA.
+00009fe0: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+00009ff0: 2b20 2220 5472 7920 7275 6e6e 696e 6720  + " Try running 
+0000a000: 7468 6973 2063 6f6d 6d61 6e64 2061 7420  this command at 
+0000a010: 6469 7265 6374 6f72 7920 2722 202b 2073  directory '" + s
+0000a020: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
+0000a030: 6820 2b20 2227 3a20 5c6e 2220 5c0a 2020  h + "': \n" \.  
+0000a040: 2020 2020 2020 2020 2020 2b20 2224 2064            + "$ d
+0000a050: 6174 616c 6164 2070 7573 6820 2d2d 746f  atalad push --to
+0000a060: 2069 6e70 7574 220a 0a20 2020 2020 2020   input"..       
+0000a070: 2023 206f 7574 7075 7420 7269 6127 7320   # output ria's 
+0000a080: 636f 6d6d 6974 2068 6173 683a 0a20 2020  commit hash:.   
+0000a090: 2020 2020 2070 726f 635f 6861 7368 5f6f       proc_hash_o
+0000a0a0: 7574 7075 745f 7269 6120 3d20 7375 6270  utput_ria = subp
+0000a0b0: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
+0000a0c0: 2020 2020 2020 2020 5b22 6769 7422 2c20          ["git", 
+0000a0d0: 2272 6576 2d70 6172 7365 222c 2022 4845  "rev-parse", "HE
+0000a0e0: 4144 225d 2c0a 2020 2020 2020 2020 2020  AD"],.          
+0000a0f0: 2020 6377 643d 6163 7475 616c 5f6f 7574    cwd=actual_out
+0000a100: 7075 745f 7269 615f 6461 7461 5f64 6972  put_ria_data_dir
+0000a110: 2c20 2020 2320 7573 696e 6720 7468 6520  ,   # using the 
+0000a120: 6163 7475 616c 206f 6e65 2077 6520 6a75  actual one we ju
+0000a130: 7374 2067 6f74 0a20 2020 2020 2020 2020  st got.         
+0000a140: 2020 2073 7464 6f75 743d 7375 6270 726f     stdout=subpro
+0000a150: 6365 7373 2e50 4950 4529 0a20 2020 2020  cess.PIPE).     
+0000a160: 2020 2070 726f 635f 6861 7368 5f6f 7574     proc_hash_out
+0000a170: 7075 745f 7269 612e 6368 6563 6b5f 7265  put_ria.check_re
+0000a180: 7475 726e 636f 6465 2829 0a20 2020 2020  turncode().     
+0000a190: 2020 2068 6173 685f 6f75 7470 7574 5f72     hash_output_r
+0000a1a0: 6961 203d 2070 726f 635f 6861 7368 5f6f  ia = proc_hash_o
+0000a1b0: 7574 7075 745f 7269 612e 7374 646f 7574  utput_ria.stdout
+0000a1c0: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+0000a1d0: 2e72 6570 6c61 6365 2822 5c6e 222c 2022  .replace("\n", "
+0000a1e0: 2229 0a20 2020 2020 2020 2023 206f 6e6c  ").        # onl
+0000a1f0: 7920 7468 726f 7720 6f75 7420 6120 7761  y throw out a wa
+0000a200: 726e 696e 6720 6966 206e 6f74 206d 6174  rning if not mat
+0000a210: 6368 6564 2c20 6173 2061 6674 6572 2074  ched, as after t
+0000a220: 6865 7265 2069 7320 6272 616e 6368 2069  here is branch i
+0000a230: 6e20 6f75 7470 7574 2052 4941 2c0a 2020  n output RIA,.  
+0000a240: 2020 2020 2020 2320 2020 6e6f 7420 7265        #   not re
+0000a250: 636f 6d6d 656e 6420 746f 2070 7573 6820  commend to push 
+0000a260: 7570 6461 7465 7320 6672 6f6d 2061 6e61  updates from ana
+0000a270: 6c79 7369 7320 746f 206f 7574 7075 7420  lysis to output 
+0000a280: 5249 413a 0a20 2020 2020 2020 2069 6620  RIA:.        if 
+0000a290: 6861 7368 5f61 6e61 6c79 7369 7320 213d  hash_analysis !=
+0000a2a0: 2068 6173 685f 6f75 7470 7574 5f72 6961   hash_output_ria
+0000a2b0: 3a0a 2020 2020 2020 2020 2020 2020 666c  :.            fl
+0000a2c0: 6167 5f77 6172 6e69 6e67 5f6f 7574 7075  ag_warning_outpu
+0000a2d0: 745f 7269 6120 3d20 5472 7565 0a20 2020  t_ria = True.   
+0000a2e0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000a2f0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+0000a300: 2020 2020 2020 2020 2254 6865 2068 6173          "The has
+0000a310: 6820 6f66 2063 7572 7265 6e74 2063 6f6d  h of current com
+0000a320: 6d69 7420 6f66 2060 616e 616c 7973 6973  mit of `analysis
+0000a330: 6020 6461 7461 6c61 6420 6461 7461 7365  ` datalad datase
+0000a340: 7420 646f 6573 206e 6f74 206d 6174 6368  t does not match
+0000a350: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000a360: 2020 2b20 2220 7769 7468 2074 6861 7420    + " with that 
+0000a370: 6f66 206f 7574 7075 7420 5249 412e 220a  of output RIA.".
+0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a390: 2b20 2220 466f 726d 6572 203d 2022 202b  + " Former = " +
+0000a3a0: 2068 6173 685f 616e 616c 7973 6973 202b   hash_analysis +
+0000a3b0: 2022 3b22 0a20 2020 2020 2020 2020 2020   ";".           
+0000a3c0: 2020 2020 202b 2022 204c 6174 7465 7220       + " Latter 
+0000a3d0: 3d20 2220 2b20 6861 7368 5f6f 7574 7075  = " + hash_outpu
+0000a3e0: 745f 7269 6120 2b20 222e 5c6e 220a 2020  t_ria + ".\n".  
+0000a3f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a400: 2249 7420 6d69 6768 7420 6265 2062 6563  "It might be bec
+0000a410: 6175 7365 2074 6861 7420 6c61 7465 7374  ause that latest
+0000a420: 2063 6f6d 6d69 7473 2069 6e22 0a20 2020   commits in".   
+0000a430: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000a440: 2060 616e 616c 7973 6973 6020 7765 7265   `analysis` were
+0000a450: 206e 6f74 2070 7573 6865 6420 746f 206f   not pushed to o
+0000a460: 7574 7075 7420 5249 412e 5c6e 220a 2020  utput RIA.\n".  
+0000a470: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a480: 2249 6620 7468 6572 6520 6172 6520 616c  "If there are al
+0000a490: 7265 6164 7920 7375 6363 6573 7366 756c  ready successful
+0000a4a0: 206a 6f62 2873 2920 6669 6e69 7368 6564   job(s) finished
+0000a4b0: 2c20 706c 6561 7365 2064 6f20 4e4f 5420  , please do NOT 
+0000a4c0: 7075 7368 2075 7064 6174 6573 220a 2020  push updates".  
+0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0000a4e0: 2220 6672 6f6d 2060 616e 616c 7973 6973  " from `analysis
+0000a4f0: 6020 746f 206f 7574 7075 7420 5249 412e  ` to output RIA.
+0000a500: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0000a510: 2020 2020 2b20 2249 6620 796f 7527 7265      + "If you're
+0000a520: 2073 7572 6520 7468 6572 6520 6973 206e   sure there is n
+0000a530: 6f20 7375 6363 6573 7366 756c 206a 6f62  o successful job
+0000a540: 2066 696e 6973 6865 642c 2079 6f75 206d   finished, you m
+0000a550: 6179 2074 7279 2072 756e 6e69 6e67 220a  ay try running".
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 2b20 2220 7468 6973 2063 6f6d 6d61 6e64  + " this command
+0000a580: 2061 7420 6469 7265 6374 6f72 7920 2722   at directory '"
+0000a590: 202b 2073 656c 662e 616e 616c 7973 6973   + self.analysis
+0000a5a0: 5f70 6174 6820 2b20 2227 3a20 5c6e 220a  _path + "': \n".
+0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5c0: 2b20 2224 2064 6174 616c 6164 2070 7573  + "$ datalad pus
+0000a5d0: 6820 2d2d 746f 206f 7574 7075 7422 0a20  h --to output". 
+0000a5e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000a5f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000a600: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
 0000a610: 7761 726e 696e 675f 6f75 7470 7574 5f72  warning_output_r
-0000a620: 6961 3a0a 2020 2020 2020 2020 2020 2020  ia:.            
-0000a630: 7072 696e 7428 2254 6865 7265 2069 7320  print("There is 
-0000a640: 7761 726e 696e 6720 666f 7220 6f75 7470  warning for outp
-0000a650: 7574 2052 4941 202d 2050 6c65 6173 6520  ut RIA - Please 
-0000a660: 6368 6563 6b20 6974 206f 7574 2122 0a20  check it out!". 
-0000a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a680: 2022 2045 6c73 6520 696e 2069 6e70 7574   " Else in input
-0000a690: 2061 6e64 206f 7574 7075 7420 5249 4120   and output RIA 
-0000a6a0: 6973 2067 6f6f 642e 2229 0a20 2020 2020  is good.").     
-0000a6b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a6c0: 2020 2020 2070 7269 6e74 2843 4845 434b       print(CHECK
-0000a6d0: 5f4d 4152 4b20 2b20 2220 416c 6c20 676f  _MARK + " All go
-0000a6e0: 6f64 2122 290a 0a20 2020 2020 2020 2023  od!")..        #
-0000a6f0: 2053 7562 6d69 7420 6120 7465 7374 206a   Submit a test j
-0000a700: 6f62 2028 6966 2072 6571 7565 7374 6564  ob (if requested
-0000a710: 2920 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ) --------------
-0000a720: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0000a730: 2d2d 0a20 2020 2020 2020 2069 6620 6e6f  --.        if no
-0000a740: 7420 666c 6167 5f6a 6f62 5f74 6573 743a  t flag_job_test:
-0000a750: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000a760: 6e74 2822 5c6e 4e6f 7420 746f 2073 7562  nt("\nNot to sub
-0000a770: 6d69 7420 6120 7465 7374 206a 6f62 2061  mit a test job a
-0000a780: 7320 6974 2773 206e 6f74 2072 6571 7565  s it's not reque
-0000a790: 7374 6564 2e22 0a20 2020 2020 2020 2020  sted.".         
-0000a7a0: 2020 2020 2020 2020 202b 2022 2057 6520           + " We 
-0000a7b0: 7265 636f 6d6d 656e 6420 7275 6e6e 696e  recommend runnin
-0000a7c0: 6720 6120 7465 7374 206a 6f62 2077 6974  g a test job wit
-0000a7d0: 6820 602d 2d6a 6f62 2d74 6573 7460 2069  h `--job-test` i
-0000a7e0: 6620 796f 7520 6861 7665 6e27 7420 646f  f you haven't do
-0000a7f0: 6e65 2073 6f3b 220a 2020 2020 2020 2020  ne so;".        
-0000a800: 2020 2020 2020 2020 2020 2b20 2220 4974            + " It
-0000a810: 2077 696c 6c20 6761 7468 6572 2073 6574   will gather set
-0000a820: 7570 2069 6e66 6f72 6d61 7469 6f6e 2069  up information i
-0000a830: 6e20 7468 6520 6465 7369 676e 6174 6564  n the designated
-0000a840: 2065 6e76 6972 6f6e 6d65 6e74 220a 2020   environment".  
-0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a860: 2b20 2220 616e 6420 6d61 6b65 2073 7572  + " and make sur
-0000a870: 6520 6675 7475 7265 2042 4142 5320 6a6f  e future BABS jo
-0000a880: 6273 2077 6974 6820 6375 7272 656e 7420  bs with current 
-0000a890: 7365 7475 7073 220a 2020 2020 2020 2020  setups".        
-0000a8a0: 2020 2020 2020 2020 2020 2b20 2220 7769            + " wi
-0000a8b0: 6c6c 2062 6520 6162 6c65 2074 6f20 6669  ll be able to fi
-0000a8c0: 6e69 7368 2073 7563 6365 7373 6675 6c6c  nish successfull
-0000a8d0: 792e 2229 0a20 2020 2020 2020 2020 2020  y.").           
-0000a8e0: 2070 7269 6e74 2822 5c6e 6062 6162 732d   print("\n`babs-
-0000a8f0: 6368 6563 6b2d 7365 7475 7060 2077 6173  check-setup` was
-0000a900: 2073 7563 6365 7373 6675 6c21 2022 290a   successful! ").
-0000a910: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a920: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000a930: 225c 6e53 7562 6d69 7474 696e 6720 6120  "\nSubmitting a 
-0000a940: 7465 7374 206a 6f62 2c20 7769 6c6c 2074  test job, will t
-0000a950: 616b 6520 6120 7768 696c 6520 746f 2066  ake a while to f
-0000a960: 696e 6973 682e 2e2e 2229 0a20 2020 2020  inish...").     
-0000a970: 2020 2020 2020 2070 7269 6e74 2822 416c         print("Al
-0000a980: 7468 6f75 6768 2074 6865 2073 6372 6970  though the scrip
-0000a990: 7420 7769 6c6c 2062 6520 7375 626d 6974  t will be submit
-0000a9a0: 7465 6420 746f 2061 2063 6f6d 7075 7465  ted to a compute
-0000a9b0: 206e 6f64 652c 220a 2020 2020 2020 2020   node,".        
-0000a9c0: 2020 2020 2020 2020 2020 2220 7468 6973            " this
-0000a9d0: 2074 6573 7420 6a6f 6220 7769 6c6c 206e   test job will n
-0000a9e0: 6f74 2072 756e 2074 6865 2042 4944 5320  ot run the BIDS 
-0000a9f0: 4170 703b 220a 2020 2020 2020 2020 2020  App;".          
-0000aa00: 2020 2020 2020 2020 2220 696e 7374 6561          " instea
-0000aa10: 642c 2074 6869 7320 7465 7374 206a 6f62  d, this test job
-0000aa20: 2077 696c 6c20 6761 7468 6572 2073 6574   will gather set
-0000aa30: 7570 2069 6e66 6f72 6d61 7469 6f6e 220a  up information".
-0000aa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa50: 2020 2220 696e 2074 6865 2064 6573 6967    " in the desig
-0000aa60: 6e61 7465 6420 656e 7669 726f 6e6d 656e  nated environmen
-0000aa70: 7422 0a20 2020 2020 2020 2020 2020 2020  t".             
-0000aa80: 2020 2020 2022 2061 6e64 206d 616b 6520       " and make 
-0000aa90: 7375 7265 2066 7574 7572 6520 4241 4253  sure future BABS
-0000aaa0: 206a 6f62 7320 7769 7468 2063 7572 7265   jobs with curre
-0000aab0: 6e74 2073 6574 7570 7322 0a20 2020 2020  nt setups".     
-0000aac0: 2020 2020 2020 2020 2020 2020 2022 2077               " w
-0000aad0: 696c 6c20 6265 2061 626c 6520 746f 2066  ill be able to f
-0000aae0: 696e 6973 6820 7375 6363 6573 7366 756c  inish successful
-0000aaf0: 6c79 2e22 290a 0a20 2020 2020 2020 2020  ly.")..         
-0000ab00: 2020 205f 2c20 6a6f 625f 6964 5f73 7472     _, job_id_str
-0000ab10: 2c20 6c6f 675f 6669 6c65 6e61 6d65 203d  , log_filename =
-0000ab20: 2073 7562 6d69 745f 6f6e 655f 7465 7374   submit_one_test
-0000ab30: 5f6a 6f62 2873 656c 662e 616e 616c 7973  _job(self.analys
-0000ab40: 6973 5f70 6174 682c 2073 656c 662e 7479  is_path, self.ty
-0000ab50: 7065 5f73 7973 7465 6d29 0a20 2020 2020  pe_system).     
-0000ab60: 2020 2020 2020 206c 6f67 5f66 6e20 3d20         log_fn = 
-0000ab70: 6f70 2e6a 6f69 6e28 7365 6c66 2e61 6e61  op.join(self.ana
-0000ab80: 6c79 7369 735f 7061 7468 2c20 226c 6f67  lysis_path, "log
-0000ab90: 7322 2c20 6c6f 675f 6669 6c65 6e61 6d65  s", log_filename
-0000aba0: 2920 2023 2061 6273 2070 6174 680a 2020  )  # abs path.  
-0000abb0: 2020 2020 2020 2020 2020 6f5f 666e 203d            o_fn =
-0000abc0: 206c 6f67 5f66 6e2e 7265 706c 6163 6528   log_fn.replace(
-0000abd0: 222e 2a22 2c20 222e 6f22 290a 2020 2020  ".*", ".o").    
-0000abe0: 2020 2020 2020 2020 2320 7772 6974 6520          # write 
-0000abf0: 7468 6973 2069 6e66 6f72 6d61 7469 6f6e  this information
-0000ac00: 2069 6e20 6120 5941 4d4c 2066 696c 653a   in a YAML file:
-0000ac10: 0a20 2020 2020 2020 2020 2020 2066 6e5f  .            fn_
-0000ac20: 7465 7374 5f6a 6f62 5f69 6e66 6f20 3d20  test_job_info = 
-0000ac30: 6f70 2e6a 6f69 6e28 7365 6c66 2e61 6e61  op.join(self.ana
-0000ac40: 6c79 7369 735f 7061 7468 2c20 2263 6f64  lysis_path, "cod
-0000ac50: 652f 6368 6563 6b5f 7365 7475 7022 2c0a  e/check_setup",.
-0000ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac80: 2020 2020 2020 2022 7465 7374 5f6a 6f62         "test_job
-0000ac90: 5f69 6e66 6f2e 7961 6d6c 2229 0a20 2020  _info.yaml").   
-0000aca0: 2020 2020 2020 2020 2069 6620 6f70 2e65           if op.e
-0000acb0: 7869 7374 7328 666e 5f74 6573 745f 6a6f  xists(fn_test_jo
-0000acc0: 625f 696e 666f 293a 0a20 2020 2020 2020  b_info):.       
-0000acd0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
-0000ace0: 7665 2866 6e5f 7465 7374 5f6a 6f62 5f69  ve(fn_test_job_i
-0000acf0: 6e66 6f29 2020 2320 7265 6d6f 7665 2069  nfo)  # remove i
-0000ad00: 740a 0a20 2020 2020 2020 2020 2020 2074  t..            t
-0000ad10: 6573 745f 6a6f 625f 696e 666f 5f66 696c  est_job_info_fil
-0000ad20: 6520 3d20 6f70 656e 2866 6e5f 7465 7374  e = open(fn_test
-0000ad30: 5f6a 6f62 5f69 6e66 6f2c 2022 7722 290a  _job_info, "w").
-0000ad40: 2020 2020 2020 2020 2020 2020 7465 7374              test
-0000ad50: 5f6a 6f62 5f69 6e66 6f5f 6669 6c65 2e77  _job_info_file.w
-0000ad60: 7269 7465 2822 2320 496e 666f 726d 6174  rite("# Informat
-0000ad70: 696f 6e20 6f66 2073 7562 6d69 7474 6564  ion of submitted
-0000ad80: 2074 6573 7420 6a6f 623a 5c6e 2229 0a20   test job:\n"). 
-0000ad90: 2020 2020 2020 2020 2020 2074 6573 745f             test_
-0000ada0: 6a6f 625f 696e 666f 5f66 696c 652e 7772  job_info_file.wr
-0000adb0: 6974 6528 226a 6f62 5f69 643a 2027 2220  ite("job_id: '" 
-0000adc0: 2b20 6a6f 625f 6964 5f73 7472 202b 2022  + job_id_str + "
-0000add0: 275c 6e22 290a 2020 2020 2020 2020 2020  '\n").          
-0000ade0: 2020 7465 7374 5f6a 6f62 5f69 6e66 6f5f    test_job_info_
-0000adf0: 6669 6c65 2e77 7269 7465 2822 6c6f 675f  file.write("log_
-0000ae00: 6669 6c65 6e61 6d65 3a20 2722 202b 206c  filename: '" + l
-0000ae10: 6f67 5f66 696c 656e 616d 6520 2b20 2227  og_filename + "'
-0000ae20: 5c6e 2229 0a0a 2020 2020 2020 2020 2020  \n")..          
-0000ae30: 2020 7465 7374 5f6a 6f62 5f69 6e66 6f5f    test_job_info_
-0000ae40: 6669 6c65 2e63 6c6f 7365 2829 0a0a 2020  file.close()..  
-0000ae50: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0000ae60: 6b20 6a6f 6220 7374 6174 7573 2065 7665  k job status eve
-0000ae70: 7279 2031 206d 696e 3a0a 2020 2020 2020  ry 1 min:.      
-0000ae80: 2020 2020 2020 666c 6167 5f64 6f6e 6520        flag_done 
-0000ae90: 3d20 4661 6c73 6520 2020 2320 7768 6574  = False   # whet
-0000aea0: 6865 7220 6a6f 6220 6973 206f 7574 206f  her job is out o
-0000aeb0: 6620 7175 6575 6520 2854 7275 6529 0a20  f queue (True). 
-0000aec0: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
-0000aed0: 7375 6363 6573 735f 7465 7374 5f6a 6f62  success_test_job
-0000aee0: 203d 2046 616c 7365 2020 2320 7768 6574   = False  # whet
-0000aef0: 6865 7220 6a6f 6220 7761 7320 7375 6363  her job was succ
-0000af00: 6573 7366 756c 6c79 2066 696e 6973 6865  essfully finishe
-0000af10: 6420 2854 7275 6529 0a20 2020 2020 2020  d (True).       
-0000af20: 2020 2020 2070 7269 6e74 2822 5769 6c6c       print("Will
-0000af30: 2063 6865 636b 2074 6865 2074 6573 7420   check the test 
-0000af40: 6a6f 6227 7320 7374 6174 7573 2065 7665  job's status eve
-0000af50: 7279 2031 206d 696e 2e2e 2e22 290a 2020  ry 1 min...").  
-0000af60: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-0000af70: 6e6f 7420 666c 6167 5f64 6f6e 653a 0a20  not flag_done:. 
-0000af80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000af90: 2077 6169 7420 666f 7220 3120 6d69 6e3a   wait for 1 min:
-0000afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000afb0: 2074 696d 652e 736c 6565 7028 3630 2920   time.sleep(60) 
-0000afc0: 2020 2320 536c 6565 7020 666f 7220 3630    # Sleep for 60
-0000afd0: 2073 6563 6f6e 6473 0a0a 2020 2020 2020   seconds..      
-0000afe0: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0000aff0: 6b20 7468 6520 6a6f 6220 7374 6174 7573  k the job status
-0000b000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b010: 2064 665f 616c 6c5f 6a6f 625f 7374 6174   df_all_job_stat
-0000b020: 7573 203d 2072 6571 7565 7374 5f61 6c6c  us = request_all
-0000b030: 5f6a 6f62 5f73 7461 7475 7328 7365 6c66  _job_status(self
-0000b040: 2e74 7970 655f 7379 7374 656d 290a 2020  .type_system).  
-0000b050: 2020 2020 2020 2020 2020 2020 2020 645f                d_
-0000b060: 6e6f 775f 7374 7220 3d20 7374 7228 6461  now_str = str(da
-0000b070: 7465 7469 6d65 2e6e 6f77 2829 290a 2020  tetime.now()).  
-0000b080: 2020 2020 2020 2020 2020 2020 2020 746f                to
-0000b090: 5f70 7269 6e74 203d 2064 5f6e 6f77 5f73  _print = d_now_s
-0000b0a0: 7472 202b 2022 3a20 220a 2020 2020 2020  tr + ": ".      
-0000b0b0: 2020 2020 2020 2020 2020 6966 206a 6f62            if job
-0000b0c0: 5f69 645f 7374 7220 696e 2064 665f 616c  _id_str in df_al
-0000b0d0: 6c5f 6a6f 625f 7374 6174 7573 2e69 6e64  l_job_status.ind
-0000b0e0: 6578 2e74 6f5f 6c69 7374 2829 3a0a 2020  ex.to_list():.  
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b100: 2020 2320 5e5e 2069 6620 6064 6660 2069    # ^^ if `df` i
-0000b110: 7320 656d 7074 792c 2060 2e69 6e64 6578  s empty, `.index
-0000b120: 2e74 6f5f 6c69 7374 2829 6020 7769 6c6c  .to_list()` will
-0000b130: 2072 6574 7572 6e20 5b5d 0a20 2020 2020   return [].     
-0000b140: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b150: 2069 6620 7468 6520 6a6f 6220 6973 2073   if the job is s
-0000b160: 7469 6c6c 2069 6e20 7468 6520 7175 6575  till in the queu
-0000b170: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000b180: 2020 2020 2020 2023 2073 7461 7465 5f63         # state_c
-0000b190: 6174 6567 6f72 7920 3d20 6466 5f61 6c6c  ategory = df_all
-0000b1a0: 5f6a 6f62 5f73 7461 7475 732e 6174 5b6a  _job_status.at[j
-0000b1b0: 6f62 5f69 645f 7374 722c 2027 4073 7461  ob_id_str, '@sta
-0000b1c0: 7465 275d 0a20 2020 2020 2020 2020 2020  te'].           
-0000b1d0: 2020 2020 2020 2020 2073 7461 7465 5f63           state_c
-0000b1e0: 6f64 6520 3d20 6466 5f61 6c6c 5f6a 6f62  ode = df_all_job
-0000b1f0: 5f73 7461 7475 732e 6174 5b6a 6f62 5f69  _status.at[job_i
-0000b200: 645f 7374 722c 2027 7374 6174 6527 5d0a  d_str, 'state'].
-0000b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b220: 2020 2020 2320 5e5e 2063 6f6c 756d 6e20      # ^^ column 
-0000b230: 6040 7374 6174 6560 3a20 2772 756e 6e69  `@state`: 'runni
-0000b240: 6e67 2720 6f72 2027 7065 6e64 696e 6727  ng' or 'pending'
-0000b250: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b260: 2020 2020 2020 2320 7072 696e 7420 736f        # print so
-0000b270: 6d65 2069 6e66 6f72 6d61 7469 6f6e 3a0a  me information:.
+0000a620: 6961 203d 2046 616c 7365 0a0a 2020 2020  ia = False..    
+0000a630: 2020 2020 6966 2066 6c61 675f 7761 726e      if flag_warn
+0000a640: 696e 675f 6f75 7470 7574 5f72 6961 3a0a  ing_output_ria:.
+0000a650: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000a660: 7428 2254 6865 7265 2069 7320 7761 726e  t("There is warn
+0000a670: 696e 6720 666f 7220 6f75 7470 7574 2052  ing for output R
+0000a680: 4941 202d 2050 6c65 6173 6520 6368 6563  IA - Please chec
+0000a690: 6b20 6974 206f 7574 2122 0a20 2020 2020  k it out!".     
+0000a6a0: 2020 2020 2020 2020 2020 2020 2022 2045               " E
+0000a6b0: 6c73 6520 696e 2069 6e70 7574 2061 6e64  lse in input and
+0000a6c0: 206f 7574 7075 7420 5249 4120 6973 2067   output RIA is g
+0000a6d0: 6f6f 642e 2229 0a20 2020 2020 2020 2065  ood.").        e
+0000a6e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a6f0: 2070 7269 6e74 2843 4845 434b 5f4d 4152   print(CHECK_MAR
+0000a700: 4b20 2b20 2220 416c 6c20 676f 6f64 2122  K + " All good!"
+0000a710: 290a 0a20 2020 2020 2020 2023 2053 7562  )..        # Sub
+0000a720: 6d69 7420 6120 7465 7374 206a 6f62 2028  mit a test job (
+0000a730: 6966 2072 6571 7565 7374 6564 2920 2d2d  if requested) --
+0000a740: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0000a750: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
+0000a760: 2020 2020 2020 2069 6620 6e6f 7420 666c         if not fl
+0000a770: 6167 5f6a 6f62 5f74 6573 743a 0a20 2020  ag_job_test:.   
+0000a780: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0000a790: 5c6e 4e6f 7420 746f 2073 7562 6d69 7420  \nNot to submit 
+0000a7a0: 6120 7465 7374 206a 6f62 2061 7320 6974  a test job as it
+0000a7b0: 2773 206e 6f74 2072 6571 7565 7374 6564  's not requested
+0000a7c0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+0000a7d0: 2020 2020 202b 2022 2057 6520 7265 636f       + " We reco
+0000a7e0: 6d6d 656e 6420 7275 6e6e 696e 6720 6120  mmend running a 
+0000a7f0: 7465 7374 206a 6f62 2077 6974 6820 602d  test job with `-
+0000a800: 2d6a 6f62 2d74 6573 7460 2069 6620 796f  -job-test` if yo
+0000a810: 7520 6861 7665 6e27 7420 646f 6e65 2073  u haven't done s
+0000a820: 6f3b 220a 2020 2020 2020 2020 2020 2020  o;".            
+0000a830: 2020 2020 2020 2b20 2220 4974 2077 696c        + " It wil
+0000a840: 6c20 6761 7468 6572 2073 6574 7570 2069  l gather setup i
+0000a850: 6e66 6f72 6d61 7469 6f6e 2069 6e20 7468  nformation in th
+0000a860: 6520 6465 7369 676e 6174 6564 2065 6e76  e designated env
+0000a870: 6972 6f6e 6d65 6e74 220a 2020 2020 2020  ironment".      
+0000a880: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+0000a890: 616e 6420 6d61 6b65 2073 7572 6520 6675  and make sure fu
+0000a8a0: 7475 7265 2042 4142 5320 6a6f 6273 2077  ture BABS jobs w
+0000a8b0: 6974 6820 6375 7272 656e 7420 7365 7475  ith current setu
+0000a8c0: 7073 220a 2020 2020 2020 2020 2020 2020  ps".            
+0000a8d0: 2020 2020 2020 2b20 2220 7769 6c6c 2062        + " will b
+0000a8e0: 6520 6162 6c65 2074 6f20 6669 6e69 7368  e able to finish
+0000a8f0: 2073 7563 6365 7373 6675 6c6c 792e 2229   successfully.")
+0000a900: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000a910: 6e74 2822 5c6e 6062 6162 732d 6368 6563  nt("\n`babs-chec
+0000a920: 6b2d 7365 7475 7060 2077 6173 2073 7563  k-setup` was suc
+0000a930: 6365 7373 6675 6c21 2022 290a 2020 2020  cessful! ").    
+0000a940: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a950: 2020 2020 2020 7072 696e 7428 225c 6e53        print("\nS
+0000a960: 7562 6d69 7474 696e 6720 6120 7465 7374  ubmitting a test
+0000a970: 206a 6f62 2c20 7769 6c6c 2074 616b 6520   job, will take 
+0000a980: 6120 7768 696c 6520 746f 2066 696e 6973  a while to finis
+0000a990: 682e 2e2e 2229 0a20 2020 2020 2020 2020  h...").         
+0000a9a0: 2020 2070 7269 6e74 2822 416c 7468 6f75     print("Althou
+0000a9b0: 6768 2074 6865 2073 6372 6970 7420 7769  gh the script wi
+0000a9c0: 6c6c 2062 6520 7375 626d 6974 7465 6420  ll be submitted 
+0000a9d0: 746f 2061 2063 6f6d 7075 7465 206e 6f64  to a compute nod
+0000a9e0: 652c 220a 2020 2020 2020 2020 2020 2020  e,".            
+0000a9f0: 2020 2020 2020 2220 7468 6973 2074 6573        " this tes
+0000aa00: 7420 6a6f 6220 7769 6c6c 206e 6f74 2072  t job will not r
+0000aa10: 756e 2074 6865 2042 4944 5320 4170 703b  un the BIDS App;
+0000aa20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000aa30: 2020 2020 2220 696e 7374 6561 642c 2074      " instead, t
+0000aa40: 6869 7320 7465 7374 206a 6f62 2077 696c  his test job wil
+0000aa50: 6c20 6761 7468 6572 2073 6574 7570 2069  l gather setup i
+0000aa60: 6e66 6f72 6d61 7469 6f6e 220a 2020 2020  nformation".    
+0000aa70: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+0000aa80: 696e 2074 6865 2064 6573 6967 6e61 7465  in the designate
+0000aa90: 6420 656e 7669 726f 6e6d 656e 7422 0a20  d environment". 
+0000aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aab0: 2022 2061 6e64 206d 616b 6520 7375 7265   " and make sure
+0000aac0: 2066 7574 7572 6520 4241 4253 206a 6f62   future BABS job
+0000aad0: 7320 7769 7468 2063 7572 7265 6e74 2073  s with current s
+0000aae0: 6574 7570 7322 0a20 2020 2020 2020 2020  etups".         
+0000aaf0: 2020 2020 2020 2020 2022 2077 696c 6c20           " will 
+0000ab00: 6265 2061 626c 6520 746f 2066 696e 6973  be able to finis
+0000ab10: 6820 7375 6363 6573 7366 756c 6c79 2e22  h successfully."
+0000ab20: 290a 0a20 2020 2020 2020 2020 2020 205f  )..            _
+0000ab30: 2c20 6a6f 625f 6964 5f73 7472 2c20 6c6f  , job_id_str, lo
+0000ab40: 675f 6669 6c65 6e61 6d65 203d 2073 7562  g_filename = sub
+0000ab50: 6d69 745f 6f6e 655f 7465 7374 5f6a 6f62  mit_one_test_job
+0000ab60: 2873 656c 662e 616e 616c 7973 6973 5f70  (self.analysis_p
+0000ab70: 6174 682c 2073 656c 662e 7479 7065 5f73  ath, self.type_s
+0000ab80: 7973 7465 6d29 0a20 2020 2020 2020 2020  ystem).         
+0000ab90: 2020 206c 6f67 5f66 6e20 3d20 6f70 2e6a     log_fn = op.j
+0000aba0: 6f69 6e28 7365 6c66 2e61 6e61 6c79 7369  oin(self.analysi
+0000abb0: 735f 7061 7468 2c20 226c 6f67 7322 2c20  s_path, "logs", 
+0000abc0: 6c6f 675f 6669 6c65 6e61 6d65 2920 2023  log_filename)  #
+0000abd0: 2061 6273 2070 6174 680a 2020 2020 2020   abs path.      
+0000abe0: 2020 2020 2020 6f5f 666e 203d 206c 6f67        o_fn = log
+0000abf0: 5f66 6e2e 7265 706c 6163 6528 222e 2a22  _fn.replace(".*"
+0000ac00: 2c20 222e 6f22 290a 2020 2020 2020 2020  , ".o").        
+0000ac10: 2020 2020 2320 7772 6974 6520 7468 6973      # write this
+0000ac20: 2069 6e66 6f72 6d61 7469 6f6e 2069 6e20   information in 
+0000ac30: 6120 5941 4d4c 2066 696c 653a 0a20 2020  a YAML file:.   
+0000ac40: 2020 2020 2020 2020 2066 6e5f 7465 7374           fn_test
+0000ac50: 5f6a 6f62 5f69 6e66 6f20 3d20 6f70 2e6a  _job_info = op.j
+0000ac60: 6f69 6e28 7365 6c66 2e61 6e61 6c79 7369  oin(self.analysi
+0000ac70: 735f 7061 7468 2c20 2263 6f64 652f 6368  s_path, "code/ch
+0000ac80: 6563 6b5f 7365 7475 7022 2c0a 2020 2020  eck_setup",.    
+0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acb0: 2020 2022 7465 7374 5f6a 6f62 5f69 6e66     "test_job_inf
+0000acc0: 6f2e 7961 6d6c 2229 0a20 2020 2020 2020  o.yaml").       
+0000acd0: 2020 2020 2069 6620 6f70 2e65 7869 7374       if op.exist
+0000ace0: 7328 666e 5f74 6573 745f 6a6f 625f 696e  s(fn_test_job_in
+0000acf0: 666f 293a 0a20 2020 2020 2020 2020 2020  fo):.           
+0000ad00: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
+0000ad10: 6e5f 7465 7374 5f6a 6f62 5f69 6e66 6f29  n_test_job_info)
+0000ad20: 2020 2320 7265 6d6f 7665 2069 740a 0a20    # remove it.. 
+0000ad30: 2020 2020 2020 2020 2020 2074 6573 745f             test_
+0000ad40: 6a6f 625f 696e 666f 5f66 696c 6520 3d20  job_info_file = 
+0000ad50: 6f70 656e 2866 6e5f 7465 7374 5f6a 6f62  open(fn_test_job
+0000ad60: 5f69 6e66 6f2c 2022 7722 290a 2020 2020  _info, "w").    
+0000ad70: 2020 2020 2020 2020 7465 7374 5f6a 6f62          test_job
+0000ad80: 5f69 6e66 6f5f 6669 6c65 2e77 7269 7465  _info_file.write
+0000ad90: 2822 2320 496e 666f 726d 6174 696f 6e20  ("# Information 
+0000ada0: 6f66 2073 7562 6d69 7474 6564 2074 6573  of submitted tes
+0000adb0: 7420 6a6f 623a 5c6e 2229 0a20 2020 2020  t job:\n").     
+0000adc0: 2020 2020 2020 2074 6573 745f 6a6f 625f         test_job_
+0000add0: 696e 666f 5f66 696c 652e 7772 6974 6528  info_file.write(
+0000ade0: 226a 6f62 5f69 643a 2027 2220 2b20 6a6f  "job_id: '" + jo
+0000adf0: 625f 6964 5f73 7472 202b 2022 275c 6e22  b_id_str + "'\n"
+0000ae00: 290a 2020 2020 2020 2020 2020 2020 7465  ).            te
+0000ae10: 7374 5f6a 6f62 5f69 6e66 6f5f 6669 6c65  st_job_info_file
+0000ae20: 2e77 7269 7465 2822 6c6f 675f 6669 6c65  .write("log_file
+0000ae30: 6e61 6d65 3a20 2722 202b 206c 6f67 5f66  name: '" + log_f
+0000ae40: 696c 656e 616d 6520 2b20 2227 5c6e 2229  ilename + "'\n")
+0000ae50: 0a0a 2020 2020 2020 2020 2020 2020 7465  ..            te
+0000ae60: 7374 5f6a 6f62 5f69 6e66 6f5f 6669 6c65  st_job_info_file
+0000ae70: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
+0000ae80: 2020 2020 2020 2320 6368 6563 6b20 6a6f        # check jo
+0000ae90: 6220 7374 6174 7573 2065 7665 7279 2031  b status every 1
+0000aea0: 206d 696e 3a0a 2020 2020 2020 2020 2020   min:.          
+0000aeb0: 2020 666c 6167 5f64 6f6e 6520 3d20 4661    flag_done = Fa
+0000aec0: 6c73 6520 2020 2320 7768 6574 6865 7220  lse   # whether 
+0000aed0: 6a6f 6220 6973 206f 7574 206f 6620 7175  job is out of qu
+0000aee0: 6575 6520 2854 7275 6529 0a20 2020 2020  eue (True).     
+0000aef0: 2020 2020 2020 2066 6c61 675f 7375 6363         flag_succ
+0000af00: 6573 735f 7465 7374 5f6a 6f62 203d 2046  ess_test_job = F
+0000af10: 616c 7365 2020 2320 7768 6574 6865 7220  alse  # whether 
+0000af20: 6a6f 6220 7761 7320 7375 6363 6573 7366  job was successf
+0000af30: 756c 6c79 2066 696e 6973 6865 6420 2854  ully finished (T
+0000af40: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0000af50: 2070 7269 6e74 2822 5769 6c6c 2063 6865   print("Will che
+0000af60: 636b 2074 6865 2074 6573 7420 6a6f 6227  ck the test job'
+0000af70: 7320 7374 6174 7573 2065 7665 7279 2031  s status every 1
+0000af80: 206d 696e 2e2e 2e22 290a 2020 2020 2020   min...").      
+0000af90: 2020 2020 2020 7768 696c 6520 6e6f 7420        while not 
+0000afa0: 666c 6167 5f64 6f6e 653a 0a20 2020 2020  flag_done:.     
+0000afb0: 2020 2020 2020 2020 2020 2023 2077 6169             # wai
+0000afc0: 7420 666f 7220 3120 6d69 6e3a 0a20 2020  t for 1 min:.   
+0000afd0: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0000afe0: 652e 736c 6565 7028 3630 2920 2020 2320  e.sleep(60)   # 
+0000aff0: 536c 6565 7020 666f 7220 3630 2073 6563  Sleep for 60 sec
+0000b000: 6f6e 6473 0a0a 2020 2020 2020 2020 2020  onds..          
+0000b010: 2020 2020 2020 2320 6368 6563 6b20 7468        # check th
+0000b020: 6520 6a6f 6220 7374 6174 7573 0a20 2020  e job status.   
+0000b030: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0000b040: 616c 6c5f 6a6f 625f 7374 6174 7573 203d  all_job_status =
+0000b050: 2072 6571 7565 7374 5f61 6c6c 5f6a 6f62   request_all_job
+0000b060: 5f73 7461 7475 7328 7365 6c66 2e74 7970  _status(self.typ
+0000b070: 655f 7379 7374 656d 290a 2020 2020 2020  e_system).      
+0000b080: 2020 2020 2020 2020 2020 645f 6e6f 775f            d_now_
+0000b090: 7374 7220 3d20 7374 7228 6461 7465 7469  str = str(dateti
+0000b0a0: 6d65 2e6e 6f77 2829 290a 2020 2020 2020  me.now()).      
+0000b0b0: 2020 2020 2020 2020 2020 746f 5f70 7269            to_pri
+0000b0c0: 6e74 203d 2064 5f6e 6f77 5f73 7472 202b  nt = d_now_str +
+0000b0d0: 2022 3a20 220a 2020 2020 2020 2020 2020   ": ".          
+0000b0e0: 2020 2020 2020 6966 206a 6f62 5f69 645f        if job_id_
+0000b0f0: 7374 7220 696e 2064 665f 616c 6c5f 6a6f  str in df_all_jo
+0000b100: 625f 7374 6174 7573 2e69 6e64 6578 2e74  b_status.index.t
+0000b110: 6f5f 6c69 7374 2829 3a0a 2020 2020 2020  o_list():.      
+0000b120: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000b130: 5e5e 2069 6620 6064 6660 2069 7320 656d  ^^ if `df` is em
+0000b140: 7074 792c 2060 2e69 6e64 6578 2e74 6f5f  pty, `.index.to_
+0000b150: 6c69 7374 2829 6020 7769 6c6c 2072 6574  list()` will ret
+0000b160: 7572 6e20 5b5d 0a20 2020 2020 2020 2020  urn [].         
+0000b170: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+0000b180: 7468 6520 6a6f 6220 6973 2073 7469 6c6c  the job is still
+0000b190: 2069 6e20 7468 6520 7175 6575 653a 0a20   in the queue:. 
+0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1b0: 2020 2023 2073 7461 7465 5f63 6174 6567     # state_categ
+0000b1c0: 6f72 7920 3d20 6466 5f61 6c6c 5f6a 6f62  ory = df_all_job
+0000b1d0: 5f73 7461 7475 732e 6174 5b6a 6f62 5f69  _status.at[job_i
+0000b1e0: 645f 7374 722c 2027 4073 7461 7465 275d  d_str, '@state']
+0000b1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b200: 2020 2020 2073 7461 7465 5f63 6f64 6520       state_code 
+0000b210: 3d20 6466 5f61 6c6c 5f6a 6f62 5f73 7461  = df_all_job_sta
+0000b220: 7475 732e 6174 5b6a 6f62 5f69 645f 7374  tus.at[job_id_st
+0000b230: 722c 2027 7374 6174 6527 5d0a 2020 2020  r, 'state'].    
+0000b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b250: 2320 5e5e 2063 6f6c 756d 6e20 6040 7374  # ^^ column `@st
+0000b260: 6174 6560 3a20 2772 756e 6e69 6e67 2720  ate`: 'running' 
+0000b270: 6f72 2027 7065 6e64 696e 6727 0a0a 2020  or 'pending'..  
 0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b290: 2020 2020 6966 2073 7461 7465 5f63 6f64      if state_cod
-0000b2a0: 6520 3d3d 2022 7222 3a0a 2020 2020 2020  e == "r":.      
+0000b290: 2020 2320 7072 696e 7420 736f 6d65 2069    # print some i
+0000b2a0: 6e66 6f72 6d61 7469 6f6e 3a0a 2020 2020  nformation:.    
 0000b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2c0: 2020 746f 5f70 7269 6e74 202b 3d20 2254    to_print += "T
-0000b2d0: 6573 7420 6a6f 6220 6973 2072 756e 6e69  est job is runni
-0000b2e0: 6e67 2028 6072 6029 2e2e 2e22 0a20 2020  ng (`r`)...".   
-0000b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b300: 2065 6c69 6620 7374 6174 655f 636f 6465   elif state_code
-0000b310: 203d 3d20 2271 7722 3a0a 2020 2020 2020   == "qw":.      
-0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b330: 2020 746f 5f70 7269 6e74 202b 3d20 2254    to_print += "T
-0000b340: 6573 7420 6a6f 6220 6973 2070 656e 6469  est job is pendi
-0000b350: 6e67 2028 6071 7760 292e 2e2e 220a 2020  ng (`qw`)...".  
-0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b370: 2020 656c 6966 2073 7461 7465 5f63 6f64    elif state_cod
-0000b380: 6520 3d3d 2022 6571 7722 3a0a 2020 2020  e == "eqw":.    
-0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3a0: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
-0000b3b0: 2254 6573 7420 6a6f 6220 6973 2073 7461  "Test job is sta
-0000b3c0: 6c6c 6564 2028 6065 7177 6029 2e2e 2e22  lled (`eqw`)..."
-0000b3d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b3e0: 2020 656c 7365 3a20 2020 2320 7468 6520    else:   # the 
-0000b3f0: 6a6f 6220 6973 206e 6f74 2069 6e20 7175  job is not in qu
-0000b400: 6575 653a 0a20 2020 2020 2020 2020 2020  eue:.           
-0000b410: 2020 2020 2020 2020 2066 6c61 675f 646f           flag_do
-0000b420: 6e65 203d 2054 7275 650a 2020 2020 2020  ne = True.      
-0000b430: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000b440: 6765 7420 7468 6520 6c61 7374 206c 696e  get the last lin
-0000b450: 6520 6f66 2074 6865 206c 6f67 2066 696c  e of the log fil
-0000b460: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000b470: 2020 2020 2020 206c 6173 745f 6c69 6e65         last_line
-0000b480: 203d 2067 6574 5f6c 6173 745f 6c69 6e65   = get_last_line
-0000b490: 286f 5f66 6e29 2e72 6570 6c61 6365 2822  (o_fn).replace("
-0000b4a0: 5c6e 222c 2022 2229 0a20 2020 2020 2020  \n", "").       
-0000b4b0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-0000b4c0: 6865 636b 2069 6620 6974 2773 2022 5355  heck if it's "SU
-0000b4d0: 4343 4553 5322 3a0a 2020 2020 2020 2020  CCESS":.        
-0000b4e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000b4f0: 6173 745f 6c69 6e65 203d 3d20 2253 5543  ast_line == "SUC
-0000b500: 4345 5353 223a 0a20 2020 2020 2020 2020  CESS":.         
-0000b510: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000b520: 6c61 675f 7375 6363 6573 735f 7465 7374  lag_success_test
-0000b530: 5f6a 6f62 203d 2054 7275 650a 2020 2020  _job = True.    
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
-0000b560: 2254 6573 7420 6a6f 6220 6973 2073 7563  "Test job is suc
-0000b570: 6365 7373 6675 6c6c 7920 6669 6e69 7368  cessfully finish
-0000b580: 6564 2122 0a20 2020 2020 2020 2020 2020  ed!".           
-0000b590: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
-0000b5a0: 2023 2066 6169 6c65 643a 0a20 2020 2020   # failed:.     
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5c0: 2020 2066 6c61 675f 7375 6363 6573 735f     flag_success_
-0000b5d0: 7465 7374 5f6a 6f62 203d 2046 616c 7365  test_job = False
-0000b5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b5f0: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
-0000b600: 7420 2b3d 2022 5465 7374 206a 6f62 2077  t += "Test job w
-0000b610: 6173 206e 6f74 2073 7563 6365 7373 6675  as not successfu
-0000b620: 6c6c 7920 6669 6e69 7368 6564 220a 2020  lly finished".  
-0000b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b640: 2020 2020 2020 746f 5f70 7269 6e74 202b        to_print +
-0000b650: 3d20 2220 616e 6420 6973 2063 7572 7265  = " and is curre
-0000b660: 6e74 6c79 206f 7574 206f 6620 7175 6575  ntly out of queu
-0000b670: 652e 220a 2020 2020 2020 2020 2020 2020  e.".            
-0000b680: 2020 2020 2020 2020 2020 2020 746f 5f70              to_p
-0000b690: 7269 6e74 202b 3d20 2220 4c61 7374 206c  rint += " Last l
-0000b6a0: 696e 6520 6f66 2073 7464 6f75 7420 6c6f  ine of stdout lo
-0000b6b0: 6720 6669 6c65 3a20 2722 202b 206c 6173  g file: '" + las
-0000b6c0: 745f 6c69 6e65 202b 2022 272e 220a 2020  t_line + "'.".  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2020 2020 746f 5f70 7269 6e74 202b        to_print +
-0000b6f0: 3d20 2220 5061 7468 2074 6f20 7468 6520  = " Path to the 
-0000b700: 6c6f 6720 6669 6c65 3a20 2220 2b20 6c6f  log file: " + lo
-0000b710: 675f 666e 0a20 2020 2020 2020 2020 2020  g_fn.           
-0000b720: 2020 2020 2070 7269 6e74 2874 6f5f 7072       print(to_pr
-0000b730: 696e 7429 0a0a 2020 2020 2020 2020 2020  int)..          
-0000b740: 2020 6966 206e 6f74 2066 6c61 675f 7375    if not flag_su
-0000b750: 6363 6573 735f 7465 7374 5f6a 6f62 3a20  ccess_test_job: 
-0000b760: 2020 2320 6661 696c 6564 0a20 2020 2020    # failed.     
-0000b770: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000b780: 2045 7863 6570 7469 6f6e 280a 2020 2020   Exception(.    
-0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7a0: 225c 6e54 6865 7265 2069 7320 736f 6d65  "\nThere is some
-0000b7b0: 7468 696e 6720 7772 6f6e 6720 7072 6f62  thing wrong prob
-0000b7c0: 6162 6c79 2069 6e20 7468 6520 7365 7475  ably in the setu
-0000b7d0: 7073 2e22 0a20 2020 2020 2020 2020 2020  ps.".           
-0000b7e0: 2020 2020 2020 2020 202b 2022 2050 6c65           + " Ple
-0000b7f0: 6173 6520 6368 6563 6b20 7468 6520 6c6f  ase check the lo
-0000b800: 6720 6669 6c65 7322 0a20 2020 2020 2020  g files".       
-0000b810: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000b820: 2061 6e64 2074 6865 2060 2d2d 636f 6e74   and the `--cont
-0000b830: 6169 6e65 725f 636f 6e66 6967 5f79 616d  ainer_config_yam
-0000b840: 6c5f 6669 6c65 6022 0a20 2020 2020 2020  l_file`".       
-0000b850: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0000b860: 2070 726f 7669 6465 6420 696e 2060 6261   provided in `ba
-0000b870: 6273 2d69 6e69 7460 2122 0a20 2020 2020  bs-init`!".     
-0000b880: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000b890: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
-0000b8a0: 2023 2066 6c61 675f 7375 6363 6573 735f   # flag_success_
-0000b8b0: 7465 7374 5f6a 6f62 203d 3d20 5472 7565  test_job == True
-0000b8c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b8d0: 2020 2320 676f 2074 6872 7520 6063 6f64    # go thru `cod
-0000b8e0: 652f 6368 6563 6b5f 7365 7475 702f 6368  e/check_setup/ch
-0000b8f0: 6563 6b5f 656e 762e 7961 6d6c 603a 2063  eck_env.yaml`: c
-0000b900: 6865 636b 2069 6620 616e 7974 6869 6e67  heck if anything
-0000b910: 2077 726f 6e67 3a0a 2020 2020 2020 2020   wrong:.        
-0000b920: 2020 2020 2020 2020 666e 5f63 6865 636b          fn_check
-0000b930: 5f65 6e76 5f79 616d 6c20 3d20 6f70 2e6a  _env_yaml = op.j
-0000b940: 6f69 6e28 7365 6c66 2e61 6e61 6c79 7369  oin(self.analysi
-0000b950: 735f 7061 7468 2c20 2263 6f64 652f 6368  s_path, "code/ch
-0000b960: 6563 6b5f 7365 7475 7022 2c0a 2020 2020  eck_setup",.    
-0000b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b990: 2020 2020 2020 2020 2263 6865 636b 5f65          "check_e
-0000b9a0: 6e76 2e79 616d 6c22 290a 2020 2020 2020  nv.yaml").      
-0000b9b0: 2020 2020 2020 2020 2020 666c 6167 5f77            flag_w
-0000b9c0: 7269 7461 626c 652c 2066 6c61 675f 616c  ritable, flag_al
-0000b9d0: 6c5f 696e 7374 616c 6c65 6420 3d20 7072  l_installed = pr
-0000b9e0: 696e 745f 7665 7273 696f 6e73 5f66 726f  int_versions_fro
-0000b9f0: 6d5f 7961 6d6c 2866 6e5f 6368 6563 6b5f  m_yaml(fn_check_
-0000ba00: 656e 765f 7961 6d6c 290a 2020 2020 2020  env_yaml).      
-0000ba10: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000ba20: 2066 6c61 675f 7772 6974 6162 6c65 3a0a   flag_writable:.
-0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba40: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000ba50: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000ba60: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-0000ba70: 6520 6465 7369 676e 6174 6564 2077 6f72  e designated wor
-0000ba80: 6b73 7061 6365 2069 7320 6e6f 7420 7772  kspace is not wr
-0000ba90: 6974 6162 6c65 2122 0a20 2020 2020 2020  itable!".       
-0000baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bab0: 202b 2022 2050 6c65 6173 6520 6368 616e   + " Please chan
-0000bac0: 6765 2069 7420 696e 2074 6865 2059 414d  ge it in the YAM
-0000bad0: 4c20 6669 6c65 220a 2020 2020 2020 2020  L file".        
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baf0: 2b20 2220 7573 6564 2069 6e20 6062 6162  + " used in `bab
-0000bb00: 732d 696e 6974 202d 2d63 6f6e 7461 696e  s-init --contain
-0000bb10: 6572 2d63 6f6e 6669 672d 7961 6d6c 2d66  er-config-yaml-f
-0000bb20: 696c 6560 2c22 0a20 2020 2020 2020 2020  ile`,".         
-0000bb30: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000bb40: 2022 2074 6865 6e20 7265 7275 6e20 6062   " then rerun `b
-0000bb50: 6162 732d 696e 6974 6020 7769 7468 2075  abs-init` with u
-0000bb60: 7064 6174 6564 2059 414d 4c20 6669 6c65  pdated YAML file
-0000bb70: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0000bb80: 2020 2020 2020 2020 2320 4e4f 5445 3a20          # NOTE: 
-0000bb90: 5e5e 2063 7572 7265 6e74 6c79 2074 6869  ^^ currently thi
-0000bba0: 7320 6973 206e 6f74 2061 6c69 676e 6564  s is not aligned
-0000bbb0: 2077 6974 6820 5941 4d4c 2066 696c 6520   with YAML file 
-0000bbc0: 7365 6374 696f 6e73 3b0a 2020 2020 2020  sections;.      
-0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000bbe0: 7468 6973 2077 696c 6c20 6d61 6b65 206d  this will make m
-0000bbf0: 6f72 6520 7365 6e73 6520 6166 7465 7220  ore sense after 
-0000bc00: 6164 6469 6e67 2073 6563 7469 6f6e 206f  adding section o
-0000bc10: 6620 776f 726b 7370 6163 6520 7061 7468  f workspace path
-0000bc20: 2069 6e20 5941 4d4c 2066 696c 650a 2020   in YAML file.  
-0000bc30: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000bc40: 206e 6f74 2066 6c61 675f 616c 6c5f 696e   not flag_all_in
-0000bc50: 7374 616c 6c65 643a 0a20 2020 2020 2020  stalled:.       
-0000bc60: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000bc70: 7365 2045 7863 6570 7469 6f6e 280a 2020  se Exception(.  
-0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc90: 2020 2020 2020 2253 6f6d 6520 7265 7175        "Some requ
-0000bca0: 6972 6564 2070 6163 6b61 6765 2873 2920  ired package(s) 
-0000bcb0: 7765 7265 206e 6f74 2069 6e73 7461 6c6c  were not install
-0000bcc0: 6564 220a 2020 2020 2020 2020 2020 2020  ed".            
-0000bcd0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0000bce0: 696e 2074 6865 2064 6573 6967 6e61 7465  in the designate
-0000bcf0: 6420 656e 7669 726f 6e6d 656e 7421 220a  d environment!".
-0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd10: 2020 2020 2020 2020 2b20 2220 506c 6561          + " Plea
-0000bd20: 7365 2069 6e73 7461 6c6c 2074 6865 6d20  se install them 
-0000bd30: 696e 2074 6865 2064 6573 6967 6e61 7465  in the designate
-0000bd40: 6420 656e 7669 726f 6e6d 656e 742c 220a  d environment,".
-0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd60: 2020 2020 2020 2020 2b20 2220 6f72 2063          + " or c
-0000bd70: 6861 6e67 6520 7468 6520 6465 7369 676e  hange the design
-0000bd80: 6174 6564 2065 6e76 6972 6f6e 6d65 6e74  ated environment
-0000bd90: 2079 6f75 2068 6f70 6520 746f 2075 7365   you hope to use
-0000bda0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000bdb0: 2020 2020 2020 2020 2020 2b20 2220 696e            + " in
-0000bdc0: 2060 2d2d 636f 6e74 6169 6e65 722d 636f   `--container-co
-0000bdd0: 6e66 6967 2d79 616d 6c2d 6669 6c65 6020  nfig-yaml-file` 
-0000bde0: 616e 6420 7265 7275 6e20 6062 6162 732d  and rerun `babs-
-0000bdf0: 696e 6974 6021 2229 0a0a 2020 2020 2020  init`!")..      
-0000be00: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000be10: 2250 6c65 6173 6520 6368 6563 6b20 6966  "Please check if
-0000be20: 2061 626f 7665 2076 6572 7369 6f6e 7320   above versions 
-0000be30: 6172 6520 7468 6520 6f6e 6573 2079 6f75  are the ones you
-0000be40: 2068 6f70 6520 746f 2075 7365 2122 0a20   hope to use!". 
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 202b 2022 2049 6620 6e6f 742c       + " If not,
-0000be70: 2070 6c65 6173 6520 6368 616e 6765 2074   please change t
-0000be80: 6865 2076 6572 7369 6f6e 2069 6e20 7468  he version in th
-0000be90: 6520 6465 7369 676e 6174 6564 2065 6e76  e designated env
-0000bea0: 6972 6f6e 6d65 6e74 2c22 0a20 2020 2020  ironment,".     
-0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bec0: 202b 2022 206f 7220 6368 616e 6765 2074   + " or change t
-0000bed0: 6865 2064 6573 6967 6e61 7465 6420 656e  he designated en
-0000bee0: 7669 726f 6e6d 656e 7420 796f 7520 686f  vironment you ho
-0000bef0: 7065 2074 6f20 7573 6522 0a20 2020 2020  pe to use".     
-0000bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf10: 202b 2022 2069 6e20 602d 2d63 6f6e 7461   + " in `--conta
-0000bf20: 696e 6572 2d63 6f6e 6669 672d 7961 6d6c  iner-config-yaml
-0000bf30: 2d66 696c 6560 2061 6e64 2072 6572 756e  -file` and rerun
-0000bf40: 2060 6261 6273 2d69 6e69 7460 2e22 290a   `babs-init`.").
-0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf60: 7072 696e 7428 4348 4543 4b5f 4d41 524b  print(CHECK_MARK
-0000bf70: 202b 2022 2041 6c6c 2067 6f6f 6420 696e   + " All good in
-0000bf80: 2074 6573 7420 6a6f 6221 2229 0a20 2020   test job!").   
-0000bf90: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000bfa0: 6e74 2822 5c6e 6062 6162 732d 6368 6563  nt("\n`babs-chec
-0000bfb0: 6b2d 7365 7475 7060 2077 6173 2073 7563  k-setup` was suc
-0000bfc0: 6365 7373 6675 6c21 2022 290a 0a20 2020  cessful! ")..   
-0000bfd0: 2020 2020 2069 6620 666c 6167 5f77 6172       if flag_war
-0000bfe0: 6e69 6e67 5f6f 7574 7075 745f 7269 613a  ning_output_ria:
-0000bff0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000c000: 6e74 2822 5c6e 506c 6561 7365 2063 6865  nt("\nPlease che
-0000c010: 636b 206f 7574 2074 6865 2077 6172 6e69  ck out the warni
-0000c020: 6e67 2066 6f72 206f 7574 7075 7420 5249  ng for output RI
-0000c030: 4121 2229 0a0a 2020 2020 6465 6620 6261  A!")..    def ba
-0000c040: 6273 5f73 7562 6d69 7428 7365 6c66 2c20  bs_submit(self, 
-0000c050: 636f 756e 743d 312c 2064 665f 6a6f 625f  count=1, df_job_
-0000c060: 7370 6563 6966 6965 643d 4e6f 6e65 293a  specified=None):
-0000c070: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000c080: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-0000c090: 6f6e 2073 7562 6d69 7473 206a 6f62 7320  on submits jobs 
-0000c0a0: 616e 6420 7072 696e 7473 206f 7574 206a  and prints out j
-0000c0b0: 6f62 2073 7461 7475 732e 0a0a 2020 2020  ob status...    
-0000c0c0: 2020 2020 5061 7261 6d65 7465 7273 3a0a      Parameters:.
-0000c0d0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-0000c0e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-0000c0f0: 2020 2020 636f 756e 743a 2069 6e74 0a20      count: int. 
-0000c100: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
-0000c110: 7220 6f66 206a 6f62 7320 746f 2062 6520  r of jobs to be 
-0000c120: 7375 626d 6974 7465 640a 2020 2020 2020  submitted.      
-0000c130: 2020 2020 2020 6465 6661 756c 743a 2031        default: 1
-0000c140: 0a20 2020 2020 2020 2020 2020 206e 6567  .            neg
-0000c150: 6174 6976 6520 7661 6c75 653a 2074 6f20  ative value: to 
-0000c160: 7375 626d 6974 2061 6c6c 206a 6f62 730a  submit all jobs.
-0000c170: 2020 2020 2020 2020 6466 5f6a 6f62 5f73          df_job_s
-0000c180: 7065 6369 6669 6564 3a20 7064 2e44 6174  pecified: pd.Dat
-0000c190: 6146 7261 6d65 206f 7220 4e6f 6e65 0a20  aFrame or None. 
-0000c1a0: 2020 2020 2020 2020 2020 206c 6973 7420             list 
-0000c1b0: 6f66 2073 7065 6369 6669 6564 206a 6f62  of specified job
-0000c1c0: 2873 2920 746f 2073 7562 6d69 742e 0a20  (s) to submit.. 
-0000c1d0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0000c1e0: 6e73 3a20 2773 7562 5f69 6427 2028 616e  ns: 'sub_id' (an
-0000c1f0: 6420 2773 6573 5f69 6427 2c20 6966 206d  d 'ses_id', if m
-0000c200: 756c 7469 2d73 6573 290a 2020 2020 2020  ulti-ses).      
-0000c210: 2020 2020 2020 4966 2060 2d2d 6a6f 6260        If `--job`
-0000c220: 2077 6173 206e 6f74 2073 7065 6369 6669   was not specifi
-0000c230: 6564 2069 6e20 6062 6162 732d 7375 626d  ed in `babs-subm
-0000c240: 6974 602c 2069 7420 7769 6c6c 2062 6520  it`, it will be 
-0000c250: 4e6f 6e65 2e0a 2020 2020 2020 2020 2222  None..        ""
-0000c260: 220a 0a20 2020 2020 2020 2063 6f75 6e74  "..        count
-0000c270: 5f72 6570 6f72 745f 7072 6f67 7265 7373  _report_progress
-0000c280: 203d 2031 300a 2020 2020 2020 2020 2320   = 10.        # 
-0000c290: 5e5e 2069 6620 606a 5f63 6f75 6e74 6020  ^^ if `j_count` 
-0000c2a0: 6973 2073 6576 6572 616c 2074 696d 6573  is several times
-0000c2b0: 206f 6620 6063 6f75 6e74 5f72 6570 6f72   of `count_repor
-0000c2c0: 745f 7072 6f67 7265 7373 602c 2072 6570  t_progress`, rep
-0000c2d0: 6f72 7420 7072 6f67 7265 7373 0a0a 2020  ort progress..  
-0000c2e0: 2020 2020 2020 2320 7570 6461 7465 2060        # update `
-0000c2f0: 616e 616c 7973 6973 5f64 6174 616c 6164  analysis_datalad
-0000c300: 5f68 616e 646c 6560 3a0a 2020 2020 2020  _handle`:.      
-0000c310: 2020 6966 2073 656c 662e 616e 616c 7973    if self.analys
-0000c320: 6973 5f64 6174 616c 6164 5f68 616e 646c  is_datalad_handl
-0000c330: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0000c340: 2020 2020 2020 2073 656c 662e 616e 616c         self.anal
-0000c350: 7973 6973 5f64 6174 616c 6164 5f68 616e  ysis_datalad_han
-0000c360: 646c 6520 3d20 646c 6170 692e 4461 7461  dle = dlapi.Data
-0000c370: 7365 7428 7365 6c66 2e61 6e61 6c79 7369  set(self.analysi
-0000c380: 735f 7061 7468 290a 0a20 2020 2020 2020  s_path)..       
-0000c390: 2023 2060 6372 6561 7465 5f6a 6f62 5f73   # `create_job_s
-0000c3a0: 7461 7475 735f 6373 7628 7365 6c66 2960  tatus_csv(self)`
-0000c3b0: 2068 6173 2062 6565 6e20 6361 6c6c 6564   has been called
-0000c3c0: 2069 6e20 6062 6162 735f 7374 6174 7573   in `babs_status
-0000c3d0: 2829 600a 2020 2020 2020 2020 2320 2020  ()`.        #   
-0000c3e0: 696e 2060 636c 692e 7079 600a 0a20 2020  in `cli.py`..   
-0000c3f0: 2020 2020 2023 204c 6f61 6420 7468 6520       # Load the 
-0000c400: 6373 7620 6669 6c65 0a20 2020 2020 2020  csv file.       
-0000c410: 206c 6f63 6b5f 7061 7468 203d 2073 656c   lock_path = sel
-0000c420: 662e 6a6f 625f 7374 6174 7573 5f70 6174  f.job_status_pat
-0000c430: 685f 6162 7320 2b20 222e 6c6f 636b 220a  h_abs + ".lock".
-0000c440: 2020 2020 2020 2020 6c6f 636b 203d 2046          lock = F
-0000c450: 696c 654c 6f63 6b28 6c6f 636b 5f70 6174  ileLock(lock_pat
-0000c460: 6829 0a0a 2020 2020 2020 2020 7472 793a  h)..        try:
-0000c470: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000c480: 6820 6c6f 636b 2e61 6371 7569 7265 2874  h lock.acquire(t
-0000c490: 696d 656f 7574 3d35 293a 2020 2320 6c6f  imeout=5):  # lo
-0000c4a0: 636b 2074 6865 2066 696c 652c 2069 2e65  ck the file, i.e
-0000c4b0: 2e2c 206c 6f63 6b20 6a6f 6220 7374 6174  ., lock job stat
-0000c4c0: 7573 2064 660a 2020 2020 2020 2020 2020  us df.          
-0000c4d0: 2020 2020 2020 6466 5f6a 6f62 203d 2072        df_job = r
-0000c4e0: 6561 645f 6a6f 625f 7374 6174 7573 5f63  ead_job_status_c
-0000c4f0: 7376 2873 656c 662e 6a6f 625f 7374 6174  sv(self.job_stat
-0000c500: 7573 5f70 6174 685f 6162 7329 0a20 2020  us_path_abs).   
-0000c510: 2020 2020 2020 2020 2020 2020 2023 2067               # g
-0000c520: 6574 7469 6e67 206c 6973 7420 6f66 206a  etting list of j
-0000c530: 6f62 7320 696e 6469 6365 7320 746f 2073  obs indices to s
-0000c540: 7562 6d69 7420 2862 6173 6564 2065 6974  ubmit (based eit
-0000c550: 6865 7220 6f6e 2064 665f 6a6f 625f 7370  her on df_job_sp
-0000c560: 6563 6966 6965 6420 6f72 2063 6f75 6e74  ecified or count
-0000c570: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000c580: 2020 206a 6f62 5f69 6e64 5f6c 6973 7420     job_ind_list 
-0000c590: 3d20 7072 6570 6172 655f 6a6f 625f 696e  = prepare_job_in
-0000c5a0: 645f 6c69 7374 2864 665f 6a6f 622c 2064  d_list(df_job, d
-0000c5b0: 665f 6a6f 625f 7370 6563 6966 6965 642c  f_job_specified,
-0000c5c0: 2063 6f75 6e74 2c20 7365 6c66 2e74 7970   count, self.typ
-0000c5d0: 655f 7365 7373 696f 6e29 0a20 2020 2020  e_session).     
-0000c5e0: 2020 2020 2020 2020 2020 2064 665f 6a6f             df_jo
-0000c5f0: 625f 7570 6461 7465 6420 3d20 6466 5f6a  b_updated = df_j
-0000c600: 6f62 2e63 6f70 7928 290a 2020 2020 2020  ob.copy().      
-0000c610: 2020 2020 2020 2020 2020 666f 7220 695f            for i_
-0000c620: 7072 6f67 7265 7373 2c20 695f 6a6f 6220  progress, i_job 
-0000c630: 696e 2065 6e75 6d65 7261 7465 286a 6f62  in enumerate(job
-0000c640: 5f69 6e64 5f6c 6973 7429 3a0a 2020 2020  _ind_list):.    
-0000c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c660: 2320 5375 626d 6974 2061 206a 6f62 3a0a  # Submit a job:.
-0000c670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c680: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-0000c690: 5f73 6573 7369 6f6e 203d 3d20 2273 696e  _session == "sin
-0000c6a0: 676c 652d 7365 7322 3a0a 2020 2020 2020  gle-ses":.      
-0000c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6c0: 2020 7375 6220 3d20 6466 5f6a 6f62 2e61    sub = df_job.a
-0000c6d0: 745b 695f 6a6f 622c 2022 7375 625f 6964  t[i_job, "sub_id
-0000c6e0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-0000c6f0: 2020 2020 2020 2020 2020 2073 6573 203d             ses =
-0000c700: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-0000c710: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-0000c720: 2023 206d 756c 7469 2d73 6573 0a20 2020   # multi-ses.   
-0000c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c740: 2020 2020 2073 7562 203d 2064 665f 6a6f       sub = df_jo
-0000c750: 622e 6174 5b69 5f6a 6f62 2c20 2273 7562  b.at[i_job, "sub
-0000c760: 5f69 6422 5d0a 2020 2020 2020 2020 2020  _id"].          
-0000c770: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000c780: 7320 3d20 6466 5f6a 6f62 2e61 745b 695f  s = df_job.at[i_
-0000c790: 6a6f 622c 2022 7365 735f 6964 225d 0a0a  job, "ses_id"]..
-0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7b0: 2020 2020 6a6f 625f 6964 2c20 5f2c 206c      job_id, _, l
-0000c7c0: 6f67 5f66 696c 656e 616d 6520 3d20 5c0a  og_filename = \.
+0000b2c0: 6966 2073 7461 7465 5f63 6f64 6520 3d3d  if state_code ==
+0000b2d0: 2022 7222 3a0a 2020 2020 2020 2020 2020   "r":.          
+0000b2e0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000b2f0: 5f70 7269 6e74 202b 3d20 2254 6573 7420  _print += "Test 
+0000b300: 6a6f 6220 6973 2072 756e 6e69 6e67 2028  job is running (
+0000b310: 6072 6029 2e2e 2e22 0a20 2020 2020 2020  `r`)...".       
+0000b320: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0000b330: 6620 7374 6174 655f 636f 6465 203d 3d20  f state_code == 
+0000b340: 2271 7722 3a0a 2020 2020 2020 2020 2020  "qw":.          
+0000b350: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000b360: 5f70 7269 6e74 202b 3d20 2254 6573 7420  _print += "Test 
+0000b370: 6a6f 6220 6973 2070 656e 6469 6e67 2028  job is pending (
+0000b380: 6071 7760 292e 2e2e 220a 2020 2020 2020  `qw`)...".      
+0000b390: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000b3a0: 6966 2073 7461 7465 5f63 6f64 6520 3d3d  if state_code ==
+0000b3b0: 2022 6571 7722 3a0a 2020 2020 2020 2020   "eqw":.        
+0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3d0: 746f 5f70 7269 6e74 202b 3d20 2254 6573  to_print += "Tes
+0000b3e0: 7420 6a6f 6220 6973 2073 7461 6c6c 6564  t job is stalled
+0000b3f0: 2028 6065 7177 6029 2e2e 2e22 0a0a 2020   (`eqw`)..."..  
+0000b400: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000b410: 7365 3a20 2020 2320 7468 6520 6a6f 6220  se:   # the job 
+0000b420: 6973 206e 6f74 2069 6e20 7175 6575 653a  is not in queue:
+0000b430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b440: 2020 2020 2066 6c61 675f 646f 6e65 203d       flag_done =
+0000b450: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0000b460: 2020 2020 2020 2020 2020 2320 6765 7420            # get 
+0000b470: 7468 6520 6c61 7374 206c 696e 6520 6f66  the last line of
+0000b480: 2074 6865 206c 6f67 2066 696c 653a 0a20   the log file:. 
+0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4a0: 2020 206c 6173 745f 6c69 6e65 203d 2067     last_line = g
+0000b4b0: 6574 5f6c 6173 745f 6c69 6e65 286f 5f66  et_last_line(o_f
+0000b4c0: 6e29 2e72 6570 6c61 6365 2822 5c6e 222c  n).replace("\n",
+0000b4d0: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
+0000b4e0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+0000b4f0: 2069 6620 6974 2773 2022 5355 4343 4553   if it's "SUCCES
+0000b500: 5322 3a0a 2020 2020 2020 2020 2020 2020  S":.            
+0000b510: 2020 2020 2020 2020 6966 206c 6173 745f          if last_
+0000b520: 6c69 6e65 203d 3d20 2253 5543 4345 5353  line == "SUCCESS
+0000b530: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000b540: 2020 2020 2020 2020 2020 2066 6c61 675f             flag_
+0000b550: 7375 6363 6573 735f 7465 7374 5f6a 6f62  success_test_job
+0000b560: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0000b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b580: 746f 5f70 7269 6e74 202b 3d20 2254 6573  to_print += "Tes
+0000b590: 7420 6a6f 6220 6973 2073 7563 6365 7373  t job is success
+0000b5a0: 6675 6c6c 7920 6669 6e69 7368 6564 2122  fully finished!"
+0000b5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b5c0: 2020 2020 2065 6c73 653a 2020 2023 2066       else:   # f
+0000b5d0: 6169 6c65 643a 0a20 2020 2020 2020 2020  ailed:.         
+0000b5e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000b5f0: 6c61 675f 7375 6363 6573 735f 7465 7374  lag_success_test
+0000b600: 5f6a 6f62 203d 2046 616c 7365 0a20 2020  _job = False.   
+0000b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b620: 2020 2020 2074 6f5f 7072 696e 7420 2b3d       to_print +=
+0000b630: 2022 5465 7374 206a 6f62 2077 6173 206e   "Test job was n
+0000b640: 6f74 2073 7563 6365 7373 6675 6c6c 7920  ot successfully 
+0000b650: 6669 6e69 7368 6564 220a 2020 2020 2020  finished".      
+0000b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b670: 2020 746f 5f70 7269 6e74 202b 3d20 2220    to_print += " 
+0000b680: 616e 6420 6973 2063 7572 7265 6e74 6c79  and is currently
+0000b690: 206f 7574 206f 6620 7175 6575 652e 220a   out of queue.".
+0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6b0: 2020 2020 2020 2020 746f 5f70 7269 6e74          to_print
+0000b6c0: 202b 3d20 2220 4c61 7374 206c 696e 6520   += " Last line 
+0000b6d0: 6f66 2073 7464 6f75 7420 6c6f 6720 6669  of stdout log fi
+0000b6e0: 6c65 3a20 2722 202b 206c 6173 745f 6c69  le: '" + last_li
+0000b6f0: 6e65 202b 2022 272e 220a 2020 2020 2020  ne + "'.".      
+0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b710: 2020 746f 5f70 7269 6e74 202b 3d20 2220    to_print += " 
+0000b720: 5061 7468 2074 6f20 7468 6520 6c6f 6720  Path to the log 
+0000b730: 6669 6c65 3a20 2220 2b20 6c6f 675f 666e  file: " + log_fn
+0000b740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b750: 2070 7269 6e74 2874 6f5f 7072 696e 7429   print(to_print)
+0000b760: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000b770: 206e 6f74 2066 6c61 675f 7375 6363 6573   not flag_succes
+0000b780: 735f 7465 7374 5f6a 6f62 3a20 2020 2320  s_test_job:   # 
+0000b790: 6661 696c 6564 0a20 2020 2020 2020 2020  failed.         
+0000b7a0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000b7b0: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+0000b7c0: 2020 2020 2020 2020 2020 2020 225c 6e54              "\nT
+0000b7d0: 6865 7265 2069 7320 736f 6d65 7468 696e  here is somethin
+0000b7e0: 6720 7772 6f6e 6720 7072 6f62 6162 6c79  g wrong probably
+0000b7f0: 2069 6e20 7468 6520 7365 7475 7073 2e22   in the setups."
+0000b800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b810: 2020 2020 202b 2022 2050 6c65 6173 6520       + " Please 
+0000b820: 6368 6563 6b20 7468 6520 6c6f 6720 6669  check the log fi
+0000b830: 6c65 7322 0a20 2020 2020 2020 2020 2020  les".           
+0000b840: 2020 2020 2020 2020 202b 2022 2061 6e64           + " and
+0000b850: 2074 6865 2060 2d2d 636f 6e74 6169 6e65   the `--containe
+0000b860: 725f 636f 6e66 6967 5f79 616d 6c5f 6669  r_config_yaml_fi
+0000b870: 6c65 6022 0a20 2020 2020 2020 2020 2020  le`".           
+0000b880: 2020 2020 2020 2020 202b 2022 2070 726f           + " pro
+0000b890: 7669 6465 6420 696e 2060 6261 6273 2d69  vided in `babs-i
+0000b8a0: 6e69 7460 2122 0a20 2020 2020 2020 2020  nit`!".         
+0000b8b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000b8c0: 2020 2020 2065 6c73 653a 2020 2023 2066       else:   # f
+0000b8d0: 6c61 675f 7375 6363 6573 735f 7465 7374  lag_success_test
+0000b8e0: 5f6a 6f62 203d 3d20 5472 7565 3a0a 2020  _job == True:.  
+0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000b900: 676f 2074 6872 7520 6063 6f64 652f 6368  go thru `code/ch
+0000b910: 6563 6b5f 7365 7475 702f 6368 6563 6b5f  eck_setup/check_
+0000b920: 656e 762e 7961 6d6c 603a 2063 6865 636b  env.yaml`: check
+0000b930: 2069 6620 616e 7974 6869 6e67 2077 726f   if anything wro
+0000b940: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+0000b950: 2020 2020 666e 5f63 6865 636b 5f65 6e76      fn_check_env
+0000b960: 5f79 616d 6c20 3d20 6f70 2e6a 6f69 6e28  _yaml = op.join(
+0000b970: 7365 6c66 2e61 6e61 6c79 7369 735f 7061  self.analysis_pa
+0000b980: 7468 2c20 2263 6f64 652f 6368 6563 6b5f  th, "code/check_
+0000b990: 7365 7475 7022 2c0a 2020 2020 2020 2020  setup",.        
+0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9c0: 2020 2020 2263 6865 636b 5f65 6e76 2e79      "check_env.y
+0000b9d0: 616d 6c22 290a 2020 2020 2020 2020 2020  aml").          
+0000b9e0: 2020 2020 2020 666c 6167 5f77 7269 7461        flag_writa
+0000b9f0: 626c 652c 2066 6c61 675f 616c 6c5f 696e  ble, flag_all_in
+0000ba00: 7374 616c 6c65 6420 3d20 7072 696e 745f  stalled = print_
+0000ba10: 7665 7273 696f 6e73 5f66 726f 6d5f 7961  versions_from_ya
+0000ba20: 6d6c 2866 6e5f 6368 6563 6b5f 656e 765f  ml(fn_check_env_
+0000ba30: 7961 6d6c 290a 2020 2020 2020 2020 2020  yaml).          
+0000ba40: 2020 2020 2020 6966 206e 6f74 2066 6c61        if not fla
+0000ba50: 675f 7772 6974 6162 6c65 3a0a 2020 2020  g_writable:.    
+0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba70: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000ba80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ba90: 2020 2020 2020 2020 2022 5468 6520 6465           "The de
+0000baa0: 7369 676e 6174 6564 2077 6f72 6b73 7061  signated workspa
+0000bab0: 6365 2069 7320 6e6f 7420 7772 6974 6162  ce is not writab
+0000bac0: 6c65 2122 0a20 2020 2020 2020 2020 2020  le!".           
+0000bad0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000bae0: 2050 6c65 6173 6520 6368 616e 6765 2069   Please change i
+0000baf0: 7420 696e 2074 6865 2059 414d 4c20 6669  t in the YAML fi
+0000bb00: 6c65 220a 2020 2020 2020 2020 2020 2020  le".            
+0000bb10: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+0000bb20: 7573 6564 2069 6e20 6062 6162 732d 696e  used in `babs-in
+0000bb30: 6974 202d 2d63 6f6e 7461 696e 6572 2d63  it --container-c
+0000bb40: 6f6e 6669 672d 7961 6d6c 2d66 696c 6560  onfig-yaml-file`
+0000bb50: 2c22 0a20 2020 2020 2020 2020 2020 2020  ,".             
+0000bb60: 2020 2020 2020 2020 2020 202b 2022 2074             + " t
+0000bb70: 6865 6e20 7265 7275 6e20 6062 6162 732d  hen rerun `babs-
+0000bb80: 696e 6974 6020 7769 7468 2075 7064 6174  init` with updat
+0000bb90: 6564 2059 414d 4c20 6669 6c65 2e22 290a  ed YAML file.").
+0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbb0: 2020 2020 2320 4e4f 5445 3a20 5e5e 2063      # NOTE: ^^ c
+0000bbc0: 7572 7265 6e74 6c79 2074 6869 7320 6973  urrently this is
+0000bbd0: 206e 6f74 2061 6c69 676e 6564 2077 6974   not aligned wit
+0000bbe0: 6820 5941 4d4c 2066 696c 6520 7365 6374  h YAML file sect
+0000bbf0: 696f 6e73 3b0a 2020 2020 2020 2020 2020  ions;.          
+0000bc00: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+0000bc10: 2077 696c 6c20 6d61 6b65 206d 6f72 6520   will make more 
+0000bc20: 7365 6e73 6520 6166 7465 7220 6164 6469  sense after addi
+0000bc30: 6e67 2073 6563 7469 6f6e 206f 6620 776f  ng section of wo
+0000bc40: 726b 7370 6163 6520 7061 7468 2069 6e20  rkspace path in 
+0000bc50: 5941 4d4c 2066 696c 650a 2020 2020 2020  YAML file.      
+0000bc60: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000bc70: 2066 6c61 675f 616c 6c5f 696e 7374 616c   flag_all_instal
+0000bc80: 6c65 643a 0a20 2020 2020 2020 2020 2020  led:.           
+0000bc90: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+0000bca0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+0000bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bcc0: 2020 2253 6f6d 6520 7265 7175 6972 6564    "Some required
+0000bcd0: 2070 6163 6b61 6765 2873 2920 7765 7265   package(s) were
+0000bce0: 206e 6f74 2069 6e73 7461 6c6c 6564 220a   not installed".
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 2020 2020 2020 2020 2b20 2220 696e 2074          + " in t
+0000bd10: 6865 2064 6573 6967 6e61 7465 6420 656e  he designated en
+0000bd20: 7669 726f 6e6d 656e 7421 220a 2020 2020  vironment!".    
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd40: 2020 2020 2b20 2220 506c 6561 7365 2069      + " Please i
+0000bd50: 6e73 7461 6c6c 2074 6865 6d20 696e 2074  nstall them in t
+0000bd60: 6865 2064 6573 6967 6e61 7465 6420 656e  he designated en
+0000bd70: 7669 726f 6e6d 656e 742c 220a 2020 2020  vironment,".    
+0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd90: 2020 2020 2b20 2220 6f72 2063 6861 6e67      + " or chang
+0000bda0: 6520 7468 6520 6465 7369 676e 6174 6564  e the designated
+0000bdb0: 2065 6e76 6972 6f6e 6d65 6e74 2079 6f75   environment you
+0000bdc0: 2068 6f70 6520 746f 2075 7365 220a 2020   hope to use".  
+0000bdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bde0: 2020 2020 2020 2b20 2220 696e 2060 2d2d        + " in `--
+0000bdf0: 636f 6e74 6169 6e65 722d 636f 6e66 6967  container-config
+0000be00: 2d79 616d 6c2d 6669 6c65 6020 616e 6420  -yaml-file` and 
+0000be10: 7265 7275 6e20 6062 6162 732d 696e 6974  rerun `babs-init
+0000be20: 6021 2229 0a0a 2020 2020 2020 2020 2020  `!")..          
+0000be30: 2020 2020 2020 7072 696e 7428 2250 6c65        print("Ple
+0000be40: 6173 6520 6368 6563 6b20 6966 2061 626f  ase check if abo
+0000be50: 7665 2076 6572 7369 6f6e 7320 6172 6520  ve versions are 
+0000be60: 7468 6520 6f6e 6573 2079 6f75 2068 6f70  the ones you hop
+0000be70: 6520 746f 2075 7365 2122 0a20 2020 2020  e to use!".     
+0000be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be90: 202b 2022 2049 6620 6e6f 742c 2070 6c65   + " If not, ple
+0000bea0: 6173 6520 6368 616e 6765 2074 6865 2076  ase change the v
+0000beb0: 6572 7369 6f6e 2069 6e20 7468 6520 6465  ersion in the de
+0000bec0: 7369 676e 6174 6564 2065 6e76 6972 6f6e  signated environ
+0000bed0: 6d65 6e74 2c22 0a20 2020 2020 2020 2020  ment,".         
+0000bee0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000bef0: 206f 7220 6368 616e 6765 2074 6865 2064   or change the d
+0000bf00: 6573 6967 6e61 7465 6420 656e 7669 726f  esignated enviro
+0000bf10: 6e6d 656e 7420 796f 7520 686f 7065 2074  nment you hope t
+0000bf20: 6f20 7573 6522 0a20 2020 2020 2020 2020  o use".         
+0000bf30: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000bf40: 2069 6e20 602d 2d63 6f6e 7461 696e 6572   in `--container
+0000bf50: 2d63 6f6e 6669 672d 7961 6d6c 2d66 696c  -config-yaml-fil
+0000bf60: 6560 2061 6e64 2072 6572 756e 2060 6261  e` and rerun `ba
+0000bf70: 6273 2d69 6e69 7460 2e22 290a 2020 2020  bs-init`.").    
+0000bf80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000bf90: 7428 4348 4543 4b5f 4d41 524b 202b 2022  t(CHECK_MARK + "
+0000bfa0: 2041 6c6c 2067 6f6f 6420 696e 2074 6573   All good in tes
+0000bfb0: 7420 6a6f 6221 2229 0a20 2020 2020 2020  t job!").       
+0000bfc0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0000bfd0: 5c6e 6062 6162 732d 6368 6563 6b2d 7365  \n`babs-check-se
+0000bfe0: 7475 7060 2077 6173 2073 7563 6365 7373  tup` was success
+0000bff0: 6675 6c21 2022 290a 0a20 2020 2020 2020  ful! ")..       
+0000c000: 2069 6620 666c 6167 5f77 6172 6e69 6e67   if flag_warning
+0000c010: 5f6f 7574 7075 745f 7269 613a 0a20 2020  _output_ria:.   
+0000c020: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0000c030: 5c6e 506c 6561 7365 2063 6865 636b 206f  \nPlease check o
+0000c040: 7574 2074 6865 2077 6172 6e69 6e67 2066  ut the warning f
+0000c050: 6f72 206f 7574 7075 7420 5249 4121 2229  or output RIA!")
+0000c060: 0a0a 2020 2020 6465 6620 6261 6273 5f73  ..    def babs_s
+0000c070: 7562 6d69 7428 7365 6c66 2c20 636f 756e  ubmit(self, coun
+0000c080: 743d 312c 2064 665f 6a6f 625f 7370 6563  t=1, df_job_spec
+0000c090: 6966 6965 643d 4e6f 6e65 293a 0a20 2020  ified=None):.   
+0000c0a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000c0b0: 2054 6869 7320 6675 6e63 7469 6f6e 2073   This function s
+0000c0c0: 7562 6d69 7473 206a 6f62 7320 616e 6420  ubmits jobs and 
+0000c0d0: 7072 696e 7473 206f 7574 206a 6f62 2073  prints out job s
+0000c0e0: 7461 7475 732e 0a0a 2020 2020 2020 2020  tatus...        
+0000c0f0: 5061 7261 6d65 7465 7273 3a0a 2020 2020  Parameters:.    
+0000c100: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+0000c110: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+0000c120: 636f 756e 743a 2069 6e74 0a20 2020 2020  count: int.     
+0000c130: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
+0000c140: 206a 6f62 7320 746f 2062 6520 7375 626d   jobs to be subm
+0000c150: 6974 7465 640a 2020 2020 2020 2020 2020  itted.          
+0000c160: 2020 6465 6661 756c 743a 2031 0a20 2020    default: 1.   
+0000c170: 2020 2020 2020 2020 206e 6567 6174 6976           negativ
+0000c180: 6520 7661 6c75 653a 2074 6f20 7375 626d  e value: to subm
+0000c190: 6974 2061 6c6c 206a 6f62 730a 2020 2020  it all jobs.    
+0000c1a0: 2020 2020 6466 5f6a 6f62 5f73 7065 6369      df_job_speci
+0000c1b0: 6669 6564 3a20 7064 2e44 6174 6146 7261  fied: pd.DataFra
+0000c1c0: 6d65 206f 7220 4e6f 6e65 0a20 2020 2020  me or None.     
+0000c1d0: 2020 2020 2020 206c 6973 7420 6f66 2073         list of s
+0000c1e0: 7065 6369 6669 6564 206a 6f62 2873 2920  pecified job(s) 
+0000c1f0: 746f 2073 7562 6d69 742e 0a20 2020 2020  to submit..     
+0000c200: 2020 2020 2020 2063 6f6c 756d 6e73 3a20         columns: 
+0000c210: 2773 7562 5f69 6427 2028 616e 6420 2773  'sub_id' (and 's
+0000c220: 6573 5f69 6427 2c20 6966 206d 756c 7469  es_id', if multi
+0000c230: 2d73 6573 290a 2020 2020 2020 2020 2020  -ses).          
+0000c240: 2020 4966 2060 2d2d 6a6f 6260 2077 6173    If `--job` was
+0000c250: 206e 6f74 2073 7065 6369 6669 6564 2069   not specified i
+0000c260: 6e20 6062 6162 732d 7375 626d 6974 602c  n `babs-submit`,
+0000c270: 2069 7420 7769 6c6c 2062 6520 4e6f 6e65   it will be None
+0000c280: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000c290: 2020 2020 2020 2063 6f75 6e74 5f72 6570         count_rep
+0000c2a0: 6f72 745f 7072 6f67 7265 7373 203d 2031  ort_progress = 1
+0000c2b0: 300a 2020 2020 2020 2020 2320 5e5e 2069  0.        # ^^ i
+0000c2c0: 6620 606a 5f63 6f75 6e74 6020 6973 2073  f `j_count` is s
+0000c2d0: 6576 6572 616c 2074 696d 6573 206f 6620  everal times of 
+0000c2e0: 6063 6f75 6e74 5f72 6570 6f72 745f 7072  `count_report_pr
+0000c2f0: 6f67 7265 7373 602c 2072 6570 6f72 7420  ogress`, report 
+0000c300: 7072 6f67 7265 7373 0a0a 2020 2020 2020  progress..      
+0000c310: 2020 2320 7570 6461 7465 2060 616e 616c    # update `anal
+0000c320: 7973 6973 5f64 6174 616c 6164 5f68 616e  ysis_datalad_han
+0000c330: 646c 6560 3a0a 2020 2020 2020 2020 6966  dle`:.        if
+0000c340: 2073 656c 662e 616e 616c 7973 6973 5f64   self.analysis_d
+0000c350: 6174 616c 6164 5f68 616e 646c 6520 6973  atalad_handle is
+0000c360: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000c370: 2020 2073 656c 662e 616e 616c 7973 6973     self.analysis
+0000c380: 5f64 6174 616c 6164 5f68 616e 646c 6520  _datalad_handle 
+0000c390: 3d20 646c 6170 692e 4461 7461 7365 7428  = dlapi.Dataset(
+0000c3a0: 7365 6c66 2e61 6e61 6c79 7369 735f 7061  self.analysis_pa
+0000c3b0: 7468 290a 0a20 2020 2020 2020 2023 2060  th)..        # `
+0000c3c0: 6372 6561 7465 5f6a 6f62 5f73 7461 7475  create_job_statu
+0000c3d0: 735f 6373 7628 7365 6c66 2960 2068 6173  s_csv(self)` has
+0000c3e0: 2062 6565 6e20 6361 6c6c 6564 2069 6e20   been called in 
+0000c3f0: 6062 6162 735f 7374 6174 7573 2829 600a  `babs_status()`.
+0000c400: 2020 2020 2020 2020 2320 2020 696e 2060          #   in `
+0000c410: 636c 692e 7079 600a 0a20 2020 2020 2020  cli.py`..       
+0000c420: 2023 204c 6f61 6420 7468 6520 6373 7620   # Load the csv 
+0000c430: 6669 6c65 0a20 2020 2020 2020 206c 6f63  file.        loc
+0000c440: 6b5f 7061 7468 203d 2073 656c 662e 6a6f  k_path = self.jo
+0000c450: 625f 7374 6174 7573 5f70 6174 685f 6162  b_status_path_ab
+0000c460: 7320 2b20 222e 6c6f 636b 220a 2020 2020  s + ".lock".    
+0000c470: 2020 2020 6c6f 636b 203d 2046 696c 654c      lock = FileL
+0000c480: 6f63 6b28 6c6f 636b 5f70 6174 6829 0a0a  ock(lock_path)..
+0000c490: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000c4a0: 2020 2020 2020 2020 2077 6974 6820 6c6f           with lo
+0000c4b0: 636b 2e61 6371 7569 7265 2874 696d 656f  ck.acquire(timeo
+0000c4c0: 7574 3d35 293a 2020 2320 6c6f 636b 2074  ut=5):  # lock t
+0000c4d0: 6865 2066 696c 652c 2069 2e65 2e2c 206c  he file, i.e., l
+0000c4e0: 6f63 6b20 6a6f 6220 7374 6174 7573 2064  ock job status d
+0000c4f0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+0000c500: 2020 6466 5f6a 6f62 203d 2072 6561 645f    df_job = read_
+0000c510: 6a6f 625f 7374 6174 7573 5f63 7376 2873  job_status_csv(s
+0000c520: 656c 662e 6a6f 625f 7374 6174 7573 5f70  elf.job_status_p
+0000c530: 6174 685f 6162 7329 0a20 2020 2020 2020  ath_abs).       
+0000c540: 2020 2020 2020 2020 2023 2067 6574 7469           # getti
+0000c550: 6e67 206c 6973 7420 6f66 206a 6f62 7320  ng list of jobs 
+0000c560: 696e 6469 6365 7320 746f 2073 7562 6d69  indices to submi
+0000c570: 7420 2862 6173 6564 2065 6974 6865 7220  t (based either 
+0000c580: 6f6e 2064 665f 6a6f 625f 7370 6563 6966  on df_job_specif
+0000c590: 6965 6420 6f72 2063 6f75 6e74 293a 0a20  ied or count):. 
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 206a                 j
+0000c5b0: 6f62 5f69 6e64 5f6c 6973 7420 3d20 7072  ob_ind_list = pr
+0000c5c0: 6570 6172 655f 6a6f 625f 696e 645f 6c69  epare_job_ind_li
+0000c5d0: 7374 2864 665f 6a6f 622c 2064 665f 6a6f  st(df_job, df_jo
+0000c5e0: 625f 7370 6563 6966 6965 642c 2063 6f75  b_specified, cou
+0000c5f0: 6e74 2c20 7365 6c66 2e74 7970 655f 7365  nt, self.type_se
+0000c600: 7373 696f 6e29 0a20 2020 2020 2020 2020  ssion).         
+0000c610: 2020 2020 2020 2064 665f 6a6f 625f 7570         df_job_up
+0000c620: 6461 7465 6420 3d20 6466 5f6a 6f62 2e63  dated = df_job.c
+0000c630: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
+0000c640: 2020 2020 2020 666f 7220 695f 7072 6f67        for i_prog
+0000c650: 7265 7373 2c20 695f 6a6f 6220 696e 2065  ress, i_job in e
+0000c660: 6e75 6d65 7261 7465 286a 6f62 5f69 6e64  numerate(job_ind
+0000c670: 5f6c 6973 7429 3a0a 2020 2020 2020 2020  _list):.        
+0000c680: 2020 2020 2020 2020 2020 2020 2320 5375              # Su
+0000c690: 626d 6974 2061 206a 6f62 3a0a 2020 2020  bmit a job:.    
+0000c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6b0: 6966 2073 656c 662e 7479 7065 5f73 6573  if self.type_ses
+0000c6c0: 7369 6f6e 203d 3d20 2273 696e 676c 652d  sion == "single-
+0000c6d0: 7365 7322 3a0a 2020 2020 2020 2020 2020  ses":.          
+0000c6e0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000c6f0: 6220 3d20 6466 5f6a 6f62 2e61 745b 695f  b = df_job.at[i_
+0000c700: 6a6f 622c 2022 7375 625f 6964 225d 0a20  job, "sub_id"]. 
+0000c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c720: 2020 2020 2020 2073 6573 203d 204e 6f6e         ses = Non
+0000c730: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000c740: 2020 2020 2020 656c 7365 3a20 2023 206d        else:  # m
+0000c750: 756c 7469 2d73 6573 0a20 2020 2020 2020  ulti-ses.       
+0000c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c770: 2073 7562 203d 2064 665f 6a6f 622e 6174   sub = df_job.at
+0000c780: 5b69 5f6a 6f62 2c20 2273 7562 5f69 6422  [i_job, "sub_id"
+0000c790: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000c7a0: 2020 2020 2020 2020 2020 7365 7320 3d20            ses = 
+0000c7b0: 6466 5f6a 6f62 2e61 745b 695f 6a6f 622c  df_job.at[i_job,
+0000c7c0: 2022 7365 735f 6964 225d 0a0a 2020 2020   "ses_id"]..    
 0000c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7e0: 2020 2020 2020 2020 7375 626d 6974 5f6f          submit_o
-0000c7f0: 6e65 5f6a 6f62 2873 656c 662e 616e 616c  ne_job(self.anal
-0000c800: 7973 6973 5f70 6174 682c 0a20 2020 2020  ysis_path,.     
-0000c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c830: 2020 7365 6c66 2e74 7970 655f 7365 7373    self.type_sess
-0000c840: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0000c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c870: 2e74 7970 655f 7379 7374 656d 2c0a 2020  .type_system,.  
+0000c7e0: 6a6f 625f 6964 2c20 5f2c 206c 6f67 5f66  job_id, _, log_f
+0000c7f0: 696c 656e 616d 6520 3d20 5c0a 2020 2020  ilename = \.    
+0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c810: 2020 2020 7375 626d 6974 5f6f 6e65 5f6a      submit_one_j
+0000c820: 6f62 2873 656c 662e 616e 616c 7973 6973  ob(self.analysis
+0000c830: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
+0000c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c850: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000c860: 6c66 2e74 7970 655f 7365 7373 696f 6e2c  lf.type_session,
+0000c870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8a0: 2020 2020 2073 7562 2c20 7365 7329 0a20       sub, ses). 
+0000c890: 2020 2020 2020 2020 7365 6c66 2e74 7970          self.typ
+0000c8a0: 655f 7379 7374 656d 2c0a 2020 2020 2020  e_system,.      
 0000c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8c0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-0000c8d0: 6420 3d20 6466 5f75 7064 6174 655f 6f6e  d = df_update_on
-0000c8e0: 655f 6a6f 6228 6466 5f6a 6f62 5f75 7064  e_job(df_job_upd
-0000c8f0: 6174 6564 2c20 695f 6a6f 622c 206a 6f62  ated, i_job, job
-0000c900: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-0000c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c930: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
-0000c940: 6669 6c65 6e61 6d65 2c20 7375 626d 6974  filename, submit
-0000c950: 7465 643d 5472 7565 290a 0a20 2020 2020  ted=True)..     
-0000c960: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c970: 2069 6620 6974 2773 2073 6576 6572 616c   if it's several
-0000c980: 2074 696d 6573 206f 6620 6063 6f75 6e74   times of `count
-0000c990: 5f72 6570 6f72 745f 7072 6f67 7265 7373  _report_progress
-0000c9a0: 603a 0a20 2020 2020 2020 2020 2020 2020  `:.             
-0000c9b0: 2020 2020 2020 2069 6620 2869 5f70 726f         if (i_pro
-0000c9c0: 6772 6573 7320 2b20 3129 2025 2063 6f75  gress + 1) % cou
-0000c9d0: 6e74 5f72 6570 6f72 745f 7072 6f67 7265  nt_report_progre
-0000c9e0: 7373 203d 3d20 303a 0a20 2020 2020 2020  ss == 0:.       
-0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca00: 2070 7269 6e74 2827 536f 2066 6172 2027   print('So far '
-0000ca10: 202b 2073 7472 2869 5f70 726f 6772 6573   + str(i_progres
-0000ca20: 7320 2b20 3129 202b 2027 206a 6f62 7320  s + 1) + ' jobs 
-0000ca30: 6861 7665 2062 6565 6e20 7375 626d 6974  have been submit
-0000ca40: 7465 642e 2729 0a0a 2020 2020 2020 2020  ted.')..        
-0000ca50: 2020 2020 2020 2020 6e75 6d5f 726f 7773          num_rows
-0000ca60: 5f74 6f5f 7072 696e 7420 3d20 360a 2020  _to_print = 6.  
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000ca80: 696e 7428 225c 6e46 6972 7374 2022 202b  int("\nFirst " +
-0000ca90: 2073 7472 286e 756d 5f72 6f77 735f 746f   str(num_rows_to
-0000caa0: 5f70 7269 6e74 290a 2020 2020 2020 2020  _print).        
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000cac0: 2220 726f 7773 206f 6620 2761 6e61 6c79  " rows of 'analy
-0000cad0: 7369 732f 636f 6465 2f6a 6f62 5f73 7461  sis/code/job_sta
-0000cae0: 7475 732e 6373 7627 3a22 290a 2020 2020  tus.csv':").    
-0000caf0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0000cb00: 2070 642e 6f70 7469 6f6e 5f63 6f6e 7465   pd.option_conte
-0000cb10: 7874 2827 6469 7370 6c61 792e 6d61 785f  xt('display.max_
-0000cb20: 726f 7773 272c 204e 6f6e 652c 0a20 2020  rows', None,.   
-0000cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb50: 2020 2020 2764 6973 706c 6179 2e6d 6178      'display.max
-0000cb60: 5f63 6f6c 756d 6e73 272c 204e 6f6e 652c  _columns', None,
-0000cb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb90: 2020 2020 2020 2020 2764 6973 706c 6179          'display
-0000cba0: 2e77 6964 7468 272c 2031 3230 293a 2020  .width', 120):  
-0000cbb0: 2023 2064 6566 6175 6c74 2069 7320 3830   # default is 80
-0000cbc0: 2063 6861 7261 6374 6572 732e 2e2e 0a20   characters.... 
-0000cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbe0: 2020 2023 205e 5e20 7072 696e 7420 616c     # ^^ print al
-0000cbf0: 6c20 7468 6520 636f 6c75 6d6e 7320 616e  l the columns an
-0000cc00: 6420 726f 7773 2028 7769 7468 2072 6574  d rows (with ret
-0000cc10: 7572 6e73 290a 2020 2020 2020 2020 2020  urns).          
-0000cc20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000cc30: 6466 5f6a 6f62 5f75 7064 6174 6564 2e68  df_job_updated.h
-0000cc40: 6561 6428 6e75 6d5f 726f 7773 5f74 6f5f  ead(num_rows_to_
-0000cc50: 7072 696e 7429 2920 2020 2320 6f6e 6c79  print))   # only
-0000cc60: 2066 6972 7374 2073 6576 6572 616c 2072   first several r
-0000cc70: 6f77 730a 0a20 2020 2020 2020 2020 2020  ows..           
-0000cc80: 2020 2020 2023 2073 6176 6520 7570 6461       # save upda
-0000cc90: 7465 6420 6466 3a0a 2020 2020 2020 2020  ted df:.        
-0000cca0: 2020 2020 2020 2020 6466 5f6a 6f62 5f75          df_job_u
-0000ccb0: 7064 6174 6564 2e74 6f5f 6373 7628 7365  pdated.to_csv(se
-0000ccc0: 6c66 2e6a 6f62 5f73 7461 7475 735f 7061  lf.job_status_pa
-0000ccd0: 7468 5f61 6273 2c20 696e 6465 783d 4661  th_abs, index=Fa
-0000cce0: 6c73 6529 0a0a 2020 2020 2020 2020 2020  lse)..          
-0000ccf0: 2020 2020 2020 2320 6865 7265 2c20 7468        # here, th
-0000cd00: 6520 6a6f 6220 7374 6174 7573 2077 6173  e job status was
-0000cd10: 206e 6f74 2063 6865 636b 6564 2c20 736f   not checked, so
-0000cd20: 206d 6573 7361 6765 2066 726f 6d20 6072   message from `r
-0000cd30: 6570 6f72 745f 6a6f 625f 7374 6174 7573  eport_job_status
-0000cd40: 2829 600a 2020 2020 2020 2020 2020 2020  ()`.            
-0000cd50: 2020 2020 2320 2020 6261 7365 6420 6f6e      #   based on
-0000cd60: 2063 7572 7265 6e74 2064 6620 6973 206e   current df is n
-0000cd70: 6f74 2074 7275 7374 6162 6c65 3a0a 2020  ot trustable:.  
-0000cd80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000cd90: 2320 5265 706f 7274 2074 6865 206a 6f62  # Report the job
-0000cda0: 2073 7461 7475 733a 0a20 2020 2020 2020   status:.       
-0000cdb0: 2020 2020 2020 2020 2023 2072 6570 6f72           # repor
-0000cdc0: 745f 6a6f 625f 7374 6174 7573 2864 665f  t_job_status(df_
-0000cdd0: 6a6f 625f 7570 6461 7465 6429 0a0a 2020  job_updated)..  
-0000cde0: 2020 2020 2020 6578 6365 7074 2054 696d        except Tim
-0000cdf0: 656f 7574 3a20 2020 2320 6166 7465 7220  eout:   # after 
-0000ce00: 7761 6974 696e 6720 666f 7220 7469 6d65  waiting for time
-0000ce10: 2064 6566 696e 6564 2069 6e20 6074 696d   defined in `tim
-0000ce20: 656f 7574 603a 0a20 2020 2020 2020 2020  eout`:.         
-0000ce30: 2020 2023 2069 6620 616e 6f74 6865 7220     # if another 
-0000ce40: 696e 7374 616e 6365 2061 6c73 6f20 7573  instance also us
-0000ce50: 6573 206c 6f63 6b73 2c20 616e 6420 6973  es locks, and is
-0000ce60: 2063 7572 7265 6e74 6c79 2072 756e 6e69   currently runni
-0000ce70: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0000ce80: 2320 2020 7468 6572 6520 7769 6c6c 2062  #   there will b
-0000ce90: 6520 6120 7469 6d65 6f75 7420 6572 726f  e a timeout erro
-0000cea0: 720a 2020 2020 2020 2020 2020 2020 7072  r.            pr
-0000ceb0: 696e 7428 2241 6e6f 7468 6572 2069 6e73  int("Another ins
-0000cec0: 7461 6e63 6520 6f66 2074 6869 7320 6170  tance of this ap
-0000ced0: 706c 6963 6174 696f 6e20 6375 7272 656e  plication curren
-0000cee0: 746c 7920 686f 6c64 7320 7468 6520 6c6f  tly holds the lo
-0000cef0: 636b 2e22 290a 0a20 2020 2064 6566 2062  ck.")..    def b
-0000cf00: 6162 735f 7374 6174 7573 2873 656c 662c  abs_status(self,
-0000cf10: 2066 6c61 6773 5f72 6573 7562 6d69 742c   flags_resubmit,
-0000cf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf30: 2020 2020 2064 665f 7265 7375 626d 6974       df_resubmit
-0000cf40: 5f6a 6f62 5f73 7065 6369 6669 633d 4e6f  _job_specific=No
-0000cf50: 6e65 2c20 7265 636b 6c65 7373 3d46 616c  ne, reckless=Fal
-0000cf60: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0000cf70: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-0000cf80: 725f 636f 6e66 6967 5f79 616d 6c5f 6669  r_config_yaml_fi
-0000cf90: 6c65 3d4e 6f6e 652c 0a20 2020 2020 2020  le=None,.       
-0000cfa0: 2020 2020 2020 2020 2020 2020 206a 6f62               job
-0000cfb0: 5f61 6363 6f75 6e74 3d46 616c 7365 293a  _account=False):
-0000cfc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000cfd0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-0000cfe0: 6f6e 2063 6865 636b 7320 6a6f 6220 7374  on checks job st
-0000cff0: 6174 7573 2061 6e64 2072 6573 7562 6d69  atus and resubmi
-0000d000: 7420 6a6f 6273 2069 6620 7265 7175 6573  t jobs if reques
-0000d010: 7465 642e 0a0a 2020 2020 2020 2020 5061  ted...        Pa
-0000d020: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
-0000d030: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a    -------------.
-0000d040: 2020 2020 2020 2020 666c 6167 735f 7265          flags_re
-0000d050: 7375 626d 6974 3a20 6c69 7374 0a20 2020  submit: list.   
-0000d060: 2020 2020 2020 2020 2055 6e64 6572 2077           Under w
-0000d070: 6861 7420 636f 6e64 6974 696f 6e20 746f  hat condition to
-0000d080: 2070 6572 666f 726d 206a 6f62 2072 6573   perform job res
-0000d090: 7562 6d69 742e 0a20 2020 2020 2020 2020  ubmit..         
-0000d0a0: 2020 2045 6c65 6d65 6e74 2063 686f 6963     Element choic
-0000d0b0: 6573 2061 7265 3a20 2766 6169 6c65 6427  es are: 'failed'
-0000d0c0: 2c20 2770 656e 6469 6e67 272e 0a20 2020  , 'pending'..   
-0000d0d0: 2020 2020 2020 2020 2043 4c49 2064 6f65           CLI doe
-0000d0e0: 7320 6e6f 7420 7375 7070 6f72 7420 2773  s not support 's
-0000d0f0: 7461 6c6c 6564 2720 7269 6768 7420 6e6f  talled' right no
-0000d100: 772c 2061 7320 6974 2773 206e 6f74 2074  w, as it's not t
-0000d110: 6573 7465 642e 0a20 2020 2020 2020 2064  ested..        d
-0000d120: 665f 7265 7375 626d 6974 5f6a 6f62 5f73  f_resubmit_job_s
-0000d130: 7065 6369 6669 633a 2070 642e 4461 7461  pecific: pd.Data
-0000d140: 4672 616d 6520 6f72 204e 6f6e 650a 2020  Frame or None.  
-0000d150: 2020 2020 2020 2020 2020 6c69 7374 206f            list o
-0000d160: 6620 7370 6563 6966 6965 6420 6a6f 6228  f specified job(
-0000d170: 7329 2074 6f20 7265 7375 626d 6974 2c20  s) to resubmit, 
-0000d180: 7265 7175 6573 7465 6420 6279 2060 2d2d  requested by `--
-0000d190: 7265 7375 626d 6974 2d6a 6f62 600a 2020  resubmit-job`.  
-0000d1a0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-0000d1b0: 733a 2027 7375 625f 6964 2720 2861 6e64  s: 'sub_id' (and
-0000d1c0: 2027 7365 735f 6964 272c 2069 6620 6d75   'ses_id', if mu
-0000d1d0: 6c74 692d 7365 7329 0a20 2020 2020 2020  lti-ses).       
-0000d1e0: 2020 2020 2069 6620 602d 2d72 6573 7562       if `--resub
-0000d1f0: 6d69 742d 6a6f 6260 2077 6173 206e 6f74  mit-job` was not
-0000d200: 2073 7065 6369 6669 6564 2069 6e20 6062   specified in `b
-0000d210: 6162 732d 7374 6174 7573 602c 2069 7420  abs-status`, it 
-0000d220: 7769 6c6c 2062 6520 4e6f 6e65 2e0a 2020  will be None..  
-0000d230: 2020 2020 2020 7265 636b 6c65 7373 3a20        reckless: 
-0000d240: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-0000d250: 2057 6865 7468 6572 2074 6f20 7265 7375   Whether to resu
-0000d260: 626d 6974 206a 6f62 7320 6c69 7374 6564  bmit jobs listed
-0000d270: 2069 6e20 6064 665f 7265 7375 626d 6974   in `df_resubmit
-0000d280: 5f6a 6f62 5f73 7065 6369 6669 6360 2c0a  _job_specific`,.
-0000d290: 2020 2020 2020 2020 2020 2020 6576 656e              even
-0000d2a0: 2074 6865 7927 7265 2064 6f6e 6520 6f72   they're done or
-0000d2b0: 2072 756e 6e69 6e67 2e0a 2020 2020 2020   running..      
-0000d2c0: 2020 2020 2020 5468 6973 2069 7320 7573        This is us
-0000d2d0: 6564 2077 6865 6e20 602d 2d72 6573 7562  ed when `--resub
-0000d2e0: 6d69 742d 6a6f 6260 2e0a 2020 2020 2020  mit-job`..      
-0000d2f0: 2020 2020 2020 4e4f 5445 3a20 6375 7272        NOTE: curr
-0000d300: 656e 746c 7920 7468 6973 2061 7267 756d  ently this argum
-0000d310: 656e 7420 6861 7320 6e6f 7420 6265 656e  ent has not been
-0000d320: 2074 6573 7465 643b 0a20 2020 2020 2020   tested;.       
-0000d330: 2020 2020 204e 4f54 453a 2060 2d2d 7265       NOTE: `--re
-0000d340: 636b 6c65 7373 6020 6861 7320 6265 656e  ckless` has been
-0000d350: 2072 656d 6f76 6564 2066 726f 6d20 6062   removed from `b
-0000d360: 6162 732d 7374 6174 7573 6020 434c 492e  abs-status` CLI.
-0000d370: 2041 6c77 6179 733a 2060 7265 636b 6c65   Always: `reckle
-0000d380: 7373 3d46 616c 7365 600a 2020 2020 2020  ss=False`.      
-0000d390: 2020 636f 6e74 6169 6e65 725f 636f 6e66    container_conf
-0000d3a0: 6967 5f79 616d 6c5f 6669 6c65 3a20 7374  ig_yaml_file: st
-0000d3b0: 7220 6f72 204e 6f6e 650a 2020 2020 2020  r or None.      
-0000d3c0: 2020 2020 2020 5061 7468 2074 6f20 6120        Path to a 
-0000d3d0: 5941 4d4c 2066 696c 6520 7468 6174 2063  YAML file that c
-0000d3e0: 6f6e 7461 696e 7320 7468 6520 636f 6e66  ontains the conf
-0000d3f0: 6967 7572 6174 696f 6e73 0a20 2020 2020  igurations.     
-0000d400: 2020 2020 2020 206f 6620 686f 7720 746f         of how to
-0000d410: 2072 756e 2074 6865 2042 4944 5320 4170   run the BIDS Ap
-0000d420: 7020 636f 6e74 6169 6e65 722e 0a20 2020  p container..   
-0000d430: 2020 2020 2020 2020 2049 7420 6d61 7920           It may 
-0000d440: 696e 636c 7564 6520 2761 6c65 7274 5f6c  include 'alert_l
-0000d450: 6f67 5f6d 6573 7361 6765 7327 2073 6563  og_messages' sec
-0000d460: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0000d470: 2074 6f20 6265 2075 7365 6420 6279 2062   to be used by b
-0000d480: 6162 732d 7374 6174 7573 2e0a 2020 2020  abs-status..    
-0000d490: 2020 2020 6a6f 625f 6163 636f 756e 743a      job_account:
-0000d4a0: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
-0000d4b0: 2020 5768 6574 6865 7220 746f 2061 6363    Whether to acc
-0000d4c0: 6f75 6e74 2066 6169 6c65 6420 6a6f 6273  ount failed jobs
-0000d4d0: 2028 652e 672e 2c20 7573 696e 6720 6071   (e.g., using `q
-0000d4e0: 6163 6374 6020 666f 7220 5347 4529 2c0a  acct` for SGE),.
-0000d4f0: 2020 2020 2020 2020 2020 2020 7768 6963              whic
-0000d500: 6820 6d61 7920 7461 6b65 2073 6f6d 6520  h may take some 
-0000d510: 7469 6d65 2e0a 2020 2020 2020 2020 2020  time..          
-0000d520: 2020 5468 6973 2073 7465 7020 7769 6c6c    This step will
-0000d530: 2062 6520 736b 6970 7065 6420 6966 2060   be skipped if `
-0000d540: 2d2d 7265 7375 626d 6974 2066 6169 6c65  --resubmit faile
-0000d550: 6460 2077 6173 2072 6571 7565 7374 6564  d` was requested
-0000d560: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000d570: 2020 2020 2020 2023 2060 6372 6561 7465         # `create
-0000d580: 5f6a 6f62 5f73 7461 7475 735f 6373 7628  _job_status_csv(
-0000d590: 7365 6c66 2960 2068 6173 2062 6565 6e20  self)` has been 
-0000d5a0: 6361 6c6c 6564 2069 6e20 6062 6162 735f  called in `babs_
-0000d5b0: 7374 6174 7573 2829 600a 2020 2020 2020  status()`.      
-0000d5c0: 2020 2320 2020 696e 2060 636c 692e 7079    #   in `cli.py
-0000d5d0: 600a 0a20 2020 2020 2020 2066 726f 6d20  `..        from 
-0000d5e0: 2e63 6f6e 7374 616e 7473 2069 6d70 6f72  .constants impor
-0000d5f0: 7420 4d53 475f 4e4f 5f41 4c45 5254 5f49  t MSG_NO_ALERT_I
-0000d600: 4e5f 4c4f 4753 0a0a 2020 2020 2020 2020  N_LOGS..        
-0000d610: 2320 4c6f 6164 2074 6865 2063 7376 2066  # Load the csv f
-0000d620: 696c 650a 2020 2020 2020 2020 6c6f 636b  ile.        lock
-0000d630: 5f70 6174 6820 3d20 7365 6c66 2e6a 6f62  _path = self.job
-0000d640: 5f73 7461 7475 735f 7061 7468 5f61 6273  _status_path_abs
-0000d650: 202b 2022 2e6c 6f63 6b22 0a20 2020 2020   + ".lock".     
-0000d660: 2020 206c 6f63 6b20 3d20 4669 6c65 4c6f     lock = FileLo
-0000d670: 636b 286c 6f63 6b5f 7061 7468 290a 0a20  ck(lock_path).. 
-0000d680: 2020 2020 2020 2023 2050 7265 7061 7265         # Prepare
-0000d690: 2066 6f72 2063 6865 636b 696e 6720 616c   for checking al
-0000d6a0: 6572 7420 6d65 7373 6167 6573 2069 6e20  ert messages in 
-0000d6b0: 6c6f 6720 6669 6c65 733a 0a20 2020 2020  log files:.     
-0000d6c0: 2020 2023 2020 2067 6574 2074 6865 2070     #   get the p
-0000d6d0: 7265 2d64 6566 696e 6564 2061 6c65 7274  re-defined alert
-0000d6e0: 206d 6573 7361 6765 733a 0a20 2020 2020   messages:.     
-0000d6f0: 2020 2063 6f6e 6669 675f 6d73 675f 616c     config_msg_al
-0000d700: 6572 7420 3d20 6765 745f 636f 6e66 6967  ert = get_config
-0000d710: 5f6d 7367 5f61 6c65 7274 2863 6f6e 7461  _msg_alert(conta
-0000d720: 696e 6572 5f63 6f6e 6669 675f 7961 6d6c  iner_config_yaml
-0000d730: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
-0000d740: 2320 4765 7420 7573 6572 6e61 6d65 2c20  # Get username, 
-0000d750: 6966 2060 2d2d 6a6f 622d 6163 636f 756e  if `--job-accoun
-0000d760: 7460 2069 7320 7265 7175 6573 7465 643a  t` is requested:
-0000d770: 0a20 2020 2020 2020 2075 7365 726e 616d  .        usernam
-0000d780: 655f 6c6f 7765 7263 6173 6520 3d20 6765  e_lowercase = ge
-0000d790: 745f 7573 6572 6e61 6d65 2829 0a0a 2020  t_username()..  
-0000d7a0: 2020 2020 2020 2320 4765 7420 7468 6520        # Get the 
-0000d7b0: 6c69 7374 206f 6620 6272 616e 6368 6573  list of branches
-0000d7c0: 2069 6e20 6f75 7470 7574 2052 4941 3a0a   in output RIA:.
-0000d7d0: 2020 2020 2020 2020 7072 6f63 5f67 6974          proc_git
-0000d7e0: 5f62 7261 6e63 685f 616c 6c20 3d20 7375  _branch_all = su
-0000d7f0: 6270 726f 6365 7373 2e72 756e 280a 2020  bprocess.run(.  
-0000d800: 2020 2020 2020 2020 2020 5b22 6769 7422            ["git"
-0000d810: 2c20 2262 7261 6e63 6822 2c20 222d 6122  , "branch", "-a"
-0000d820: 5d2c 0a20 2020 2020 2020 2020 2020 2063  ],.            c
-0000d830: 7764 3d73 656c 662e 6f75 7470 7574 5f72  wd=self.output_r
-0000d840: 6961 5f64 6174 615f 6469 722c 0a20 2020  ia_data_dir,.   
-0000d850: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
-0000d860: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
-0000d870: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d880: 2020 7072 6f63 5f67 6974 5f62 7261 6e63    proc_git_branc
-0000d890: 685f 616c 6c2e 6368 6563 6b5f 7265 7475  h_all.check_retu
-0000d8a0: 726e 636f 6465 2829 0a20 2020 2020 2020  rncode().       
-0000d8b0: 206d 7367 203d 2070 726f 635f 6769 745f   msg = proc_git_
-0000d8c0: 6272 616e 6368 5f61 6c6c 2e73 7464 6f75  branch_all.stdou
-0000d8d0: 742e 6465 636f 6465 2827 7574 662d 3827  t.decode('utf-8'
-0000d8e0: 290a 2020 2020 2020 2020 6c69 7374 5f62  ).        list_b
-0000d8f0: 7261 6e63 6865 7320 3d20 6d73 672e 7370  ranches = msg.sp
-0000d900: 6c69 7428 290a 0a20 2020 2020 2020 2074  lit()..        t
-0000d910: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000d920: 7769 7468 206c 6f63 6b2e 6163 7175 6972  with lock.acquir
-0000d930: 6528 7469 6d65 6f75 743d 3529 3a20 2023  e(timeout=5):  #
-0000d940: 206c 6f63 6b20 7468 6520 6669 6c65 2c20   lock the file, 
-0000d950: 692e 652e 2c20 6c6f 636b 206a 6f62 2073  i.e., lock job s
-0000d960: 7461 7475 7320 6466 0a20 2020 2020 2020  tatus df.       
-0000d970: 2020 2020 2020 2020 2064 665f 6a6f 6220           df_job 
-0000d980: 3d20 7265 6164 5f6a 6f62 5f73 7461 7475  = read_job_statu
-0000d990: 735f 6373 7628 7365 6c66 2e6a 6f62 5f73  s_csv(self.job_s
-0000d9a0: 7461 7475 735f 7061 7468 5f61 6273 290a  tatus_path_abs).
-0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9c0: 6466 5f6a 6f62 5f75 7064 6174 6564 203d  df_job_updated =
-0000d9d0: 2064 665f 6a6f 622e 636f 7079 2829 0a0a   df_job.copy()..
-0000d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d9f0: 2320 4765 7420 616c 6c20 6a6f 6273 2720  # Get all jobs' 
-0000da00: 7374 6174 7573 3a0a 2020 2020 2020 2020  status:.        
-0000da10: 2020 2020 2020 2020 6466 5f61 6c6c 5f6a          df_all_j
-0000da20: 6f62 5f73 7461 7475 7320 3d20 7265 7175  ob_status = requ
-0000da30: 6573 745f 616c 6c5f 6a6f 625f 7374 6174  est_all_job_stat
-0000da40: 7573 2873 656c 662e 7479 7065 5f73 7973  us(self.type_sys
-0000da50: 7465 6d29 0a0a 2020 2020 2020 2020 2020  tem)..          
-0000da60: 2020 2020 2020 2320 466f 7220 6a6f 6273        # For jobs
-0000da70: 2074 6861 7420 6861 7665 2062 6565 6e20   that have been 
-0000da80: 7375 626d 6974 7465 6420 6275 7420 6e6f  submitted but no
-0000da90: 7420 7375 6363 6573 7366 756c 2079 6574  t successful yet
-0000daa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dab0: 2020 2320 5570 6461 7465 206a 6f62 2073    # Update job s
-0000dac0: 7461 7475 732c 2061 6e64 2072 6573 7562  tatus, and resub
-0000dad0: 6d69 7420 6966 2072 6571 7565 7374 6564  mit if requested
-0000dae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000daf0: 2020 2320 6765 7420 7468 6520 6c69 7374    # get the list
-0000db00: 206f 6620 6a6f 6273 2073 7562 6d69 7474   of jobs submitt
-0000db10: 6564 2c20 6275 7420 6069 735f 646f 6e65  ed, but `is_done
-0000db20: 6020 6973 206e 6f74 2054 7275 653a 0a20  ` is not True:. 
-0000db30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000db40: 656d 7020 3d20 2864 665f 6a6f 625b 2768  emp = (df_job['h
-0000db50: 6173 5f73 7562 6d69 7474 6564 275d 2920  as_submitted']) 
-0000db60: 2620 287e 6466 5f6a 6f62 5b27 6973 5f64  & (~df_job['is_d
-0000db70: 6f6e 6527 5d29 0a20 2020 2020 2020 2020  one']).         
-0000db80: 2020 2020 2020 206c 6973 745f 696e 6465         list_inde
-0000db90: 785f 6a6f 625f 746f 6368 6563 6b20 3d20  x_job_tocheck = 
-0000dba0: 6466 5f6a 6f62 2e69 6e64 6578 5b74 656d  df_job.index[tem
-0000dbb0: 705d 2e74 6f6c 6973 7428 290a 2020 2020  p].tolist().    
-0000dbc0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000dbd0: 695f 6a6f 6220 696e 206c 6973 745f 696e  i_job in list_in
-0000dbe0: 6465 785f 6a6f 625f 746f 6368 6563 6b3a  dex_job_tocheck:
-0000dbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dc00: 2020 2020 2023 2047 6574 2062 6173 6963       # Get basic
-0000dc10: 2069 6e66 6f72 6d61 7469 6f6e 2066 6f72   information for
-0000dc20: 2074 6869 7320 6a6f 623a 0a20 2020 2020   this job:.     
-0000dc30: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-0000dc40: 6f62 5f69 6420 3d20 6466 5f6a 6f62 2e61  ob_id = df_job.a
-0000dc50: 745b 695f 6a6f 622c 2022 6a6f 625f 6964  t[i_job, "job_id
-0000dc60: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-0000dc70: 2020 2020 2020 206a 6f62 5f69 645f 7374         job_id_st
-0000dc80: 7220 3d20 7374 7228 6a6f 625f 6964 290a  r = str(job_id).
+0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8d0: 2073 7562 2c20 7365 7329 0a20 2020 2020   sub, ses).     
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000c8f0: 665f 6a6f 625f 7570 6461 7465 6420 3d20  f_job_updated = 
+0000c900: 6466 5f75 7064 6174 655f 6f6e 655f 6a6f  df_update_one_jo
+0000c910: 6228 6466 5f6a 6f62 5f75 7064 6174 6564  b(df_job_updated
+0000c920: 2c20 695f 6a6f 622c 206a 6f62 5f69 642c  , i_job, job_id,
+0000c930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c960: 2020 2020 2020 2020 6c6f 675f 6669 6c65          log_file
+0000c970: 6e61 6d65 2c20 7375 626d 6974 7465 643d  name, submitted=
+0000c980: 5472 7565 290a 0a20 2020 2020 2020 2020  True)..         
+0000c990: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
+0000c9a0: 6974 2773 2073 6576 6572 616c 2074 696d  it's several tim
+0000c9b0: 6573 206f 6620 6063 6f75 6e74 5f72 6570  es of `count_rep
+0000c9c0: 6f72 745f 7072 6f67 7265 7373 603a 0a20  ort_progress`:. 
+0000c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9e0: 2020 2069 6620 2869 5f70 726f 6772 6573     if (i_progres
+0000c9f0: 7320 2b20 3129 2025 2063 6f75 6e74 5f72  s + 1) % count_r
+0000ca00: 6570 6f72 745f 7072 6f67 7265 7373 203d  eport_progress =
+0000ca10: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0000ca20: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000ca30: 6e74 2827 536f 2066 6172 2027 202b 2073  nt('So far ' + s
+0000ca40: 7472 2869 5f70 726f 6772 6573 7320 2b20  tr(i_progress + 
+0000ca50: 3129 202b 2027 206a 6f62 7320 6861 7665  1) + ' jobs have
+0000ca60: 2062 6565 6e20 7375 626d 6974 7465 642e   been submitted.
+0000ca70: 2729 0a0a 2020 2020 2020 2020 2020 2020  ')..            
+0000ca80: 2020 2020 6e75 6d5f 726f 7773 5f74 6f5f      num_rows_to_
+0000ca90: 7072 696e 7420 3d20 360a 2020 2020 2020  print = 6.      
+0000caa0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000cab0: 225c 6e46 6972 7374 2022 202b 2073 7472  "\nFirst " + str
+0000cac0: 286e 756d 5f72 6f77 735f 746f 5f70 7269  (num_rows_to_pri
+0000cad0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+0000cae0: 2020 2020 2020 2020 2020 2b20 2220 726f            + " ro
+0000caf0: 7773 206f 6620 2761 6e61 6c79 7369 732f  ws of 'analysis/
+0000cb00: 636f 6465 2f6a 6f62 5f73 7461 7475 732e  code/job_status.
+0000cb10: 6373 7627 3a22 290a 2020 2020 2020 2020  csv':").        
+0000cb20: 2020 2020 2020 2020 7769 7468 2070 642e          with pd.
+0000cb30: 6f70 7469 6f6e 5f63 6f6e 7465 7874 2827  option_context('
+0000cb40: 6469 7370 6c61 792e 6d61 785f 726f 7773  display.max_rows
+0000cb50: 272c 204e 6f6e 652c 0a20 2020 2020 2020  ', None,.       
+0000cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb80: 2764 6973 706c 6179 2e6d 6178 5f63 6f6c  'display.max_col
+0000cb90: 756d 6e73 272c 204e 6f6e 652c 0a20 2020  umns', None,.   
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbc0: 2020 2020 2764 6973 706c 6179 2e77 6964      'display.wid
+0000cbd0: 7468 272c 2031 3230 293a 2020 2023 2064  th', 120):   # d
+0000cbe0: 6566 6175 6c74 2069 7320 3830 2063 6861  efault is 80 cha
+0000cbf0: 7261 6374 6572 732e 2e2e 0a20 2020 2020  racters....     
+0000cc00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000cc10: 205e 5e20 7072 696e 7420 616c 6c20 7468   ^^ print all th
+0000cc20: 6520 636f 6c75 6d6e 7320 616e 6420 726f  e columns and ro
+0000cc30: 7773 2028 7769 7468 2072 6574 7572 6e73  ws (with returns
+0000cc40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000cc50: 2020 2020 2020 7072 696e 7428 6466 5f6a        print(df_j
+0000cc60: 6f62 5f75 7064 6174 6564 2e68 6561 6428  ob_updated.head(
+0000cc70: 6e75 6d5f 726f 7773 5f74 6f5f 7072 696e  num_rows_to_prin
+0000cc80: 7429 2920 2020 2320 6f6e 6c79 2066 6972  t))   # only fir
+0000cc90: 7374 2073 6576 6572 616c 2072 6f77 730a  st several rows.
+0000cca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ccb0: 2023 2073 6176 6520 7570 6461 7465 6420   # save updated 
+0000ccc0: 6466 3a0a 2020 2020 2020 2020 2020 2020  df:.            
+0000ccd0: 2020 2020 6466 5f6a 6f62 5f75 7064 6174      df_job_updat
+0000cce0: 6564 2e74 6f5f 6373 7628 7365 6c66 2e6a  ed.to_csv(self.j
+0000ccf0: 6f62 5f73 7461 7475 735f 7061 7468 5f61  ob_status_path_a
+0000cd00: 6273 2c20 696e 6465 783d 4661 6c73 6529  bs, index=False)
+0000cd10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cd20: 2020 2320 6865 7265 2c20 7468 6520 6a6f    # here, the jo
+0000cd30: 6220 7374 6174 7573 2077 6173 206e 6f74  b status was not
+0000cd40: 2063 6865 636b 6564 2c20 736f 206d 6573   checked, so mes
+0000cd50: 7361 6765 2066 726f 6d20 6072 6570 6f72  sage from `repor
+0000cd60: 745f 6a6f 625f 7374 6174 7573 2829 600a  t_job_status()`.
+0000cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cd80: 2320 2020 6261 7365 6420 6f6e 2063 7572  #   based on cur
+0000cd90: 7265 6e74 2064 6620 6973 206e 6f74 2074  rent df is not t
+0000cda0: 7275 7374 6162 6c65 3a0a 2020 2020 2020  rustable:.      
+0000cdb0: 2020 2020 2020 2020 2020 2320 2320 5265            # # Re
+0000cdc0: 706f 7274 2074 6865 206a 6f62 2073 7461  port the job sta
+0000cdd0: 7475 733a 0a20 2020 2020 2020 2020 2020  tus:.           
+0000cde0: 2020 2020 2023 2072 6570 6f72 745f 6a6f       # report_jo
+0000cdf0: 625f 7374 6174 7573 2864 665f 6a6f 625f  b_status(df_job_
+0000ce00: 7570 6461 7465 6429 0a0a 2020 2020 2020  updated)..      
+0000ce10: 2020 6578 6365 7074 2054 696d 656f 7574    except Timeout
+0000ce20: 3a20 2020 2320 6166 7465 7220 7761 6974  :   # after wait
+0000ce30: 696e 6720 666f 7220 7469 6d65 2064 6566  ing for time def
+0000ce40: 696e 6564 2069 6e20 6074 696d 656f 7574  ined in `timeout
+0000ce50: 603a 0a20 2020 2020 2020 2020 2020 2023  `:.            #
+0000ce60: 2069 6620 616e 6f74 6865 7220 696e 7374   if another inst
+0000ce70: 616e 6365 2061 6c73 6f20 7573 6573 206c  ance also uses l
+0000ce80: 6f63 6b73 2c20 616e 6420 6973 2063 7572  ocks, and is cur
+0000ce90: 7265 6e74 6c79 2072 756e 6e69 6e67 2c0a  rently running,.
+0000cea0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0000ceb0: 7468 6572 6520 7769 6c6c 2062 6520 6120  there will be a 
+0000cec0: 7469 6d65 6f75 7420 6572 726f 720a 2020  timeout error.  
+0000ced0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000cee0: 2241 6e6f 7468 6572 2069 6e73 7461 6e63  "Another instanc
+0000cef0: 6520 6f66 2074 6869 7320 6170 706c 6963  e of this applic
+0000cf00: 6174 696f 6e20 6375 7272 656e 746c 7920  ation currently 
+0000cf10: 686f 6c64 7320 7468 6520 6c6f 636b 2e22  holds the lock."
+0000cf20: 290a 0a20 2020 2064 6566 2062 6162 735f  )..    def babs_
+0000cf30: 7374 6174 7573 2873 656c 662c 2066 6c61  status(self, fla
+0000cf40: 6773 5f72 6573 7562 6d69 742c 0a20 2020  gs_resubmit,.   
+0000cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf60: 2064 665f 7265 7375 626d 6974 5f6a 6f62   df_resubmit_job
+0000cf70: 5f73 7065 6369 6669 633d 4e6f 6e65 2c20  _specific=None, 
+0000cf80: 7265 636b 6c65 7373 3d46 616c 7365 2c0a  reckless=False,.
+0000cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfa0: 2020 2020 636f 6e74 6169 6e65 725f 636f      container_co
+0000cfb0: 6e66 6967 5f79 616d 6c5f 6669 6c65 3d4e  nfig_yaml_file=N
+0000cfc0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000cfd0: 2020 2020 2020 2020 206a 6f62 5f61 6363           job_acc
+0000cfe0: 6f75 6e74 3d46 616c 7365 293a 0a20 2020  ount=False):.   
+0000cff0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000d000: 2054 6869 7320 6675 6e63 7469 6f6e 2063   This function c
+0000d010: 6865 636b 7320 6a6f 6220 7374 6174 7573  hecks job status
+0000d020: 2061 6e64 2072 6573 7562 6d69 7420 6a6f   and resubmit jo
+0000d030: 6273 2069 6620 7265 7175 6573 7465 642e  bs if requested.
+0000d040: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+0000d050: 7465 7273 3a0a 2020 2020 2020 2020 2d2d  ters:.        --
+0000d060: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+0000d070: 2020 2020 666c 6167 735f 7265 7375 626d      flags_resubm
+0000d080: 6974 3a20 6c69 7374 0a20 2020 2020 2020  it: list.       
+0000d090: 2020 2020 2055 6e64 6572 2077 6861 7420       Under what 
+0000d0a0: 636f 6e64 6974 696f 6e20 746f 2070 6572  condition to per
+0000d0b0: 666f 726d 206a 6f62 2072 6573 7562 6d69  form job resubmi
+0000d0c0: 742e 0a20 2020 2020 2020 2020 2020 2045  t..            E
+0000d0d0: 6c65 6d65 6e74 2063 686f 6963 6573 2061  lement choices a
+0000d0e0: 7265 3a20 2766 6169 6c65 6427 2c20 2770  re: 'failed', 'p
+0000d0f0: 656e 6469 6e67 272e 0a20 2020 2020 2020  ending'..       
+0000d100: 2020 2020 2043 4c49 2064 6f65 7320 6e6f       CLI does no
+0000d110: 7420 7375 7070 6f72 7420 2773 7461 6c6c  t support 'stall
+0000d120: 6564 2720 7269 6768 7420 6e6f 772c 2061  ed' right now, a
+0000d130: 7320 6974 2773 206e 6f74 2074 6573 7465  s it's not teste
+0000d140: 642e 0a20 2020 2020 2020 2064 665f 7265  d..        df_re
+0000d150: 7375 626d 6974 5f6a 6f62 5f73 7065 6369  submit_job_speci
+0000d160: 6669 633a 2070 642e 4461 7461 4672 616d  fic: pd.DataFram
+0000d170: 6520 6f72 204e 6f6e 650a 2020 2020 2020  e or None.      
+0000d180: 2020 2020 2020 6c69 7374 206f 6620 7370        list of sp
+0000d190: 6563 6966 6965 6420 6a6f 6228 7329 2074  ecified job(s) t
+0000d1a0: 6f20 7265 7375 626d 6974 2c20 7265 7175  o resubmit, requ
+0000d1b0: 6573 7465 6420 6279 2060 2d2d 7265 7375  ested by `--resu
+0000d1c0: 626d 6974 2d6a 6f62 600a 2020 2020 2020  bmit-job`.      
+0000d1d0: 2020 2020 2020 636f 6c75 6d6e 733a 2027        columns: '
+0000d1e0: 7375 625f 6964 2720 2861 6e64 2027 7365  sub_id' (and 'se
+0000d1f0: 735f 6964 272c 2069 6620 6d75 6c74 692d  s_id', if multi-
+0000d200: 7365 7329 0a20 2020 2020 2020 2020 2020  ses).           
+0000d210: 2069 6620 602d 2d72 6573 7562 6d69 742d   if `--resubmit-
+0000d220: 6a6f 6260 2077 6173 206e 6f74 2073 7065  job` was not spe
+0000d230: 6369 6669 6564 2069 6e20 6062 6162 732d  cified in `babs-
+0000d240: 7374 6174 7573 602c 2069 7420 7769 6c6c  status`, it will
+0000d250: 2062 6520 4e6f 6e65 2e0a 2020 2020 2020   be None..      
+0000d260: 2020 7265 636b 6c65 7373 3a20 626f 6f6c    reckless: bool
+0000d270: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
+0000d280: 7468 6572 2074 6f20 7265 7375 626d 6974  ther to resubmit
+0000d290: 206a 6f62 7320 6c69 7374 6564 2069 6e20   jobs listed in 
+0000d2a0: 6064 665f 7265 7375 626d 6974 5f6a 6f62  `df_resubmit_job
+0000d2b0: 5f73 7065 6369 6669 6360 2c0a 2020 2020  _specific`,.    
+0000d2c0: 2020 2020 2020 2020 6576 656e 2074 6865          even the
+0000d2d0: 7927 7265 2064 6f6e 6520 6f72 2072 756e  y're done or run
+0000d2e0: 6e69 6e67 2e0a 2020 2020 2020 2020 2020  ning..          
+0000d2f0: 2020 5468 6973 2069 7320 7573 6564 2077    This is used w
+0000d300: 6865 6e20 602d 2d72 6573 7562 6d69 742d  hen `--resubmit-
+0000d310: 6a6f 6260 2e0a 2020 2020 2020 2020 2020  job`..          
+0000d320: 2020 4e4f 5445 3a20 6375 7272 656e 746c    NOTE: currentl
+0000d330: 7920 7468 6973 2061 7267 756d 656e 7420  y this argument 
+0000d340: 6861 7320 6e6f 7420 6265 656e 2074 6573  has not been tes
+0000d350: 7465 643b 0a20 2020 2020 2020 2020 2020  ted;.           
+0000d360: 204e 4f54 453a 2060 2d2d 7265 636b 6c65   NOTE: `--reckle
+0000d370: 7373 6020 6861 7320 6265 656e 2072 656d  ss` has been rem
+0000d380: 6f76 6564 2066 726f 6d20 6062 6162 732d  oved from `babs-
+0000d390: 7374 6174 7573 6020 434c 492e 2041 6c77  status` CLI. Alw
+0000d3a0: 6179 733a 2060 7265 636b 6c65 7373 3d46  ays: `reckless=F
+0000d3b0: 616c 7365 600a 2020 2020 2020 2020 636f  alse`.        co
+0000d3c0: 6e74 6169 6e65 725f 636f 6e66 6967 5f79  ntainer_config_y
+0000d3d0: 616d 6c5f 6669 6c65 3a20 7374 7220 6f72  aml_file: str or
+0000d3e0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000d3f0: 2020 5061 7468 2074 6f20 6120 5941 4d4c    Path to a YAML
+0000d400: 2066 696c 6520 7468 6174 2063 6f6e 7461   file that conta
+0000d410: 696e 7320 7468 6520 636f 6e66 6967 7572  ins the configur
+0000d420: 6174 696f 6e73 0a20 2020 2020 2020 2020  ations.         
+0000d430: 2020 206f 6620 686f 7720 746f 2072 756e     of how to run
+0000d440: 2074 6865 2042 4944 5320 4170 7020 636f   the BIDS App co
+0000d450: 6e74 6169 6e65 722e 0a20 2020 2020 2020  ntainer..       
+0000d460: 2020 2020 2049 7420 6d61 7920 696e 636c       It may incl
+0000d470: 7564 6520 2761 6c65 7274 5f6c 6f67 5f6d  ude 'alert_log_m
+0000d480: 6573 7361 6765 7327 2073 6563 7469 6f6e  essages' section
+0000d490: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0000d4a0: 6265 2075 7365 6420 6279 2062 6162 732d  be used by babs-
+0000d4b0: 7374 6174 7573 2e0a 2020 2020 2020 2020  status..        
+0000d4c0: 6a6f 625f 6163 636f 756e 743a 2062 6f6f  job_account: boo
+0000d4d0: 6c0a 2020 2020 2020 2020 2020 2020 5768  l.            Wh
+0000d4e0: 6574 6865 7220 746f 2061 6363 6f75 6e74  ether to account
+0000d4f0: 2066 6169 6c65 6420 6a6f 6273 2028 652e   failed jobs (e.
+0000d500: 672e 2c20 7573 696e 6720 6071 6163 6374  g., using `qacct
+0000d510: 6020 666f 7220 5347 4529 2c0a 2020 2020  ` for SGE),.    
+0000d520: 2020 2020 2020 2020 7768 6963 6820 6d61          which ma
+0000d530: 7920 7461 6b65 2073 6f6d 6520 7469 6d65  y take some time
+0000d540: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+0000d550: 6973 2073 7465 7020 7769 6c6c 2062 6520  is step will be 
+0000d560: 736b 6970 7065 6420 6966 2060 2d2d 7265  skipped if `--re
+0000d570: 7375 626d 6974 2066 6169 6c65 6460 2077  submit failed` w
+0000d580: 6173 2072 6571 7565 7374 6564 2e0a 2020  as requested..  
+0000d590: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000d5a0: 2020 2023 2060 6372 6561 7465 5f6a 6f62     # `create_job
+0000d5b0: 5f73 7461 7475 735f 6373 7628 7365 6c66  _status_csv(self
+0000d5c0: 2960 2068 6173 2062 6565 6e20 6361 6c6c  )` has been call
+0000d5d0: 6564 2069 6e20 6062 6162 735f 7374 6174  ed in `babs_stat
+0000d5e0: 7573 2829 600a 2020 2020 2020 2020 2320  us()`.        # 
+0000d5f0: 2020 696e 2060 636c 692e 7079 600a 0a20    in `cli.py`.. 
+0000d600: 2020 2020 2020 2066 726f 6d20 2e63 6f6e         from .con
+0000d610: 7374 616e 7473 2069 6d70 6f72 7420 4d53  stants import MS
+0000d620: 475f 4e4f 5f41 4c45 5254 5f49 4e5f 4c4f  G_NO_ALERT_IN_LO
+0000d630: 4753 0a0a 2020 2020 2020 2020 2320 4c6f  GS..        # Lo
+0000d640: 6164 2074 6865 2063 7376 2066 696c 650a  ad the csv file.
+0000d650: 2020 2020 2020 2020 6c6f 636b 5f70 6174          lock_pat
+0000d660: 6820 3d20 7365 6c66 2e6a 6f62 5f73 7461  h = self.job_sta
+0000d670: 7475 735f 7061 7468 5f61 6273 202b 2022  tus_path_abs + "
+0000d680: 2e6c 6f63 6b22 0a20 2020 2020 2020 206c  .lock".        l
+0000d690: 6f63 6b20 3d20 4669 6c65 4c6f 636b 286c  ock = FileLock(l
+0000d6a0: 6f63 6b5f 7061 7468 290a 0a20 2020 2020  ock_path)..     
+0000d6b0: 2020 2023 2050 7265 7061 7265 2066 6f72     # Prepare for
+0000d6c0: 2063 6865 636b 696e 6720 616c 6572 7420   checking alert 
+0000d6d0: 6d65 7373 6167 6573 2069 6e20 6c6f 6720  messages in log 
+0000d6e0: 6669 6c65 733a 0a20 2020 2020 2020 2023  files:.        #
+0000d6f0: 2020 2067 6574 2074 6865 2070 7265 2d64     get the pre-d
+0000d700: 6566 696e 6564 2061 6c65 7274 206d 6573  efined alert mes
+0000d710: 7361 6765 733a 0a20 2020 2020 2020 2063  sages:.        c
+0000d720: 6f6e 6669 675f 6d73 675f 616c 6572 7420  onfig_msg_alert 
+0000d730: 3d20 6765 745f 636f 6e66 6967 5f6d 7367  = get_config_msg
+0000d740: 5f61 6c65 7274 2863 6f6e 7461 696e 6572  _alert(container
+0000d750: 5f63 6f6e 6669 675f 7961 6d6c 5f66 696c  _config_yaml_fil
+0000d760: 6529 0a0a 2020 2020 2020 2020 2320 4765  e)..        # Ge
+0000d770: 7420 7573 6572 6e61 6d65 2c20 6966 2060  t username, if `
+0000d780: 2d2d 6a6f 622d 6163 636f 756e 7460 2069  --job-account` i
+0000d790: 7320 7265 7175 6573 7465 643a 0a20 2020  s requested:.   
+0000d7a0: 2020 2020 2075 7365 726e 616d 655f 6c6f       username_lo
+0000d7b0: 7765 7263 6173 6520 3d20 6765 745f 7573  wercase = get_us
+0000d7c0: 6572 6e61 6d65 2829 0a0a 2020 2020 2020  ername()..      
+0000d7d0: 2020 2320 4765 7420 7468 6520 6c69 7374    # Get the list
+0000d7e0: 206f 6620 6272 616e 6368 6573 2069 6e20   of branches in 
+0000d7f0: 6f75 7470 7574 2052 4941 3a0a 2020 2020  output RIA:.    
+0000d800: 2020 2020 7072 6f63 5f67 6974 5f62 7261      proc_git_bra
+0000d810: 6e63 685f 616c 6c20 3d20 7375 6270 726f  nch_all = subpro
+0000d820: 6365 7373 2e72 756e 280a 2020 2020 2020  cess.run(.      
+0000d830: 2020 2020 2020 5b22 6769 7422 2c20 2262        ["git", "b
+0000d840: 7261 6e63 6822 2c20 222d 6122 5d2c 0a20  ranch", "-a"],. 
+0000d850: 2020 2020 2020 2020 2020 2063 7764 3d73             cwd=s
+0000d860: 656c 662e 6f75 7470 7574 5f72 6961 5f64  elf.output_ria_d
+0000d870: 6174 615f 6469 722c 0a20 2020 2020 2020  ata_dir,.       
+0000d880: 2020 2020 2073 7464 6f75 743d 7375 6270       stdout=subp
+0000d890: 726f 6365 7373 2e50 4950 450a 2020 2020  rocess.PIPE.    
+0000d8a0: 2020 2020 290a 2020 2020 2020 2020 7072      ).        pr
+0000d8b0: 6f63 5f67 6974 5f62 7261 6e63 685f 616c  oc_git_branch_al
+0000d8c0: 6c2e 6368 6563 6b5f 7265 7475 726e 636f  l.check_returnco
+0000d8d0: 6465 2829 0a20 2020 2020 2020 206d 7367  de().        msg
+0000d8e0: 203d 2070 726f 635f 6769 745f 6272 616e   = proc_git_bran
+0000d8f0: 6368 5f61 6c6c 2e73 7464 6f75 742e 6465  ch_all.stdout.de
+0000d900: 636f 6465 2827 7574 662d 3827 290a 2020  code('utf-8').  
+0000d910: 2020 2020 2020 6c69 7374 5f62 7261 6e63        list_branc
+0000d920: 6865 7320 3d20 6d73 672e 7370 6c69 7428  hes = msg.split(
+0000d930: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+0000d940: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0000d950: 206c 6f63 6b2e 6163 7175 6972 6528 7469   lock.acquire(ti
+0000d960: 6d65 6f75 743d 3529 3a20 2023 206c 6f63  meout=5):  # loc
+0000d970: 6b20 7468 6520 6669 6c65 2c20 692e 652e  k the file, i.e.
+0000d980: 2c20 6c6f 636b 206a 6f62 2073 7461 7475  , lock job statu
+0000d990: 7320 6466 0a20 2020 2020 2020 2020 2020  s df.           
+0000d9a0: 2020 2020 2064 665f 6a6f 6220 3d20 7265       df_job = re
+0000d9b0: 6164 5f6a 6f62 5f73 7461 7475 735f 6373  ad_job_status_cs
+0000d9c0: 7628 7365 6c66 2e6a 6f62 5f73 7461 7475  v(self.job_statu
+0000d9d0: 735f 7061 7468 5f61 6273 290a 2020 2020  s_path_abs).    
+0000d9e0: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
+0000d9f0: 6f62 5f75 7064 6174 6564 203d 2064 665f  ob_updated = df_
+0000da00: 6a6f 622e 636f 7079 2829 0a0a 2020 2020  job.copy()..    
+0000da10: 2020 2020 2020 2020 2020 2020 2320 4765              # Ge
+0000da20: 7420 616c 6c20 6a6f 6273 2720 7374 6174  t all jobs' stat
+0000da30: 7573 3a0a 2020 2020 2020 2020 2020 2020  us:.            
+0000da40: 2020 2020 6466 5f61 6c6c 5f6a 6f62 5f73      df_all_job_s
+0000da50: 7461 7475 7320 3d20 7265 7175 6573 745f  tatus = request_
+0000da60: 616c 6c5f 6a6f 625f 7374 6174 7573 2873  all_job_status(s
+0000da70: 656c 662e 7479 7065 5f73 7973 7465 6d29  elf.type_system)
+0000da80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000da90: 2020 2320 466f 7220 6a6f 6273 2074 6861    # For jobs tha
+0000daa0: 7420 6861 7665 2062 6565 6e20 7375 626d  t have been subm
+0000dab0: 6974 7465 6420 6275 7420 6e6f 7420 7375  itted but not su
+0000dac0: 6363 6573 7366 756c 2079 6574 3a0a 2020  ccessful yet:.  
+0000dad0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000dae0: 5570 6461 7465 206a 6f62 2073 7461 7475  Update job statu
+0000daf0: 732c 2061 6e64 2072 6573 7562 6d69 7420  s, and resubmit 
+0000db00: 6966 2072 6571 7565 7374 6564 3a0a 2020  if requested:.  
+0000db10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000db20: 6765 7420 7468 6520 6c69 7374 206f 6620  get the list of 
+0000db30: 6a6f 6273 2073 7562 6d69 7474 6564 2c20  jobs submitted, 
+0000db40: 6275 7420 6069 735f 646f 6e65 6020 6973  but `is_done` is
+0000db50: 206e 6f74 2054 7275 653a 0a20 2020 2020   not True:.     
+0000db60: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
+0000db70: 3d20 2864 665f 6a6f 625b 2768 6173 5f73  = (df_job['has_s
+0000db80: 7562 6d69 7474 6564 275d 2920 2620 287e  ubmitted']) & (~
+0000db90: 6466 5f6a 6f62 5b27 6973 5f64 6f6e 6527  df_job['is_done'
+0000dba0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0000dbb0: 2020 206c 6973 745f 696e 6465 785f 6a6f     list_index_jo
+0000dbc0: 625f 746f 6368 6563 6b20 3d20 6466 5f6a  b_tocheck = df_j
+0000dbd0: 6f62 2e69 6e64 6578 5b74 656d 705d 2e74  ob.index[temp].t
+0000dbe0: 6f6c 6973 7428 290a 2020 2020 2020 2020  olist().        
+0000dbf0: 2020 2020 2020 2020 666f 7220 695f 6a6f          for i_jo
+0000dc00: 6220 696e 206c 6973 745f 696e 6465 785f  b in list_index_
+0000dc10: 6a6f 625f 746f 6368 6563 6b3a 0a20 2020  job_tocheck:.   
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 2023 2047 6574 2062 6173 6963 2069 6e66   # Get basic inf
+0000dc40: 6f72 6d61 7469 6f6e 2066 6f72 2074 6869  ormation for thi
+0000dc50: 7320 6a6f 623a 0a20 2020 2020 2020 2020  s job:.         
+0000dc60: 2020 2020 2020 2020 2020 206a 6f62 5f69             job_i
+0000dc70: 6420 3d20 6466 5f6a 6f62 2e61 745b 695f  d = df_job.at[i_
+0000dc80: 6a6f 622c 2022 6a6f 625f 6964 225d 0a20  job, "job_id"]. 
 0000dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dca0: 2020 2020 6c6f 675f 6669 6c65 6e61 6d65      log_filename
-0000dcb0: 203d 2064 665f 6a6f 622e 6174 5b69 5f6a   = df_job.at[i_j
-0000dcc0: 6f62 2c20 226c 6f67 5f66 696c 656e 616d  ob, "log_filenam
-0000dcd0: 6522 5d20 2023 2077 6974 6820 222a 220a  e"]  # with "*".
-0000dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dcf0: 2020 2020 6c6f 675f 666e 203d 206f 702e      log_fn = op.
-0000dd00: 6a6f 696e 2873 656c 662e 616e 616c 7973  join(self.analys
-0000dd10: 6973 5f70 6174 682c 2022 6c6f 6773 222c  is_path, "logs",
-0000dd20: 206c 6f67 5f66 696c 656e 616d 6529 2020   log_filename)  
-0000dd30: 2320 6162 7320 7061 7468 0a20 2020 2020  # abs path.     
-0000dd40: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000dd50: 5f66 6e20 3d20 6c6f 675f 666e 2e72 6570  _fn = log_fn.rep
-0000dd60: 6c61 6365 2822 2e2a 222c 2022 2e6f 2229  lace(".*", ".o")
-0000dd70: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000dd80: 2020 2020 2020 2320 6469 645f 7265 7375        # did_resu
-0000dd90: 626d 6974 203d 2046 616c 7365 2020 2023  bmit = False   #
-0000dda0: 2072 6573 6574 3a20 6469 6420 6e6f 7420   reset: did not 
-0000ddb0: 7265 7375 626d 6974 2074 6869 7320 6a6f  resubmit this jo
-0000ddc0: 620a 0a20 2020 2020 2020 2020 2020 2020  b..             
-0000ddd0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0000dde0: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
-0000ddf0: 7369 6e67 6c65 2d73 6573 223a 0a20 2020  single-ses":.   
-0000de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de10: 2020 2020 2073 7562 203d 2064 665f 6a6f       sub = df_jo
-0000de20: 622e 6174 5b69 5f6a 6f62 2c20 2273 7562  b.at[i_job, "sub
-0000de30: 5f69 6422 5d0a 2020 2020 2020 2020 2020  _id"].          
-0000de40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000de50: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
-0000de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de70: 2062 7261 6e63 686e 616d 6520 3d20 226a   branchname = "j
-0000de80: 6f62 2d22 202b 206a 6f62 5f69 645f 7374  ob-" + job_id_st
-0000de90: 7220 2b20 222d 2220 2b20 7375 620a 2020  r + "-" + sub.  
-0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000deb0: 2020 2020 2020 2320 652e 672e 2c20 6a6f        # e.g., jo
-0000dec0: 622d 3030 3030 302d 7375 622d 3031 0a20  b-00000-sub-01. 
+0000dca0: 2020 206a 6f62 5f69 645f 7374 7220 3d20     job_id_str = 
+0000dcb0: 7374 7228 6a6f 625f 6964 290a 2020 2020  str(job_id).    
+0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcd0: 6c6f 675f 6669 6c65 6e61 6d65 203d 2064  log_filename = d
+0000dce0: 665f 6a6f 622e 6174 5b69 5f6a 6f62 2c20  f_job.at[i_job, 
+0000dcf0: 226c 6f67 5f66 696c 656e 616d 6522 5d20  "log_filename"] 
+0000dd00: 2023 2077 6974 6820 222a 220a 2020 2020   # with "*".    
+0000dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd20: 6c6f 675f 666e 203d 206f 702e 6a6f 696e  log_fn = op.join
+0000dd30: 2873 656c 662e 616e 616c 7973 6973 5f70  (self.analysis_p
+0000dd40: 6174 682c 2022 6c6f 6773 222c 206c 6f67  ath, "logs", log
+0000dd50: 5f66 696c 656e 616d 6529 2020 2320 6162  _filename)  # ab
+0000dd60: 7320 7061 7468 0a20 2020 2020 2020 2020  s path.         
+0000dd70: 2020 2020 2020 2020 2020 206f 5f66 6e20             o_fn 
+0000dd80: 3d20 6c6f 675f 666e 2e72 6570 6c61 6365  = log_fn.replace
+0000dd90: 2822 2e2a 222c 2022 2e6f 2229 0a0a 2020  (".*", ".o")..  
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 2020 2320 6469 645f 7265 7375 626d 6974    # did_resubmit
+0000ddc0: 203d 2046 616c 7365 2020 2023 2072 6573   = False   # res
+0000ddd0: 6574 3a20 6469 6420 6e6f 7420 7265 7375  et: did not resu
+0000dde0: 626d 6974 2074 6869 7320 6a6f 620a 0a20  bmit this job.. 
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de00: 2020 2069 6620 7365 6c66 2e74 7970 655f     if self.type_
+0000de10: 7365 7373 696f 6e20 3d3d 2022 7369 6e67  session == "sing
+0000de20: 6c65 2d73 6573 223a 0a20 2020 2020 2020  le-ses":.       
+0000de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de40: 2073 7562 203d 2064 665f 6a6f 622e 6174   sub = df_job.at
+0000de50: 5b69 5f6a 6f62 2c20 2273 7562 5f69 6422  [i_job, "sub_id"
+0000de60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000de70: 2020 2020 2020 2020 2020 7365 7320 3d20            ses = 
+0000de80: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0000de90: 2020 2020 2020 2020 2020 2020 2062 7261               bra
+0000dea0: 6e63 686e 616d 6520 3d20 226a 6f62 2d22  nchname = "job-"
+0000deb0: 202b 206a 6f62 5f69 645f 7374 7220 2b20   + job_id_str + 
+0000dec0: 222d 2220 2b20 7375 620a 2020 2020 2020  "-" + sub.      
 0000ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dee0: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-0000def0: 655f 7365 7373 696f 6e20 3d3d 2022 6d75  e_session == "mu
-0000df00: 6c74 692d 7365 7322 3a0a 2020 2020 2020  lti-ses":.      
-0000df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df20: 2020 7375 6220 3d20 6466 5f6a 6f62 2e61    sub = df_job.a
-0000df30: 745b 695f 6a6f 622c 2022 7375 625f 6964  t[i_job, "sub_id
-0000df40: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-0000df50: 2020 2020 2020 2020 2020 2073 6573 203d             ses =
-0000df60: 2064 665f 6a6f 622e 6174 5b69 5f6a 6f62   df_job.at[i_job
-0000df70: 2c20 2273 6573 5f69 6422 5d0a 2020 2020  , "ses_id"].    
-0000df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000df90: 2020 2020 6272 616e 6368 6e61 6d65 203d      branchname =
-0000dfa0: 2022 6a6f 622d 2220 2b20 6a6f 625f 6964   "job-" + job_id
-0000dfb0: 5f73 7472 202b 2022 2d22 202b 2073 7562  _str + "-" + sub
-0000dfc0: 202b 2022 2d22 202b 2073 6573 0a20 2020   + "-" + ses.   
-0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfe0: 2020 2020 2023 2065 2e67 2e2c 206a 6f62       # e.g., job
-0000dff0: 2d30 3030 3030 2d73 7562 2d30 312d 7365  -00000-sub-01-se
-0000e000: 732d 420a 0a20 2020 2020 2020 2020 2020  s-B..           
-0000e010: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-0000e020: 2069 6620 7265 7375 626d 6973 7369 6f6e   if resubmission
-0000e030: 206f 6620 7468 6973 206a 6f62 2069 7320   of this job is 
-0000e040: 7265 7175 6573 7465 643a 0a20 2020 2020  requested:.     
-0000e050: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e060: 665f 7265 7175 6573 745f 7265 7375 626d  f_request_resubm
-0000e070: 6974 5f74 6869 735f 6a6f 6220 3d20 4661  it_this_job = Fa
-0000e080: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-0000e090: 2020 2020 2020 2020 6966 2064 665f 7265          if df_re
-0000e0a0: 7375 626d 6974 5f6a 6f62 5f73 7065 6369  submit_job_speci
-0000e0b0: 6669 6320 6973 206e 6f74 204e 6f6e 653a  fic is not None:
-0000e0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e0d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000e0e0: 2e74 7970 655f 7365 7373 696f 6e20 3d3d  .type_session ==
-0000e0f0: 2022 7369 6e67 6c65 2d73 6573 223a 0a20   "single-ses":. 
-0000e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e110: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
-0000e120: 3d20 6466 5f72 6573 7562 6d69 745f 6a6f  = df_resubmit_jo
-0000e130: 625f 7370 6563 6966 6963 5b27 7375 625f  b_specific['sub_
-0000e140: 6964 275d 203d 3d20 7375 620a 2020 2020  id'] == sub.    
-0000e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e160: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
-0000e170: 7065 5f73 6573 7369 6f6e 203d 3d20 226d  pe_session == "m
-0000e180: 756c 7469 2d73 6573 223a 0a20 2020 2020  ulti-ses":.     
-0000e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1a0: 2020 2020 2020 2074 656d 7020 3d20 2864         temp = (d
-0000e1b0: 665f 7265 7375 626d 6974 5f6a 6f62 5f73  f_resubmit_job_s
-0000e1c0: 7065 6369 6669 635b 2773 7562 5f69 6427  pecific['sub_id'
-0000e1d0: 5d20 3d3d 2073 7562 2920 2620 5c0a 2020  ] == sub) & \.  
-0000e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2864                (d
-0000e200: 665f 7265 7375 626d 6974 5f6a 6f62 5f73  f_resubmit_job_s
-0000e210: 7065 6369 6669 635b 2773 6573 5f69 6427  pecific['ses_id'
-0000e220: 5d20 3d3d 2073 6573 290a 0a20 2020 2020  ] == ses)..     
-0000e230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e240: 2020 2069 6620 616e 7928 7465 6d70 293a     if any(temp):
-0000e250: 2020 2023 2061 6e79 206d 6174 6368 6564     # any matched
-0000e260: 3b20 6074 656d 7060 2069 7320 7064 2e53  ; `temp` is pd.S
-0000e270: 6572 6965 7320 6f66 2054 7275 6520 6f72  eries of True or
-0000e280: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0000e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2a0: 2020 2069 665f 7265 7175 6573 745f 7265     if_request_re
-0000e2b0: 7375 626d 6974 5f74 6869 735f 6a6f 6220  submit_this_job 
-0000e2c0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2e0: 2020 2023 2070 7269 6e74 2822 6465 6275     # print("debu
-0000e2f0: 6767 696e 6720 7075 7270 6f73 653a 2072  gging purpose: r
-0000e300: 6571 7565 7374 2074 6f20 7265 7375 626d  equest to resubm
-0000e310: 6974 206a 6f62 3a20 2220 2b20 7375 6220  it job: " + sub 
-0000e320: 2b20 222c 2022 202b 2073 6573 290a 2020  + ", " + ses).  
-0000e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e340: 2020 2020 2020 2020 2020 2320 5e5e 206f            # ^^ o
-0000e350: 6e6c 7920 666f 7220 6d75 6c74 692d 7365  nly for multi-se
-0000e360: 7321 0a0a 2020 2020 2020 2020 2020 2020  s!..            
-0000e370: 2020 2020 2020 2020 2320 5570 6461 7465          # Update
-0000e380: 2074 6865 2022 6c61 7374 5f6c 696e 655f   the "last_line_
-0000e390: 7374 646f 7574 5f66 696c 6522 3a0a 2020  stdout_file":.  
-0000e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3b0: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
-0000e3c0: 2e61 745b 695f 6a6f 622c 2022 6c61 7374  .at[i_job, "last
-0000e3d0: 5f6c 696e 655f 7374 646f 7574 5f66 696c  _line_stdout_fil
-0000e3e0: 6522 5d20 3d20 5c0a 2020 2020 2020 2020  e"] = \.        
-0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e400: 6765 745f 6c61 7374 5f6c 696e 6528 6f5f  get_last_line(o_
-0000e410: 666e 290a 0a20 2020 2020 2020 2020 2020  fn)..           
-0000e420: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
-0000e430: 2069 6620 616e 7920 616c 6572 7420 6d65   if any alert me
-0000e440: 7373 6167 6520 696e 206c 6f67 2066 696c  ssage in log fil
-0000e450: 6573 2066 6f72 2074 6869 7320 6a6f 623a  es for this job:
-0000e460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e470: 2020 2020 2023 204e 4f54 453a 2069 6e20       # NOTE: in 
-0000e480: 7468 656f 7279 2063 616e 2073 6b69 7020  theory can skip 
-0000e490: 6661 696c 6564 206a 6f62 7320 696e 2070  failed jobs in p
-0000e4a0: 7265 7669 6f75 7320 726f 756e 642c 0a20  revious round,. 
-0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4c0: 2020 2023 2020 2020 2020 2062 7574 206d     #       but m
-0000e4d0: 616b 696e 6720 6173 7369 676e 696e 6720  aking assigning 
-0000e4e0: 7661 7269 6162 6c65 7320 6861 7264 3b20  variables hard; 
-0000e4f0: 736f 206e 6f74 2074 6f20 736b 6970 0a20  so not to skip. 
-0000e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e510: 2020 2023 2020 2020 2020 2069 6620 6466     #       if df
-0000e520: 5f6a 6f62 2e61 745b 695f 6a6f 622c 2022  _job.at[i_job, "
-0000e530: 6973 5f66 6169 6c65 6422 5d20 6973 206e  is_failed"] is n
-0000e540: 6f74 2054 7275 653a 2020 2020 2320 6e70  ot True:    # np
-0000e550: 2e6e 616e 206f 7220 4661 6c73 650a 2020  .nan or False.  
-0000e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e570: 2020 616c 6572 745f 6d65 7373 6167 655f    alert_message_
-0000e580: 696e 5f6c 6f67 5f66 696c 6573 2c20 6966  in_log_files, if
-0000e590: 5f6e 6f5f 616c 6572 745f 696e 5f6c 6f67  _no_alert_in_log
-0000e5a0: 2c20 6966 5f66 6f75 6e64 5f6c 6f67 5f66  , if_found_log_f
-0000e5b0: 696c 6573 203d 205c 0a20 2020 2020 2020  iles = \.       
-0000e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5d0: 2067 6574 5f61 6c65 7274 5f6d 6573 7361   get_alert_messa
-0000e5e0: 6765 5f69 6e5f 6c6f 675f 6669 6c65 7328  ge_in_log_files(
-0000e5f0: 636f 6e66 6967 5f6d 7367 5f61 6c65 7274  config_msg_alert
-0000e600: 2c20 6c6f 675f 666e 290a 2020 2020 2020  , log_fn).      
-0000e610: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000e620: 5e5e 2074 6865 2066 756e 6374 696f 6e20  ^^ the function 
-0000e630: 7769 6c6c 2068 616e 646c 6520 6576 656e  will handle even
-0000e640: 2069 6620 6063 6f6e 6669 675f 6d73 675f   if `config_msg_
-0000e650: 616c 6572 743d 4e6f 6e65 600a 2020 2020  alert=None`.    
-0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e670: 6466 5f6a 6f62 5f75 7064 6174 6564 2e61  df_job_updated.a
-0000e680: 745b 695f 6a6f 622c 2022 616c 6572 745f  t[i_job, "alert_
-0000e690: 6d65 7373 6167 6522 5d20 3d20 5c0a 2020  message"] = \.  
-0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 2020 616c 6572 745f 6d65 7373        alert_mess
-0000e6c0: 6167 655f 696e 5f6c 6f67 5f66 696c 6573  age_in_log_files
-0000e6d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e6e0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0000e6f0: 2074 6865 7265 2069 7320 6120 6272 616e   there is a bran
-0000e700: 6368 2069 6e20 6f75 7470 7574 2052 4941  ch in output RIA
-0000e710: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e720: 2020 2020 2020 2320 2020 6368 6563 6b20        #   check 
-0000e730: 6966 2062 7261 6e63 6820 6e61 6d65 206f  if branch name o
-0000e740: 6620 6375 7272 656e 7420 6a6f 6220 6973  f current job is
-0000e750: 2069 6e20 7468 6520 6c69 7374 206f 6620   in the list of 
-0000e760: 616c 6c20 6272 616e 6368 6573 3a0a 2020  all branches:.  
-0000e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e780: 2020 6966 2062 7261 6e63 686e 616d 6520    if branchname 
-0000e790: 696e 206c 6973 745f 6272 616e 6368 6573  in list_branches
-0000e7a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e7b0: 2020 2020 2020 2020 2020 2320 666f 756e            # foun
-0000e7c0: 6420 7468 6520 6272 616e 6368 3a0a 2020  d the branch:.  
+0000dee0: 2020 2320 652e 672e 2c20 6a6f 622d 3030    # e.g., job-00
+0000def0: 3030 302d 7375 622d 3031 0a20 2020 2020  000-sub-01.     
+0000df00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000df10: 6c69 6620 7365 6c66 2e74 7970 655f 7365  lif self.type_se
+0000df20: 7373 696f 6e20 3d3d 2022 6d75 6c74 692d  ssion == "multi-
+0000df30: 7365 7322 3a0a 2020 2020 2020 2020 2020  ses":.          
+0000df40: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000df50: 6220 3d20 6466 5f6a 6f62 2e61 745b 695f  b = df_job.at[i_
+0000df60: 6a6f 622c 2022 7375 625f 6964 225d 0a20  job, "sub_id"]. 
+0000df70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df80: 2020 2020 2020 2073 6573 203d 2064 665f         ses = df_
+0000df90: 6a6f 622e 6174 5b69 5f6a 6f62 2c20 2273  job.at[i_job, "s
+0000dfa0: 6573 5f69 6422 5d0a 2020 2020 2020 2020  es_id"].        
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 6272 616e 6368 6e61 6d65 203d 2022 6a6f  branchname = "jo
+0000dfd0: 622d 2220 2b20 6a6f 625f 6964 5f73 7472  b-" + job_id_str
+0000dfe0: 202b 2022 2d22 202b 2073 7562 202b 2022   + "-" + sub + "
+0000dff0: 2d22 202b 2073 6573 0a20 2020 2020 2020  -" + ses.       
+0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e010: 2023 2065 2e67 2e2c 206a 6f62 2d30 3030   # e.g., job-000
+0000e020: 3030 2d73 7562 2d30 312d 7365 732d 420a  00-sub-01-ses-B.
+0000e030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e040: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+0000e050: 7265 7375 626d 6973 7369 6f6e 206f 6620  resubmission of 
+0000e060: 7468 6973 206a 6f62 2069 7320 7265 7175  this job is requ
+0000e070: 6573 7465 643a 0a20 2020 2020 2020 2020  ested:.         
+0000e080: 2020 2020 2020 2020 2020 2069 665f 7265             if_re
+0000e090: 7175 6573 745f 7265 7375 626d 6974 5f74  quest_resubmit_t
+0000e0a0: 6869 735f 6a6f 6220 3d20 4661 6c73 650a  his_job = False.
+0000e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0c0: 2020 2020 6966 2064 665f 7265 7375 626d      if df_resubm
+0000e0d0: 6974 5f6a 6f62 5f73 7065 6369 6669 6320  it_job_specific 
+0000e0e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e100: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+0000e110: 655f 7365 7373 696f 6e20 3d3d 2022 7369  e_session == "si
+0000e120: 6e67 6c65 2d73 6573 223a 0a20 2020 2020  ngle-ses":.     
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e140: 2020 2020 2020 2074 656d 7020 3d20 6466         temp = df
+0000e150: 5f72 6573 7562 6d69 745f 6a6f 625f 7370  _resubmit_job_sp
+0000e160: 6563 6966 6963 5b27 7375 625f 6964 275d  ecific['sub_id']
+0000e170: 203d 3d20 7375 620a 2020 2020 2020 2020   == sub.        
+0000e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e190: 656c 6966 2073 656c 662e 7479 7065 5f73  elif self.type_s
+0000e1a0: 6573 7369 6f6e 203d 3d20 226d 756c 7469  ession == "multi
+0000e1b0: 2d73 6573 223a 0a20 2020 2020 2020 2020  -ses":.         
+0000e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1d0: 2020 2074 656d 7020 3d20 2864 665f 7265     temp = (df_re
+0000e1e0: 7375 626d 6974 5f6a 6f62 5f73 7065 6369  submit_job_speci
+0000e1f0: 6669 635b 2773 7562 5f69 6427 5d20 3d3d  fic['sub_id'] ==
+0000e200: 2073 7562 2920 2620 5c0a 2020 2020 2020   sub) & \.      
+0000e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e220: 2020 2020 2020 2020 2020 2864 665f 7265            (df_re
+0000e230: 7375 626d 6974 5f6a 6f62 5f73 7065 6369  submit_job_speci
+0000e240: 6669 635b 2773 6573 5f69 6427 5d20 3d3d  fic['ses_id'] ==
+0000e250: 2073 6573 290a 0a20 2020 2020 2020 2020   ses)..         
+0000e260: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e270: 6620 616e 7928 7465 6d70 293a 2020 2023  f any(temp):   #
+0000e280: 2061 6e79 206d 6174 6368 6564 3b20 6074   any matched; `t
+0000e290: 656d 7060 2069 7320 7064 2e53 6572 6965  emp` is pd.Serie
+0000e2a0: 7320 6f66 2054 7275 6520 6f72 2046 616c  s of True or Fal
+0000e2b0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e2d0: 665f 7265 7175 6573 745f 7265 7375 626d  f_request_resubm
+0000e2e0: 6974 5f74 6869 735f 6a6f 6220 3d20 5472  it_this_job = Tr
+0000e2f0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000e300: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000e310: 2070 7269 6e74 2822 6465 6275 6767 696e   print("debuggin
+0000e320: 6720 7075 7270 6f73 653a 2072 6571 7565  g purpose: reque
+0000e330: 7374 2074 6f20 7265 7375 626d 6974 206a  st to resubmit j
+0000e340: 6f62 3a20 2220 2b20 7375 6220 2b20 222c  ob: " + sub + ",
+0000e350: 2022 202b 2073 6573 290a 2020 2020 2020   " + ses).      
+0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e370: 2020 2020 2020 2320 5e5e 206f 6e6c 7920        # ^^ only 
+0000e380: 666f 7220 6d75 6c74 692d 7365 7321 0a0a  for multi-ses!..
+0000e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3a0: 2020 2020 2320 5570 6461 7465 2074 6865      # Update the
+0000e3b0: 2022 6c61 7374 5f6c 696e 655f 7374 646f   "last_line_stdo
+0000e3c0: 7574 5f66 696c 6522 3a0a 2020 2020 2020  ut_file":.      
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 6466                df
+0000e3e0: 5f6a 6f62 5f75 7064 6174 6564 2e61 745b  _job_updated.at[
+0000e3f0: 695f 6a6f 622c 2022 6c61 7374 5f6c 696e  i_job, "last_lin
+0000e400: 655f 7374 646f 7574 5f66 696c 6522 5d20  e_stdout_file"] 
+0000e410: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+0000e420: 2020 2020 2020 2020 2020 2020 6765 745f              get_
+0000e430: 6c61 7374 5f6c 696e 6528 6f5f 666e 290a  last_line(o_fn).
+0000e440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e450: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
+0000e460: 616e 7920 616c 6572 7420 6d65 7373 6167  any alert messag
+0000e470: 6520 696e 206c 6f67 2066 696c 6573 2066  e in log files f
+0000e480: 6f72 2074 6869 7320 6a6f 623a 0a20 2020  or this job:.   
+0000e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4a0: 2023 204e 4f54 453a 2069 6e20 7468 656f   # NOTE: in theo
+0000e4b0: 7279 2063 616e 2073 6b69 7020 6661 696c  ry can skip fail
+0000e4c0: 6564 206a 6f62 7320 696e 2070 7265 7669  ed jobs in previ
+0000e4d0: 6f75 7320 726f 756e 642c 0a20 2020 2020  ous round,.     
+0000e4e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000e4f0: 2020 2020 2020 2062 7574 206d 616b 696e         but makin
+0000e500: 6720 6173 7369 676e 696e 6720 7661 7269  g assigning vari
+0000e510: 6162 6c65 7320 6861 7264 3b20 736f 206e  ables hard; so n
+0000e520: 6f74 2074 6f20 736b 6970 0a20 2020 2020  ot to skip.     
+0000e530: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000e540: 2020 2020 2020 2069 6620 6466 5f6a 6f62         if df_job
+0000e550: 2e61 745b 695f 6a6f 622c 2022 6973 5f66  .at[i_job, "is_f
+0000e560: 6169 6c65 6422 5d20 6973 206e 6f74 2054  ailed"] is not T
+0000e570: 7275 653a 2020 2020 2320 6e70 2e6e 616e  rue:    # np.nan
+0000e580: 206f 7220 4661 6c73 650a 2020 2020 2020   or False.      
+0000e590: 2020 2020 2020 2020 2020 2020 2020 616c                al
+0000e5a0: 6572 745f 6d65 7373 6167 655f 696e 5f6c  ert_message_in_l
+0000e5b0: 6f67 5f66 696c 6573 2c20 6966 5f6e 6f5f  og_files, if_no_
+0000e5c0: 616c 6572 745f 696e 5f6c 6f67 2c20 6966  alert_in_log, if
+0000e5d0: 5f66 6f75 6e64 5f6c 6f67 5f66 696c 6573  _found_log_files
+0000e5e0: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+0000e5f0: 2020 2020 2020 2020 2020 2020 2067 6574               get
+0000e600: 5f61 6c65 7274 5f6d 6573 7361 6765 5f69  _alert_message_i
+0000e610: 6e5f 6c6f 675f 6669 6c65 7328 636f 6e66  n_log_files(conf
+0000e620: 6967 5f6d 7367 5f61 6c65 7274 2c20 6c6f  ig_msg_alert, lo
+0000e630: 675f 666e 290a 2020 2020 2020 2020 2020  g_fn).          
+0000e640: 2020 2020 2020 2020 2020 2320 5e5e 2074            # ^^ t
+0000e650: 6865 2066 756e 6374 696f 6e20 7769 6c6c  he function will
+0000e660: 2068 616e 646c 6520 6576 656e 2069 6620   handle even if 
+0000e670: 6063 6f6e 6669 675f 6d73 675f 616c 6572  `config_msg_aler
+0000e680: 743d 4e6f 6e65 600a 2020 2020 2020 2020  t=None`.        
+0000e690: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
+0000e6a0: 6f62 5f75 7064 6174 6564 2e61 745b 695f  ob_updated.at[i_
+0000e6b0: 6a6f 622c 2022 616c 6572 745f 6d65 7373  job, "alert_mess
+0000e6c0: 6167 6522 5d20 3d20 5c0a 2020 2020 2020  age"] = \.      
+0000e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6e0: 2020 616c 6572 745f 6d65 7373 6167 655f    alert_message_
+0000e6f0: 696e 5f6c 6f67 5f66 696c 6573 0a0a 2020  in_log_files..  
+0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e710: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
+0000e720: 7265 2069 7320 6120 6272 616e 6368 2069  re is a branch i
+0000e730: 6e20 6f75 7470 7574 2052 4941 3a0a 2020  n output RIA:.  
+0000e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e750: 2020 2320 2020 6368 6563 6b20 6966 2062    #   check if b
+0000e760: 7261 6e63 6820 6e61 6d65 206f 6620 6375  ranch name of cu
+0000e770: 7272 656e 7420 6a6f 6220 6973 2069 6e20  rrent job is in 
+0000e780: 7468 6520 6c69 7374 206f 6620 616c 6c20  the list of all 
+0000e790: 6272 616e 6368 6573 3a0a 2020 2020 2020  branches:.      
+0000e7a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e7b0: 2062 7261 6e63 686e 616d 6520 696e 206c   branchname in l
+0000e7c0: 6973 745f 6272 616e 6368 6573 3a0a 2020  ist_branches:.  
 0000e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7e0: 2020 2020 2020 6466 5f6a 6f62 5f75 7064        df_job_upd
-0000e7f0: 6174 6564 2e61 745b 695f 6a6f 622c 2022  ated.at[i_job, "
-0000e800: 6973 5f64 6f6e 6522 5d20 3d20 5472 7565  is_done"] = True
-0000e810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e820: 2020 2020 2020 2020 2023 2072 6573 6574           # reset
-0000e830: 2f75 7064 6174 653a 0a20 2020 2020 2020  /update:.       
+0000e7e0: 2020 2020 2020 2320 666f 756e 6420 7468        # found th
+0000e7f0: 6520 6272 616e 6368 3a0a 2020 2020 2020  e branch:.      
+0000e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e810: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+0000e820: 2e61 745b 695f 6a6f 622c 2022 6973 5f64  .at[i_job, "is_d
+0000e830: 6f6e 6522 5d20 3d20 5472 7565 0a20 2020  one"] = True.   
 0000e840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e850: 2064 665f 6a6f 625f 7570 6461 7465 642e   df_job_updated.
-0000e860: 6174 5b69 5f6a 6f62 2c20 226a 6f62 5f73  at[i_job, "job_s
-0000e870: 7461 7465 5f63 6174 6567 6f72 7922 5d20  tate_category"] 
-0000e880: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
-0000e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8a0: 2064 665f 6a6f 625f 7570 6461 7465 642e   df_job_updated.
-0000e8b0: 6174 5b69 5f6a 6f62 2c20 226a 6f62 5f73  at[i_job, "job_s
-0000e8c0: 7461 7465 5f63 6f64 6522 5d20 3d20 6e70  tate_code"] = np
-0000e8d0: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
-0000e8e0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0000e8f0: 6a6f 625f 7570 6461 7465 642e 6174 5b69  job_updated.at[i
-0000e900: 5f6a 6f62 2c20 2264 7572 6174 696f 6e22  _job, "duration"
-0000e910: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2020  ] = np.nan.     
-0000e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e930: 2020 2023 2020 2052 4f41 444d 4150 3a20     #   ROADMAP: 
-0000e940: 5e5e 2067 6574 2064 7572 6174 696f 6e20  ^^ get duration 
-0000e950: 7669 6120 6071 6163 6374 600a 2020 2020  via `qacct`.    
-0000e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e970: 2020 2020 2320 2020 2020 2020 2874 686f      #       (tho
-0000e980: 7567 6820 7161 6363 7420 6d61 7920 6e6f  ugh qacct may no
-0000e990: 7420 6265 2061 6363 7572 6174 6529 0a20  t be accurate). 
-0000e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9b0: 2020 2020 2020 2064 665f 6a6f 625f 7570         df_job_up
-0000e9c0: 6461 7465 642e 6174 5b69 5f6a 6f62 2c20  dated.at[i_job, 
-0000e9d0: 2269 735f 6661 696c 6564 225d 203d 2046  "is_failed"] = F
-0000e9e0: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
-0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000ea00: 6368 6563 6b20 6966 2065 6368 6f65 6420  check if echoed 
-0000ea10: 2253 5543 4345 5353 223a 0a20 2020 2020  "SUCCESS":.     
-0000ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea30: 2020 2023 2054 4f44 4f20 5e5e 0a0a 2020     # TODO ^^..  
-0000ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea50: 2020 656c 7365 3a20 2020 2320 6469 6420    else:   # did 
-0000ea60: 6e6f 7420 6669 6e64 2074 6865 2062 7261  not find the bra
-0000ea70: 6e63 680a 2020 2020 2020 2020 2020 2020  nch.            
-0000ea80: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0000ea90: 6563 6b20 7468 6520 6a6f 6220 7374 6174  eck the job stat
-0000eaa0: 7573 3a0a 2020 2020 2020 2020 2020 2020  us:.            
-0000eab0: 2020 2020 2020 2020 2020 2020 6966 206a              if j
-0000eac0: 6f62 5f69 645f 7374 7220 696e 2064 665f  ob_id_str in df_
-0000ead0: 616c 6c5f 6a6f 625f 7374 6174 7573 2e69  all_job_status.i
-0000eae0: 6e64 6578 2e74 6f5f 6c69 7374 2829 3a0a  ndex.to_list():.
-0000eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb00: 2020 2020 2020 2020 2020 2020 2320 5e5e              # ^^
-0000eb10: 2069 6620 6064 6660 2069 7320 656d 7074   if `df` is empt
-0000eb20: 792c 2060 2e69 6e64 6578 2e74 6f5f 6c69  y, `.index.to_li
-0000eb30: 7374 2829 6020 7769 6c6c 2072 6574 7572  st()` will retur
-0000eb40: 6e20 5b5d 0a20 2020 2020 2020 2020 2020  n [].           
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb60: 2073 7461 7465 5f63 6174 6567 6f72 7920   state_category 
-0000eb70: 3d20 6466 5f61 6c6c 5f6a 6f62 5f73 7461  = df_all_job_sta
-0000eb80: 7475 732e 6174 5b6a 6f62 5f69 645f 7374  tus.at[job_id_st
-0000eb90: 722c 2027 4073 7461 7465 275d 0a20 2020  r, '@state'].   
-0000eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebb0: 2020 2020 2020 2020 2073 7461 7465 5f63           state_c
-0000ebc0: 6f64 6520 3d20 6466 5f61 6c6c 5f6a 6f62  ode = df_all_job
-0000ebd0: 5f73 7461 7475 732e 6174 5b6a 6f62 5f69  _status.at[job_i
-0000ebe0: 645f 7374 722c 2027 7374 6174 6527 5d0a  d_str, 'state'].
-0000ebf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec00: 2020 2020 2020 2020 2020 2020 2320 5e5e              # ^^
-0000ec10: 2063 6f6c 756d 6e20 6040 7374 6174 6560   column `@state`
-0000ec20: 3a20 2772 756e 6e69 6e67 2720 6f72 2027  : 'running' or '
-0000ec30: 7065 6e64 696e 6727 0a0a 2020 2020 2020  pending'..      
-0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec50: 2020 2020 2020 6966 2073 7461 7465 5f63        if state_c
-0000ec60: 6f64 6520 3d3d 2022 7222 3a0a 2020 2020  ode == "r":.    
+0000e850: 2020 2020 2023 2072 6573 6574 2f75 7064       # reset/upd
+0000e860: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
+0000e870: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0000e880: 6a6f 625f 7570 6461 7465 642e 6174 5b69  job_updated.at[i
+0000e890: 5f6a 6f62 2c20 226a 6f62 5f73 7461 7465  _job, "job_state
+0000e8a0: 5f63 6174 6567 6f72 7922 5d20 3d20 6e70  _category"] = np
+0000e8b0: 2e6e 616e 0a20 2020 2020 2020 2020 2020  .nan.           
+0000e8c0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+0000e8d0: 6a6f 625f 7570 6461 7465 642e 6174 5b69  job_updated.at[i
+0000e8e0: 5f6a 6f62 2c20 226a 6f62 5f73 7461 7465  _job, "job_state
+0000e8f0: 5f63 6f64 6522 5d20 3d20 6e70 2e6e 616e  _code"] = np.nan
+0000e900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e910: 2020 2020 2020 2020 2064 665f 6a6f 625f           df_job_
+0000e920: 7570 6461 7465 642e 6174 5b69 5f6a 6f62  updated.at[i_job
+0000e930: 2c20 2264 7572 6174 696f 6e22 5d20 3d20  , "duration"] = 
+0000e940: 6e70 2e6e 616e 0a20 2020 2020 2020 2020  np.nan.         
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000e960: 2020 2052 4f41 444d 4150 3a20 5e5e 2067     ROADMAP: ^^ g
+0000e970: 6574 2064 7572 6174 696f 6e20 7669 6120  et duration via 
+0000e980: 6071 6163 6374 600a 2020 2020 2020 2020  `qacct`.        
+0000e990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9a0: 2320 2020 2020 2020 2874 686f 7567 6820  #       (though 
+0000e9b0: 7161 6363 7420 6d61 7920 6e6f 7420 6265  qacct may not be
+0000e9c0: 2061 6363 7572 6174 6529 0a20 2020 2020   accurate).     
+0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9e0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
+0000e9f0: 642e 6174 5b69 5f6a 6f62 2c20 2269 735f  d.at[i_job, "is_
+0000ea00: 6661 696c 6564 225d 203d 2046 616c 7365  failed"] = False
+0000ea10: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ea20: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
+0000ea30: 6b20 6966 2065 6368 6f65 6420 2253 5543  k if echoed "SUC
+0000ea40: 4345 5353 223a 0a20 2020 2020 2020 2020  CESS":.         
+0000ea50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000ea60: 2054 4f44 4f20 5e5e 0a0a 2020 2020 2020   TODO ^^..      
+0000ea70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000ea80: 7365 3a20 2020 2320 6469 6420 6e6f 7420  se:   # did not 
+0000ea90: 6669 6e64 2074 6865 2062 7261 6e63 680a  find the branch.
+0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eab0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000eac0: 7468 6520 6a6f 6220 7374 6174 7573 3a0a  the job status:.
+0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eae0: 2020 2020 2020 2020 6966 206a 6f62 5f69          if job_i
+0000eaf0: 645f 7374 7220 696e 2064 665f 616c 6c5f  d_str in df_all_
+0000eb00: 6a6f 625f 7374 6174 7573 2e69 6e64 6578  job_status.index
+0000eb10: 2e74 6f5f 6c69 7374 2829 3a0a 2020 2020  .to_list():.    
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb30: 2020 2020 2020 2020 2320 5e5e 2069 6620          # ^^ if 
+0000eb40: 6064 6660 2069 7320 656d 7074 792c 2060  `df` is empty, `
+0000eb50: 2e69 6e64 6578 2e74 6f5f 6c69 7374 2829  .index.to_list()
+0000eb60: 6020 7769 6c6c 2072 6574 7572 6e20 5b5d  ` will return []
+0000eb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eb80: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0000eb90: 7465 5f63 6174 6567 6f72 7920 3d20 6466  te_category = df
+0000eba0: 5f61 6c6c 5f6a 6f62 5f73 7461 7475 732e  _all_job_status.
+0000ebb0: 6174 5b6a 6f62 5f69 645f 7374 722c 2027  at[job_id_str, '
+0000ebc0: 4073 7461 7465 275d 0a20 2020 2020 2020  @state'].       
+0000ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebe0: 2020 2020 2073 7461 7465 5f63 6f64 6520       state_code 
+0000ebf0: 3d20 6466 5f61 6c6c 5f6a 6f62 5f73 7461  = df_all_job_sta
+0000ec00: 7475 732e 6174 5b6a 6f62 5f69 645f 7374  tus.at[job_id_st
+0000ec10: 722c 2027 7374 6174 6527 5d0a 2020 2020  r, 'state'].    
+0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec30: 2020 2020 2020 2020 2320 5e5e 2063 6f6c          # ^^ col
+0000ec40: 756d 6e20 6040 7374 6174 6560 3a20 2772  umn `@state`: 'r
+0000ec50: 756e 6e69 6e67 2720 6f72 2027 7065 6e64  unning' or 'pend
+0000ec60: 696e 6727 0a0a 2020 2020 2020 2020 2020  ing'..          
 0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec80: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-0000ec90: 6563 6b20 6966 2072 6573 7562 6d69 7420  eck if resubmit 
-0000eca0: 6973 2072 6571 7565 7374 6564 3a0a 2020  is requested:.  
-0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000ecd0: 2069 665f 7265 7175 6573 745f 7265 7375   if_request_resu
-0000ece0: 626d 6974 5f74 6869 735f 6a6f 6220 2620  bmit_this_job & 
-0000ecf0: 286e 6f74 2072 6563 6b6c 6573 7329 3a0a  (not reckless):.
-0000ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 2020 2020 2320 7265 7175 6573 7465 6420      # requested 
-0000ed30: 7265 7375 626d 6974 2c20 6275 7420 7769  resubmit, but wi
-0000ed40: 7468 6f75 7420 6072 6563 6b6c 6573 7360  thout `reckless`
-0000ed50: 3a20 7072 696e 7420 6d73 670a 2020 2020  : print msg.    
-0000ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed80: 746f 5f70 7269 6e74 203d 2022 416c 7468  to_print = "Alth
-0000ed90: 6f75 6768 2072 6573 7562 6d69 7373 696f  ough resubmissio
-0000eda0: 6e20 666f 7220 6a6f 623a 2022 202b 2073  n for job: " + s
-0000edb0: 7562 0a20 2020 2020 2020 2020 2020 2020  ub.             
-0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edd0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0000ede0: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
-0000edf0: 6d75 6c74 692d 7365 7322 3a0a 2020 2020  multi-ses":.    
-0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee20: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
-0000ee30: 222c 2022 202b 2073 6573 0a20 2020 2020  ", " + ses.     
+0000ec80: 2020 6966 2073 7461 7465 5f63 6f64 6520    if state_code 
+0000ec90: 3d3d 2022 7222 3a0a 2020 2020 2020 2020  == "r":.        
+0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecb0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+0000ecc0: 6966 2072 6573 7562 6d69 7420 6973 2072  if resubmit is r
+0000ecd0: 6571 7565 7374 6564 3a0a 2020 2020 2020  equested:.      
+0000ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecf0: 2020 2020 2020 2020 2020 6966 2069 665f            if if_
+0000ed00: 7265 7175 6573 745f 7265 7375 626d 6974  request_resubmit
+0000ed10: 5f74 6869 735f 6a6f 6220 2620 286e 6f74  _this_job & (not
+0000ed20: 2072 6563 6b6c 6573 7329 3a0a 2020 2020   reckless):.    
+0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed50: 2320 7265 7175 6573 7465 6420 7265 7375  # requested resu
+0000ed60: 626d 6974 2c20 6275 7420 7769 7468 6f75  bmit, but withou
+0000ed70: 7420 6072 6563 6b6c 6573 7360 3a20 7072  t `reckless`: pr
+0000ed80: 696e 7420 6d73 670a 2020 2020 2020 2020  int msg.        
+0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eda0: 2020 2020 2020 2020 2020 2020 746f 5f70              to_p
+0000edb0: 7269 6e74 203d 2022 416c 7468 6f75 6768  rint = "Although
+0000edc0: 2072 6573 7562 6d69 7373 696f 6e20 666f   resubmission fo
+0000edd0: 7220 6a6f 623a 2022 202b 2073 7562 0a20  r job: " + sub. 
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee00: 2020 2069 6620 7365 6c66 2e74 7970 655f     if self.type_
+0000ee10: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
+0000ee20: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000ee60: 6f5f 7072 696e 7420 2b3d 2022 2077 6173  o_print += " was
-0000ee70: 2072 6571 7565 7374 6564 2c20 6173 2074   requested, as t
-0000ee80: 6869 7320 6a6f 6220 6973 2072 756e 6e69  his job is runni
-0000ee90: 6e67 2c22 205c 0a20 2020 2020 2020 2020  ng," \.         
-0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eeb0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0000eec0: 2022 2042 4142 5320 776f 6e27 7420 7265   " BABS won't re
-0000eed0: 7375 626d 6974 2074 6869 7320 6a6f 622e  submit this job.
-0000eee0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 2020 2020 2020 2320 4e4f 5445 3a20 7265        # NOTE: re
-0000ef10: 6d6f 7665 6420 2261 6e64 2060 2d2d 7265  moved "and `--re
-0000ef20: 636b 6c65 7373 6020 7761 7320 6e6f 7420  ckless` was not 
-0000ef30: 7370 6563 6966 6965 642c 2022 0a20 2020  specified, ".   
-0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef60: 2023 2020 2063 616e 2061 6464 2074 6869   #   can add thi
-0000ef70: 7320 5e5e 2062 6163 6b20 6166 7465 7220  s ^^ back after 
-0000ef80: 7375 7070 6f72 7469 6e67 2060 2d2d 7265  supporting `--re
-0000ef90: 636b 6c65 7373 6020 696e 2043 4c49 0a20  ckless` in CLI. 
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efc0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-0000efd0: 2874 6f5f 7072 696e 7429 0a0a 2020 2020  (to_print)..    
-0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eff0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000f000: 665f 7265 7175 6573 745f 7265 7375 626d  f_request_resubm
-0000f010: 6974 5f74 6869 735f 6a6f 6220 2620 7265  it_this_job & re
-0000f020: 636b 6c65 7373 3a20 2023 2066 6f72 6365  ckless:  # force
-0000f030: 2074 6f20 7265 7375 626d 6974 3a0a 2020   to resubmit:.  
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f060: 2020 2320 5265 7375 626d 6974 3a0a 2020    # Resubmit:.  
+0000ee50: 746f 5f70 7269 6e74 202b 3d20 222c 2022  to_print += ", "
+0000ee60: 202b 2073 6573 0a20 2020 2020 2020 2020   + ses.         
+0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee80: 2020 2020 2020 2020 2020 2074 6f5f 7072             to_pr
+0000ee90: 696e 7420 2b3d 2022 2077 6173 2072 6571  int += " was req
+0000eea0: 7565 7374 6564 2c20 6173 2074 6869 7320  uested, as this 
+0000eeb0: 6a6f 6220 6973 2072 756e 6e69 6e67 2c22  job is running,"
+0000eec0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+0000eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eee0: 2020 2020 2020 2020 2020 202b 2022 2042             + " B
+0000eef0: 4142 5320 776f 6e27 7420 7265 7375 626d  ABS won't resubm
+0000ef00: 6974 2074 6869 7320 6a6f 622e 220a 2020  it this job.".  
+0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef30: 2020 2320 4e4f 5445 3a20 7265 6d6f 7665    # NOTE: remove
+0000ef40: 6420 2261 6e64 2060 2d2d 7265 636b 6c65  d "and `--reckle
+0000ef50: 7373 6020 7761 7320 6e6f 7420 7370 6563  ss` was not spec
+0000ef60: 6966 6965 642c 2022 0a20 2020 2020 2020  ified, ".       
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+0000ef90: 2063 616e 2061 6464 2074 6869 7320 5e5e   can add this ^^
+0000efa0: 2062 6163 6b20 6166 7465 7220 7375 7070   back after supp
+0000efb0: 6f72 7469 6e67 2060 2d2d 7265 636b 6c65  orting `--reckle
+0000efc0: 7373 6020 696e 2043 4c49 0a20 2020 2020  ss` in CLI.     
+0000efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000eff0: 6172 6e69 6e67 732e 7761 726e 2874 6f5f  arnings.warn(to_
+0000f000: 7072 696e 7429 0a0a 2020 2020 2020 2020  print)..        
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2020 2020 2020 6966 2069 665f 7265          if if_re
+0000f030: 7175 6573 745f 7265 7375 626d 6974 5f74  quest_resubmit_t
+0000f040: 6869 735f 6a6f 6220 2620 7265 636b 6c65  his_job & reckle
+0000f050: 7373 3a20 2023 2066 6f72 6365 2074 6f20  ss:  # force to 
+0000f060: 7265 7375 626d 6974 3a0a 2020 2020 2020  resubmit:.      
 0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f090: 2020 2320 6469 645f 7265 7375 626d 6974    # did_resubmit
-0000f0a0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0c0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0000f0d0: 696e 7420 6120 6d65 7373 6167 653a 0a20  int a message:. 
+0000f080: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000f090: 5265 7375 626d 6974 3a0a 2020 2020 2020  Resubmit:.      
+0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000f0c0: 6469 645f 7265 7375 626d 6974 203d 2054  did_resubmit = T
+0000f0d0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
 0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f100: 2020 2074 6f5f 7072 696e 7420 3d20 2252     to_print = "R
-0000f110: 6573 7562 6d69 7420 6a6f 6220 666f 7220  esubmit job for 
-0000f120: 2220 2b20 7375 620a 2020 2020 2020 2020  " + sub.        
-0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f140: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000f150: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
-0000f160: 203d 3d20 226d 756c 7469 2d73 6573 223a   == "multi-ses":
-0000f170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f190: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
-0000f1a0: 7420 2b3d 2022 2c20 2220 2b20 7365 730a  t += ", " + ses.
+0000f0f0: 2020 2020 2020 2020 2320 7072 696e 7420          # print 
+0000f100: 6120 6d65 7373 6167 653a 0a20 2020 2020  a message:.     
+0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000f130: 6f5f 7072 696e 7420 3d20 2252 6573 7562  o_print = "Resub
+0000f140: 6d69 7420 6a6f 6220 666f 7220 2220 2b20  mit job for " + 
+0000f150: 7375 620a 2020 2020 2020 2020 2020 2020  sub.            
+0000f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f170: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000f180: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
+0000f190: 226d 756c 7469 2d73 6573 223a 0a20 2020  "multi-ses":.   
+0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1d0: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
-0000f1e0: 222c 2061 6c74 686f 7567 6820 6974 2077  ", although it w
-0000f1f0: 6173 2072 756e 6e69 6e67 2c22 205c 0a20  as running," \. 
-0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f220: 2020 2020 2020 202b 2022 2072 6573 7562         + " resub
-0000f230: 6d69 7420 666f 7220 7468 6973 206a 6f62  mit for this job
-0000f240: 2077 6173 2072 6571 7565 7374 6564 2220   was requested" 
-0000f250: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f270: 2020 2020 2020 2020 2020 2b20 2220 616e            + " an
-0000f280: 6420 602d 2d72 6563 6b6c 6573 7360 2077  d `--reckless` w
-0000f290: 6173 2073 7065 6369 6669 6564 2e22 0a20  as specified.". 
-0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2c0: 2020 2070 7269 6e74 2874 6f5f 7072 696e     print(to_prin
-0000f2d0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
-0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2f0: 2020 2020 2020 2020 2320 6b69 6c6c 206f          # kill o
-0000f300: 7269 6769 6e61 6c20 6f6e 650a 2020 2020  riginal one.    
+0000f1c0: 2020 2020 2074 6f5f 7072 696e 7420 2b3d       to_print +=
+0000f1d0: 2022 2c20 2220 2b20 7365 730a 2020 2020   ", " + ses.    
+0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f200: 746f 5f70 7269 6e74 202b 3d20 222c 2061  to_print += ", a
+0000f210: 6c74 686f 7567 6820 6974 2077 6173 2072  lthough it was r
+0000f220: 756e 6e69 6e67 2c22 205c 0a20 2020 2020  unning," \.     
+0000f230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f250: 2020 202b 2022 2072 6573 7562 6d69 7420     + " resubmit 
+0000f260: 666f 7220 7468 6973 206a 6f62 2077 6173  for this job was
+0000f270: 2072 6571 7565 7374 6564 2220 5c0a 2020   requested" \.  
+0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2a0: 2020 2020 2020 2b20 2220 616e 6420 602d        + " and `-
+0000f2b0: 2d72 6563 6b6c 6573 7360 2077 6173 2073  -reckless` was s
+0000f2c0: 7065 6369 6669 6564 2e22 0a20 2020 2020  pecified.".     
+0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f2f0: 7269 6e74 2874 6f5f 7072 696e 7429 0a0a  rint(to_print)..
+0000f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f330: 7072 6f63 5f6b 696c 6c20 3d20 7375 6270  proc_kill = subp
-0000f340: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
-0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f370: 2020 2020 5b22 7164 656c 222c 206a 6f62      ["qdel", job
-0000f380: 5f69 645f 7374 725d 2c0a 2020 2020 2020  _id_str],.      
+0000f320: 2020 2020 2320 6b69 6c6c 206f 7269 6769      # kill origi
+0000f330: 6e61 6c20 6f6e 650a 2020 2020 2020 2020  nal one.        
+0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f350: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+0000f360: 5f6b 696c 6c20 3d20 7375 6270 726f 6365  _kill = subproce
+0000f370: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
+0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3b0: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
-0000f3c0: 6573 732e 5049 5045 0a20 2020 2020 2020  ess.PIPE.       
+0000f3a0: 5b67 6574 5f63 6d64 5f63 616e 6365 6c5f  [get_cmd_cancel_
+0000f3b0: 6a6f 6228 7365 6c66 2e74 7970 655f 7379  job(self.type_sy
+0000f3c0: 7374 656d 292c 0a20 2020 2020 2020 2020  stem),.         
 0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3e0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f410: 2020 2070 726f 635f 6b69 6c6c 2e63 6865     proc_kill.che
-0000f420: 636b 5f72 6574 7572 6e63 6f64 6528 290a  ck_returncode().
-0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f450: 2020 2020 2320 7375 626d 6974 206e 6577      # submit new
-0000f460: 206f 6e65 3a0a 2020 2020 2020 2020 2020   one:.          
-0000f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f480: 2020 2020 2020 2020 2020 6a6f 625f 6964            job_id
-0000f490: 5f75 7064 6174 6564 2c20 5f2c 206c 6f67  _updated, _, log
-0000f4a0: 5f66 696c 656e 616d 6520 3d20 5c0a 2020  _filename = \.  
-0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3f0: 6a6f 625f 6964 5f73 7472 5d2c 2020 2320  job_id_str],  # 
+0000f400: 652e 672e 2c20 6071 6465 6c20 3c6a 6f62  e.g., `qdel <job
+0000f410: 5f69 643e 600a 2020 2020 2020 2020 2020  _id>`.          
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 2020 2020 2020 2020 2020 2020 2020 7374                st
+0000f440: 646f 7574 3d73 7562 7072 6f63 6573 732e  dout=subprocess.
+0000f450: 5049 5045 0a20 2020 2020 2020 2020 2020  PIPE.           
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f470: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000f4a0: 726f 635f 6b69 6c6c 2e63 6865 636b 5f72  roc_kill.check_r
+0000f4b0: 6574 7572 6e63 6f64 6528 290a 2020 2020  eturncode().    
 0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4d0: 2020 2020 2020 7375 626d 6974 5f6f 6e65        submit_one
-0000f4e0: 5f6a 6f62 2873 656c 662e 616e 616c 7973  _job(self.analys
-0000f4f0: 6973 5f70 6174 682c 0a20 2020 2020 2020  is_path,.       
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2320 7375 626d 6974 206e 6577 206f 6e65  # submit new one
+0000f4f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 0000f500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f530: 7365 6c66 2e74 7970 655f 7365 7373 696f  self.type_sessio
-0000f540: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0000f510: 2020 2020 2020 6a6f 625f 6964 5f75 7064        job_id_upd
+0000f520: 6174 6564 2c20 5f2c 206c 6f67 5f66 696c  ated, _, log_fil
+0000f530: 656e 616d 6520 3d20 5c0a 2020 2020 2020  ename = \.      
+0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f570: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-0000f580: 7970 655f 7379 7374 656d 2c0a 2020 2020  ype_system,.    
+0000f560: 2020 7375 626d 6974 5f6f 6e65 5f6a 6f62    submit_one_job
+0000f570: 2873 656c 662e 616e 616c 7973 6973 5f70  (self.analysis_p
+0000f580: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
 0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5c0: 2020 2073 7562 2c20 7365 7329 0a20 2020     sub, ses).   
+0000f5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f5c0: 2e74 7970 655f 7365 7373 696f 6e2c 0a20  .type_session,. 
 0000f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5f0: 2023 2075 7064 6174 6520 6669 656c 6473   # update fields
-0000f600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f620: 2020 2020 2020 6466 5f6a 6f62 5f75 7064        df_job_upd
-0000f630: 6174 6564 203d 2064 665f 7570 6461 7465  ated = df_update
-0000f640: 5f6f 6e65 5f6a 6f62 2864 665f 6a6f 625f  _one_job(df_job_
-0000f650: 7570 6461 7465 642c 2069 5f6a 6f62 2c20  updated, i_job, 
-0000f660: 6a6f 625f 6964 5f75 7064 6174 6564 2c0a  job_id_updated,.
-0000f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f600: 2020 2020 2020 7365 6c66 2e74 7970 655f        self.type_
+0000f610: 7379 7374 656d 2c0a 2020 2020 2020 2020  system,.        
+0000f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f640: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f650: 7562 2c20 7365 7329 0a20 2020 2020 2020  ub, ses).       
+0000f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f670: 2020 2020 2020 2020 2020 2020 2023 2075               # u
+0000f680: 7064 6174 6520 6669 656c 6473 3a0a 2020  pdate fields:.  
 0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6b0: 2020 2020 2020 206c 6f67 5f66 696c 656e         log_filen
-0000f6c0: 616d 652c 2064 6562 7567 3d54 7275 6529  ame, debug=True)
-0000f6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6f0: 2065 6c73 653a 2020 2023 206a 7573 7420   else:   # just 
-0000f700: 6c65 7420 6974 2072 756e 3a0a 2020 2020  let it run:.    
+0000f6b0: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+0000f6c0: 203d 2064 665f 7570 6461 7465 5f6f 6e65   = df_update_one
+0000f6d0: 5f6a 6f62 2864 665f 6a6f 625f 7570 6461  _job(df_job_upda
+0000f6e0: 7465 642c 2069 5f6a 6f62 2c20 6a6f 625f  ted, i_job, job_
+0000f6f0: 6964 5f75 7064 6174 6564 2c0a 2020 2020  id_updated,.    
+0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f730: 6466 5f6a 6f62 5f75 7064 6174 6564 2e61  df_job_updated.a
-0000f740: 745b 695f 6a6f 622c 2022 6a6f 625f 7374  t[i_job, "job_st
-0000f750: 6174 655f 6361 7465 676f 7279 225d 203d  ate_category"] =
-0000f760: 2073 7461 7465 5f63 6174 6567 6f72 790a   state_category.
-0000f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f790: 2020 2020 6466 5f6a 6f62 5f75 7064 6174      df_job_updat
-0000f7a0: 6564 2e61 745b 695f 6a6f 622c 2022 6a6f  ed.at[i_job, "jo
-0000f7b0: 625f 7374 6174 655f 636f 6465 225d 203d  b_state_code"] =
-0000f7c0: 2073 7461 7465 5f63 6f64 650a 2020 2020   state_code.    
-0000f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7f0: 2320 6765 7420 7468 6520 6475 7261 7469  # get the durati
-0000f800: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+0000f730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f740: 2020 206c 6f67 5f66 696c 656e 616d 652c     log_filename,
+0000f750: 2064 6562 7567 3d54 7275 6529 0a20 2020   debug=True).   
+0000f760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f770: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0000f780: 653a 2020 2023 206a 7573 7420 6c65 7420  e:   # just let 
+0000f790: 6974 2072 756e 3a0a 2020 2020 2020 2020  it run:.        
+0000f7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7b0: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
+0000f7c0: 6f62 5f75 7064 6174 6564 2e61 745b 695f  ob_updated.at[i_
+0000f7d0: 6a6f 622c 2022 6a6f 625f 7374 6174 655f  job, "job_state_
+0000f7e0: 6361 7465 676f 7279 225d 203d 2073 7461  category"] = sta
+0000f7f0: 7465 5f63 6174 6567 6f72 790a 2020 2020  te_category.    
+0000f800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f820: 2020 2020 2020 2020 6966 2022 6475 7261          if "dura
-0000f830: 7469 6f6e 2220 696e 2064 665f 616c 6c5f  tion" in df_all_
-0000f840: 6a6f 625f 7374 6174 7573 3a0a 2020 2020  job_status:.    
-0000f850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f820: 6466 5f6a 6f62 5f75 7064 6174 6564 2e61  df_job_updated.a
+0000f830: 745b 695f 6a6f 622c 2022 6a6f 625f 7374  t[i_job, "job_st
+0000f840: 6174 655f 636f 6465 225d 203d 2073 7461  ate_code"] = sta
+0000f850: 7465 5f63 6f64 650a 2020 2020 2020 2020  te_code.        
 0000f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f870: 2020 2020 2320 652e 672e 2c20 736c 7572      # e.g., slur
-0000f880: 6d20 6073 7175 6575 6560 2061 7574 6f6d  m `squeue` autom
-0000f890: 6174 6963 616c 6c79 2072 6574 7572 6e73  atically returns
-0000f8a0: 2074 6865 2064 7572 6174 696f 6e2c 0a20   the duration,. 
-0000f8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8d0: 2020 2020 2020 2023 2020 2073 6f20 6e6f         #   so no
-0000f8e0: 206e 6565 6420 746f 2063 616c 6375 2061   need to calcu a
-0000f8f0: 6761 696e 2e0a 2020 2020 2020 2020 2020  gain..          
-0000f900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f910: 2020 2020 2020 2020 2020 2020 2020 6475                du
-0000f920: 7261 7469 6f6e 203d 2064 665f 616c 6c5f  ration = df_all_
-0000f930: 6a6f 625f 7374 6174 7573 2e61 745b 6a6f  job_status.at[jo
-0000f940: 625f 6964 5f73 7472 2c20 2264 7572 6174  b_id_str, "durat
-0000f950: 696f 6e22 5d0a 2020 2020 2020 2020 2020  ion"].          
-0000f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f970: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f870: 2020 2020 2020 2020 2020 2020 2320 6765              # ge
+0000f880: 7420 7468 6520 6475 7261 7469 6f6e 3a0a  t the duration:.
+0000f890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8b0: 2020 2020 6966 2022 6475 7261 7469 6f6e      if "duration
+0000f8c0: 2220 696e 2064 665f 616c 6c5f 6a6f 625f  " in df_all_job_
+0000f8d0: 7374 6174 7573 3a0a 2020 2020 2020 2020  status:.        
+0000f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f900: 2320 652e 672e 2c20 736c 7572 6d20 6073  # e.g., slurm `s
+0000f910: 7175 6575 6560 2061 7574 6f6d 6174 6963  queue` automatic
+0000f920: 616c 6c79 2072 6574 7572 6e73 2074 6865  ally returns the
+0000f930: 2064 7572 6174 696f 6e2c 0a20 2020 2020   duration,.     
+0000f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f960: 2020 2023 2020 2073 6f20 6e6f 206e 6565     #   so no nee
+0000f970: 6420 746f 2063 616c 6375 2061 6761 696e  d to calcu again
+0000f980: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
 0000f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f9a0: 2020 2020 2020 2020 2320 5468 6973 2064          # This d
-0000f9b0: 7572 6174 696f 6e20 7469 6d65 206d 6179  uration time may
-0000f9c0: 2062 6520 736c 6967 6874 6c79 206c 6f6e   be slightly lon
-0000f9d0: 6765 7220 7468 616e 2061 6374 7561 6c0a  ger than actual.
-0000f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f9a0: 2020 2020 2020 2020 2020 6475 7261 7469            durati
+0000f9b0: 6f6e 203d 2064 665f 616c 6c5f 6a6f 625f  on = df_all_job_
+0000f9c0: 7374 6174 7573 2e61 745b 6a6f 625f 6964  status.at[job_id
+0000f9d0: 5f73 7472 2c20 2264 7572 6174 696f 6e22  _str, "duration"
+0000f9e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
 0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa00: 2020 2020 2020 2020 2320 7469 6d65 2c20          # time, 
-0000fa10: 6173 2074 6869 7320 6973 2075 7369 6e67  as this is using
-0000fa20: 2063 7572 7265 6e74 2074 696d 652c 2069   current time, i
-0000fa30: 6e73 7465 6164 206f 660a 2020 2020 2020  nstead of.      
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa60: 2020 2320 7468 6520 7469 6d65 2077 6865    # the time whe
-0000fa70: 6e20 6071 7374 6174 602f 7265 7175 6573  n `qstat`/reques
-0000fa80: 7469 6e67 206a 6f62 2071 7565 7565 2e0a  ting job queue..
-0000fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fab0: 2020 2020 2020 2020 6475 7261 7469 6f6e          duration
-0000fac0: 203d 2063 616c 6375 5f72 756e 7469 6d65   = calcu_runtime
-0000fad0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000faf0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-0000fb00: 5f61 6c6c 5f6a 6f62 5f73 7461 7475 732e  _all_job_status.
-0000fb10: 6174 5b6a 6f62 5f69 645f 7374 722c 2022  at[job_id_str, "
-0000fb20: 4a41 545f 7374 6172 745f 7469 6d65 225d  JAT_start_time"]
-0000fb30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb50: 2020 2020 2020 6466 5f6a 6f62 5f75 7064        df_job_upd
-0000fb60: 6174 6564 2e61 745b 695f 6a6f 622c 2022  ated.at[i_job, "
-0000fb70: 6475 7261 7469 6f6e 225d 203d 2064 7572  duration"] = dur
-0000fb80: 6174 696f 6e0a 0a20 2020 2020 2020 2020  ation..         
-0000fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fba0: 2020 2020 2020 2020 2020 2023 2064 6f20             # do 
-0000fbb0: 6e6f 7468 696e 6720 656c 7365 2c20 6a75  nothing else, ju
-0000fbc0: 7374 2077 6169 740a 0a20 2020 2020 2020  st wait..       
+0000fa00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa30: 2020 2020 2320 5468 6973 2064 7572 6174      # This durat
+0000fa40: 696f 6e20 7469 6d65 206d 6179 2062 6520  ion time may be 
+0000fa50: 736c 6967 6874 6c79 206c 6f6e 6765 7220  slightly longer 
+0000fa60: 7468 616e 2061 6374 7561 6c0a 2020 2020  than actual.    
+0000fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa90: 2020 2020 2320 7469 6d65 2c20 6173 2074      # time, as t
+0000faa0: 6869 7320 6973 2075 7369 6e67 2063 7572  his is using cur
+0000fab0: 7265 6e74 2074 696d 652c 2069 6e73 7465  rent time, inste
+0000fac0: 6164 206f 660a 2020 2020 2020 2020 2020  ad of.          
+0000fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fae0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000faf0: 7468 6520 7469 6d65 2077 6865 6e20 6071  the time when `q
+0000fb00: 7374 6174 602f 7265 7175 6573 7469 6e67  stat`/requesting
+0000fb10: 206a 6f62 2071 7565 7565 2e0a 2020 2020   job queue..    
+0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 2020 2020 6475 7261 7469 6f6e 203d 2063      duration = c
+0000fb50: 616c 6375 5f72 756e 7469 6d65 280a 2020  alcu_runtime(.  
+0000fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb80: 2020 2020 2020 2020 2020 6466 5f61 6c6c            df_all
+0000fb90: 5f6a 6f62 5f73 7461 7475 732e 6174 5b6a  _job_status.at[j
+0000fba0: 6f62 5f69 645f 7374 722c 2022 4a41 545f  ob_id_str, "JAT_
+0000fbb0: 7374 6172 745f 7469 6d65 225d 290a 2020  start_time"]).  
+0000fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbe0: 2020 2020 2065 6c69 6620 7374 6174 655f       elif state_
-0000fbf0: 636f 6465 203d 3d20 2271 7722 3a0a 2020  code == "qw":.  
-0000fc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000fc20: 2028 2770 656e 6469 6e67 2720 696e 2066   ('pending' in f
-0000fc30: 6c61 6773 5f72 6573 7562 6d69 7429 206f  lags_resubmit) o
-0000fc40: 7220 2869 665f 7265 7175 6573 745f 7265  r (if_request_re
-0000fc50: 7375 626d 6974 5f74 6869 735f 6a6f 6229  submit_this_job)
-0000fc60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc80: 2020 2020 2020 2320 5265 7375 626d 6974        # Resubmit
-0000fc90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcb0: 2020 2020 2020 2320 6469 645f 7265 7375        # did_resu
-0000fcc0: 626d 6974 203d 2054 7275 650a 2020 2020  bmit = True.    
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcf0: 2320 7072 696e 7420 6120 6d65 7373 6167  # print a messag
-0000fd00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 2020 2020 2020 2074 6f5f 7072 696e 7420         to_print 
-0000fd30: 3d20 2252 6573 7562 6d69 7420 6a6f 6220  = "Resubmit job 
-0000fd40: 666f 7220 2220 2b20 7375 620a 2020 2020  for " + sub.    
-0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fbe0: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+0000fbf0: 2e61 745b 695f 6a6f 622c 2022 6475 7261  .at[i_job, "dura
+0000fc00: 7469 6f6e 225d 203d 2064 7572 6174 696f  tion"] = duratio
+0000fc10: 6e0a 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc30: 2020 2020 2020 2023 2064 6f20 6e6f 7468         # do noth
+0000fc40: 696e 6720 656c 7365 2c20 6a75 7374 2077  ing else, just w
+0000fc50: 6169 740a 0a20 2020 2020 2020 2020 2020  ait..           
+0000fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc70: 2065 6c69 6620 7374 6174 655f 636f 6465   elif state_code
+0000fc80: 203d 3d20 2271 7722 3a0a 2020 2020 2020   == "qw":.      
+0000fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fca0: 2020 2020 2020 2020 2020 6966 2028 2770            if ('p
+0000fcb0: 656e 6469 6e67 2720 696e 2066 6c61 6773  ending' in flags
+0000fcc0: 5f72 6573 7562 6d69 7429 206f 7220 2869  _resubmit) or (i
+0000fcd0: 665f 7265 7175 6573 745f 7265 7375 626d  f_request_resubm
+0000fce0: 6974 5f74 6869 735f 6a6f 6229 3a0a 2020  it_this_job):.  
+0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd10: 2020 2320 5265 7375 626d 6974 3a0a 2020    # Resubmit:.  
+0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd40: 2020 2320 6469 645f 7265 7375 626d 6974    # did_resubmit
+0000fd50: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
 0000fd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd70: 6966 2073 656c 662e 7479 7065 5f73 6573  if self.type_ses
-0000fd80: 7369 6f6e 203d 3d20 226d 756c 7469 2d73  sion == "multi-s
-0000fd90: 6573 223a 0a20 2020 2020 2020 2020 2020  es":.           
+0000fd70: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+0000fd80: 696e 7420 6120 6d65 7373 6167 653a 0a20  int a message:. 
+0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdb0: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-0000fdc0: 7072 696e 7420 2b3d 2022 2c20 2220 2b20  print += ", " + 
-0000fdd0: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
+0000fdb0: 2020 2074 6f5f 7072 696e 7420 3d20 2252     to_print = "R
+0000fdc0: 6573 7562 6d69 7420 6a6f 6220 666f 7220  esubmit job for 
+0000fdd0: 2220 2b20 7375 620a 2020 2020 2020 2020  " + sub.        
 0000fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdf0: 2020 2020 2020 2020 746f 5f70 7269 6e74          to_print
-0000fe00: 202b 3d20 222c 2061 7320 6974 2077 6173   += ", as it was
-0000fe10: 2070 656e 6469 6e67 2061 6e64 2072 6573   pending and res
-0000fe20: 7562 6d69 7420 7761 7320 7265 7175 6573  ubmit was reques
-0000fe30: 7465 642e 220a 2020 2020 2020 2020 2020  ted.".          
-0000fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000fe60: 746f 5f70 7269 6e74 290a 0a20 2020 2020  to_print)..     
+0000fdf0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000fe00: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
+0000fe10: 203d 3d20 226d 756c 7469 2d73 6573 223a   == "multi-ses":
+0000fe20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe40: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
+0000fe50: 7420 2b3d 2022 2c20 2220 2b20 7365 730a  t += ", " + ses.
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000fe70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000fe90: 206b 696c 6c20 6f72 6967 696e 616c 206f   kill original o
-0000fea0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-0000feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fec0: 2020 2020 2020 2070 726f 635f 6b69 6c6c         proc_kill
-0000fed0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
-0000fee0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000fef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff00: 2020 2020 2020 2020 2020 205b 2271 6465             ["qde
-0000ff10: 6c22 2c20 6a6f 625f 6964 5f73 7472 5d2c  l", job_id_str],
-0000ff20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe80: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
+0000fe90: 222c 2061 7320 6974 2077 6173 2070 656e  ", as it was pen
+0000fea0: 6469 6e67 2061 6e64 2072 6573 7562 6d69  ding and resubmi
+0000feb0: 7420 7761 7320 7265 7175 6573 7465 642e  t was requested.
+0000fec0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000fed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fee0: 2020 2020 2020 7072 696e 7428 746f 5f70        print(to_p
+0000fef0: 7269 6e74 290a 0a20 2020 2020 2020 2020  rint)..         
+0000ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff10: 2020 2020 2020 2020 2020 2023 206b 696c             # kil
+0000ff20: 6c20 6f72 6967 696e 616c 206f 6e65 0a20  l original one. 
 0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff40: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
-0000ff50: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff50: 2020 2070 726f 635f 6b69 6c6c 203d 2073     proc_kill = s
+0000ff60: 7562 7072 6f63 6573 732e 7275 6e28 0a20  ubprocess.run(. 
 0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff80: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffa0: 2020 2020 2020 2020 2020 7072 6f63 5f6b            proc_k
-0000ffb0: 696c 6c2e 6368 6563 6b5f 7265 7475 726e  ill.check_return
-0000ffc0: 636f 6465 2829 0a20 2020 2020 2020 2020  code().         
+0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff90: 2020 2020 2020 205b 6765 745f 636d 645f         [get_cmd_
+0000ffa0: 6361 6e63 656c 5f6a 6f62 2873 656c 662e  cancel_job(self.
+0000ffb0: 7479 7065 5f73 7973 7465 6d29 2c0a 2020  type_system),.  
+0000ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffe0: 2020 2020 2020 2020 2020 2023 2073 7562             # sub
-0000fff0: 6d69 7420 6e65 7720 6f6e 653a 0a20 2020  mit new one:.   
-00010000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffe0: 2020 2020 2020 206a 6f62 5f69 645f 7374         job_id_st
+0000fff0: 725d 2c20 2023 2065 2e67 2e2c 2060 7164  r],  # e.g., `qd
+00010000: 656c 203c 6a6f 625f 6964 3e60 0a20 2020  el <job_id>`.   
 00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010020: 206a 6f62 5f69 645f 7570 6461 7465 642c   job_id_updated,
-00010030: 205f 2c20 6c6f 675f 6669 6c65 6e61 6d65   _, log_filename
-00010040: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+00010020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010030: 2020 2020 2073 7464 6f75 743d 7375 6270       stdout=subp
+00010040: 726f 6365 7373 2e50 4950 450a 2020 2020  rocess.PIPE.    
 00010050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010060: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00010070: 6d69 745f 6f6e 655f 6a6f 6228 7365 6c66  mit_one_job(self
-00010080: 2e61 6e61 6c79 7369 735f 7061 7468 2c0a  .analysis_path,.
-00010090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100c0: 2020 2020 2020 2073 656c 662e 7479 7065         self.type
-000100d0: 5f73 6573 7369 6f6e 2c0a 2020 2020 2020  _session,.      
-000100e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010070: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010090: 2020 2020 2020 7072 6f63 5f6b 696c 6c2e        proc_kill.
+000100a0: 6368 6563 6b5f 7265 7475 726e 636f 6465  check_returncode
+000100b0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100d0: 2020 2020 2020 2023 2073 7562 6d69 7420         # submit 
+000100e0: 6e65 7720 6f6e 653a 0a20 2020 2020 2020  new one:.       
 000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010110: 2073 656c 662e 7479 7065 5f73 7973 7465   self.type_syste
-00010120: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
-00010130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010100: 2020 2020 2020 2020 2020 2020 206a 6f62               job
+00010110: 5f69 645f 7570 6461 7465 642c 205f 2c20  _id_updated, _, 
+00010120: 6c6f 675f 6669 6c65 6e61 6d65 203d 205c  log_filename = \
+00010130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00010140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010150: 2020 2020 2020 2020 2020 7375 622c 2073            sub, s
-00010160: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00010170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010180: 2020 2020 2020 2020 2320 7570 6461 7465          # update
-00010190: 2066 6965 6c64 733a 0a20 2020 2020 2020   fields:.       
+00010150: 2020 2020 2020 2020 2073 7562 6d69 745f           submit_
+00010160: 6f6e 655f 6a6f 6228 7365 6c66 2e61 6e61  one_job(self.ana
+00010170: 6c79 7369 735f 7061 7468 2c0a 2020 2020  lysis_path,.    
+00010180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010190: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101b0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-000101c0: 6a6f 625f 7570 6461 7465 6420 3d20 6466  job_updated = df
-000101d0: 5f75 7064 6174 655f 6f6e 655f 6a6f 6228  _update_one_job(
-000101e0: 6466 5f6a 6f62 5f75 7064 6174 6564 2c20  df_job_updated, 
-000101f0: 695f 6a6f 622c 206a 6f62 5f69 645f 7570  i_job, job_id_up
-00010200: 6461 7465 642c 0a20 2020 2020 2020 2020  dated,.         
+000101b0: 2020 2073 656c 662e 7479 7065 5f73 6573     self.type_ses
+000101c0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00010200: 662e 7479 7065 5f73 7973 7465 6d2c 0a20  f.type_system,. 
 00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010220: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010240: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00010250: 675f 6669 6c65 6e61 6d65 2c20 6465 6275  g_filename, debu
-00010260: 673d 5472 7565 290a 2020 2020 2020 2020  g=True).        
-00010270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010280: 2020 2020 2020 2020 656c 7365 3a20 2020          else:   
-00010290: 2320 6e6f 7420 746f 2072 6573 7562 6d69  # not to resubmi
-000102a0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102c0: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
-000102d0: 6669 656c 6473 3a0a 2020 2020 2020 2020  fields:.        
-000102e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102f0: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
-00010300: 6f62 5f75 7064 6174 6564 2e61 745b 695f  ob_updated.at[i_
-00010310: 6a6f 622c 2022 6a6f 625f 7374 6174 655f  job, "job_state_
-00010320: 6361 7465 676f 7279 225d 203d 2073 7461  category"] = sta
-00010330: 7465 5f63 6174 6567 6f72 790a 2020 2020  te_category.    
-00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010360: 6466 5f6a 6f62 5f75 7064 6174 6564 2e61  df_job_updated.a
-00010370: 745b 695f 6a6f 622c 2022 6a6f 625f 7374  t[i_job, "job_st
-00010380: 6174 655f 636f 6465 225d 203d 2073 7461  ate_code"] = sta
-00010390: 7465 5f63 6f64 650a 0a20 2020 2020 2020  te_code..       
+00010240: 2020 2020 2020 7375 622c 2073 6573 290a        sub, ses).
+00010250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010270: 2020 2020 2320 7570 6461 7465 2066 6965      # update fie
+00010280: 6c64 733a 0a20 2020 2020 2020 2020 2020  lds:.           
+00010290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102a0: 2020 2020 2020 2020 2064 665f 6a6f 625f           df_job_
+000102b0: 7570 6461 7465 6420 3d20 6466 5f75 7064  updated = df_upd
+000102c0: 6174 655f 6f6e 655f 6a6f 6228 6466 5f6a  ate_one_job(df_j
+000102d0: 6f62 5f75 7064 6174 6564 2c20 695f 6a6f  ob_updated, i_jo
+000102e0: 622c 206a 6f62 5f69 645f 7570 6461 7465  b, job_id_update
+000102f0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00010300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010330: 2020 2020 2020 2020 2020 6c6f 675f 6669            log_fi
+00010340: 6c65 6e61 6d65 2c20 6465 6275 673d 5472  lename, debug=Tr
+00010350: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00010360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010370: 2020 2020 656c 7365 3a20 2020 2320 6e6f      else:   # no
+00010380: 7420 746f 2072 6573 7562 6d69 743a 0a20  t to resubmit:. 
+00010390: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103b0: 2020 2020 2065 6c69 6620 7374 6174 655f       elif state_
-000103c0: 636f 6465 203d 3d20 2265 7177 223a 0a20  code == "eqw":. 
+000103b0: 2020 2023 2075 7064 6174 6520 6669 656c     # update fiel
+000103c0: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
 000103d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000103f0: 204e 4f54 453a 2063 6f6d 6d65 6e74 206f   NOTE: comment o
-00010400: 7574 2072 6573 7562 6d69 7373 696f 6e20  ut resubmission 
-00010410: 6f66 2060 6571 7760 206a 6f62 730a 2020  of `eqw` jobs.  
-00010420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010430: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010440: 2020 6173 2074 6869 7320 7761 7320 6e6f    as this was no
-00010450: 7420 7465 7374 6564 206f 7574 3b0a 2020  t tested out;.  
-00010460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010470: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010480: 2020 616c 736f 2c20 6571 7569 7661 6c65    also, equivale
-00010490: 6e74 2060 6571 7760 2063 6f64 6520 6f6e  nt `eqw` code on
-000104a0: 2053 6c75 726d 2077 6173 206e 6f74 206d   Slurm was not m
-000104b0: 6170 7065 6420 6569 7468 6572 2e0a 0a20  apped either... 
+000103e0: 2020 2020 2020 2020 6466 5f6a 6f62 5f75          df_job_u
+000103f0: 7064 6174 6564 2e61 745b 695f 6a6f 622c  pdated.at[i_job,
+00010400: 2022 6a6f 625f 7374 6174 655f 6361 7465   "job_state_cate
+00010410: 676f 7279 225d 203d 2073 7461 7465 5f63  gory"] = state_c
+00010420: 6174 6567 6f72 790a 2020 2020 2020 2020  ategory.        
+00010430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010440: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
+00010450: 6f62 5f75 7064 6174 6564 2e61 745b 695f  ob_updated.at[i_
+00010460: 6a6f 622c 2022 6a6f 625f 7374 6174 655f  job, "job_state_
+00010470: 636f 6465 225d 203d 2073 7461 7465 5f63  code"] = state_c
+00010480: 6f64 650a 0a20 2020 2020 2020 2020 2020  ode..           
+00010490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104a0: 2065 6c69 6620 7374 6174 655f 636f 6465   elif state_code
+000104b0: 203d 3d20 2265 7177 223a 0a20 2020 2020   == "eqw":.     
 000104c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000104d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000104e0: 6620 2827 7374 616c 6c65 6427 2069 6e20  f ('stalled' in 
-000104f0: 666c 6167 735f 7265 7375 626d 6974 2920  flags_resubmit) 
-00010500: 6f72 2028 6966 5f72 6571 7565 7374 5f72  or (if_request_r
-00010510: 6573 7562 6d69 745f 7468 6973 5f6a 6f62  esubmit_this_job
-00010520: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010540: 2020 2020 2020 2023 2072 6571 7565 7374         # request
-00010550: 6564 2072 6573 7562 6d69 742c 0a20 2020  ed resubmit,.   
-00010560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010580: 2023 2020 2062 7574 2063 7572 7265 6e74   #   but current
-00010590: 6c79 206e 6f74 2073 7570 706f 7274 2072  ly not support r
-000105a0: 6573 7562 6d69 7474 696e 6720 7374 616c  esubmitting stal
-000105b0: 6c65 6420 6a6f 6273 3a0a 2020 2020 2020  led jobs:.      
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000105e0: 2020 7072 696e 7420 7761 726e 696e 6720    print warning 
-000105f0: 6d73 673a 0a20 2020 2020 2020 2020 2020  msg:.           
-00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010610: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
-00010620: 7420 3d20 2241 6c74 686f 7567 6820 7265  t = "Although re
-00010630: 7375 626d 6973 7369 6f6e 2066 6f72 206a  submission for j
-00010640: 6f62 3a20 2220 2b20 7375 620a 2020 2020  ob: " + sub.    
+000104d0: 2020 2020 2020 2020 2020 2023 204e 4f54             # NOT
+000104e0: 453a 2063 6f6d 6d65 6e74 206f 7574 2072  E: comment out r
+000104f0: 6573 7562 6d69 7373 696f 6e20 6f66 2060  esubmission of `
+00010500: 6571 7760 206a 6f62 730a 2020 2020 2020  eqw` jobs.      
+00010510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010520: 2020 2020 2020 2020 2020 2320 2020 6173            #   as
+00010530: 2074 6869 7320 7761 7320 6e6f 7420 7465   this was not te
+00010540: 7374 6564 206f 7574 3b0a 2020 2020 2020  sted out;.      
+00010550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010560: 2020 2020 2020 2020 2020 2320 2020 616c            #   al
+00010570: 736f 2c20 6571 7569 7661 6c65 6e74 2060  so, equivalent `
+00010580: 6571 7760 2063 6f64 6520 6f6e 2053 6c75  eqw` code on Slu
+00010590: 726d 2077 6173 206e 6f74 206d 6170 7065  rm was not mappe
+000105a0: 6420 6569 7468 6572 2e0a 0a20 2020 2020  d either...     
+000105b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105c0: 2020 2020 2020 2020 2020 2069 6620 2827             if ('
+000105d0: 7374 616c 6c65 6427 2069 6e20 666c 6167  stalled' in flag
+000105e0: 735f 7265 7375 626d 6974 2920 6f72 2028  s_resubmit) or (
+000105f0: 6966 5f72 6571 7565 7374 5f72 6573 7562  if_request_resub
+00010600: 6d69 745f 7468 6973 5f6a 6f62 293a 0a20  mit_this_job):. 
+00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010630: 2020 2023 2072 6571 7565 7374 6564 2072     # requested r
+00010640: 6573 7562 6d69 742c 0a20 2020 2020 2020  esubmit,.       
 00010650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010670: 6966 2073 656c 662e 7479 7065 5f73 6573  if self.type_ses
-00010680: 7369 6f6e 203d 3d20 226d 756c 7469 2d73  sion == "multi-s
-00010690: 6573 223a 0a20 2020 2020 2020 2020 2020  es":.           
-000106a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106b0: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
-000106c0: 7072 696e 7420 2b3d 2022 2c20 2220 2b20  print += ", " + 
-000106d0: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
-000106e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106f0: 2020 2020 2020 2020 746f 5f70 7269 6e74          to_print
-00010700: 202b 3d20 2220 7761 7320 7265 7175 6573   += " was reques
-00010710: 7465 642c 2061 7320 7468 6973 206a 6f62  ted, as this job
-00010720: 2069 7320 7374 616c 6c65 6422 205c 0a20   is stalled" \. 
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010660: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00010670: 2062 7574 2063 7572 7265 6e74 6c79 206e   but currently n
+00010680: 6f74 2073 7570 706f 7274 2072 6573 7562  ot support resub
+00010690: 6d69 7474 696e 6720 7374 616c 6c65 6420  mitting stalled 
+000106a0: 6a6f 6273 3a0a 2020 2020 2020 2020 2020  jobs:.          
+000106b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106c0: 2020 2020 2020 2020 2020 2320 2020 7072            #   pr
+000106d0: 696e 7420 7761 726e 696e 6720 6d73 673a  int warning msg:
+000106e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000106f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010700: 2020 2020 2074 6f5f 7072 696e 7420 3d20       to_print = 
+00010710: 2241 6c74 686f 7567 6820 7265 7375 626d  "Although resubm
+00010720: 6973 7369 6f6e 2066 6f72 206a 6f62 3a20  ission for job: 
+00010730: 2220 2b20 7375 620a 2020 2020 2020 2020  " + sub.        
 00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010750: 2020 2020 2020 202b 2022 2028 652e 672e         + " (e.g.
-00010760: 2c20 6a6f 6220 7374 6174 6520 636f 6465  , job state code
-00010770: 2027 6571 7727 206f 6e20 5347 4529 2c22   'eqw' on SGE),"
-00010780: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00010750: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00010760: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
+00010770: 203d 3d20 226d 756c 7469 2d73 6573 223a   == "multi-ses":
+00010780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00010790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107a0: 2020 2020 2020 2020 2020 202b 2022 2042             + " B
-000107b0: 4142 5320 776f 6e27 7420 7265 7375 626d  ABS won't resubm
-000107c0: 6974 2074 6869 7320 6a6f 622e 220a 2020  it this job.".  
+000107a0: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
+000107b0: 7420 2b3d 2022 2c20 2220 2b20 7365 730a  t += ", " + ses.
+000107c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000107d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107f0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
-00010800: 746f 5f70 7269 6e74 290a 0a20 2020 2020  to_print)..     
-00010810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010820: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00010830: 2023 2052 6573 7562 6d69 743a 0a20 2020   # Resubmit:.   
-00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010850: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00010860: 2020 2023 2064 6964 5f72 6573 7562 6d69     # did_resubmi
-00010870: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
+000107e0: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
+000107f0: 2220 7761 7320 7265 7175 6573 7465 642c  " was requested,
+00010800: 2061 7320 7468 6973 206a 6f62 2069 7320   as this job is 
+00010810: 7374 616c 6c65 6422 205c 0a20 2020 2020  stalled" \.     
+00010820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010840: 2020 202b 2022 2028 652e 672e 2c20 6a6f     + " (e.g., jo
+00010850: 6220 7374 6174 6520 636f 6465 2027 6571  b state code 'eq
+00010860: 7727 206f 6e20 5347 4529 2c22 205c 0a20  w' on SGE)," \. 
+00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010890: 2020 2020 2020 2020 2023 2020 2020 2023           #     #
-000108a0: 2070 7269 6e74 2061 206d 6573 7361 6765   print a message
-000108b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010890: 2020 2020 2020 202b 2022 2042 4142 5320         + " BABS 
+000108a0: 776f 6e27 7420 7265 7375 626d 6974 2074  won't resubmit t
+000108b0: 6869 7320 6a6f 622e 220a 2020 2020 2020  his job.".      
 000108c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108d0: 2020 2320 2020 2020 746f 5f70 7269 6e74    #     to_print
-000108e0: 203d 2022 5265 7375 626d 6974 206a 6f62   = "Resubmit job
-000108f0: 2066 6f72 2022 202b 2073 7562 0a20 2020   for " + sub.   
+000108d0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+000108e0: 726e 696e 6773 2e77 6172 6e28 746f 5f70  rnings.warn(to_p
+000108f0: 7269 6e74 290a 0a20 2020 2020 2020 2020  rint)..         
 00010900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010910: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00010920: 2020 2069 6620 7365 6c66 2e74 7970 655f     if self.type_
-00010930: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
-00010940: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
-00010950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010960: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00010970: 2020 746f 5f70 7269 6e74 202b 3d20 222c    to_print += ",
-00010980: 2022 202b 2073 6573 0a20 2020 2020 2020   " + ses.       
-00010990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109a0: 2020 2020 2020 2020 2023 2020 2020 2074           #     t
-000109b0: 6f5f 7072 696e 7420 2b3d 2022 2c20 6173  o_print += ", as
-000109c0: 2069 7420 7761 7320 7374 616c 6c65 6420   it was stalled 
-000109d0: 616e 6420 7265 7375 626d 6974 2077 6173  and resubmit was
-000109e0: 2072 6571 7565 7374 6564 2e22 0a20 2020   requested.".   
+00010910: 2020 2020 2020 2023 2020 2020 2023 2052         #     # R
+00010920: 6573 7562 6d69 743a 0a20 2020 2020 2020  esubmit:.       
+00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010940: 2020 2020 2020 2020 2023 2020 2020 2023           #     #
+00010950: 2064 6964 5f72 6573 7562 6d69 7420 3d20   did_resubmit = 
+00010960: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00010970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010980: 2020 2020 2023 2020 2020 2023 2070 7269       #     # pri
+00010990: 6e74 2061 206d 6573 7361 6765 3a0a 2020  nt a message:.  
+000109a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000109b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000109c0: 2020 2020 746f 5f70 7269 6e74 203d 2022      to_print = "
+000109d0: 5265 7375 626d 6974 206a 6f62 2066 6f72  Resubmit job for
+000109e0: 2022 202b 2073 7562 0a20 2020 2020 2020   " + sub.       
 000109f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a00: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00010a10: 2020 2070 7269 6e74 2874 6f5f 7072 696e     print(to_prin
-00010a20: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
-00010a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a40: 2020 2020 2320 2020 2020 2320 6b69 6c6c      #     # kill
-00010a50: 206f 7269 6769 6e61 6c20 6f6e 650a 2020   original one.  
-00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010a80: 2020 2020 7072 6f63 5f6b 696c 6c20 3d20      proc_kill = 
-00010a90: 7375 6270 726f 6365 7373 2e72 756e 280a  subprocess.run(.
-00010aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ac0: 2320 2020 2020 2020 2020 5b22 7164 656c  #         ["qdel
-00010ad0: 222c 206a 6f62 5f69 645f 7374 725d 2c0a  ", job_id_str],.
+00010a00: 2020 2020 2020 2020 2023 2020 2020 2069           #     i
+00010a10: 6620 7365 6c66 2e74 7970 655f 7365 7373  f self.type_sess
+00010a20: 696f 6e20 3d3d 2022 6d75 6c74 692d 7365  ion == "multi-se
+00010a30: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a50: 2020 2020 2320 2020 2020 2020 2020 746f      #         to
+00010a60: 5f70 7269 6e74 202b 3d20 222c 2022 202b  _print += ", " +
+00010a70: 2073 6573 0a20 2020 2020 2020 2020 2020   ses.           
+00010a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a90: 2020 2020 2023 2020 2020 2074 6f5f 7072       #     to_pr
+00010aa0: 696e 7420 2b3d 2022 2c20 6173 2069 7420  int += ", as it 
+00010ab0: 7761 7320 7374 616c 6c65 6420 616e 6420  was stalled and 
+00010ac0: 7265 7375 626d 6974 2077 6173 2072 6571  resubmit was req
+00010ad0: 7565 7374 6564 2e22 0a20 2020 2020 2020  uested.".       
 00010ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b00: 2320 2020 2020 2020 2020 7374 646f 7574  #         stdout
-00010b10: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
-00010b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b40: 2023 2020 2020 2029 0a20 2020 2020 2020   #     ).       
+00010af0: 2020 2020 2020 2020 2023 2020 2020 2070           #     p
+00010b00: 7269 6e74 2874 6f5f 7072 696e 7429 0a0a  rint(to_print)..
+00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b30: 2320 2020 2020 2320 6b69 6c6c 206f 7269  #     # kill ori
+00010b40: 6769 6e61 6c20 6f6e 650a 2020 2020 2020  ginal one.      
 00010b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b60: 2020 2020 2020 2020 2023 2020 2020 2070           #     p
-00010b70: 726f 635f 6b69 6c6c 2e63 6865 636b 5f72  roc_kill.check_r
-00010b80: 6574 7572 6e63 6f64 6528 290a 2020 2020  eturncode().    
+00010b60: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00010b70: 7072 6f63 5f6b 696c 6c20 3d20 7375 6270  proc_kill = subp
+00010b80: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
 00010b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010ba0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00010bb0: 2020 2320 7375 626d 6974 206e 6577 206f    # submit new o
-00010bc0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00010bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010be0: 2020 2020 2320 2020 2020 6a6f 625f 6964      #     job_id
-00010bf0: 5f75 7064 6174 6564 2c20 5f2c 206c 6f67  _updated, _, log
-00010c00: 5f66 696c 656e 616d 6520 3d20 5c0a 2020  _filename = \.  
-00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010c30: 2020 2020 2020 2020 7375 626d 6974 5f6f          submit_o
-00010c40: 6e65 5f6a 6f62 2873 656c 662e 616e 616c  ne_job(self.anal
-00010c50: 7973 6973 5f70 6174 682c 0a20 2020 2020  ysis_path,.     
-00010c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c70: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00010bb0: 2020 2020 2020 5b67 6574 5f63 6d64 5f63        [get_cmd_c
+00010bc0: 616e 6365 6c5f 6a6f 6228 7365 6c66 2e74  ancel_job(self.t
+00010bd0: 7970 655f 7379 7374 656d 292c 0a20 2020  ype_system),.   
+00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010bf0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00010c00: 2020 2020 2020 2020 6a6f 625f 6964 5f73          job_id_s
+00010c10: 7472 5d2c 2020 2023 2065 2e67 2e2c 2060  tr],   # e.g., `
+00010c20: 7164 656c 203c 6a6f 625f 6964 3e60 0a20  qdel <job_id>`. 
+00010c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00010c50: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00010c60: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
+00010c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c90: 2020 2020 7365 6c66 2e74 7970 655f 7365      self.type_se
-00010ca0: 7373 696f 6e2c 0a20 2020 2020 2020 2020  ssion,.         
-00010cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cc0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00010cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ce0: 7365 6c66 2e74 7970 655f 7379 7374 656d  self.type_system
-00010cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d10: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00010d20: 2020 2020 2020 2020 2020 2073 7562 2c20             sub, 
-00010d30: 7365 7329 0a20 2020 2020 2020 2020 2020  ses).           
-00010d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d50: 2020 2020 2023 2020 2020 2023 2075 7064       #     # upd
-00010d60: 6174 6520 6669 656c 6473 3a0a 2020 2020  ate fields:.    
-00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d80: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00010d90: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
-00010da0: 203d 2064 665f 7570 6461 7465 5f6f 6e65   = df_update_one
-00010db0: 5f6a 6f62 2864 665f 6a6f 625f 7570 6461  _job(df_job_upda
-00010dc0: 7465 642c 2069 5f6a 6f62 2c20 6a6f 625f  ted, i_job, job_
-00010dd0: 6964 5f75 7064 6174 6564 2c0a 2020 2020  id_updated,.    
-00010de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010df0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00010c90: 2320 2020 2020 290a 2020 2020 2020 2020  #     ).        
+00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cb0: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
+00010cc0: 6f63 5f6b 696c 6c2e 6368 6563 6b5f 7265  oc_kill.check_re
+00010cd0: 7475 726e 636f 6465 2829 0a20 2020 2020  turncode().     
+00010ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cf0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00010d00: 2023 2073 7562 6d69 7420 6e65 7720 6f6e   # submit new on
+00010d10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d30: 2020 2023 2020 2020 206a 6f62 5f69 645f     #     job_id_
+00010d40: 7570 6461 7465 642c 205f 2c20 6c6f 675f  updated, _, log_
+00010d50: 6669 6c65 6e61 6d65 203d 205c 0a20 2020  filename = \.   
+00010d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d70: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00010d80: 2020 2020 2020 2073 7562 6d69 745f 6f6e         submit_on
+00010d90: 655f 6a6f 6228 7365 6c66 2e61 6e61 6c79  e_job(self.analy
+00010da0: 7369 735f 7061 7468 2c0a 2020 2020 2020  sis_path,.      
+00010db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010dc0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00010dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010de0: 2020 2073 656c 662e 7479 7065 5f73 6573     self.type_ses
+00010df0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
 00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e20: 2020 2020 206c 6f67 5f66 696c 656e 616d       log_filenam
-00010e30: 652c 2064 6562 7567 3d54 7275 6529 0a20  e, debug=True). 
-00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00010e60: 2065 6c73 653a 2020 2023 206e 6f74 2074   else:   # not t
-00010e70: 6f20 7265 7375 626d 6974 3a0a 0a20 2020  o resubmit:..   
-00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e90: 2020 2020 2020 2020 2020 2020 2023 206f               # o
-00010ea0: 6e6c 7920 7570 6461 7465 2066 6965 6c64  nly update field
-00010eb0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00010e10: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00010e20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010e30: 656c 662e 7479 7065 5f73 7973 7465 6d2c  elf.type_system,
+00010e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e60: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00010e70: 2020 2020 2020 2020 2020 7375 622c 2073            sub, s
+00010e80: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ea0: 2020 2020 2320 2020 2020 2320 7570 6461      #     # upda
+00010eb0: 7465 2066 6965 6c64 733a 0a20 2020 2020  te fields:.     
 00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ed0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-00010ee0: 642e 6174 5b69 5f6a 6f62 2c20 226a 6f62  d.at[i_job, "job
-00010ef0: 5f73 7461 7465 5f63 6174 6567 6f72 7922  _state_category"
-00010f00: 5d20 3d20 7374 6174 655f 6361 7465 676f  ] = state_catego
-00010f10: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
-00010f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f30: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-00010f40: 642e 6174 5b69 5f6a 6f62 2c20 226a 6f62  d.at[i_job, "job
-00010f50: 5f73 7461 7465 5f63 6f64 6522 5d20 3d20  _state_code"] = 
-00010f60: 7374 6174 655f 636f 6465 0a0a 2020 2020  state_code..    
-00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f80: 2020 2020 656c 7365 3a20 2020 2320 6469      else:   # di
-00010f90: 6420 6e6f 7420 6669 6e64 2069 6e20 6064  d not find in `d
-00010fa0: 665f 616c 6c5f 6a6f 625f 7374 6174 7573  f_all_job_status
-00010fb0: 602c 2069 2e65 2e2c 206a 6f62 2071 7565  `, i.e., job que
-00010fc0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00010fd0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00010fe0: 2070 726f 6261 626c 7920 6572 726f 720a   probably error.
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011000: 2020 2020 2020 2020 2020 2020 6466 5f6a              df_j
-00011010: 6f62 5f75 7064 6174 6564 2e61 745b 695f  ob_updated.at[i_
-00011020: 6a6f 622c 2022 6973 5f66 6169 6c65 6422  job, "is_failed"
-00011030: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011050: 2020 2020 2023 2072 6573 6574 3a0a 2020       # reset:.  
-00011060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011070: 2020 2020 2020 2020 2020 6466 5f6a 6f62            df_job
-00011080: 5f75 7064 6174 6564 2e61 745b 695f 6a6f  _updated.at[i_jo
-00011090: 622c 2022 6a6f 625f 7374 6174 655f 6361  b, "job_state_ca
-000110a0: 7465 676f 7279 225d 203d 206e 702e 6e61  tegory"] = np.na
-000110b0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-000110c0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-000110d0: 5f6a 6f62 5f75 7064 6174 6564 2e61 745b  _job_updated.at[
-000110e0: 695f 6a6f 622c 2022 6a6f 625f 7374 6174  i_job, "job_stat
-000110f0: 655f 636f 6465 225d 203d 206e 702e 6e61  e_code"] = np.na
-00011100: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00011110: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00011120: 5f6a 6f62 5f75 7064 6174 6564 2e61 745b  _job_updated.at[
-00011130: 695f 6a6f 622c 2022 6475 7261 7469 6f6e  i_job, "duration
-00011140: 225d 203d 206e 702e 6e61 6e0a 2020 2020  "] = np.nan.    
-00011150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011160: 2020 2020 2020 2020 2320 524f 4144 4d41          # ROADMA
-00011170: 503a 205e 5e20 6765 7420 6475 7261 7469  P: ^^ get durati
-00011180: 6f6e 2076 6961 2060 7161 6363 7460 0a20  on via `qacct`. 
+00010ed0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00010ee0: 2064 665f 6a6f 625f 7570 6461 7465 6420   df_job_updated 
+00010ef0: 3d20 6466 5f75 7064 6174 655f 6f6e 655f  = df_update_one_
+00010f00: 6a6f 6228 6466 5f6a 6f62 5f75 7064 6174  job(df_job_updat
+00010f10: 6564 2c20 695f 6a6f 622c 206a 6f62 5f69  ed, i_job, job_i
+00010f20: 645f 7570 6461 7465 642c 0a20 2020 2020  d_updated,.     
+00010f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f40: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00010f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f70: 2020 2020 6c6f 675f 6669 6c65 6e61 6d65      log_filename
+00010f80: 2c20 6465 6275 673d 5472 7565 290a 2020  , debug=True).  
+00010f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fa0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010fb0: 656c 7365 3a20 2020 2320 6e6f 7420 746f  else:   # not to
+00010fc0: 2072 6573 7562 6d69 743a 0a0a 2020 2020   resubmit:..    
+00010fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fe0: 2020 2020 2020 2020 2020 2020 2320 6f6e              # on
+00010ff0: 6c79 2075 7064 6174 6520 6669 656c 6473  ly update fields
+00011000: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011020: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+00011030: 2e61 745b 695f 6a6f 622c 2022 6a6f 625f  .at[i_job, "job_
+00011040: 7374 6174 655f 6361 7465 676f 7279 225d  state_category"]
+00011050: 203d 2073 7461 7465 5f63 6174 6567 6f72   = state_categor
+00011060: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+00011070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011080: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+00011090: 2e61 745b 695f 6a6f 622c 2022 6a6f 625f  .at[i_job, "job_
+000110a0: 7374 6174 655f 636f 6465 225d 203d 2073  state_code"] = s
+000110b0: 7461 7465 5f63 6f64 650a 0a20 2020 2020  tate_code..     
+000110c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110d0: 2020 2065 6c73 653a 2020 2023 2064 6964     else:   # did
+000110e0: 206e 6f74 2066 696e 6420 696e 2060 6466   not find in `df
+000110f0: 5f61 6c6c 5f6a 6f62 5f73 7461 7475 7360  _all_job_status`
+00011100: 2c20 692e 652e 2c20 6a6f 6220 7175 6575  , i.e., job queu
+00011110: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00011120: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00011130: 7072 6f62 6162 6c79 2065 7272 6f72 0a20  probably error. 
+00011140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011150: 2020 2020 2020 2020 2020 2064 665f 6a6f             df_jo
+00011160: 625f 7570 6461 7465 642e 6174 5b69 5f6a  b_updated.at[i_j
+00011170: 6f62 2c20 2269 735f 6661 696c 6564 225d  ob, "is_failed"]
+00011180: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
 00011190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111a0: 2020 2020 2020 2020 2020 2069 6620 6966             if if
-000111b0: 5f66 6f75 6e64 5f6c 6f67 5f66 696c 6573  _found_log_files
-000111c0: 203d 3d20 4661 6c73 653a 2020 2023 2062   == False:   # b
-000111d0: 6f6f 6c20 6f72 206e 702e 6e61 6e0a 2020  ool or np.nan.  
-000111e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011200: 4966 2074 6865 7265 2069 7320 6e6f 206c  If there is no l
-00011210: 6f67 2066 696c 6573 2c20 7468 6520 616c  og files, the al
-00011220: 6572 7420 6d65 7373 6167 6520 776f 756c  ert message woul
-00011230: 6420 6265 2027 6e70 2e6e 616e 273b 0a20  d be 'np.nan';. 
-00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011250: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00011260: 2068 6f77 6576 6572 2074 6869 7320 6973   however this is
-00011270: 2061 2066 6169 6c65 6420 6a6f 622c 2073   a failed job, s
-00011280: 6f20 6974 2073 686f 756c 6420 6861 7665  o it should have
-00011290: 206c 6f67 2066 696c 6573 2c0a 2020 2020   log files,.    
+000111a0: 2020 2020 2320 7265 7365 743a 0a20 2020      # reset:.   
+000111b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111c0: 2020 2020 2020 2020 2064 665f 6a6f 625f           df_job_
+000111d0: 7570 6461 7465 642e 6174 5b69 5f6a 6f62  updated.at[i_job
+000111e0: 2c20 226a 6f62 5f73 7461 7465 5f63 6174  , "job_state_cat
+000111f0: 6567 6f72 7922 5d20 3d20 6e70 2e6e 616e  egory"] = np.nan
+00011200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011210: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00011220: 6a6f 625f 7570 6461 7465 642e 6174 5b69  job_updated.at[i
+00011230: 5f6a 6f62 2c20 226a 6f62 5f73 7461 7465  _job, "job_state
+00011240: 5f63 6f64 6522 5d20 3d20 6e70 2e6e 616e  _code"] = np.nan
+00011250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011260: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00011270: 6a6f 625f 7570 6461 7465 642e 6174 5b69  job_updated.at[i
+00011280: 5f6a 6f62 2c20 2264 7572 6174 696f 6e22  _job, "duration"
+00011290: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2020  ] = np.nan.     
 000112a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112b0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-000112c0: 756e 6c65 7373 2069 7420 7761 7320 6b69  unless it was ki
-000112d0: 6c6c 6564 2062 7920 7468 6520 7573 6572  lled by the user
-000112e0: 2077 6865 6e20 7065 6e64 696e 672e 0a20   when pending.. 
-000112f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011300: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00011310: 2063 6861 6e67 6520 7468 6520 2761 6c65   change the 'ale
-00011320: 7274 5f6d 6573 7361 6765 2720 746f 206e  rt_message' to n
-00011330: 6f20 616c 6572 7420 696e 206c 6f67 732c  o alert in logs,
-00011340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011360: 2023 2020 2073 6f20 7468 6174 2077 6865   #   so that whe
-00011370: 6e20 7265 706f 7274 696e 6720 6a6f 6220  n reporting job 
-00011380: 7374 6174 7573 2c0a 2020 2020 2020 2020  status,.        
+000112b0: 2020 2020 2020 2023 2052 4f41 444d 4150         # ROADMAP
+000112c0: 3a20 5e5e 2067 6574 2064 7572 6174 696f  : ^^ get duratio
+000112d0: 6e20 7669 6120 6071 6163 6374 600a 2020  n via `qacct`.  
+000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112f0: 2020 2020 2020 2020 2020 6966 2069 665f            if if_
+00011300: 666f 756e 645f 6c6f 675f 6669 6c65 7320  found_log_files 
+00011310: 3d3d 2046 616c 7365 3a20 2020 2320 626f  == False:   # bo
+00011320: 6f6c 206f 7220 6e70 2e6e 616e 0a20 2020  ol or np.nan.   
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+00011350: 6620 7468 6572 6520 6973 206e 6f20 6c6f  f there is no lo
+00011360: 6720 6669 6c65 732c 2074 6865 2061 6c65  g files, the ale
+00011370: 7274 206d 6573 7361 6765 2077 6f75 6c64  rt message would
+00011380: 2062 6520 276e 702e 6e61 6e27 3b0a 2020   be 'np.nan';.  
 00011390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113a0: 2020 2020 2020 2020 2320 2020 696e 666f          #   info
-000113b0: 2066 726f 6d20 6a6f 6220 6163 636f 756e   from job accoun
-000113c0: 7469 6e67 2077 696c 6c20 6265 2072 6570  ting will be rep
-000113d0: 6f72 7465 640a 2020 2020 2020 2020 2020  orted.          
-000113e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113f0: 2020 2020 2020 6466 5f6a 6f62 5f75 7064        df_job_upd
-00011400: 6174 6564 2e61 745b 695f 6a6f 622c 2022  ated.at[i_job, "
-00011410: 616c 6572 745f 6d65 7373 6167 6522 5d20  alert_message"] 
-00011420: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
-00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011440: 2020 2020 2020 2020 4d53 475f 4e4f 5f41          MSG_NO_A
-00011450: 4c45 5254 5f49 4e5f 4c4f 4753 0a0a 2020  LERT_IN_LOGS..  
-00011460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011470: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-00011480: 6b20 7468 6520 6c6f 6720 6669 6c65 3a0a  k the log file:.
+000113a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000113b0: 686f 7765 7665 7220 7468 6973 2069 7320  however this is 
+000113c0: 6120 6661 696c 6564 206a 6f62 2c20 736f  a failed job, so
+000113d0: 2069 7420 7368 6f75 6c64 2068 6176 6520   it should have 
+000113e0: 6c6f 6720 6669 6c65 732c 0a20 2020 2020  log files,.     
+000113f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011400: 2020 2020 2020 2020 2020 2023 2020 2075             #   u
+00011410: 6e6c 6573 7320 6974 2077 6173 206b 696c  nless it was kil
+00011420: 6c65 6420 6279 2074 6865 2075 7365 7220  led by the user 
+00011430: 7768 656e 2070 656e 6469 6e67 2e0a 2020  when pending..  
+00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011450: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00011460: 6368 616e 6765 2074 6865 2027 616c 6572  change the 'aler
+00011470: 745f 6d65 7373 6167 6527 2074 6f20 6e6f  t_message' to no
+00011480: 2061 6c65 7274 2069 6e20 6c6f 6773 2c0a   alert in logs,.
 00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114a0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
-000114b0: 444f 205e 5e0a 2020 2020 2020 2020 2020  DO ^^.          
-000114c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114d0: 2020 2320 544f 444f 3a20 6173 7369 676e    # TODO: assign
-000114e0: 2065 7272 6f72 2063 6174 6567 6f72 7920   error category 
-000114f0: 696e 2064 663b 2061 6c73 6f20 7072 696e  in df; also prin
-00011500: 7420 6974 206f 7574 0a0a 2020 2020 2020  t it out..      
-00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011520: 2020 2020 2020 2320 7265 7375 626d 6974        # resubmit
-00011530: 2069 6620 7265 7175 6573 7465 643a 0a20   if requested:. 
-00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011550: 2020 2020 2020 2020 2020 2069 6620 2822             if ("
-00011560: 6661 696c 6564 2220 696e 2066 6c61 6773  failed" in flags
-00011570: 5f72 6573 7562 6d69 7429 206f 7220 2869  _resubmit) or (i
-00011580: 665f 7265 7175 6573 745f 7265 7375 626d  f_request_resubm
-00011590: 6974 5f74 6869 735f 6a6f 6229 3a0a 2020  it_this_job):.  
-000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000115c0: 5265 7375 626d 6974 3a0a 2020 2020 2020  Resubmit:.      
-000115d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115e0: 2020 2020 2020 2020 2020 2320 6469 645f            # did_
-000115f0: 7265 7375 626d 6974 203d 2054 7275 650a  resubmit = True.
-00011600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114b0: 2320 2020 736f 2074 6861 7420 7768 656e  #   so that when
+000114c0: 2072 6570 6f72 7469 6e67 206a 6f62 2073   reporting job s
+000114d0: 7461 7475 732c 0a20 2020 2020 2020 2020  tatus,.         
+000114e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114f0: 2020 2020 2020 2023 2020 2069 6e66 6f20         #   info 
+00011500: 6672 6f6d 206a 6f62 2061 6363 6f75 6e74  from job account
+00011510: 696e 6720 7769 6c6c 2062 6520 7265 706f  ing will be repo
+00011520: 7274 6564 0a20 2020 2020 2020 2020 2020  rted.           
+00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011540: 2020 2020 2064 665f 6a6f 625f 7570 6461       df_job_upda
+00011550: 7465 642e 6174 5b69 5f6a 6f62 2c20 2261  ted.at[i_job, "a
+00011560: 6c65 7274 5f6d 6573 7361 6765 225d 203d  lert_message"] =
+00011570: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011590: 2020 2020 2020 204d 5347 5f4e 4f5f 414c         MSG_NO_AL
+000115a0: 4552 545f 494e 5f4c 4f47 530a 0a20 2020  ERT_IN_LOGS..   
+000115b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115c0: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+000115d0: 2074 6865 206c 6f67 2066 696c 653a 0a20   the log file:. 
+000115e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115f0: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
+00011600: 4f20 5e5e 0a20 2020 2020 2020 2020 2020  O ^^.           
 00011610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011620: 2320 7072 696e 7420 6120 6d65 7373 6167  # print a messag
-00011630: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00011640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011650: 2020 2074 6f5f 7072 696e 7420 3d20 2252     to_print = "R
-00011660: 6573 7562 6d69 7420 6a6f 6220 666f 7220  esubmit job for 
-00011670: 2220 2b20 7375 620a 2020 2020 2020 2020  " + sub.        
-00011680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011690: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000116a0: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
-000116b0: 226d 756c 7469 2d73 6573 223a 0a20 2020  "multi-ses":.   
-000116c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116e0: 2074 6f5f 7072 696e 7420 2b3d 2022 2c20   to_print += ", 
-000116f0: 2220 2b20 7365 730a 2020 2020 2020 2020  " + ses.        
-00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011710: 2020 2020 2020 2020 746f 5f70 7269 6e74          to_print
-00011720: 202b 3d20 222c 2061 7320 6974 2069 7320   += ", as it is 
-00011730: 6661 696c 6564 2061 6e64 2072 6573 7562  failed and resub
-00011740: 6d69 7420 7761 7320 7265 7175 6573 7465  mit was requeste
-00011750: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
-00011760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011770: 2020 2020 7072 696e 7428 746f 5f70 7269      print(to_pri
-00011780: 6e74 290a 0a20 2020 2020 2020 2020 2020  nt)..           
+00011620: 2023 2054 4f44 4f3a 2061 7373 6967 6e20   # TODO: assign 
+00011630: 6572 726f 7220 6361 7465 676f 7279 2069  error category i
+00011640: 6e20 6466 3b20 616c 736f 2070 7269 6e74  n df; also print
+00011650: 2069 7420 6f75 740a 0a20 2020 2020 2020   it out..       
+00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011670: 2020 2020 2023 2072 6573 7562 6d69 7420       # resubmit 
+00011680: 6966 2072 6571 7565 7374 6564 3a0a 2020  if requested:.  
+00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116a0: 2020 2020 2020 2020 2020 6966 2028 2266            if ("f
+000116b0: 6169 6c65 6422 2069 6e20 666c 6167 735f  ailed" in flags_
+000116c0: 7265 7375 626d 6974 2920 6f72 2028 6966  resubmit) or (if
+000116d0: 5f72 6571 7565 7374 5f72 6573 7562 6d69  _request_resubmi
+000116e0: 745f 7468 6973 5f6a 6f62 293a 0a20 2020  t_this_job):.   
+000116f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011700: 2020 2020 2020 2020 2020 2020 2023 2052               # R
+00011710: 6573 7562 6d69 743a 0a20 2020 2020 2020  esubmit:.       
+00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011730: 2020 2020 2020 2020 2023 2064 6964 5f72           # did_r
+00011740: 6573 7562 6d69 7420 3d20 5472 7565 0a20  esubmit = True. 
+00011750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011760: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00011770: 2070 7269 6e74 2061 206d 6573 7361 6765   print a message
+00011780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 00011790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117a0: 2020 2020 2023 206e 6f20 6e65 6564 2074       # no need t
-000117b0: 6f20 6b69 6c6c 206f 7269 6769 6e61 6c20  o kill original 
-000117c0: 6f6e 6521 0a20 2020 2020 2020 2020 2020  one!.           
+000117a0: 2020 746f 5f70 7269 6e74 203d 2022 5265    to_print = "Re
+000117b0: 7375 626d 6974 206a 6f62 2066 6f72 2022  submit job for "
+000117c0: 202b 2073 7562 0a20 2020 2020 2020 2020   + sub.         
 000117d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117e0: 2020 2020 2023 2020 2041 7320 6974 2061       #   As it a
-000117f0: 6c72 6561 6479 2066 6169 6c65 6420 616e  lready failed an
-00011800: 6420 6f75 7420 6f66 206a 6f62 2071 7565  d out of job que
-00011810: 7565 2e2e 2e0a 0a20 2020 2020 2020 2020  ue.....         
+000117e0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+000117f0: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
+00011800: 6d75 6c74 692d 7365 7322 3a0a 2020 2020  multi-ses":.    
+00011810: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011830: 2020 2020 2020 2023 2073 7562 6d69 7420         # submit 
-00011840: 6e65 7720 6f6e 653a 0a20 2020 2020 2020  new one:.       
+00011830: 746f 5f70 7269 6e74 202b 3d20 222c 2022  to_print += ", "
+00011840: 202b 2073 6573 0a20 2020 2020 2020 2020   + ses.         
 00011850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011860: 2020 2020 2020 2020 206a 6f62 5f69 645f           job_id_
-00011870: 7570 6461 7465 642c 205f 2c20 6c6f 675f  updated, _, log_
-00011880: 6669 6c65 6e61 6d65 203d 205c 0a20 2020  filename = \.   
-00011890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118b0: 2073 7562 6d69 745f 6f6e 655f 6a6f 6228   submit_one_job(
-000118c0: 7365 6c66 2e61 6e61 6c79 7369 735f 7061  self.analysis_pa
-000118d0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+00011860: 2020 2020 2020 2074 6f5f 7072 696e 7420         to_print 
+00011870: 2b3d 2022 2c20 6173 2069 7420 6973 2066  += ", as it is f
+00011880: 6169 6c65 6420 616e 6420 7265 7375 626d  ailed and resubm
+00011890: 6974 2077 6173 2072 6571 7565 7374 6564  it was requested
+000118a0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
+000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118c0: 2020 2070 7269 6e74 2874 6f5f 7072 696e     print(to_prin
+000118d0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
 000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011900: 2020 2020 2020 2073 656c 662e 7479 7065         self.type
-00011910: 5f73 6573 7369 6f6e 2c0a 2020 2020 2020  _session,.      
+000118f0: 2020 2020 2320 6e6f 206e 6565 6420 746f      # no need to
+00011900: 206b 696c 6c20 6f72 6967 696e 616c 206f   kill original o
+00011910: 6e65 210a 2020 2020 2020 2020 2020 2020  ne!.            
 00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011940: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011950: 662e 7479 7065 5f73 7973 7465 6d2c 0a20  f.type_system,. 
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011930: 2020 2020 2320 2020 4173 2069 7420 616c      #   As it al
+00011940: 7265 6164 7920 6661 696c 6564 2061 6e64  ready failed and
+00011950: 206f 7574 206f 6620 6a6f 6220 7175 6575   out of job queu
+00011960: 652e 2e2e 0a0a 2020 2020 2020 2020 2020  e.....          
 00011970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011990: 2020 7375 622c 2073 6573 290a 0a20 2020    sub, ses)..   
+00011980: 2020 2020 2020 2320 7375 626d 6974 206e        # submit n
+00011990: 6577 206f 6e65 3a0a 2020 2020 2020 2020  ew one:.        
 000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119b0: 2020 2020 2020 2020 2020 2020 2023 2075               # u
-000119c0: 7064 6174 6520 6669 656c 6473 3a0a 2020  pdate fields:.  
-000119d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119e0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-000119f0: 5f6a 6f62 5f75 7064 6174 6564 203d 2064  _job_updated = d
-00011a00: 665f 7570 6461 7465 5f6f 6e65 5f6a 6f62  f_update_one_job
-00011a10: 2864 665f 6a6f 625f 7570 6461 7465 642c  (df_job_updated,
-00011a20: 2069 5f6a 6f62 2c20 6a6f 625f 6964 5f75   i_job, job_id_u
-00011a30: 7064 6174 6564 2c0a 2020 2020 2020 2020  pdated,.        
+000119b0: 2020 2020 2020 2020 6a6f 625f 6964 5f75          job_id_u
+000119c0: 7064 6174 6564 2c20 5f2c 206c 6f67 5f66  pdated, _, log_f
+000119d0: 696c 656e 616d 6520 3d20 5c0a 2020 2020  ilename = \.    
+000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a00: 7375 626d 6974 5f6f 6e65 5f6a 6f62 2873  submit_one_job(s
+00011a10: 656c 662e 616e 616c 7973 6973 5f70 6174  elf.analysis_pat
+00011a20: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+00011a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a70: 2020 2020 2020 2020 2020 206c 6f67 5f66             log_f
-00011a80: 696c 656e 616d 652c 2064 6562 7567 3d54  ilename, debug=T
-00011a90: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00011aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ab0: 2065 6c73 653a 2020 2320 7265 7375 626d   else:  # resubm
-00011ac0: 6974 2027 6572 726f 7227 2077 6173 206e  it 'error' was n
-00011ad0: 6f74 2072 6571 7565 7374 6564 3a0a 2020  ot requested:.  
-00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011af0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011b00: 7265 7365 743a 0a20 2020 2020 2020 2020  reset:.         
-00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b20: 2020 2020 2020 2064 665f 6a6f 625f 7570         df_job_up
-00011b30: 6461 7465 642e 6174 5b69 5f6a 6f62 2c20  dated.at[i_job, 
-00011b40: 226a 6f62 5f73 7461 7465 5f63 6174 6567  "job_state_categ
-00011b50: 6f72 7922 5d20 3d20 6e70 2e6e 616e 0a20  ory"] = np.nan. 
-00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00011b80: 665f 6a6f 625f 7570 6461 7465 642e 6174  f_job_updated.at
-00011b90: 5b69 5f6a 6f62 2c20 226a 6f62 5f73 7461  [i_job, "job_sta
-00011ba0: 7465 5f63 6f64 6522 5d20 3d20 6e70 2e6e  te_code"] = np.n
-00011bb0: 616e 0a20 2020 2020 2020 2020 2020 2020  an.             
-00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bd0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-00011be0: 642e 6174 5b69 5f6a 6f62 2c20 2264 7572  d.at[i_job, "dur
-00011bf0: 6174 696f 6e22 5d20 3d20 6e70 2e6e 616e  ation"] = np.nan
-00011c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c20: 2023 2052 4f41 444d 4150 3a20 5e5e 2067   # ROADMAP: ^^ g
-00011c30: 6574 2064 7572 6174 696f 6e20 7669 6120  et duration via 
-00011c40: 6071 6163 6374 600a 0a20 2020 2020 2020  `qacct`..       
-00011c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c60: 2020 2020 2020 2020 2023 2049 6620 602d           # If `-
-00011c70: 2d6a 6f62 2d61 6363 6f75 6e74 6020 6973  -job-account` is
-00011c80: 2072 6571 7565 7374 6564 3a0a 2020 2020   requested:.    
-00011c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ca0: 2020 2020 2020 2020 2020 2020 6966 206a              if j
-00011cb0: 6f62 5f61 6363 6f75 6e74 2026 2069 665f  ob_account & if_
-00011cc0: 6e6f 5f61 6c65 7274 5f69 6e5f 6c6f 673a  no_alert_in_log:
-00011cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cf0: 2020 2020 2023 2069 6620 602d 2d6a 6f62       # if `--job
-00011d00: 2d61 6363 6f75 6e74 6020 6973 2072 6571  -account` is req
-00011d10: 7565 7374 6564 2c20 616e 6420 7468 6572  uested, and ther
-00011d20: 6520 6973 206e 6f20 616c 6572 740a 2020  e is no alert.  
-00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d50: 2020 2320 2020 6d65 7373 6167 6520 666f    #   message fo
-00011d60: 756e 6420 696e 206c 6f67 2066 696c 6573  und in log files
-00011d70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 2020 2020 6a6f 625f 6e61 6d65 203d        job_name =
-00011da0: 206c 6f67 5f66 696c 656e 616d 652e 7370   log_filename.sp
-00011db0: 6c69 7428 222e 2a22 295b 305d 0a20 2020  lit(".*")[0].   
-00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011de0: 206d 7367 5f6a 6f62 5f61 6363 6f75 6e74   msg_job_account
-00011df0: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
-00011e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e10: 2020 2020 2020 2020 2020 2020 2063 6865               che
-00011e20: 636b 5f6a 6f62 5f61 6363 6f75 6e74 286a  ck_job_account(j
-00011e30: 6f62 5f69 645f 7374 722c 206a 6f62 5f6e  ob_id_str, job_n
-00011e40: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00011e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00011e80: 7365 726e 616d 655f 6c6f 7765 7263 6173  sername_lowercas
-00011e90: 652c 2073 656c 662e 7479 7065 5f73 7973  e, self.type_sys
-00011ea0: 7465 6d29 0a20 2020 2020 2020 2020 2020  tem).           
-00011eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ec0: 2020 2020 2020 2020 2064 665f 6a6f 625f           df_job_
-00011ed0: 7570 6461 7465 642e 6174 5b69 5f6a 6f62  updated.at[i_job
-00011ee0: 2c20 226a 6f62 5f61 6363 6f75 6e74 225d  , "job_account"]
-00011ef0: 203d 206d 7367 5f6a 6f62 5f61 6363 6f75   = msg_job_accou
-00011f00: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-00011f10: 2020 2023 2044 6f6e 653a 2073 7562 6d69     # Done: submi
-00011f20: 7474 6564 206a 6f62 7320 7468 6174 206e  tted jobs that n
-00011f30: 6f74 2027 6973 5f64 6f6e 6527 0a0a 2020  ot 'is_done'..  
-00011f40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00011f50: 466f 7220 2769 735f 646f 6e65 2720 6a6f  For 'is_done' jo
-00011f60: 6273 2069 6e20 7072 6576 696f 7573 2072  bs in previous r
-00011f70: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-00011f80: 2020 2020 2020 7465 6d70 203d 2028 6466        temp = (df
-00011f90: 5f6a 6f62 5b27 6861 735f 7375 626d 6974  _job['has_submit
-00011fa0: 7465 6427 5d29 2026 2028 6466 5f6a 6f62  ted']) & (df_job
-00011fb0: 5b27 6973 5f64 6f6e 6527 5d29 0a20 2020  ['is_done']).   
-00011fc0: 2020 2020 2020 2020 2020 2020 206c 6973               lis
-00011fd0: 745f 696e 6465 785f 6a6f 625f 6973 5f64  t_index_job_is_d
-00011fe0: 6f6e 6520 3d20 6466 5f6a 6f62 2e69 6e64  one = df_job.ind
-00011ff0: 6578 5b74 656d 705d 2e74 6f6c 6973 7428  ex[temp].tolist(
-00012000: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012010: 2020 666f 7220 695f 6a6f 6220 696e 206c    for i_job in l
-00012020: 6973 745f 696e 6465 785f 6a6f 625f 6973  ist_index_job_is
-00012030: 5f64 6f6e 653a 0a20 2020 2020 2020 2020  _done:.         
-00012040: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
-00012050: 2062 6173 6963 2069 6e66 6f72 6d61 7469   basic informati
-00012060: 6f6e 2066 6f72 2074 6869 7320 6a6f 623a  on for this job:
-00012070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012080: 2020 2020 206a 6f62 5f69 6420 3d20 6466       job_id = df
-00012090: 5f6a 6f62 2e61 745b 695f 6a6f 622c 2022  _job.at[i_job, "
-000120a0: 6a6f 625f 6964 225d 0a20 2020 2020 2020  job_id"].       
-000120b0: 2020 2020 2020 2020 2020 2020 206a 6f62               job
-000120c0: 5f69 645f 7374 7220 3d20 7374 7228 6a6f  _id_str = str(jo
-000120d0: 625f 6964 290a 2020 2020 2020 2020 2020  b_id).          
-000120e0: 2020 2020 2020 2020 2020 6c6f 675f 6669            log_fi
-000120f0: 6c65 6e61 6d65 203d 2064 665f 6a6f 622e  lename = df_job.
-00012100: 6174 5b69 5f6a 6f62 2c20 226c 6f67 5f66  at[i_job, "log_f
-00012110: 696c 656e 616d 6522 5d20 2023 2077 6974  ilename"]  # wit
-00012120: 6820 222a 220a 2020 2020 2020 2020 2020  h "*".          
-00012130: 2020 2020 2020 2020 2020 6c6f 675f 666e            log_fn
-00012140: 203d 206f 702e 6a6f 696e 2873 656c 662e   = op.join(self.
-00012150: 616e 616c 7973 6973 5f70 6174 682c 2022  analysis_path, "
-00012160: 6c6f 6773 222c 206c 6f67 5f66 696c 656e  logs", log_filen
-00012170: 616d 6529 2020 2320 6162 7320 7061 7468  ame)  # abs path
-00012180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012190: 2020 2020 206f 5f66 6e20 3d20 6c6f 675f       o_fn = log_
-000121a0: 666e 2e72 6570 6c61 6365 2822 2e2a 222c  fn.replace(".*",
-000121b0: 2022 2e6f 2229 0a0a 2020 2020 2020 2020   ".o")..        
-000121c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000121d0: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
-000121e0: 203d 3d20 2273 696e 676c 652d 7365 7322   == "single-ses"
-000121f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012200: 2020 2020 2020 2020 2020 7375 6220 3d20            sub = 
-00012210: 6466 5f6a 6f62 2e61 745b 695f 6a6f 622c  df_job.at[i_job,
-00012220: 2022 7375 625f 6964 225d 0a20 2020 2020   "sub_id"].     
-00012230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012240: 2020 2073 6573 203d 204e 6f6e 650a 2020     ses = None.  
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2020 2020 2020 6272 616e 6368 6e61 6d65        branchname
-00012270: 203d 2022 6a6f 622d 2220 2b20 6a6f 625f   = "job-" + job_
-00012280: 6964 5f73 7472 202b 2022 2d22 202b 2073  id_str + "-" + s
-00012290: 7562 0a20 2020 2020 2020 2020 2020 2020  ub.             
-000122a0: 2020 2020 2020 2020 2020 2023 2065 2e67             # e.g
-000122b0: 2e2c 206a 6f62 2d30 3030 3030 2d73 7562  ., job-00000-sub
-000122c0: 2d30 310a 2020 2020 2020 2020 2020 2020  -01.            
-000122d0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-000122e0: 662e 7479 7065 5f73 6573 7369 6f6e 203d  f.type_session =
-000122f0: 3d20 226d 756c 7469 2d73 6573 223a 0a20  = "multi-ses":. 
-00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012310: 2020 2020 2020 2073 7562 203d 2064 665f         sub = df_
-00012320: 6a6f 622e 6174 5b69 5f6a 6f62 2c20 2273  job.at[i_job, "s
-00012330: 7562 5f69 6422 5d0a 2020 2020 2020 2020  ub_id"].        
-00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012350: 7365 7320 3d20 6466 5f6a 6f62 2e61 745b  ses = df_job.at[
-00012360: 695f 6a6f 622c 2022 7365 735f 6964 225d  i_job, "ses_id"]
-00012370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012380: 2020 2020 2020 2020 2062 7261 6e63 686e           branchn
-00012390: 616d 6520 3d20 226a 6f62 2d22 202b 206a  ame = "job-" + j
-000123a0: 6f62 5f69 645f 7374 7220 2b20 222d 2220  ob_id_str + "-" 
-000123b0: 2b20 7375 6220 2b20 222d 2220 2b20 7365  + sub + "-" + se
-000123c0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000123d0: 2020 2020 2020 2020 2020 2320 652e 672e            # e.g.
-000123e0: 2c20 6a6f 622d 3030 3030 302d 7375 622d  , job-00000-sub-
-000123f0: 3031 2d73 6573 2d42 0a0a 2020 2020 2020  01-ses-B..      
-00012400: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012410: 4368 6563 6b20 6966 2072 6573 7562 6d69  Check if resubmi
-00012420: 7373 696f 6e20 6f66 2074 6869 7320 6a6f  ssion of this jo
-00012430: 6220 6973 2072 6571 7565 7374 6564 3a0a  b is requested:.
-00012440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012450: 2020 2020 6966 5f72 6571 7565 7374 5f72      if_request_r
-00012460: 6573 7562 6d69 745f 7468 6973 5f6a 6f62  esubmit_this_job
-00012470: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00012480: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00012490: 6466 5f72 6573 7562 6d69 745f 6a6f 625f  df_resubmit_job_
-000124a0: 7370 6563 6966 6963 2069 7320 6e6f 7420  specific is not 
-000124b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000124c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000124d0: 2073 656c 662e 7479 7065 5f73 6573 7369   self.type_sessi
-000124e0: 6f6e 203d 3d20 2273 696e 676c 652d 7365  on == "single-se
-000124f0: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012510: 7465 6d70 203d 2064 665f 7265 7375 626d  temp = df_resubm
-00012520: 6974 5f6a 6f62 5f73 7065 6369 6669 635b  it_job_specific[
-00012530: 2773 7562 5f69 6427 5d20 3d3d 2073 7562  'sub_id'] == sub
-00012540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012550: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-00012560: 6c66 2e74 7970 655f 7365 7373 696f 6e20  lf.type_session 
-00012570: 3d3d 2022 6d75 6c74 692d 7365 7322 3a0a  == "multi-ses":.
-00012580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012590: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-000125a0: 203d 2028 6466 5f72 6573 7562 6d69 745f   = (df_resubmit_
-000125b0: 6a6f 625f 7370 6563 6966 6963 5b27 7375  job_specific['su
-000125c0: 625f 6964 275d 203d 3d20 7375 6229 2026  b_id'] == sub) &
-000125d0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000125e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125f0: 2020 2028 6466 5f72 6573 7562 6d69 745f     (df_resubmit_
-00012600: 6a6f 625f 7370 6563 6966 6963 5b27 7365  job_specific['se
-00012610: 735f 6964 275d 203d 3d20 7365 7329 0a0a  s_id'] == ses)..
-00012620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012630: 2020 2020 2020 2020 6966 2061 6e79 2874          if any(t
-00012640: 656d 7029 3a20 2020 2320 616e 7920 6d61  emp):   # any ma
-00012650: 7463 6865 643b 2060 7465 6d70 6020 6973  tched; `temp` is
-00012660: 2070 642e 5365 7269 6573 206f 6620 5472   pd.Series of Tr
-00012670: 7565 206f 7220 4661 6c73 650a 2020 2020  ue or False.    
-00012680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012690: 2020 2020 2020 2020 6966 5f72 6571 7565          if_reque
-000126a0: 7374 5f72 6573 7562 6d69 745f 7468 6973  st_resubmit_this
-000126b0: 5f6a 6f62 203d 2054 7275 650a 2020 2020  _job = True.    
-000126c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126d0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-000126e0: 2264 6562 7567 6769 6e67 2070 7572 706f  "debugging purpo
-000126f0: 7365 3a20 7265 7175 6573 7420 746f 2072  se: request to r
-00012700: 6573 7562 6d69 7420 6a6f 623a 2220 2b20  esubmit job:" + 
-00012710: 7375 6220 2b20 222c 2022 202b 2073 6573  sub + ", " + ses
-00012720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012730: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012740: 5e5e 206f 6e6c 7920 666f 7220 6d75 6c74  ^^ only for mult
-00012750: 692d 7365 730a 0a20 2020 2020 2020 2020  i-ses..         
-00012760: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00012770: 7761 6e74 2074 6f20 7265 7375 626d 6974  want to resubmit
-00012780: 2c20 6275 7420 602d 2d72 6563 6b6c 6573  , but `--reckles
-00012790: 7360 2069 7320 4e4f 5420 7370 6563 6966  s` is NOT specif
-000127a0: 6965 643a 2070 7269 6e74 206d 7367 3a0a  ied: print msg:.
-000127b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127c0: 2020 2020 6966 2069 665f 7265 7175 6573      if if_reques
-000127d0: 745f 7265 7375 626d 6974 5f74 6869 735f  t_resubmit_this_
-000127e0: 6a6f 6220 2620 286e 6f74 2072 6563 6b6c  job & (not reckl
-000127f0: 6573 7329 3a0a 2020 2020 2020 2020 2020  ess):.          
-00012800: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00012810: 5f70 7269 6e74 203d 2022 416c 7468 6f75  _print = "Althou
-00012820: 6768 2072 6573 7562 6d69 7373 696f 6e20  gh resubmission 
-00012830: 666f 7220 6a6f 623a 2022 202b 2073 7562  for job: " + sub
-00012840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012850: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00012860: 2e74 7970 655f 7365 7373 696f 6e20 3d3d  .type_session ==
-00012870: 2022 6d75 6c74 692d 7365 7322 3a0a 2020   "multi-ses":.  
-00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012890: 2020 2020 2020 2020 2020 746f 5f70 7269            to_pri
-000128a0: 6e74 202b 3d20 222c 2022 202b 2073 6573  nt += ", " + ses
-000128b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128c0: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
-000128d0: 7420 2b3d 2022 2077 6173 2072 6571 7565  t += " was reque
-000128e0: 7374 6564 2c20 6173 2074 6869 7320 6a6f  sted, as this jo
-000128f0: 6220 6973 2064 6f6e 652c 2220 5c0a 2020  b is done," \.  
+00011a50: 2020 2020 2020 7365 6c66 2e74 7970 655f        self.type_
+00011a60: 7365 7373 696f 6e2c 0a20 2020 2020 2020  session,.       
+00011a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011aa0: 2e74 7970 655f 7379 7374 656d 2c0a 2020  .type_system,.  
+00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ae0: 2073 7562 2c20 7365 7329 0a0a 2020 2020   sub, ses)..    
+00011af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b00: 2020 2020 2020 2020 2020 2020 2320 7570              # up
+00011b10: 6461 7465 2066 6965 6c64 733a 0a20 2020  date fields:.   
+00011b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b30: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00011b40: 6a6f 625f 7570 6461 7465 6420 3d20 6466  job_updated = df
+00011b50: 5f75 7064 6174 655f 6f6e 655f 6a6f 6228  _update_one_job(
+00011b60: 6466 5f6a 6f62 5f75 7064 6174 6564 2c20  df_job_updated, 
+00011b70: 695f 6a6f 622c 206a 6f62 5f69 645f 7570  i_job, job_id_up
+00011b80: 6461 7465 642c 0a20 2020 2020 2020 2020  dated,.         
+00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bc0: 2020 2020 2020 2020 2020 6c6f 675f 6669            log_fi
+00011bd0: 6c65 6e61 6d65 2c20 6465 6275 673d 5472  lename, debug=Tr
+00011be0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c00: 656c 7365 3a20 2023 2072 6573 7562 6d69  else:  # resubmi
+00011c10: 7420 2765 7272 6f72 2720 7761 7320 6e6f  t 'error' was no
+00011c20: 7420 7265 7175 6573 7465 643a 0a20 2020  t requested:.   
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00011c50: 6573 6574 3a0a 2020 2020 2020 2020 2020  eset:.          
+00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c70: 2020 2020 2020 6466 5f6a 6f62 5f75 7064        df_job_upd
+00011c80: 6174 6564 2e61 745b 695f 6a6f 622c 2022  ated.at[i_job, "
+00011c90: 6a6f 625f 7374 6174 655f 6361 7465 676f  job_state_catego
+00011ca0: 7279 225d 203d 206e 702e 6e61 6e0a 2020  ry"] = np.nan.  
+00011cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cc0: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00011cd0: 5f6a 6f62 5f75 7064 6174 6564 2e61 745b  _job_updated.at[
+00011ce0: 695f 6a6f 622c 2022 6a6f 625f 7374 6174  i_job, "job_stat
+00011cf0: 655f 636f 6465 225d 203d 206e 702e 6e61  e_code"] = np.na
+00011d00: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d20: 2020 6466 5f6a 6f62 5f75 7064 6174 6564    df_job_updated
+00011d30: 2e61 745b 695f 6a6f 622c 2022 6475 7261  .at[i_job, "dura
+00011d40: 7469 6f6e 225d 203d 206e 702e 6e61 6e0a  tion"] = np.nan.
+00011d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d70: 2320 524f 4144 4d41 503a 205e 5e20 6765  # ROADMAP: ^^ ge
+00011d80: 7420 6475 7261 7469 6f6e 2076 6961 2060  t duration via `
+00011d90: 7161 6363 7460 0a0a 2020 2020 2020 2020  qacct`..        
+00011da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011db0: 2020 2020 2020 2020 2320 4966 2060 2d2d          # If `--
+00011dc0: 6a6f 622d 6163 636f 756e 7460 2069 7320  job-account` is 
+00011dd0: 7265 7175 6573 7465 643a 0a20 2020 2020  requested:.     
+00011de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011df0: 2020 2020 2020 2020 2020 2069 6620 6a6f             if jo
+00011e00: 625f 6163 636f 756e 7420 2620 6966 5f6e  b_account & if_n
+00011e10: 6f5f 616c 6572 745f 696e 5f6c 6f67 3a0a  o_alert_in_log:.
+00011e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e40: 2020 2020 2320 6966 2060 2d2d 6a6f 622d      # if `--job-
+00011e50: 6163 636f 756e 7460 2069 7320 7265 7175  account` is requ
+00011e60: 6573 7465 642c 2061 6e64 2074 6865 7265  ested, and there
+00011e70: 2069 7320 6e6f 2061 6c65 7274 0a20 2020   is no alert.   
+00011e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ea0: 2023 2020 206d 6573 7361 6765 2066 6f75   #   message fou
+00011eb0: 6e64 2069 6e20 6c6f 6720 6669 6c65 733a  nd in log files:
+00011ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ee0: 2020 2020 206a 6f62 5f6e 616d 6520 3d20       job_name = 
+00011ef0: 6c6f 675f 6669 6c65 6e61 6d65 2e73 706c  log_filename.spl
+00011f00: 6974 2822 2e2a 2229 5b30 5d0a 2020 2020  it(".*")[0].    
+00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f30: 6d73 675f 6a6f 625f 6163 636f 756e 7420  msg_job_account 
+00011f40: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f60: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+00011f70: 6b5f 6a6f 625f 6163 636f 756e 7428 6a6f  k_job_account(jo
+00011f80: 625f 6964 5f73 7472 2c20 6a6f 625f 6e61  b_id_str, job_na
+00011f90: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+00011fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fc0: 2020 2020 2020 2020 2020 2020 2020 7573                us
+00011fd0: 6572 6e61 6d65 5f6c 6f77 6572 6361 7365  ername_lowercase
+00011fe0: 2c20 7365 6c66 2e74 7970 655f 7379 7374  , self.type_syst
+00011ff0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+00012000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012010: 2020 2020 2020 2020 6466 5f6a 6f62 5f75          df_job_u
+00012020: 7064 6174 6564 2e61 745b 695f 6a6f 622c  pdated.at[i_job,
+00012030: 2022 6a6f 625f 6163 636f 756e 7422 5d20   "job_account"] 
+00012040: 3d20 6d73 675f 6a6f 625f 6163 636f 756e  = msg_job_accoun
+00012050: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00012060: 2020 2320 446f 6e65 3a20 7375 626d 6974    # Done: submit
+00012070: 7465 6420 6a6f 6273 2074 6861 7420 6e6f  ted jobs that no
+00012080: 7420 2769 735f 646f 6e65 270a 0a20 2020  t 'is_done'..   
+00012090: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+000120a0: 6f72 2027 6973 5f64 6f6e 6527 206a 6f62  or 'is_done' job
+000120b0: 7320 696e 2070 7265 7669 6f75 7320 726f  s in previous ro
+000120c0: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
+000120d0: 2020 2020 2074 656d 7020 3d20 2864 665f       temp = (df_
+000120e0: 6a6f 625b 2768 6173 5f73 7562 6d69 7474  job['has_submitt
+000120f0: 6564 275d 2920 2620 2864 665f 6a6f 625b  ed']) & (df_job[
+00012100: 2769 735f 646f 6e65 275d 290a 2020 2020  'is_done']).    
+00012110: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+00012120: 5f69 6e64 6578 5f6a 6f62 5f69 735f 646f  _index_job_is_do
+00012130: 6e65 203d 2064 665f 6a6f 622e 696e 6465  ne = df_job.inde
+00012140: 785b 7465 6d70 5d2e 746f 6c69 7374 2829  x[temp].tolist()
+00012150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012160: 2066 6f72 2069 5f6a 6f62 2069 6e20 6c69   for i_job in li
+00012170: 7374 5f69 6e64 6578 5f6a 6f62 5f69 735f  st_index_job_is_
+00012180: 646f 6e65 3a0a 2020 2020 2020 2020 2020  done:.          
+00012190: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+000121a0: 6261 7369 6320 696e 666f 726d 6174 696f  basic informatio
+000121b0: 6e20 666f 7220 7468 6973 206a 6f62 3a0a  n for this job:.
+000121c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121d0: 2020 2020 6a6f 625f 6964 203d 2064 665f      job_id = df_
+000121e0: 6a6f 622e 6174 5b69 5f6a 6f62 2c20 226a  job.at[i_job, "j
+000121f0: 6f62 5f69 6422 5d0a 2020 2020 2020 2020  ob_id"].        
+00012200: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
+00012210: 6964 5f73 7472 203d 2073 7472 286a 6f62  id_str = str(job
+00012220: 5f69 6429 0a20 2020 2020 2020 2020 2020  _id).           
+00012230: 2020 2020 2020 2020 206c 6f67 5f66 696c           log_fil
+00012240: 656e 616d 6520 3d20 6466 5f6a 6f62 2e61  ename = df_job.a
+00012250: 745b 695f 6a6f 622c 2022 6c6f 675f 6669  t[i_job, "log_fi
+00012260: 6c65 6e61 6d65 225d 2020 2320 7769 7468  lename"]  # with
+00012270: 2022 2a22 0a20 2020 2020 2020 2020 2020   "*".           
+00012280: 2020 2020 2020 2020 206c 6f67 5f66 6e20           log_fn 
+00012290: 3d20 6f70 2e6a 6f69 6e28 7365 6c66 2e61  = op.join(self.a
+000122a0: 6e61 6c79 7369 735f 7061 7468 2c20 226c  nalysis_path, "l
+000122b0: 6f67 7322 2c20 6c6f 675f 6669 6c65 6e61  ogs", log_filena
+000122c0: 6d65 2920 2023 2061 6273 2070 6174 680a  me)  # abs path.
+000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122e0: 2020 2020 6f5f 666e 203d 206c 6f67 5f66      o_fn = log_f
+000122f0: 6e2e 7265 706c 6163 6528 222e 2a22 2c20  n.replace(".*", 
+00012300: 222e 6f22 290a 0a20 2020 2020 2020 2020  ".o")..         
+00012310: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00012320: 6c66 2e74 7970 655f 7365 7373 696f 6e20  lf.type_session 
+00012330: 3d3d 2022 7369 6e67 6c65 2d73 6573 223a  == "single-ses":
+00012340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012350: 2020 2020 2020 2020 2073 7562 203d 2064           sub = d
+00012360: 665f 6a6f 622e 6174 5b69 5f6a 6f62 2c20  f_job.at[i_job, 
+00012370: 2273 7562 5f69 6422 5d0a 2020 2020 2020  "sub_id"].      
+00012380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012390: 2020 7365 7320 3d20 4e6f 6e65 0a20 2020    ses = None.   
+000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123b0: 2020 2020 2062 7261 6e63 686e 616d 6520       branchname 
+000123c0: 3d20 226a 6f62 2d22 202b 206a 6f62 5f69  = "job-" + job_i
+000123d0: 645f 7374 7220 2b20 222d 2220 2b20 7375  d_str + "-" + su
+000123e0: 620a 2020 2020 2020 2020 2020 2020 2020  b.              
+000123f0: 2020 2020 2020 2020 2020 2320 652e 672e            # e.g.
+00012400: 2c20 6a6f 622d 3030 3030 302d 7375 622d  , job-00000-sub-
+00012410: 3031 0a20 2020 2020 2020 2020 2020 2020  01.             
+00012420: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00012430: 2e74 7970 655f 7365 7373 696f 6e20 3d3d  .type_session ==
+00012440: 2022 6d75 6c74 692d 7365 7322 3a0a 2020   "multi-ses":.  
+00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012460: 2020 2020 2020 7375 6220 3d20 6466 5f6a        sub = df_j
+00012470: 6f62 2e61 745b 695f 6a6f 622c 2022 7375  ob.at[i_job, "su
+00012480: 625f 6964 225d 0a20 2020 2020 2020 2020  b_id"].         
+00012490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000124a0: 6573 203d 2064 665f 6a6f 622e 6174 5b69  es = df_job.at[i
+000124b0: 5f6a 6f62 2c20 2273 6573 5f69 6422 5d0a  _job, "ses_id"].
+000124c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124d0: 2020 2020 2020 2020 6272 616e 6368 6e61          branchna
+000124e0: 6d65 203d 2022 6a6f 622d 2220 2b20 6a6f  me = "job-" + jo
+000124f0: 625f 6964 5f73 7472 202b 2022 2d22 202b  b_id_str + "-" +
+00012500: 2073 7562 202b 2022 2d22 202b 2073 6573   sub + "-" + ses
+00012510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012520: 2020 2020 2020 2020 2023 2065 2e67 2e2c           # e.g.,
+00012530: 206a 6f62 2d30 3030 3030 2d73 7562 2d30   job-00000-sub-0
+00012540: 312d 7365 732d 420a 0a20 2020 2020 2020  1-ses-B..       
+00012550: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00012560: 6865 636b 2069 6620 7265 7375 626d 6973  heck if resubmis
+00012570: 7369 6f6e 206f 6620 7468 6973 206a 6f62  sion of this job
+00012580: 2069 7320 7265 7175 6573 7465 643a 0a20   is requested:. 
+00012590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125a0: 2020 2069 665f 7265 7175 6573 745f 7265     if_request_re
+000125b0: 7375 626d 6974 5f74 6869 735f 6a6f 6220  submit_this_job 
+000125c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000125d0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+000125e0: 665f 7265 7375 626d 6974 5f6a 6f62 5f73  f_resubmit_job_s
+000125f0: 7065 6369 6669 6320 6973 206e 6f74 204e  pecific is not N
+00012600: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012610: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00012620: 7365 6c66 2e74 7970 655f 7365 7373 696f  self.type_sessio
+00012630: 6e20 3d3d 2022 7369 6e67 6c65 2d73 6573  n == "single-ses
+00012640: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00012650: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00012660: 656d 7020 3d20 6466 5f72 6573 7562 6d69  emp = df_resubmi
+00012670: 745f 6a6f 625f 7370 6563 6966 6963 5b27  t_job_specific['
+00012680: 7375 625f 6964 275d 203d 3d20 7375 620a  sub_id'] == sub.
+00012690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126a0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+000126b0: 662e 7479 7065 5f73 6573 7369 6f6e 203d  f.type_session =
+000126c0: 3d20 226d 756c 7469 2d73 6573 223a 0a20  = "multi-ses":. 
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
+000126f0: 3d20 2864 665f 7265 7375 626d 6974 5f6a  = (df_resubmit_j
+00012700: 6f62 5f73 7065 6369 6669 635b 2773 7562  ob_specific['sub
+00012710: 5f69 6427 5d20 3d3d 2073 7562 2920 2620  _id'] == sub) & 
+00012720: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00012730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012740: 2020 2864 665f 7265 7375 626d 6974 5f6a    (df_resubmit_j
+00012750: 6f62 5f73 7065 6369 6669 635b 2773 6573  ob_specific['ses
+00012760: 5f69 6427 5d20 3d3d 2073 6573 290a 0a20  _id'] == ses).. 
+00012770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012780: 2020 2020 2020 2069 6620 616e 7928 7465         if any(te
+00012790: 6d70 293a 2020 2023 2061 6e79 206d 6174  mp):   # any mat
+000127a0: 6368 6564 3b20 6074 656d 7060 2069 7320  ched; `temp` is 
+000127b0: 7064 2e53 6572 6965 7320 6f66 2054 7275  pd.Series of Tru
+000127c0: 6520 6f72 2046 616c 7365 0a20 2020 2020  e or False.     
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127e0: 2020 2020 2020 2069 665f 7265 7175 6573         if_reques
+000127f0: 745f 7265 7375 626d 6974 5f74 6869 735f  t_resubmit_this_
+00012800: 6a6f 6220 3d20 5472 7565 0a20 2020 2020  job = True.     
+00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012820: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
+00012830: 6465 6275 6767 696e 6720 7075 7270 6f73  debugging purpos
+00012840: 653a 2072 6571 7565 7374 2074 6f20 7265  e: request to re
+00012850: 7375 626d 6974 206a 6f62 3a22 202b 2073  submit job:" + s
+00012860: 7562 202b 2022 2c20 2220 2b20 7365 7329  ub + ", " + ses)
+00012870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012880: 2020 2020 2020 2020 2020 2020 2023 205e               # ^
+00012890: 5e20 6f6e 6c79 2066 6f72 206d 756c 7469  ^ only for multi
+000128a0: 2d73 6573 0a0a 2020 2020 2020 2020 2020  -ses..          
+000128b0: 2020 2020 2020 2020 2020 2320 6966 2077            # if w
+000128c0: 616e 7420 746f 2072 6573 7562 6d69 742c  ant to resubmit,
+000128d0: 2062 7574 2060 2d2d 7265 636b 6c65 7373   but `--reckless
+000128e0: 6020 6973 204e 4f54 2073 7065 6369 6669  ` is NOT specifi
+000128f0: 6564 3a20 7072 696e 7420 6d73 673a 0a20  ed: print msg:. 
 00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012910: 2020 2020 2020 2020 2020 2b20 2220 4241            + " BA
-00012920: 4253 2077 6f6e 2774 2072 6573 7562 6d69  BS won't resubmi
-00012930: 7420 7468 6973 206a 6f62 2e22 0a20 2020  t this job.".   
-00012940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012950: 2020 2020 2023 204e 4f54 453a 2072 656d       # NOTE: rem
-00012960: 6f76 6564 2022 616e 6420 602d 2d72 6563  oved "and `--rec
-00012970: 6b6c 6573 7360 2077 6173 206e 6f74 2073  kless` was not s
-00012980: 7065 6369 6669 6564 2c20 220a 2020 2020  pecified, ".    
+00012910: 2020 2069 6620 6966 5f72 6571 7565 7374     if if_request
+00012920: 5f72 6573 7562 6d69 745f 7468 6973 5f6a  _resubmit_this_j
+00012930: 6f62 2026 2028 6e6f 7420 7265 636b 6c65  ob & (not reckle
+00012940: 7373 293a 0a20 2020 2020 2020 2020 2020  ss):.           
+00012950: 2020 2020 2020 2020 2020 2020 2074 6f5f               to_
+00012960: 7072 696e 7420 3d20 2241 6c74 686f 7567  print = "Althoug
+00012970: 6820 7265 7375 626d 6973 7369 6f6e 2066  h resubmission f
+00012980: 6f72 206a 6f62 3a20 2220 2b20 7375 620a  or job: " + sub.
 00012990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129a0: 2020 2020 2320 2020 6361 6e20 6164 6420      #   can add 
-000129b0: 7468 6973 205e 5e20 6261 636b 2061 6674  this ^^ back aft
-000129c0: 6572 2073 7570 706f 7274 696e 6720 602d  er supporting `-
-000129d0: 2d72 6563 6b6c 6573 7360 2069 6e20 434c  -reckless` in CL
-000129e0: 490a 2020 2020 2020 2020 2020 2020 2020  I.              
-000129f0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00012a00: 6773 2e77 6172 6e28 746f 5f70 7269 6e74  gs.warn(to_print
-00012a10: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012a20: 2020 2020 2020 2023 2069 6620 7265 7375         # if resu
-00012a30: 626d 6974 2069 7320 7265 7175 6573 7465  bmit is requeste
-00012a40: 642c 2061 6e64 2060 2d2d 7265 636b 6c65  d, and `--reckle
-00012a50: 7373 6020 6973 2073 7065 6369 6669 6564  ss` is specified
-00012a60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012a70: 2020 2020 2020 6966 2069 665f 7265 7175        if if_requ
-00012a80: 6573 745f 7265 7375 626d 6974 5f74 6869  est_resubmit_thi
-00012a90: 735f 6a6f 6220 2620 7265 636b 6c65 7373  s_job & reckless
-00012aa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012ab0: 2020 2020 2020 2020 2020 2320 5265 7375            # Resu
-00012ac0: 626d 6974 3a0a 2020 2020 2020 2020 2020  bmit:.          
-00012ad0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00012ae0: 6469 645f 7265 7375 626d 6974 203d 2054  did_resubmit = T
-00012af0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00012b00: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00012b10: 696e 7420 6120 6d65 7373 6167 653a 0a20  int a message:. 
-00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b30: 2020 2020 2020 2074 6f5f 7072 696e 7420         to_print 
-00012b40: 3d20 2252 6573 7562 6d69 7420 6a6f 6220  = "Resubmit job 
-00012b50: 666f 7220 2220 2b20 7375 620a 2020 2020  for " + sub.    
-00012b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b70: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-00012b80: 5f73 6573 7369 6f6e 203d 3d20 226d 756c  _session == "mul
-00012b90: 7469 2d73 6573 223a 0a20 2020 2020 2020  ti-ses":.       
-00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bb0: 2020 2020 2074 6f5f 7072 696e 7420 2b3d       to_print +=
-00012bc0: 2022 2c20 2220 2b20 7365 730a 2020 2020   ", " + ses.    
-00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012be0: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
-00012bf0: 222c 2061 6c74 686f 7567 6820 6974 2069  ", although it i
-00012c00: 7320 646f 6e65 2c22 205c 0a20 2020 2020  s done," \.     
-00012c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c20: 2020 2020 2020 202b 2022 2072 6573 7562         + " resub
-00012c30: 6d69 7420 666f 7220 7468 6973 206a 6f62  mit for this job
-00012c40: 2077 6173 2072 6571 7565 7374 6564 2220   was requested" 
-00012c50: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00012c60: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00012c70: 2220 616e 6420 602d 2d72 6563 6b6c 6573  " and `--reckles
-00012c80: 7360 2077 6173 2073 7065 6369 6669 6564  s` was specified
-00012c90: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00012ca0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012cb0: 2874 6f5f 7072 696e 7429 0a0a 2020 2020  (to_print)..    
-00012cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cd0: 2020 2020 2320 544f 444f 3a20 6465 6c65      # TODO: dele
-00012ce0: 7465 2074 6865 206f 7269 6769 6e61 6c20  te the original 
-00012cf0: 6272 616e 6368 3f0a 0a20 2020 2020 2020  branch?..       
-00012d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d10: 2023 206b 696c 6c20 6f72 6967 696e 616c   # kill original
-00012d20: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
-00012d30: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-00012d40: 635f 6b69 6c6c 203d 2073 7562 7072 6f63  c_kill = subproc
-00012d50: 6573 732e 7275 6e28 0a20 2020 2020 2020  ess.run(.       
+000129a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000129b0: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
+000129c0: 226d 756c 7469 2d73 6573 223a 0a20 2020  "multi-ses":.   
+000129d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129e0: 2020 2020 2020 2020 2074 6f5f 7072 696e           to_prin
+000129f0: 7420 2b3d 2022 2c20 2220 2b20 7365 730a  t += ", " + ses.
+00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a10: 2020 2020 2020 2020 746f 5f70 7269 6e74          to_print
+00012a20: 202b 3d20 2220 7761 7320 7265 7175 6573   += " was reques
+00012a30: 7465 642c 2061 7320 7468 6973 206a 6f62  ted, as this job
+00012a40: 2069 7320 646f 6e65 2c22 205c 0a20 2020   is done," \.   
+00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a60: 2020 2020 2020 2020 202b 2022 2042 4142           + " BAB
+00012a70: 5320 776f 6e27 7420 7265 7375 626d 6974  S won't resubmit
+00012a80: 2074 6869 7320 6a6f 622e 220a 2020 2020   this job.".    
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 2020 2320 4e4f 5445 3a20 7265 6d6f      # NOTE: remo
+00012ab0: 7665 6420 2261 6e64 2060 2d2d 7265 636b  ved "and `--reck
+00012ac0: 6c65 7373 6020 7761 7320 6e6f 7420 7370  less` was not sp
+00012ad0: 6563 6966 6965 642c 2022 0a20 2020 2020  ecified, ".     
+00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012af0: 2020 2023 2020 2063 616e 2061 6464 2074     #   can add t
+00012b00: 6869 7320 5e5e 2062 6163 6b20 6166 7465  his ^^ back afte
+00012b10: 7220 7375 7070 6f72 7469 6e67 2060 2d2d  r supporting `--
+00012b20: 7265 636b 6c65 7373 6020 696e 2043 4c49  reckless` in CLI
+00012b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012b40: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00012b50: 732e 7761 726e 2874 6f5f 7072 696e 7429  s.warn(to_print)
+00012b60: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012b70: 2020 2020 2020 2320 6966 2072 6573 7562        # if resub
+00012b80: 6d69 7420 6973 2072 6571 7565 7374 6564  mit is requested
+00012b90: 2c20 616e 6420 602d 2d72 6563 6b6c 6573  , and `--reckles
+00012ba0: 7360 2069 7320 7370 6563 6966 6965 643a  s` is specified:
+00012bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012bc0: 2020 2020 2069 6620 6966 5f72 6571 7565       if if_reque
+00012bd0: 7374 5f72 6573 7562 6d69 745f 7468 6973  st_resubmit_this
+00012be0: 5f6a 6f62 2026 2072 6563 6b6c 6573 733a  _job & reckless:
+00012bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c00: 2020 2020 2020 2020 2023 2052 6573 7562           # Resub
+00012c10: 6d69 743a 0a20 2020 2020 2020 2020 2020  mit:.           
+00012c20: 2020 2020 2020 2020 2020 2020 2023 2064               # d
+00012c30: 6964 5f72 6573 7562 6d69 7420 3d20 5472  id_resubmit = Tr
+00012c40: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00012c50: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00012c60: 6e74 2061 206d 6573 7361 6765 3a0a 2020  nt a message:.  
+00012c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c80: 2020 2020 2020 746f 5f70 7269 6e74 203d        to_print =
+00012c90: 2022 5265 7375 626d 6974 206a 6f62 2066   "Resubmit job f
+00012ca0: 6f72 2022 202b 2073 7562 0a20 2020 2020  or " + sub.     
+00012cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cc0: 2020 2069 6620 7365 6c66 2e74 7970 655f     if self.type_
+00012cd0: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
+00012ce0: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d00: 2020 2020 746f 5f70 7269 6e74 202b 3d20      to_print += 
+00012d10: 222c 2022 202b 2073 6573 0a20 2020 2020  ", " + ses.     
+00012d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d30: 2020 2074 6f5f 7072 696e 7420 2b3d 2022     to_print += "
+00012d40: 2c20 616c 7468 6f75 6768 2069 7420 6973  , although it is
+00012d50: 2064 6f6e 652c 2220 5c0a 2020 2020 2020   done," \.      
 00012d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d70: 2020 2020 205b 2271 6465 6c22 2c20 6a6f       ["qdel", jo
-00012d80: 625f 6964 5f73 7472 5d2c 0a20 2020 2020  b_id_str],.     
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012da0: 2020 2020 2020 2073 7464 6f75 743d 7375         stdout=su
-00012db0: 6270 726f 6365 7373 2e50 4950 450a 2020  bprocess.PIPE.  
-00012dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dd0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00012de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012df0: 7072 6f63 5f6b 696c 6c2e 6368 6563 6b5f  proc_kill.check_
-00012e00: 7265 7475 726e 636f 6465 2829 0a20 2020  returncode().   
+00012d70: 2020 2020 2020 2b20 2220 7265 7375 626d        + " resubm
+00012d80: 6974 2066 6f72 2074 6869 7320 6a6f 6220  it for this job 
+00012d90: 7761 7320 7265 7175 6573 7465 6422 205c  was requested" \
+00012da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012db0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00012dc0: 2061 6e64 2060 2d2d 7265 636b 6c65 7373   and `--reckless
+00012dd0: 6020 7761 7320 7370 6563 6966 6965 642e  ` was specified.
+00012de0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00012df0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00012e00: 746f 5f70 7269 6e74 290a 0a20 2020 2020  to_print)..     
 00012e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e20: 2020 2020 2023 2073 7562 6d69 7420 6e65       # submit ne
-00012e30: 7720 6f6e 653a 0a20 2020 2020 2020 2020  w one:.         
-00012e40: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-00012e50: 6f62 5f69 645f 7570 6461 7465 642c 205f  ob_id_updated, _
-00012e60: 2c20 6c6f 675f 6669 6c65 6e61 6d65 203d  , log_filename =
-00012e70: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012e90: 7562 6d69 745f 6f6e 655f 6a6f 6228 7365  ubmit_one_job(se
-00012ea0: 6c66 2e61 6e61 6c79 7369 735f 7061 7468  lf.analysis_path
-00012eb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ed0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012ee0: 662e 7479 7065 5f73 6573 7369 6f6e 2c0a  f.type_session,.
+00012e20: 2020 2023 2054 4f44 4f3a 2064 656c 6574     # TODO: delet
+00012e30: 6520 7468 6520 6f72 6967 696e 616c 2062  e the original b
+00012e40: 7261 6e63 683f 0a0a 2020 2020 2020 2020  ranch?..        
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2320 6b69 6c6c 206f 7269 6769 6e61 6c20  # kill original 
+00012e70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00012e80: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00012e90: 5f6b 696c 6c20 3d20 7375 6270 726f 6365  _kill = subproce
+00012ea0: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ec0: 2020 2020 5b67 6574 5f63 6d64 5f63 616e      [get_cmd_can
+00012ed0: 6365 6c5f 6a6f 6228 7365 6c66 2e74 7970  cel_job(self.typ
+00012ee0: 655f 7379 7374 656d 292c 0a20 2020 2020  e_system),.     
 00012ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012f20: 7479 7065 5f73 7973 7465 6d2c 0a20 2020  type_system,.   
+00012f00: 2020 2020 2020 2020 6a6f 625f 6964 5f73          job_id_s
+00012f10: 7472 5d2c 2020 2023 2065 2e67 2e2c 2060  tr],   # e.g., `
+00012f20: 7164 656c 203c 6a6f 625f 6964 3e60 0a20  qdel <job_id>`. 
 00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f50: 2020 2020 2020 2020 7375 622c 2073 6573          sub, ses
-00012f60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012f70: 2020 2020 2020 2020 2020 2320 7570 6461            # upda
-00012f80: 7465 2066 6965 6c64 733a 0a20 2020 2020  te fields:.     
-00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fa0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-00012fb0: 6420 3d20 6466 5f75 7064 6174 655f 6f6e  d = df_update_on
-00012fc0: 655f 6a6f 6228 6466 5f6a 6f62 5f75 7064  e_job(df_job_upd
-00012fd0: 6174 6564 2c20 695f 6a6f 622c 206a 6f62  ated, i_job, job
-00012fe0: 5f69 645f 7570 6461 7465 642c 0a20 2020  _id_updated,.   
-00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013020: 2020 2020 2020 2020 6c6f 675f 6669 6c65          log_file
-00013030: 6e61 6d65 2c20 646f 6e65 3d46 616c 7365  name, done=False
-00013040: 2c20 6465 6275 673d 5472 7565 290a 2020  , debug=True).  
-00013050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013060: 2020 656c 7365 3a20 2020 2023 2064 6964    else:    # did
-00013070: 206e 6f74 2072 6571 7565 7374 2072 6573   not request res
-00013080: 7562 6d69 742c 206f 7220 602d 2d72 6563  ubmit, or `--rec
-00013090: 6b6c 6573 7360 2069 7320 4e6f 6e65 3a0a  kless` is None:.
+00012f40: 2020 2020 2020 2020 2020 2073 7464 6f75             stdou
+00012f50: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
+00012f60: 450a 2020 2020 2020 2020 2020 2020 2020  E.              
+00012f70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00012f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f90: 2020 2020 7072 6f63 5f6b 696c 6c2e 6368      proc_kill.ch
+00012fa0: 6563 6b5f 7265 7475 726e 636f 6465 2829  eck_returncode()
+00012fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012fc0: 2020 2020 2020 2020 2023 2073 7562 6d69           # submi
+00012fd0: 7420 6e65 7720 6f6e 653a 0a20 2020 2020  t new one:.     
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 2020 206a 6f62 5f69 645f 7570 6461 7465     job_id_update
+00013000: 642c 205f 2c20 6c6f 675f 6669 6c65 6e61  d, _, log_filena
+00013010: 6d65 203d 205c 0a20 2020 2020 2020 2020  me = \.         
+00013020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013030: 2020 2073 7562 6d69 745f 6f6e 655f 6a6f     submit_one_jo
+00013040: 6228 7365 6c66 2e61 6e61 6c79 7369 735f  b(self.analysis_
+00013050: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
+00013060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013080: 2073 656c 662e 7479 7065 5f73 6573 7369   self.type_sessi
+00013090: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
 000130a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130b0: 2020 2020 2020 2020 2320 6a75 7374 2070          # just p
-000130c0: 6572 666f 726d 206e 6f72 6d61 6c20 7374  erform normal st
-000130d0: 7566 6620 666f 7220 6120 7375 6363 6573  uff for a succes
-000130e0: 7366 756c 206a 6f62 3a0a 2020 2020 2020  sful job:.      
-000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013100: 2020 2320 5570 6461 7465 2074 6865 2022    # Update the "
-00013110: 6c61 7374 5f6c 696e 655f 7374 646f 7574  last_line_stdout
-00013120: 5f66 696c 6522 3a0a 2020 2020 2020 2020  _file":.        
+000130b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000130c0: 656c 662e 7479 7065 5f73 7973 7465 6d2c  elf.type_system,
+000130d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000130e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130f0: 2020 2020 2020 2020 2020 2020 7375 622c              sub,
+00013100: 2073 6573 290a 2020 2020 2020 2020 2020   ses).          
+00013110: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00013120: 7570 6461 7465 2066 6965 6c64 733a 0a20  update fields:. 
 00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013140: 6466 5f6a 6f62 5f75 7064 6174 6564 2e61  df_job_updated.a
-00013150: 745b 695f 6a6f 622c 2022 6c61 7374 5f6c  t[i_job, "last_l
-00013160: 696e 655f 7374 646f 7574 5f66 696c 6522  ine_stdout_file"
-00013170: 5d20 3d20 5c0a 2020 2020 2020 2020 2020  ] = \.          
-00013180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013190: 2020 6765 745f 6c61 7374 5f6c 696e 6528    get_last_line(
-000131a0: 6f5f 666e 290a 2020 2020 2020 2020 2020  o_fn).          
-000131b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000131c0: 4368 6563 6b20 6966 2061 6e79 2061 6c65  Check if any ale
-000131d0: 7274 206d 6573 7361 6765 2069 6e20 6c6f  rt message in lo
-000131e0: 6720 6669 6c65 7320 666f 7220 7468 6973  g files for this
-000131f0: 206a 6f62 3a0a 2020 2020 2020 2020 2020   job:.          
-00013200: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00013210: 2020 7468 6973 2069 7320 746f 2075 7064    this is to upd
-00013220: 6174 6520 6061 6c65 7274 5f6d 6573 7361  ate `alert_messa
-00013230: 6765 6020 696e 2063 6173 6520 7573 6572  ge` in case user
-00013240: 2063 6861 6e67 6573 2063 6f6e 6669 6773   changes configs
-00013250: 2069 6e20 7961 6d6c 0a20 2020 2020 2020   in yaml.       
-00013260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013270: 2061 6c65 7274 5f6d 6573 7361 6765 5f69   alert_message_i
-00013280: 6e5f 6c6f 675f 6669 6c65 732c 2069 665f  n_log_files, if_
-00013290: 6e6f 5f61 6c65 7274 5f69 6e5f 6c6f 672c  no_alert_in_log,
-000132a0: 205f 203d 205c 0a20 2020 2020 2020 2020   _ = \.         
-000132b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132c0: 2020 2067 6574 5f61 6c65 7274 5f6d 6573     get_alert_mes
-000132d0: 7361 6765 5f69 6e5f 6c6f 675f 6669 6c65  sage_in_log_file
-000132e0: 7328 636f 6e66 6967 5f6d 7367 5f61 6c65  s(config_msg_ale
-000132f0: 7274 2c20 6c6f 675f 666e 290a 2020 2020  rt, log_fn).    
-00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013310: 2020 2020 2320 5e5e 2074 6865 2066 756e      # ^^ the fun
-00013320: 6374 696f 6e20 7769 6c6c 2068 616e 646c  ction will handl
-00013330: 6520 6576 656e 2069 6620 6063 6f6e 6669  e even if `confi
-00013340: 675f 6d73 675f 616c 6572 743d 4e6f 6e65  g_msg_alert=None
-00013350: 600a 2020 2020 2020 2020 2020 2020 2020  `.              
-00013360: 2020 2020 2020 2020 2020 6466 5f6a 6f62            df_job
-00013370: 5f75 7064 6174 6564 2e61 745b 695f 6a6f  _updated.at[i_jo
-00013380: 622c 2022 616c 6572 745f 6d65 7373 6167  b, "alert_messag
-00013390: 6522 5d20 3d20 5c0a 2020 2020 2020 2020  e"] = \.        
+00013140: 2020 2020 2020 2064 665f 6a6f 625f 7570         df_job_up
+00013150: 6461 7465 6420 3d20 6466 5f75 7064 6174  dated = df_updat
+00013160: 655f 6f6e 655f 6a6f 6228 6466 5f6a 6f62  e_one_job(df_job
+00013170: 5f75 7064 6174 6564 2c20 695f 6a6f 622c  _updated, i_job,
+00013180: 206a 6f62 5f69 645f 7570 6461 7465 642c   job_id_updated,
+00013190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131c0: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
+000131d0: 6669 6c65 6e61 6d65 2c20 646f 6e65 3d46  filename, done=F
+000131e0: 616c 7365 2c20 6465 6275 673d 5472 7565  alse, debug=True
+000131f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013200: 2020 2020 2020 656c 7365 3a20 2020 2023        else:    #
+00013210: 2064 6964 206e 6f74 2072 6571 7565 7374   did not request
+00013220: 2072 6573 7562 6d69 742c 206f 7220 602d   resubmit, or `-
+00013230: 2d72 6563 6b6c 6573 7360 2069 7320 4e6f  -reckless` is No
+00013240: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00013250: 2020 2020 2020 2020 2020 2020 2320 6a75              # ju
+00013260: 7374 2070 6572 666f 726d 206e 6f72 6d61  st perform norma
+00013270: 6c20 7374 7566 6620 666f 7220 6120 7375  l stuff for a su
+00013280: 6363 6573 7366 756c 206a 6f62 3a0a 2020  ccessful job:.  
+00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132a0: 2020 2020 2020 2320 5570 6461 7465 2074        # Update t
+000132b0: 6865 2022 6c61 7374 5f6c 696e 655f 7374  he "last_line_st
+000132c0: 646f 7574 5f66 696c 6522 3a0a 2020 2020  dout_file":.    
+000132d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132e0: 2020 2020 6466 5f6a 6f62 5f75 7064 6174      df_job_updat
+000132f0: 6564 2e61 745b 695f 6a6f 622c 2022 6c61  ed.at[i_job, "la
+00013300: 7374 5f6c 696e 655f 7374 646f 7574 5f66  st_line_stdout_f
+00013310: 696c 6522 5d20 3d20 5c0a 2020 2020 2020  ile"] = \.      
+00013320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013330: 2020 2020 2020 6765 745f 6c61 7374 5f6c        get_last_l
+00013340: 696e 6528 6f5f 666e 290a 2020 2020 2020  ine(o_fn).      
+00013350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013360: 2020 2320 4368 6563 6b20 6966 2061 6e79    # Check if any
+00013370: 2061 6c65 7274 206d 6573 7361 6765 2069   alert message i
+00013380: 6e20 6c6f 6720 6669 6c65 7320 666f 7220  n log files for 
+00013390: 7468 6973 206a 6f62 3a0a 2020 2020 2020  this job:.      
 000133a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133b0: 2020 2020 616c 6572 745f 6d65 7373 6167      alert_messag
-000133c0: 655f 696e 5f6c 6f67 5f66 696c 6573 0a20  e_in_log_files. 
-000133d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000133e0: 2044 6f6e 653a 2027 6973 5f64 6f6e 6527   Done: 'is_done'
-000133f0: 206a 6f62 732e 0a0a 2020 2020 2020 2020   jobs...        
-00013400: 2020 2020 2020 2020 2320 466f 7220 6a6f          # For jo
-00013410: 6273 2074 6861 7420 6861 7665 6e27 7420  bs that haven't 
-00013420: 6265 656e 2073 7562 6d69 7474 6564 2079  been submitted y
-00013430: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-00013440: 2020 2020 2320 2020 6a75 7374 2074 6f20      #   just to 
-00013450: 7468 726f 7720 6f75 7420 7761 726e 696e  throw out warnin
-00013460: 6773 2069 6620 602d 2d72 6573 7562 6d69  gs if `--resubmi
-00013470: 742d 6a6f 6260 2077 6173 2072 6571 7565  t-job` was reque
-00013480: 7374 6564 2e2e 2e0a 2020 2020 2020 2020  sted....        
-00013490: 2020 2020 2020 2020 6966 2064 665f 7265          if df_re
-000134a0: 7375 626d 6974 5f6a 6f62 5f73 7065 6369  submit_job_speci
-000134b0: 6669 6320 6973 206e 6f74 204e 6f6e 653a  fic is not None:
-000134c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000134d0: 2020 2020 2023 206f 6e6c 7920 6b65 6570       # only keep
-000134e0: 2074 686f 7365 206e 6f74 2073 7562 6d69   those not submi
-000134f0: 7474 6564 3a0a 2020 2020 2020 2020 2020  tted:.          
-00013500: 2020 2020 2020 2020 2020 6466 5f6a 6f62            df_job
-00013510: 5f6e 6f74 5f73 7562 6d69 7474 6564 203d  _not_submitted =
-00013520: 2064 665f 6a6f 625b 7e64 665f 6a6f 625b   df_job[~df_job[
-00013530: 2268 6173 5f73 7562 6d69 7474 6564 225d  "has_submitted"]
-00013540: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00013550: 2020 2020 2020 2320 6f6e 6c79 206b 6565        # only kee
-00013560: 7020 636f 6c75 6d6e 7320 6f66 2060 7375  p columns of `su
-00013570: 625f 6964 6020 616e 6420 6073 6573 5f69  b_id` and `ses_i
-00013580: 6460 3a0a 2020 2020 2020 2020 2020 2020  d`:.            
-00013590: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000135a0: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
-000135b0: 2273 696e 676c 652d 7365 7322 3a0a 2020  "single-ses":.  
-000135c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135d0: 2020 2020 2020 6466 5f6a 6f62 5f6e 6f74        df_job_not
-000135e0: 5f73 7562 6d69 7474 6564 5f73 6c69 6d20  _submitted_slim 
-000135f0: 3d20 6466 5f6a 6f62 5f6e 6f74 5f73 7562  = df_job_not_sub
-00013600: 6d69 7474 6564 5b5b 2273 7562 5f69 6422  mitted[["sub_id"
-00013610: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00013620: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00013630: 2e74 7970 655f 7365 7373 696f 6e20 3d3d  .type_session ==
-00013640: 2022 6d75 6c74 692d 7365 7322 3a0a 2020   "multi-ses":.  
-00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013660: 2020 2020 2020 6466 5f6a 6f62 5f6e 6f74        df_job_not
-00013670: 5f73 7562 6d69 7474 6564 5f73 6c69 6d20  _submitted_slim 
-00013680: 3d20 6466 5f6a 6f62 5f6e 6f74 5f73 7562  = df_job_not_sub
-00013690: 6d69 7474 6564 5b5b 2273 7562 5f69 6422  mitted[["sub_id"
-000136a0: 2c20 2273 6573 5f69 6422 5d5d 0a0a 2020  , "ses_id"]]..  
-000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136c0: 2020 2320 6368 6563 6b20 6966 2060 2d2d    # check if `--
-000136d0: 7265 7375 626d 6974 2d6a 6f62 6020 7761  resubmit-job` wa
-000136e0: 7320 7265 7175 6573 7465 6420 666f 7220  s requested for 
-000136f0: 616e 7920 7468 6573 6520 6a6f 6273 3a0a  any these jobs:.
-00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013710: 2020 2020 6466 5f69 6e74 6572 7365 6374      df_intersect
-00013720: 696f 6e20 3d20 6466 5f72 6573 7562 6d69  ion = df_resubmi
-00013730: 745f 6a6f 625f 7370 6563 6966 6963 2e6d  t_job_specific.m
-00013740: 6572 6765 2864 665f 6a6f 625f 6e6f 745f  erge(df_job_not_
-00013750: 7375 626d 6974 7465 645f 736c 696d 290a  submitted_slim).
-00013760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013770: 2020 2020 6966 206c 656e 2864 665f 696e      if len(df_in
-00013780: 7465 7273 6563 7469 6f6e 2920 3e20 303a  tersection) > 0:
-00013790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000137a0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-000137b0: 732e 7761 726e 2822 4a6f 6273 2066 6f72  s.warn("Jobs for
-000137c0: 2073 6f6d 6520 6f66 2074 6865 2073 7562   some of the sub
-000137d0: 6a65 6374 7320 2861 6e64 2073 6573 7369  jects (and sessi
-000137e0: 6f6e 7329 2072 6571 7565 7374 6564 2069  ons) requested i
-000137f0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-00013800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013810: 2020 2020 2020 2020 202b 2022 2060 2d2d           + " `--
-00013820: 7265 7375 626d 6974 2d6a 6f62 6020 6861  resubmit-job` ha
-00013830: 7665 6e27 7420 6265 656e 2073 7562 6d69  ven't been submi
-00013840: 7474 6564 2079 6574 2e22 0a20 2020 2020  tted yet.".     
-00013850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013870: 202b 2022 2050 6c65 6173 6520 7573 6520   + " Please use 
-00013880: 6062 6162 732d 7375 626d 6974 6020 6669  `babs-submit` fi
-00013890: 7273 742e 2229 0a20 2020 2020 2020 2020  rst.").         
-000138a0: 2020 2020 2020 2023 2044 6f6e 653a 206a         # Done: j
-000138b0: 6f62 7320 7468 6174 2068 6176 656e 2774  obs that haven't
-000138c0: 2073 7562 6d69 7474 6564 2079 6574 0a0a   submitted yet..
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2320 4669 6e69 7368 2075 7020 6062 6162  # Finish up `bab
-000138f0: 732d 7374 6174 7573 603a 0a20 2020 2020  s-status`:.     
-00013900: 2020 2020 2020 2020 2020 2023 2023 2070             # # p
-00013910: 7269 6e74 2075 7064 6174 6564 2064 663a  rint updated df:
-00013920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013930: 2023 2070 7269 6e74 2822 2229 0a20 2020   # print("").   
-00013940: 2020 2020 2020 2020 2020 2020 2023 2077               # w
-00013950: 6974 6820 7064 2e6f 7074 696f 6e5f 636f  ith pd.option_co
-00013960: 6e74 6578 7428 2764 6973 706c 6179 2e6d  ntext('display.m
-00013970: 6178 5f72 6f77 7327 2c20 4e6f 6e65 2c0a  ax_rows', None,.
-00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013990: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000139a0: 2020 2020 2020 2020 2027 6469 7370 6c61           'displa
-000139b0: 792e 6d61 785f 636f 6c75 6d6e 7327 2c20  y.max_columns', 
-000139c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-000139d0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-000139e0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000139f0: 6469 7370 6c61 792e 7769 6474 6827 2c20  display.width', 
-00013a00: 3132 3029 3a20 2020 2320 6465 6661 756c  120):   # defaul
-00013a10: 7420 6973 2038 3020 6368 6172 6163 7465  t is 80 characte
-00013a20: 7273 2e2e 2e0a 2020 2020 2020 2020 2020  rs....          
-00013a30: 2020 2020 2020 2320 2020 2020 2320 5e5e        #     # ^^
-00013a40: 2070 7269 6e74 2061 6c6c 2063 6f6c 756d   print all colum
-00013a50: 6e73 2061 6e64 2072 6f77 7320 2877 6974  ns and rows (wit
-00013a60: 6820 7265 7475 726e 7329 0a20 2020 2020  h returns).     
-00013a70: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00013a80: 2070 7269 6e74 2864 665f 6a6f 625f 7570   print(df_job_up
-00013a90: 6461 7465 642e 6865 6164 2836 2929 0a0a  dated.head(6))..
-00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ab0: 2320 7361 7665 2075 7064 6174 6564 2064  # save updated d
-00013ac0: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-00013ad0: 2020 2064 665f 6a6f 625f 7570 6461 7465     df_job_update
-00013ae0: 642e 746f 5f63 7376 2873 656c 662e 6a6f  d.to_csv(self.jo
-00013af0: 625f 7374 6174 7573 5f70 6174 685f 6162  b_status_path_ab
-00013b00: 732c 2069 6e64 6578 3d46 616c 7365 290a  s, index=False).
-00013b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013b20: 2023 2052 6570 6f72 7420 7468 6520 6a6f   # Report the jo
-00013b30: 6220 7374 6174 7573 3a0a 2020 2020 2020  b status:.      
-00013b40: 2020 2020 2020 2020 2020 7265 706f 7274            report
-00013b50: 5f6a 6f62 5f73 7461 7475 7328 6466 5f6a  _job_status(df_j
-00013b60: 6f62 5f75 7064 6174 6564 2c20 7365 6c66  ob_updated, self
-00013b70: 2e61 6e61 6c79 7369 735f 7061 7468 2c20  .analysis_path, 
-00013b80: 636f 6e66 6967 5f6d 7367 5f61 6c65 7274  config_msg_alert
-00013b90: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-00013ba0: 7420 5469 6d65 6f75 743a 2020 2023 2061  t Timeout:   # a
-00013bb0: 6674 6572 2077 6169 7469 6e67 2066 6f72  fter waiting for
-00013bc0: 2074 696d 6520 6465 6669 6e65 6420 696e   time defined in
-00013bd0: 2060 7469 6d65 6f75 7460 3a0a 2020 2020   `timeout`:.    
-00013be0: 2020 2020 2020 2020 2320 6966 2061 6e6f          # if ano
-00013bf0: 7468 6572 2069 6e73 7461 6e63 6520 616c  ther instance al
-00013c00: 736f 2075 7365 7320 6c6f 636b 732c 2061  so uses locks, a
-00013c10: 6e64 2069 7320 6375 7272 656e 746c 7920  nd is currently 
-00013c20: 7275 6e6e 696e 672c 0a20 2020 2020 2020  running,.       
-00013c30: 2020 2020 2023 2020 2074 6865 7265 2077       #   there w
-00013c40: 696c 6c20 6265 2061 2074 696d 656f 7574  ill be a timeout
-00013c50: 2065 7272 6f72 0a20 2020 2020 2020 2020   error.         
-00013c60: 2020 2070 7269 6e74 2822 416e 6f74 6865     print("Anothe
-00013c70: 7220 696e 7374 616e 6365 206f 6620 7468  r instance of th
-00013c80: 6973 2061 7070 6c69 6361 7469 6f6e 2063  is application c
-00013c90: 7572 7265 6e74 6c79 2068 6f6c 6473 2074  urrently holds t
-00013ca0: 6865 206c 6f63 6b2e 2229 0a0a 2020 2020  he lock.")..    
-00013cb0: 6465 6620 6261 6273 5f6d 6572 6765 2873  def babs_merge(s
-00013cc0: 656c 662c 2063 6875 6e6b 5f73 697a 652c  elf, chunk_size,
-00013cd0: 2074 7269 616c 5f72 756e 293a 0a20 2020   trial_run):.   
-00013ce0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013cf0: 2054 6869 7320 6675 6e63 7469 6f6e 206d   This function m
-00013d00: 6572 6765 7320 7265 7375 6c74 7320 616e  erges results an
-00013d10: 6420 7072 6f76 656e 616e 6365 2066 726f  d provenance fro
-00013d20: 6d20 616c 6c20 7375 6363 6573 7366 756c  m all successful
-00013d30: 6c79 2066 696e 6973 6865 6420 6a6f 6273  ly finished jobs
-00013d40: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00013d50: 6574 6572 733a 0a20 2020 2020 2020 202d  eters:.        -
-00013d60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20  --------------. 
-00013d70: 2020 2020 2020 2063 6875 6e6b 5f73 697a         chunk_siz
-00013d80: 653a 2069 6e74 0a20 2020 2020 2020 2020  e: int.         
-00013d90: 2020 204e 756d 6265 7220 6f66 2062 7261     Number of bra
-00013da0: 6e63 6865 7320 696e 2061 2063 6875 6e6b  nches in a chunk
-00013db0: 2077 6865 6e20 6d65 7267 696e 6720 6174   when merging at
-00013dc0: 2061 2074 696d 652e 0a20 2020 2020 2020   a time..       
-00013dd0: 2074 7269 616c 5f72 756e 3a20 626f 6f6c   trial_run: bool
-00013de0: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
-00013df0: 7468 6572 2074 6f20 7275 6e20 6173 2061  ther to run as a
-00013e00: 2074 7269 616c 2072 756e 2077 6869 6368   trial run which
-00013e10: 2077 6f6e 2774 2070 7573 6820 7468 6520   won't push the 
-00013e20: 6d65 7267 696e 6720 6163 7469 6f6e 7320  merging actions 
-00013e30: 6261 636b 2074 6f20 6f75 7470 7574 2052  back to output R
-00013e40: 4941 2e0a 2020 2020 2020 2020 2020 2020  IA..            
-00013e50: 5468 6973 206f 7074 696f 6e20 7368 6f75  This option shou
-00013e60: 6c64 206f 6e6c 7920 6265 2075 7365 6420  ld only be used 
-00013e70: 6279 2064 6576 656c 6f70 6572 7320 666f  by developers fo
-00013e80: 7220 7465 7374 696e 6720 7075 7270 6f73  r testing purpos
-00013e90: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00013ea0: 2020 2020 2020 2069 665f 616e 795f 7761         if_any_wa
-00013eb0: 726e 696e 6720 3d20 4661 6c73 650a 2020  rning = False.  
-00013ec0: 2020 2020 2020 7365 6c66 2e77 7466 5f6b        self.wtf_k
-00013ed0: 6579 5f69 6e66 6f28 2920 2020 2320 6765  ey_info()   # ge
-00013ee0: 7420 6073 656c 662e 616e 616c 7973 6973  t `self.analysis
-00013ef0: 5f64 6174 6173 6574 5f69 6460 0a20 2020  _dataset_id`.   
-00013f00: 2020 2020 2023 2070 6174 6820 746f 2060       # path to `
-00013f10: 6d65 7267 655f 6473 603a 0a20 2020 2020  merge_ds`:.     
-00013f20: 2020 206d 6572 6765 5f64 735f 7061 7468     merge_ds_path
-00013f30: 203d 206f 702e 6a6f 696e 2873 656c 662e   = op.join(self.
-00013f40: 7072 6f6a 6563 745f 726f 6f74 2c20 226d  project_root, "m
-00013f50: 6572 6765 5f64 7322 290a 0a20 2020 2020  erge_ds")..     
-00013f60: 2020 2069 6620 6f70 2e65 7869 7374 7328     if op.exists(
-00013f70: 6d65 7267 655f 6473 5f70 6174 6829 3a0a  merge_ds_path):.
-00013f80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00013f90: 6520 4578 6365 7074 696f 6e28 2246 6f6c  e Exception("Fol
-00013fa0: 6465 7220 276d 6572 6765 5f64 7327 2061  der 'merge_ds' a
-00013fb0: 6c72 6561 6479 2065 7869 7374 732e 2060  lready exists. `
-00013fc0: 6261 6273 2d6d 6572 6765 6020 776f 6e27  babs-merge` won'
-00013fd0: 7420 7072 6f63 6565 642e 220a 2020 2020  t proceed.".    
-00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ff0: 2020 2020 2020 2020 2220 4966 2079 6f75          " If you
-00014000: 2772 6520 7375 7265 2079 6f75 2077 616e  're sure you wan
-00014010: 7420 746f 2072 6572 756e 2060 6261 6273  t to rerun `babs
-00014020: 2d6d 6572 6765 602c 220a 2020 2020 2020  -merge`,".      
-00014030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014040: 2020 2020 2020 2220 706c 6561 7365 2072        " please r
-00014050: 656d 6f76 6520 7468 6973 2066 6f6c 6465  emove this folde
-00014060: 7220 6265 666f 7265 2079 6f75 2072 6572  r before you rer
-00014070: 756e 2060 6261 6273 2d6d 6572 6765 602e  un `babs-merge`.
-00014080: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00014090: 2020 2020 2020 2020 2020 2020 2020 2220                " 
-000140a0: 5061 7468 2074 6f20 276d 6572 6765 5f64  Path to 'merge_d
-000140b0: 7327 3a20 2722 202b 206d 6572 6765 5f64  s': '" + merge_d
-000140c0: 735f 7061 7468 202b 2022 272e 2022 290a  s_path + "'. ").
-000140d0: 0a20 2020 2020 2020 2023 2044 6566 696e  .        # Defin
-000140e0: 6520 2870 6f74 656e 7469 616c 2920 7465  e (potential) te
-000140f0: 7874 2066 696c 6573 3a0a 2020 2020 2020  xt files:.      
-00014100: 2020 2320 2020 696e 2027 6d65 7267 655f    #   in 'merge_
-00014110: 6473 2f63 6f64 6527 2066 6f6c 6465 720a  ds/code' folder.
-00014120: 2020 2020 2020 2020 2320 2020 6173 2060          #   as `
-00014130: 6d65 7267 655f 6473 6020 7368 6f75 6c64  merge_ds` should
-00014140: 206e 6f74 2065 7869 7374 2061 7420 7468   not exist at th
-00014150: 6520 6d6f 6d65 6e74 2c0a 2020 2020 2020  e moment,.      
-00014160: 2020 2320 2020 6e6f 206e 6565 6420 746f    #   no need to
-00014170: 2063 6865 636b 2065 7869 7374 656e 6365   check existence
-00014180: 2f72 656d 6f76 6520 7468 6573 6520 6669  /remove these fi
-00014190: 6c65 732e 0a20 2020 2020 2020 2023 2064  les..        # d
-000141a0: 6566 696e 6520 7061 7468 2074 6f20 7465  efine path to te
-000141b0: 7874 2066 696c 6520 6f66 2069 6e76 616c  xt file of inval
-000141c0: 6964 206a 6f62 206c 6973 7420 6578 6973  id job list exis
-000141d0: 7473 3a0a 2020 2020 2020 2020 666e 5f6c  ts:.        fn_l
-000141e0: 6973 745f 696e 7661 6c69 645f 6a6f 6273  ist_invalid_jobs
-000141f0: 203d 206f 702e 6a6f 696e 286d 6572 6765   = op.join(merge
-00014200: 5f64 735f 7061 7468 2c20 2263 6f64 6522  _ds_path, "code"
-00014210: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014230: 2020 2020 2020 2020 2022 6c69 7374 5f69           "list_i
-00014240: 6e76 616c 6964 5f6a 6f62 5f77 6865 6e5f  nvalid_job_when_
-00014250: 6d65 7267 696e 672e 7478 7422 290a 2020  merging.txt").  
-00014260: 2020 2020 2020 2320 6465 6669 6e65 2070        # define p
-00014270: 6174 6820 746f 2074 6578 7420 6669 6c65  ath to text file
-00014280: 206f 6620 6669 6c65 7320 7769 7468 206d   of files with m
-00014290: 6973 7369 6e67 2063 6f6e 7465 6e74 3a0a  issing content:.
-000142a0: 2020 2020 2020 2020 666e 5f6c 6973 745f          fn_list_
-000142b0: 636f 6e74 656e 745f 6d69 7373 696e 6720  content_missing 
-000142c0: 3d20 6f70 2e6a 6f69 6e28 6d65 7267 655f  = op.join(merge_
-000142d0: 6473 5f70 6174 682c 2022 636f 6465 222c  ds_path, "code",
-000142e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014300: 2020 2020 2020 2020 2020 2022 6c69 7374             "list
-00014310: 5f63 6f6e 7465 6e74 5f6d 6973 7369 6e67  _content_missing
-00014320: 2e74 7874 2229 0a20 2020 2020 2020 2023  .txt").        #
-00014330: 2064 6566 696e 6520 7061 7468 2074 6f20   define path to 
-00014340: 7072 696e 7465 6420 6d65 7373 6167 6573  printed messages
-00014350: 2066 726f 6d20 6067 6974 2061 6e6e 6578   from `git annex
-00014360: 2066 7363 6b60 3a0a 2020 2020 2020 2020   fsck`:.        
-00014370: 2320 5e5e 2074 6869 7320 7769 6c6c 2062  # ^^ this will b
-00014380: 6520 6162 736f 6c75 7465 6c79 2075 7365  e absolutely use
-00014390: 6420 6966 2060 6261 6273 2d6d 6572 6765  d if `babs-merge
-000143a0: 6020 646f 6573 206e 6f74 2066 6169 6c3a  ` does not fail:
-000143b0: 0a20 2020 2020 2020 2066 6e5f 6d73 675f  .        fn_msg_
-000143c0: 6673 636b 203d 206f 702e 6a6f 696e 286d  fsck = op.join(m
-000143d0: 6572 6765 5f64 735f 7061 7468 2c20 2263  erge_ds_path, "c
-000143e0: 6f64 6522 2c0a 2020 2020 2020 2020 2020  ode",.          
-000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014400: 2020 2020 226c 6f67 5f67 6974 5f61 6e6e      "log_git_ann
-00014410: 6578 5f66 7363 6b2e 7478 7422 290a 0a20  ex_fsck.txt").. 
-00014420: 2020 2020 2020 2023 2043 6c6f 6e65 206f         # Clone o
-00014430: 7574 7075 7420 5249 4120 746f 2060 6d65  utput RIA to `me
-00014440: 7267 655f 6473 603a 0a20 2020 2020 2020  rge_ds`:.       
-00014450: 2070 7269 6e74 2822 436c 6f6e 696e 6720   print("Cloning 
-00014460: 6f75 7470 7574 2052 4941 2074 6f20 276d  output RIA to 'm
-00014470: 6572 6765 5f64 7327 2e2e 2e22 290a 2020  erge_ds'...").  
-00014480: 2020 2020 2020 2320 6765 7420 7468 6520        # get the 
-00014490: 7061 7468 2074 6f20 6f75 7470 7574 2052  path to output R
-000144a0: 4941 3a0a 2020 2020 2020 2020 2320 2020  IA:.        #   
-000144b0: 2772 6961 2b66 696c 653a 2f2f 2f70 6174  'ria+file:///pat
-000144c0: 682f 746f 2f42 4142 535f 7072 6f6a 6563  h/to/BABS_projec
-000144d0: 742f 6f75 7470 7574 5f72 6961 2330 3030  t/output_ria#000
-000144e0: 3030 3030 2d30 3030 2d78 7878 2d78 7878  0000-000-xxx-xxx
-000144f0: 7878 7878 7827 0a20 2020 2020 2020 206f  xxxxx'.        o
-00014500: 7574 7075 745f 7269 615f 736f 7572 6365  utput_ria_source
-00014510: 203d 2073 656c 662e 6f75 7470 7574 5f72   = self.output_r
-00014520: 6961 5f75 726c 205c 0a20 2020 2020 2020  ia_url \.       
-00014530: 2020 2020 202b 2022 2322 202b 2073 656c       + "#" + sel
-00014540: 662e 616e 616c 7973 6973 5f64 6174 6173  f.analysis_datas
-00014550: 6574 5f69 640a 2020 2020 2020 2020 2320  et_id.        # 
-00014560: 636c 6f6e 653a 2060 6461 7461 6c61 6420  clone: `datalad 
-00014570: 636c 6f6e 6520 247b 6f75 7470 7574 736f  clone ${outputso
-00014580: 7572 6365 7d20 6d65 7267 655f 6473 600a  urce} merge_ds`.
-00014590: 2020 2020 2020 2020 646c 6170 692e 636c          dlapi.cl
-000145a0: 6f6e 6528 736f 7572 6365 3d6f 7574 7075  one(source=outpu
-000145b0: 745f 7269 615f 736f 7572 6365 2c0a 2020  t_ria_source,.  
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 7061 7468 3d6d 6572 6765 5f64 735f    path=merge_ds_
-000145e0: 7061 7468 290a 0a20 2020 2020 2020 2023  path)..        #
-000145f0: 204c 6973 7420 616c 6c20 6272 616e 6368   List all branch
-00014600: 6573 2069 6e20 6f75 7470 7574 2052 4941  es in output RIA
-00014610: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00014620: 225c 6e4c 6973 7469 6e67 2061 6c6c 2062  "\nListing all b
-00014630: 7261 6e63 6865 7320 696e 206f 7574 7075  ranches in outpu
-00014640: 7420 5249 412e 2e2e 2229 0a20 2020 2020  t RIA...").     
-00014650: 2020 2023 2067 6574 2061 6c6c 2062 7261     # get all bra
-00014660: 6e63 6865 733a 0a20 2020 2020 2020 2070  nches:.        p
-00014670: 726f 635f 6769 745f 6272 616e 6368 5f61  roc_git_branch_a
-00014680: 6c6c 203d 2073 7562 7072 6f63 6573 732e  ll = subprocess.
-00014690: 7275 6e28 0a20 2020 2020 2020 2020 2020  run(.           
-000146a0: 205b 2267 6974 222c 2022 6272 616e 6368   ["git", "branch
-000146b0: 222c 2022 2d61 225d 2c0a 2020 2020 2020  ", "-a"],.      
-000146c0: 2020 2020 2020 6377 643d 6d65 7267 655f        cwd=merge_
-000146d0: 6473 5f70 6174 682c 0a20 2020 2020 2020  ds_path,.       
-000146e0: 2020 2020 2073 7464 6f75 743d 7375 6270       stdout=subp
-000146f0: 726f 6365 7373 2e50 4950 450a 2020 2020  rocess.PIPE.    
-00014700: 2020 2020 290a 2020 2020 2020 2020 7072      ).        pr
-00014710: 6f63 5f67 6974 5f62 7261 6e63 685f 616c  oc_git_branch_al
-00014720: 6c2e 6368 6563 6b5f 7265 7475 726e 636f  l.check_returnco
-00014730: 6465 2829 0a20 2020 2020 2020 206d 7367  de().        msg
-00014740: 203d 2070 726f 635f 6769 745f 6272 616e   = proc_git_bran
-00014750: 6368 5f61 6c6c 2e73 7464 6f75 742e 6465  ch_all.stdout.de
-00014760: 636f 6465 2827 7574 662d 3827 290a 2020  code('utf-8').  
-00014770: 2020 2020 2020 6c69 7374 5f62 7261 6e63        list_branc
-00014780: 6865 735f 616c 6c20 3d20 6d73 672e 7370  hes_all = msg.sp
-00014790: 6c69 7428 290a 0a20 2020 2020 2020 2023  lit()..        #
-000147a0: 206f 6e6c 7920 6b65 6570 2074 686f 7365   only keep those
-000147b0: 2068 6176 696e 6720 7061 7474 6572 6e20   having pattern 
-000147c0: 606a 6f62 2d60 3a0a 2020 2020 2020 2020  `job-`:.        
-000147d0: 6c69 7374 5f62 7261 6e63 6865 735f 6a6f  list_branches_jo
-000147e0: 6273 203d 205b 656c 6520 666f 7220 656c  bs = [ele for el
-000147f0: 6520 696e 206c 6973 745f 6272 616e 6368  e in list_branch
-00014800: 6573 5f61 6c6c 2069 6620 226a 6f62 2d22  es_all if "job-"
-00014810: 2069 6e20 656c 655d 0a20 2020 2020 2020   in ele].       
-00014820: 2023 205e 5e20 5b22 7265 6d6f 7465 732f   # ^^ ["remotes/
-00014830: 6f72 6967 696e 2f6a 6f62 2d78 7878 222c  origin/job-xxx",
-00014840: 2022 7265 6d6f 7465 732f 6f72 6967 696e   "remotes/origin
-00014850: 2f6a 6f62 2d78 7878 222c 202e 2e2e 5d0a  /job-xxx", ...].
-00014860: 2020 2020 2020 2020 2320 2020 6974 2773          #   it's
-00014870: 206e 6f72 6d61 6c20 616e 6420 6e65 6365   normal and nece
-00014880: 7373 6172 7920 746f 2068 6176 6520 6072  ssary to have `r
-00014890: 656d 6f74 6573 2f6f 7269 6769 6e60 2e20  emotes/origin`. 
-000148a0: 5365 6520 6e6f 7465 7320 6265 6c6f 772e  See notes below.
-000148b0: 0a20 2020 2020 2020 2023 204e 4f54 453a  .        # NOTE:
-000148c0: 206f 7572 206f 7269 6769 6e61 6c20 6261   our original ba
-000148d0: 7368 2073 6372 6970 7420 666f 7220 6d65  sh script for me
-000148e0: 7267 696e 673a 2060 6d65 7267 655f 6f75  rging: `merge_ou
-000148f0: 7470 7574 735f 706f 7374 7363 7269 7074  tputs_postscript
-00014900: 2e73 6860 3a0a 2020 2020 2020 2020 2320  .sh`:.        # 
-00014910: 2020 7275 6e20 6067 6974 2062 7261 6e63    run `git branc
-00014920: 6820 2d61 207c 2067 7265 7020 6a6f 622d  h -a | grep job-
-00014930: 207c 2073 6f72 7460 2069 6e20 606d 6572   | sort` in `mer
-00014940: 6765 5f64 7360 0a20 2020 2020 2020 2023  ge_ds`.        #
-00014950: 2020 202d 2d3e 2073 686f 756c 6420 6765     --> should ge
-00014960: 7420 616c 6c20 6272 616e 6368 6573 2077  t all branches w
-00014970: 686f 7365 206e 616d 6573 2063 6f6e 7461  hose names conta
-00014980: 696e 2060 2a6a 6f62 2d2a 600a 2020 2020  in `*job-*`.    
-00014990: 2020 2020 2320 2020 652e 672e 2c20 6072      #   e.g., `r
-000149a0: 656d 6f74 6573 2f6f 7269 6769 6e2f 6a6f  emotes/origin/jo
-000149b0: 622d 7878 7860 2020 2023 2061 7320 7275  b-xxx`   # as ru
-000149c0: 6e20 696e 2060 6d65 7267 655f 6473 600a  n in `merge_ds`.
-000149d0: 2020 2020 2020 2020 2320 5368 6f75 6c64          # Should
-000149e0: 206e 6f74 2072 756e 2069 6e20 6f75 7470   not run in outp
-000149f0: 7574 2052 4941 2064 6174 6120 6469 722c  ut RIA data dir,
-00014a00: 2061 7320 796f 7527 6c6c 2067 6574 2062   as you'll get b
-00014a10: 7261 6e63 6865 7320 7769 7468 6f75 7420  ranches without 
-00014a20: 6072 656d 6f74 6573 2f6f 7269 6769 6e60  `remotes/origin`
-00014a30: 0a20 2020 2020 2020 2023 2020 202d 2d3e  .        #   -->
-00014a40: 2072 6169 7365 2065 7272 6f72 206f 6620   raise error of 
-00014a50: 226d 6572 6765 3a20 6a6f 622d 7878 7878  "merge: job-xxxx
-00014a60: 202d 206e 6f74 2073 6f6d 6574 6869 6e67   - not something
-00014a70: 2077 6520 6361 6e20 6d65 7267 6522 0a20   we can merge". 
-00014a80: 2020 2020 2020 2023 2020 2069 2e65 2e2c         #   i.e.,
-00014a90: 2063 616e 6e6f 7420 6669 6e64 2074 6865   cannot find the
-00014aa0: 2062 7261 6e63 6820 746f 206d 6572 6765   branch to merge
-00014ab0: 2e0a 0a20 2020 2020 2020 2069 6620 6c65  ...        if le
-00014ac0: 6e28 6c69 7374 5f62 7261 6e63 6865 735f  n(list_branches_
-00014ad0: 6a6f 6273 2920 3d3d 2030 3a0a 2020 2020  jobs) == 0:.    
-00014ae0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-00014af0: 6365 7074 696f 6e28 2254 6865 7265 2069  ception("There i
-00014b00: 7320 6e6f 2073 7563 6365 7373 6675 6c6c  s no successfull
-00014b10: 7920 6669 6e69 7368 6564 206a 6f62 2079  y finished job y
-00014b20: 6574 2e22 0a20 2020 2020 2020 2020 2020  et.".           
-00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b40: 2022 2050 6c65 6173 6520 7275 6e20 6062   " Please run `b
-00014b50: 6162 732d 7375 626d 6974 6020 6669 7273  abs-submit` firs
-00014b60: 742e 2229 0a0a 2020 2020 2020 2020 2320  t.")..        # 
-00014b70: 4669 6e64 2061 6c6c 2076 616c 6964 2062  Find all valid b
-00014b80: 7261 6e63 6865 7320 2869 2e65 2e2c 2074  ranches (i.e., t
-00014b90: 686f 7365 2077 6974 6820 7265 7375 6c74  hose with result
-00014ba0: 7320 2d2d 3e20 6861 7665 2064 6966 6665  s --> have diffe
-00014bb0: 7265 6e74 2053 4841 5355 4d29 3a0a 2020  rent SHASUM):.  
-00014bc0: 2020 2020 2020 7072 696e 7428 225c 6e46        print("\nF
-00014bd0: 696e 6469 6e67 2061 6c6c 2076 616c 6964  inding all valid
-00014be0: 206a 6f62 2062 7261 6e63 6865 7320 746f   job branches to
-00014bf0: 206d 6572 6765 2e2e 2e22 290a 2020 2020   merge...").    
-00014c00: 2020 2020 2320 6765 7420 6465 6661 756c      # get defaul
-00014c10: 7420 6272 616e 6368 2773 206e 616d 653a  t branch's name:
-00014c20: 206d 6173 7465 7220 6f72 206d 6169 6e3a   master or main:
-00014c30: 0a20 2020 2020 2020 2023 2020 2060 6769  .        #   `gi
-00014c40: 7420 7265 6d6f 7465 2073 686f 7720 6f72  t remote show or
-00014c50: 6967 696e 207c 2073 6564 202d 6e20 272f  igin | sed -n '/
-00014c60: 4845 4144 2062 7261 6e63 682f 732f 2e2a  HEAD branch/s/.*
-00014c70: 3a20 2f2f 7027 600a 2020 2020 2020 2020  : //p'`.        
-00014c80: 7072 6f63 5f67 6974 5f72 656d 6f74 655f  proc_git_remote_
-00014c90: 7368 6f77 5f6f 7269 6769 6e20 3d20 7375  show_origin = su
-00014ca0: 6270 726f 6365 7373 2e72 756e 280a 2020  bprocess.run(.  
-00014cb0: 2020 2020 2020 2020 2020 5b22 6769 7422            ["git"
-00014cc0: 2c20 2272 656d 6f74 6522 2c20 2273 686f  , "remote", "sho
-00014cd0: 7722 2c20 276f 7269 6769 6e27 5d2c 0a20  w", 'origin'],. 
-00014ce0: 2020 2020 2020 2020 2020 2063 7764 3d6d             cwd=m
-00014cf0: 6572 6765 5f64 735f 7061 7468 2c0a 2020  erge_ds_path,.  
-00014d00: 2020 2020 2020 2020 2020 7374 646f 7574            stdout
-00014d10: 3d73 7562 7072 6f63 6573 732e 5049 5045  =subprocess.PIPE
-00014d20: 290a 2020 2020 2020 2020 7072 6f63 5f67  ).        proc_g
-00014d30: 6974 5f72 656d 6f74 655f 7368 6f77 5f6f  it_remote_show_o
-00014d40: 7269 6769 6e2e 6368 6563 6b5f 7265 7475  rigin.check_retu
-00014d50: 726e 636f 6465 2829 0a20 2020 2020 2020  rncode().       
-00014d60: 206d 7367 203d 2070 726f 635f 6769 745f   msg = proc_git_
-00014d70: 7265 6d6f 7465 5f73 686f 775f 6f72 6967  remote_show_orig
-00014d80: 696e 2e73 7464 6f75 742e 6465 636f 6465  in.stdout.decode
-00014d90: 2827 7574 662d 3827 290a 2020 2020 2020  ('utf-8').      
-00014da0: 2020 2320 652e 672e 2c20 272e 2e2e 2048    # e.g., '... H
-00014db0: 4541 4420 6272 616e 6368 3a20 6d61 7374  EAD branch: mast
-00014dc0: 6572 5c6e 2e2e 2e2e 273a 2073 6561 7263  er\n....': searc
-00014dd0: 6820 6265 7477 6565 6e20 2748 4541 4420  h between 'HEAD 
-00014de0: 6272 616e 6368 3a20 2720 616e 6420 275c  branch: ' and '\
-00014df0: 6e27 3a0a 2020 2020 2020 2020 7465 6d70  n':.        temp
-00014e00: 203d 2072 652e 7365 6172 6368 2827 4845   = re.search('HE
-00014e10: 4144 2062 7261 6e63 683a 2027 2b27 282e  AD branch: '+'(.
-00014e20: 2b3f 2927 2b27 5c6e 272c 206d 7367 290a  +?)'+'\n', msg).
-00014e30: 2020 2020 2020 2020 6966 2074 656d 703a          if temp:
-00014e40: 2020 2023 206e 6f74 2065 6d70 7479 3a0a     # not empty:.
-00014e50: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00014e60: 756c 745f 6272 616e 6368 5f6e 616d 6520  ult_branch_name 
-00014e70: 3d20 7465 6d70 2e67 726f 7570 2831 2920  = temp.group(1) 
-00014e80: 2020 2320 7768 6174 2773 2062 6574 7765    # what's betwe
-00014e90: 656e 2074 686f 7365 2074 776f 206b 6579  en those two key
-00014ea0: 776f 7264 730a 2020 2020 2020 2020 2020  words.          
-00014eb0: 2020 2320 616e 6f74 6865 7220 7761 793a    # another way:
-00014ec0: 2060 6465 6661 756c 745f 6272 616e 6368   `default_branch
-00014ed0: 5f6e 616d 6520 3d20 6d73 672e 7370 6c69  _name = msg.spli
-00014ee0: 7428 2248 4541 4420 6272 616e 6368 3a20  t("HEAD branch: 
-00014ef0: 2229 5b31 5d2e 7370 6c69 7428 225c 6e22  ")[1].split("\n"
-00014f00: 295b 305d 600a 2020 2020 2020 2020 656c  )[0]`.        el
-00014f10: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00014f20: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-00014f30: 2254 6865 7265 2069 7320 6e6f 2048 4541  "There is no HEA
-00014f40: 4420 6272 616e 6368 2069 6e20 6f75 7470  D branch in outp
-00014f50: 7574 2052 4941 2122 290a 2020 2020 2020  ut RIA!").      
-00014f60: 2020 7072 696e 7428 2247 6974 2064 6566    print("Git def
-00014f70: 6175 6c74 2062 7261 6e63 6827 7320 6e61  ault branch's na
-00014f80: 6d65 206f 6620 6f75 7470 7574 2052 4941  me of output RIA
-00014f90: 2069 733a 2027 2220 2b20 6465 6661 756c   is: '" + defaul
-00014fa0: 745f 6272 616e 6368 5f6e 616d 6520 2b20  t_branch_name + 
-00014fb0: 2227 2229 0a0a 2020 2020 2020 2020 2320  "'")..        # 
-00014fc0: 6765 7420 6375 7272 656e 7420 6769 7420  get current git 
-00014fd0: 636f 6d6d 6974 2053 4841 5355 4d20 6265  commit SHASUM be
-00014fe0: 666f 7265 206d 6572 6769 6e67 2061 7320  fore merging as 
-00014ff0: 6120 7265 6665 7265 6e63 653a 0a20 2020  a reference:.   
-00015000: 2020 2020 2067 6974 5f72 6566 2c20 5f20       git_ref, _ 
-00015010: 3d20 6765 745f 6769 745f 7368 6f77 5f72  = get_git_show_r
-00015020: 6566 5f73 6861 7375 6d28 6465 6661 756c  ef_shasum(defaul
-00015030: 745f 6272 616e 6368 5f6e 616d 652c 206d  t_branch_name, m
-00015040: 6572 6765 5f64 735f 7061 7468 290a 0a20  erge_ds_path).. 
-00015050: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-00015060: 6620 6561 6368 206a 6f62 2062 7261 6e63  f each job branc
-00015070: 6820 6861 7320 6120 6e65 7720 636f 6d6d  h has a new comm
-00015080: 6974 0a20 2020 2020 2020 2023 2020 2074  it.        #   t
-00015090: 6861 7427 7320 6469 6666 6572 656e 7420  hat's different 
-000150a0: 6672 6f6d 2063 7572 7265 6e74 2067 6974  from current git
-000150b0: 2063 6f6d 6d69 7420 5348 4153 554d 2028   commit SHASUM (
-000150c0: 6067 6974 5f72 6566 6029 3a0a 2020 2020  `git_ref`):.    
-000150d0: 2020 2020 6c69 7374 5f62 7261 6e63 6865      list_branche
-000150e0: 735f 6e6f 5f72 6573 756c 7473 203d 205b  s_no_results = [
-000150f0: 5d0a 2020 2020 2020 2020 6c69 7374 5f62  ].        list_b
-00015100: 7261 6e63 6865 735f 7769 7468 5f72 6573  ranches_with_res
-00015110: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
-00015120: 2020 666f 7220 6272 616e 6368 5f6a 6f62    for branch_job
-00015130: 2069 6e20 6c69 7374 5f62 7261 6e63 6865   in list_branche
-00015140: 735f 6a6f 6273 3a0a 2020 2020 2020 2020  s_jobs:.        
-00015150: 2020 2020 2320 6765 7420 7468 6520 6a6f      # get the jo
-00015160: 6227 7320 6067 6974 2073 686f 772d 7265  b's `git show-re
-00015170: 6660 3a0a 2020 2020 2020 2020 2020 2020  f`:.            
-00015180: 6769 745f 7265 665f 6272 616e 6368 5f6a  git_ref_branch_j
-00015190: 6f62 2c20 5f20 3d20 5c0a 2020 2020 2020  ob, _ = \.      
-000151a0: 2020 2020 2020 2020 2020 6765 745f 6769            get_gi
-000151b0: 745f 7368 6f77 5f72 6566 5f73 6861 7375  t_show_ref_shasu
-000151c0: 6d28 6272 616e 6368 5f6a 6f62 2c20 6d65  m(branch_job, me
-000151d0: 7267 655f 6473 5f70 6174 6829 0a20 2020  rge_ds_path).   
-000151e0: 2020 2020 2020 2020 2069 6620 6769 745f           if git_
-000151f0: 7265 665f 6272 616e 6368 5f6a 6f62 203d  ref_branch_job =
-00015200: 3d20 6769 745f 7265 663a 2020 2023 206e  = git_ref:   # n
-00015210: 6f20 6e65 7720 636f 6d6d 6974 202d 2d3e  o new commit -->
-00015220: 206e 6f20 7265 7375 6c74 7320 696e 2074   no results in t
-00015230: 6869 7320 6272 616e 6368 0a20 2020 2020  his branch.     
-00015240: 2020 2020 2020 2020 2020 206c 6973 745f             list_
-00015250: 6272 616e 6368 6573 5f6e 6f5f 7265 7375  branches_no_resu
-00015260: 6c74 732e 6170 7065 6e64 2862 7261 6e63  lts.append(branc
-00015270: 685f 6a6f 6229 0a20 2020 2020 2020 2020  h_job).         
-00015280: 2020 2065 6c73 653a 2020 2023 2068 6173     else:   # has
-00015290: 2072 6573 756c 7473 3a0a 2020 2020 2020   results:.      
-000152a0: 2020 2020 2020 2020 2020 6c69 7374 5f62            list_b
-000152b0: 7261 6e63 6865 735f 7769 7468 5f72 6573  ranches_with_res
-000152c0: 756c 7473 2e61 7070 656e 6428 6272 616e  ults.append(bran
-000152d0: 6368 5f6a 6f62 290a 0a20 2020 2020 2020  ch_job)..       
-000152e0: 2023 2063 6865 636b 2069 6620 7468 6572   # check if ther
-000152f0: 6520 6973 2061 6e79 2076 616c 6964 206a  e is any valid j
-00015300: 6f62 2028 7769 7468 2072 6573 756c 7473  ob (with results
-00015310: 293a 0a20 2020 2020 2020 2069 6620 6c65  ):.        if le
-00015320: 6e28 6c69 7374 5f62 7261 6e63 6865 735f  n(list_branches_
-00015330: 7769 7468 5f72 6573 756c 7473 2920 3d3d  with_results) ==
-00015340: 2030 3a20 2020 2320 656d 7074 793a 0a20   0:   # empty:. 
-00015350: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00015360: 2045 7863 6570 7469 6f6e 2822 5468 6572   Exception("Ther
-00015370: 6520 6973 206e 6f20 6a6f 6220 6272 616e  e is no job bran
-00015380: 6368 2069 6e20 6f75 7470 7574 2052 4941  ch in output RIA
-00015390: 2074 6861 7420 6861 7320 7265 7375 6c74   that has result
-000153a0: 7320 7965 742c 220a 2020 2020 2020 2020  s yet,".        
-000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153c0: 2020 2020 2b20 2220 692e 652e 2c20 7468      + " i.e., th
-000153d0: 6572 6520 6973 206e 6f20 7375 6363 6573  ere is no succes
-000153e0: 7366 756c 6c79 2066 696e 6973 6865 6420  sfully finished 
-000153f0: 6a6f 6220 7965 742e 220a 2020 2020 2020  job yet.".      
-00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015410: 2020 2020 2020 2b20 2220 506c 6561 7365        + " Please
-00015420: 2072 756e 2060 6261 6273 2d73 7562 6d69   run `babs-submi
-00015430: 7460 2066 6972 7374 2e22 290a 0a20 2020  t` first.")..   
-00015440: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
-00015450: 7468 6572 6520 6973 2069 6e76 616c 6964  there is invalid
-00015460: 206a 6f62 2028 7769 7468 6f75 7420 7265   job (without re
-00015470: 7375 6c74 7329 3a0a 2020 2020 2020 2020  sults):.        
-00015480: 6966 206c 656e 286c 6973 745f 6272 616e  if len(list_bran
-00015490: 6368 6573 5f6e 6f5f 7265 7375 6c74 7329  ches_no_results)
-000154a0: 203e 2030 3a20 2020 2320 6e6f 7420 656d   > 0:   # not em
-000154b0: 7074 790a 2020 2020 2020 2020 2020 2020  pty.            
-000154c0: 2320 7361 7665 2074 6f20 6120 7465 7874  # save to a text
-000154d0: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
-000154e0: 2020 2023 2020 206e 6f74 653a 2074 6869     #   note: thi
-000154f0: 7320 6669 6c65 2068 6173 2062 6565 6e20  s file has been 
-00015500: 7265 6d6f 7665 6420 6174 2074 6865 2062  removed at the b
-00015510: 6567 696e 6e69 6e67 206f 6620 6261 6273  eginning of babs
-00015520: 5f6d 6572 6765 2829 2069 6620 6974 2065  _merge() if it e
-00015530: 7869 7374 6564 290a 2020 2020 2020 2020  xisted).        
-00015540: 2020 2020 6966 5f61 6e79 5f77 6172 6e69      if_any_warni
-00015550: 6e67 203d 2054 7275 650a 2020 2020 2020  ng = True.      
-00015560: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-00015570: 6172 6e28 2254 6865 7265 2061 7265 2069  arn("There are i
-00015580: 6e76 616c 6964 206a 6f62 2062 7261 6e63  nvalid job branc
-00015590: 6828 6573 2920 696e 206f 7574 7075 7420  h(es) in output 
-000155a0: 5249 412c 220a 2020 2020 2020 2020 2020  RIA,".          
-000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155c0: 2b20 2220 616e 6420 7468 6573 6520 6a6f  + " and these jo
-000155d0: 6228 7329 2064 6f20 6e6f 7420 6861 7665  b(s) do not have
-000155e0: 2072 6573 756c 7473 2e22 0a20 2020 2020   results.".     
-000155f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015600: 2020 2020 202b 2022 2054 6865 206c 6973       + " The lis
-00015610: 7420 6f66 2073 7563 6820 696e 7661 6c69  t of such invali
-00015620: 6420 6a6f 6273 2077 696c 6c20 6265 2073  d jobs will be s
-00015630: 6176 6564 2074 6f22 0a20 2020 2020 2020  aved to".       
-00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015650: 2020 202b 2022 2074 6865 2066 6f6c 6c6f     + " the follo
-00015660: 7769 6e67 2074 6578 7420 6669 6c65 3a20  wing text file: 
-00015670: 2722 202b 2066 6e5f 6c69 7374 5f69 6e76  '" + fn_list_inv
-00015680: 616c 6964 5f6a 6f62 7320 2b20 2227 2e22  alid_jobs + "'."
-00015690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000156a0: 2020 2020 2020 2020 2020 202b 2022 2050             + " P
-000156b0: 6c65 6173 6520 7265 7669 6577 2069 742e  lease review it.
-000156c0: 2229 0a20 2020 2020 2020 2020 2020 2077  ").            w
-000156d0: 6974 6820 6f70 656e 2866 6e5f 6c69 7374  ith open(fn_list
-000156e0: 5f69 6e76 616c 6964 5f6a 6f62 732c 2022  _invalid_jobs, "
-000156f0: 7722 2920 6173 2066 3a0a 2020 2020 2020  w") as f:.      
-00015700: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
-00015710: 6528 275c 6e27 2e6a 6f69 6e28 6c69 7374  e('\n'.join(list
-00015720: 5f62 7261 6e63 6865 735f 6e6f 5f72 6573  _branches_no_res
-00015730: 756c 7473 2929 0a20 2020 2020 2020 2020  ults)).         
-00015740: 2020 2020 2020 2066 2e77 7269 7465 2822         f.write("
-00015750: 5c6e 2229 2020 2023 2061 6464 2061 206e  \n")   # add a n
-00015760: 6577 206c 696e 6520 6174 2074 6865 2065  ew line at the e
-00015770: 6e64 0a20 2020 2020 2020 2023 204e 4f54  nd.        # NOT
-00015780: 4520 746f 2064 6576 656c 6f70 6572 733a  E to developers:
-00015790: 2077 6865 6e20 7465 7374 696e 6720 5e5e   when testing ^^
-000157a0: 3a0a 2020 2020 2020 2020 2320 2020 596f  :.        #   Yo
-000157b0: 7520 6361 6e20 6067 6974 2062 7261 6e63  u can `git branc
-000157c0: 6820 6a6f 622d 7465 7374 6020 696e 2060  h job-test` in `
-000157d0: 6f75 7470 7574 5f72 6961 2f30 3030 2f30  output_ria/000/0
-000157e0: 3030 2d30 3030 6020 746f 206d 616b 6520  00-000` to make 
-000157f0: 6120 6661 6b65 2062 7261 6e63 680a 2020  a fake branch.  
-00015800: 2020 2020 2020 2320 2020 2020 2020 7468        #       th
-00015810: 6174 2068 6173 2074 6865 2073 616d 6520  at has the same 
-00015820: 5348 4153 554d 2061 7320 6d61 7374 6572  SHASUM as master
-00015830: 2062 7261 6e63 6827 730a 2020 2020 2020   branch's.      
-00015840: 2020 2320 2020 2020 2020 7468 656e 2079    #       then y
-00015850: 6f75 2073 686f 756c 6420 7365 6520 6162  ou should see ab
-00015860: 6f76 6520 7761 726e 696e 672e 0a20 2020  ove warning..   
-00015870: 2020 2020 2023 2020 2048 6f77 6576 6572       #   However
-00015880: 2c20 6966 2079 6f75 2066 696e 6973 6820  , if you finish 
-00015890: 7275 6e6e 696e 6720 6062 6162 732d 6d65  running `babs-me
-000158a0: 7267 6560 2c20 7468 6973 2062 7261 6e63  rge`, this branc
-000158b0: 6820 606a 6f62 2d74 6573 7460 2077 696c  h `job-test` wil
-000158c0: 6c20 6861 7665 0a20 2020 2020 2020 2023  l have.        #
-000158d0: 2020 2020 2020 2061 202a 6469 6666 6572         a *differ
-000158e0: 656e 742a 2053 4841 5355 4d20 6672 6f6d  ent* SHASUM from
-000158f0: 206d 6173 7465 7227 732c 206d 616b 696e   master's, makin
-00015900: 6720 6974 2061 2022 7661 6c69 6422 206a  g it a "valid" j
-00015910: 6f62 206e 6f77 2e0a 2020 2020 2020 2020  ob now..        
-00015920: 2320 2020 546f 2063 6f6e 7469 6e75 6520  #   To continue 
-00015930: 7465 7374 696e 6720 6162 6f76 6520 7761  testing above wa
-00015940: 726e 696e 672c 2079 6f75 206e 6565 6420  rning, you need 
-00015950: 746f 2064 656c 6574 6520 7468 6973 2062  to delete this b
-00015960: 7261 6e63 683a 0a20 2020 2020 2020 2023  ranch:.        #
-00015970: 2020 2020 2020 2060 6769 7420 6272 616e         `git bran
-00015980: 6368 202d 2d64 656c 6574 6520 6a6f 622d  ch --delete job-
-00015990: 7465 7374 6020 696e 2060 6f75 7470 7574  test` in `output
-000159a0: 5f72 6961 2f30 3030 2f30 3030 2d30 3030  _ria/000/000-000
-000159b0: 600a 2020 2020 2020 2020 2320 2020 2020  `.        #     
-000159c0: 2020 7468 656e 2072 652d 6372 6561 7465    then re-create
-000159d0: 2061 206e 6577 206f 6e65 3a20 6067 6974   a new one: `git
-000159e0: 2062 7261 6e63 6820 6a6f 622d 7465 7374   branch job-test
-000159f0: 600a 0a20 2020 2020 2020 2023 204d 6572  `..        # Mer
-00015a00: 6765 2076 616c 6964 2062 7261 6e63 6865  ge valid branche
-00015a10: 7320 6368 756e 6b20 6279 2063 6875 6e6b  s chunk by chunk
-00015a20: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00015a30: 225c 6e4d 6572 6769 6e67 2076 616c 6964  "\nMerging valid
-00015a40: 206a 6f62 2062 7261 6e63 6865 7320 6368   job branches ch
-00015a50: 756e 6b20 6279 2063 6875 6e6b 2e2e 2e22  unk by chunk..."
-00015a60: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-00015a70: 2254 6f74 616c 206e 756d 6265 7220 6f66  "Total number of
-00015a80: 206a 6f62 2062 7261 6e63 6865 7320 746f   job branches to
-00015a90: 206d 6572 6765 203d 2022 202b 2073 7472   merge = " + str
-00015aa0: 286c 656e 286c 6973 745f 6272 616e 6368  (len(list_branch
-00015ab0: 6573 5f77 6974 685f 7265 7375 6c74 7329  es_with_results)
-00015ac0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
-00015ad0: 2822 4368 756e 6b20 7369 7a65 2028 6e75  ("Chunk size (nu
-00015ae0: 6d62 6572 206f 6620 6a6f 6220 6272 616e  mber of job bran
-00015af0: 6368 6573 2070 6572 2063 6875 6e6b 2920  ches per chunk) 
-00015b00: 3d20 2220 2b20 7374 7228 6368 756e 6b5f  = " + str(chunk_
-00015b10: 7369 7a65 2929 0a20 2020 2020 2020 2023  size)).        #
-00015b20: 2074 7572 6e20 7468 6520 6c69 7374 2069   turn the list i
-00015b30: 6e74 6f20 6e75 6d70 7920 6172 7261 793a  nto numpy array:
-00015b40: 0a20 2020 2020 2020 2061 7272 203d 206e  .        arr = n
-00015b50: 702e 6173 6172 7261 7928 6c69 7374 5f62  p.asarray(list_b
-00015b60: 7261 6e63 6865 735f 7769 7468 5f72 6573  ranches_with_res
-00015b70: 756c 7473 290a 2020 2020 2020 2020 2320  ults).        # 
-00015b80: 5e5e 2065 2e67 2e2c 2061 7272 6179 285b  ^^ e.g., array([
-00015b90: 312c 2037 2c20 302c 2036 2c20 322c 2035  1, 7, 0, 6, 2, 5
-00015ba0: 2c20 365d 2920 2020 2320 6275 7420 7769  , 6])   # but wi
-00015bb0: 7468 2060 6474 7970 653d 273c 5532 3427  th `dtype='<U24'
-00015bc0: 600a 2020 2020 2020 2020 2320 7370 6c69  `.        # spli
-00015bd0: 7420 696e 746f 2073 6576 6572 616c 2063  t into several c
-00015be0: 6875 6e6b 733a 0a20 2020 2020 2020 206e  hunks:.        n
-00015bf0: 756d 5f63 6875 6e6b 7320 3d20 6365 696c  um_chunks = ceil
-00015c00: 6469 7628 6c65 6e28 6172 7229 2c20 6368  div(len(arr), ch
-00015c10: 756e 6b5f 7369 7a65 290a 2020 2020 2020  unk_size).      
-00015c20: 2020 7072 696e 7428 222d 2d3e 204e 756d    print("--> Num
-00015c30: 6265 7220 6f66 2063 6875 6e6b 7320 3d20  ber of chunks = 
-00015c40: 2220 2b20 7374 7228 6e75 6d5f 6368 756e  " + str(num_chun
-00015c50: 6b73 2929 0a20 2020 2020 2020 2061 6c6c  ks)).        all
-00015c60: 5f63 6875 6e6b 7320 3d20 6e70 2e61 7272  _chunks = np.arr
-00015c70: 6179 5f73 706c 6974 2861 7272 2c20 6e75  ay_split(arr, nu
-00015c80: 6d5f 6368 756e 6b73 290a 2020 2020 2020  m_chunks).      
-00015c90: 2020 2320 5e5e 2065 2e67 2e2c 205b 6172    # ^^ e.g., [ar
-00015ca0: 7261 7928 5b31 2c20 372c 2030 5d29 2c20  ray([1, 7, 0]), 
-00015cb0: 6172 7261 7928 5b36 2c20 325d 292c 2061  array([6, 2]), a
-00015cc0: 7272 6179 285b 352c 2036 5d29 5d0a 0a20  rray([5, 6])].. 
-00015cd0: 2020 2020 2020 2023 2069 7465 7261 7465         # iterate
-00015ce0: 2061 6372 6f73 7320 6368 756e 6b73 3a0a   across chunks:.
-00015cf0: 2020 2020 2020 2020 666f 7220 695f 6368          for i_ch
-00015d00: 756e 6b20 696e 2072 616e 6765 2830 2c20  unk in range(0, 
-00015d10: 6e75 6d5f 6368 756e 6b73 293a 0a20 2020  num_chunks):.   
-00015d20: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00015d30: 4d65 7267 696e 6720 6368 756e 6b20 2322  Merging chunk #"
-00015d40: 202b 2073 7472 2869 5f63 6875 6e6b 2b31   + str(i_chunk+1
-00015d50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015d60: 2020 2020 2b20 2220 2874 6f74 616c 206f      + " (total o
-00015d70: 6620 2220 2b20 7374 7228 6e75 6d5f 6368  f " + str(num_ch
-00015d80: 756e 6b73 2920 2b20 2220 6368 756e 6b5b  unks) + " chunk[
-00015d90: 735d 2074 6f20 6d65 7267 6529 2e2e 2e22  s] to merge)..."
-00015da0: 290a 2020 2020 2020 2020 2020 2020 7468  ).            th
-00015db0: 655f 6368 756e 6b20 3d20 616c 6c5f 6368  e_chunk = all_ch
-00015dc0: 756e 6b73 5b69 5f63 6875 6e6b 5d20 2023  unks[i_chunk]  #
-00015dd0: 2065 2e67 2e2c 2061 7272 6179 285b 2761   e.g., array(['a
-00015de0: 272c 2027 6227 2c20 2763 275d 290a 2020  ', 'b', 'c']).  
-00015df0: 2020 2020 2020 2020 2020 2320 6a6f 696e            # join
-00015e00: 2061 6c6c 2062 7261 6e63 6865 7320 696e   all branches in
-00015e10: 2074 6869 7320 6368 756e 6b3a 0a20 2020   this chunk:.   
-00015e20: 2020 2020 2020 2020 206a 6f69 6e65 645f           joined_
-00015e30: 6279 5f73 7061 6365 203d 2022 2022 2e6a  by_space = " ".j
-00015e40: 6f69 6e28 7468 655f 6368 756e 6b29 2020  oin(the_chunk)  
-00015e50: 2023 2065 2e67 2e2c 2027 6120 6220 6327   # e.g., 'a b c'
-00015e60: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00015e70: 6f6d 6d61 6e64 2074 6f20 7275 6e3a 0a20  ommand to run:. 
-00015e80: 2020 2020 2020 2020 2020 2063 6f6d 6d69             commi
-00015e90: 745f 6d73 6720 3d20 226d 6572 6765 2072  t_msg = "merge r
-00015ea0: 6573 756c 7473 2063 6875 6e6b 2022 205c  esults chunk " \
-00015eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ec0: 202b 2073 7472 2869 5f63 6875 6e6b 2b31   + str(i_chunk+1
-00015ed0: 2920 2b20 222f 2220 2b20 7374 7228 6e75  ) + "/" + str(nu
-00015ee0: 6d5f 6368 756e 6b73 290a 2020 2020 2020  m_chunks).      
-00015ef0: 2020 2020 2020 2320 5e5e 206f 6b61 7920        # ^^ okay 
-00015f00: 746f 206e 6f74 2074 6f20 6265 2071 756f  to not to be quo
-00015f10: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00015f20: 2023 2020 2061 7320 696e 2060 7375 6270   #   as in `subp
-00015f30: 726f 6365 7373 2e72 756e 6020 7468 6973  rocess.run` this
-00015f40: 2069 7320 6120 7365 7061 7261 7465 2065   is a separate e
-00015f50: 6c65 6d65 6e74 2069 6e20 7468 6520 6063  lement in the `c
-00015f60: 6d64 6020 6c69 7374 0a20 2020 2020 2020  md` list.       
-00015f70: 2020 2020 2063 6d64 203d 205b 2267 6974       cmd = ["git
-00015f80: 222c 2022 6d65 7267 6522 2c20 222d 6d22  ", "merge", "-m"
-00015f90: 2c20 636f 6d6d 6974 5f6d 7367 5d20 5c0a  , commit_msg] \.
-00015fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fb0: 2b20 6a6f 696e 6564 5f62 795f 7370 6163  + joined_by_spac
-00015fc0: 652e 7370 6c69 7428 2220 2229 2020 2023  e.split(" ")   #
-00015fd0: 2073 706c 6974 2062 7920 7370 6163 650a   split by space.
-00015fe0: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-00015ff0: 5f67 6974 5f6d 6572 6765 203d 2073 7562  _git_merge = sub
-00016000: 7072 6f63 6573 732e 7275 6e28 0a20 2020  process.run(.   
-00016010: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-00016020: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00016030: 2020 6377 643d 6d65 7267 655f 6473 5f70    cwd=merge_ds_p
-00016040: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-00016050: 2020 2020 2073 7464 6f75 743d 7375 6270       stdout=subp
-00016060: 726f 6365 7373 2e50 4950 4529 0a20 2020  rocess.PIPE).   
-00016070: 2020 2020 2020 2020 2070 726f 635f 6769           proc_gi
-00016080: 745f 6d65 7267 652e 6368 6563 6b5f 7265  t_merge.check_re
-00016090: 7475 726e 636f 6465 2829 0a20 2020 2020  turncode().     
-000160a0: 2020 2020 2020 2070 7269 6e74 2870 726f         print(pro
-000160b0: 635f 6769 745f 6d65 7267 652e 7374 646f  c_git_merge.stdo
-000160c0: 7574 2e64 6563 6f64 6528 2775 7466 2d38  ut.decode('utf-8
-000160d0: 2729 290a 0a20 2020 2020 2020 2023 2050  '))..        # P
-000160e0: 7573 6820 6d65 7267 696e 6720 6163 7469  ush merging acti
-000160f0: 6f6e 7320 6261 636b 2074 6f20 6f75 7470  ons back to outp
-00016100: 7574 2052 4941 3a0a 2020 2020 2020 2020  ut RIA:.        
-00016110: 6966 206e 6f74 2074 7269 616c 5f72 756e  if not trial_run
-00016120: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00016130: 696e 7428 225c 6e50 7573 6869 6e67 206d  int("\nPushing m
-00016140: 6572 6769 6e67 2061 6374 696f 6e73 2074  erging actions t
-00016150: 6f20 6f75 7470 7574 2052 4941 2e2e 2e22  o output RIA..."
-00016160: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00016170: 6067 6974 2070 7573 6860 3a0a 2020 2020  `git push`:.    
-00016180: 2020 2020 2020 2020 7072 6f63 5f67 6974          proc_git
-00016190: 5f70 7573 6820 3d20 7375 6270 726f 6365  _push = subproce
-000161a0: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
-000161b0: 2020 2020 2020 2020 5b22 6769 7422 2c20          ["git", 
-000161c0: 2270 7573 6822 5d2c 0a20 2020 2020 2020  "push"],.       
-000161d0: 2020 2020 2020 2020 2063 7764 3d6d 6572           cwd=mer
-000161e0: 6765 5f64 735f 7061 7468 2c20 7374 646f  ge_ds_path, stdo
-000161f0: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
-00016200: 5045 290a 2020 2020 2020 2020 2020 2020  PE).            
-00016210: 7072 6f63 5f67 6974 5f70 7573 682e 6368  proc_git_push.ch
-00016220: 6563 6b5f 7265 7475 726e 636f 6465 2829  eck_returncode()
-00016230: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00016240: 6e74 2870 726f 635f 6769 745f 7075 7368  nt(proc_git_push
-00016250: 2e73 7464 6f75 742e 6465 636f 6465 2827  .stdout.decode('
-00016260: 7574 662d 3827 2929 0a0a 2020 2020 2020  utf-8'))..      
-00016270: 2020 2020 2020 2320 4765 7420 6669 6c65        # Get file
-00016280: 2061 7661 696c 6162 696c 6974 7920 696e   availability in
-00016290: 666f 726d 6174 696f 6e3a 2077 6869 6368  formation: which
-000162a0: 2069 7320 7665 7279 2069 6d70 6f72 7461   is very importa
-000162b0: 6e74 210a 2020 2020 2020 2020 2020 2020  nt!.            
-000162c0: 2320 6067 6974 2061 6e6e 6578 2066 7363  # `git annex fsc
-000162d0: 6b20 2d2d 6661 7374 202d 6620 6f75 7470  k --fast -f outp
-000162e0: 7574 2d73 746f 7261 6765 603a 0a20 2020  ut-storage`:.   
-000162f0: 2020 2020 2020 2020 2023 2020 2060 6769           #   `gi
-00016300: 7420 616e 6e65 7820 6673 636b 6020 3d20  t annex fsck` = 
-00016310: 6669 6c65 2073 7973 7465 6d20 6368 6563  file system chec
-00016320: 6b0a 2020 2020 2020 2020 2020 2020 2320  k.            # 
-00016330: 2020 5765 2776 6520 646f 6e65 2074 6865    We've done the
-00016340: 2067 6974 206d 6572 6765 206f 6620 7468   git merge of th
-00016350: 6520 7379 6d6c 696e 6b73 206f 6620 7468  e symlinks of th
-00016360: 6520 6669 6c65 732c 0a20 2020 2020 2020  e files,.       
-00016370: 2020 2020 2023 2020 206e 6f77 2077 6520       #   now we 
-00016380: 6e65 6564 2074 6f20 6d61 7463 6820 7468  need to match th
-00016390: 6520 7379 6d6c 696e 6b73 2077 6974 6820  e symlinks with 
-000163a0: 7468 6520 6461 7461 2063 6f6e 7465 6e74  the data content
-000163b0: 2069 6e20 606f 7574 7075 742d 7374 6f72   in `output-stor
-000163c0: 6167 6560 2e0a 2020 2020 2020 2020 2020  age`..          
-000163d0: 2020 2320 2020 602d 2d66 6173 7460 3a20    #   `--fast`: 
-000163e0: 6a75 7374 2075 7365 2074 6865 2065 7869  just use the exi
-000163f0: 7374 696e 6720 4d44 352c 206e 6f74 2074  sting MD5, not t
-00016400: 6f20 7265 2d63 7265 6174 6520 6120 6e65  o re-create a ne
-00016410: 7720 6f6e 650a 2020 2020 2020 2020 2020  w one.          
-00016420: 2020 7072 6f63 5f67 6974 5f61 6e6e 6578    proc_git_annex
-00016430: 5f66 7363 6b20 3d20 7375 6270 726f 6365  _fsck = subproce
-00016440: 7373 2e72 756e 280a 2020 2020 2020 2020  ss.run(.        
-00016450: 2020 2020 2020 2020 5b22 6769 7422 2c20          ["git", 
-00016460: 2261 6e6e 6578 222c 2022 6673 636b 222c  "annex", "fsck",
-00016470: 2022 2d2d 6661 7374 222c 2022 2d66 222c   "--fast", "-f",
-00016480: 2022 6f75 7470 7574 2d73 746f 7261 6765   "output-storage
-00016490: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
-000164a0: 2020 2020 6377 643d 6d65 7267 655f 6473      cwd=merge_ds
-000164b0: 5f70 6174 682c 2073 7464 6f75 743d 7375  _path, stdout=su
-000164c0: 6270 726f 6365 7373 2e50 4950 4529 0a20  bprocess.PIPE). 
-000164d0: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
-000164e0: 6769 745f 616e 6e65 785f 6673 636b 2e63  git_annex_fsck.c
-000164f0: 6865 636b 5f72 6574 7572 6e63 6f64 6528  heck_returncode(
-00016500: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00016510: 6966 2070 7269 6e74 696e 6720 7468 6520  if printing the 
-00016520: 7265 7475 726e 6564 206d 7367 2c0a 2020  returned msg,.  
-00016530: 2020 2020 2020 2020 2020 2320 2020 7769            #   wi
-00016540: 6c6c 2062 6520 6120 6c6f 6e67 206c 6973  ll be a long lis
-00016550: 7420 6f66 2022 6673 636b 2078 7878 2e7a  t of "fsck xxx.z
-00016560: 6970 2028 6669 7869 6e67 206c 6f63 6174  ip (fixing locat
-00016570: 696f 6e20 6c6f 6729 206f 6b22 0a20 2020  ion log) ok".   
-00016580: 2020 2020 2020 2020 2023 2020 206f 7220           #   or 
-00016590: 2266 7363 6b20 7878 782e 7a69 7020 6f6b  "fsck xxx.zip ok
-000165a0: 220a 2020 2020 2020 2020 2020 2020 2320  ".            # 
-000165b0: 696e 7374 6561 642c 2073 6176 6520 6974  instead, save it
-000165c0: 2069 6e74 6f20 6120 7465 7874 2066 696c   into a text fil
-000165d0: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
-000165e0: 6974 6820 6f70 656e 2866 6e5f 6d73 675f  ith open(fn_msg_
-000165f0: 6673 636b 2c20 2277 2229 2061 7320 663a  fsck, "w") as f:
-00016600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016610: 2066 2e77 7269 7465 2822 2320 4265 6c6f   f.write("# Belo
-00016620: 7720 6172 6520 7072 696e 7465 6420 6d65  w are printed me
-00016630: 7373 6167 6573 2066 726f 6d22 0a20 2020  ssages from".   
-00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016650: 2020 2020 2022 2060 6769 7420 616e 6e65       " `git anne
-00016660: 7820 6673 636b 202d 2d66 6173 7420 2d66  x fsck --fast -f
-00016670: 206f 7574 7075 742d 7374 6f72 6167 6560   output-storage`
-00016680: 3a5c 6e5c 6e22 290a 2020 2020 2020 2020  :\n\n").        
-00016690: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-000166a0: 7072 6f63 5f67 6974 5f61 6e6e 6578 5f66  proc_git_annex_f
-000166b0: 7363 6b2e 7374 646f 7574 2e64 6563 6f64  sck.stdout.decod
-000166c0: 6528 2775 7466 2d38 2729 290a 2020 2020  e('utf-8')).    
-000166d0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
-000166e0: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
-000166f0: 2020 2020 2020 2320 6e6f 7720 7765 2063        # now we c
-00016700: 616e 2064 656c 6574 6520 6070 726f 635f  an delete `proc_
-00016710: 6769 745f 616e 6e65 785f 6673 636b 6020  git_annex_fsck` 
-00016720: 746f 2073 6176 6520 6d65 6d6f 7279 3a0a  to save memory:.
-00016730: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-00016740: 7072 6f63 5f67 6974 5f61 6e6e 6578 5f66  proc_git_annex_f
-00016750: 7363 6b0a 0a20 2020 2020 2020 2020 2020  sck..           
-00016760: 2023 2044 6f75 626c 6520 6368 6563 6b3a   # Double check:
-00016770: 2074 6865 7265 2073 686f 756c 6420 6e6f   there should no
-00016780: 7420 6265 2066 696c 6520 636f 6e74 656e  t be file conten
-00016790: 7420 7468 6174 2773 206e 6f74 2069 6e20  t that's not in 
-000167a0: 606f 7574 7075 742d 7374 6f72 6167 6560  `output-storage`
-000167b0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-000167c0: 2020 5468 6973 2073 686f 756c 6420 6e6f    This should no
-000167d0: 7420 7072 696e 7420 616e 7974 6869 6e67  t print anything
-000167e0: 202d 2077 6520 6e65 7665 7220 6861 7320   - we never has 
-000167f0: 7468 6973 2065 7272 6f72 2062 6566 6f72  this error befor
-00016800: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
-00016810: 6067 6974 2061 6e6e 6578 2066 696e 6420  `git annex find 
-00016820: 2d2d 6e6f 7420 2d2d 696e 206f 7574 7075  --not --in outpu
-00016830: 742d 7374 6f72 6167 6560 0a20 2020 2020  t-storage`.     
-00016840: 2020 2020 2020 2070 726f 635f 6769 745f         proc_git_
-00016850: 616e 6e65 785f 6669 6e64 5f6d 6973 7369  annex_find_missi
-00016860: 6e67 203d 2073 7562 7072 6f63 6573 732e  ng = subprocess.
-00016870: 7275 6e28 0a20 2020 2020 2020 2020 2020  run(.           
-00016880: 2020 2020 205b 2267 6974 222c 2022 616e       ["git", "an
-00016890: 6e65 7822 2c20 2266 696e 6422 2c20 222d  nex", "find", "-
-000168a0: 2d6e 6f74 222c 2022 2d2d 696e 222c 2022  -not", "--in", "
-000168b0: 6f75 7470 7574 2d73 746f 7261 6765 225d  output-storage"]
-000168c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000168d0: 2020 6377 643d 6d65 7267 655f 6473 5f70    cwd=merge_ds_p
-000168e0: 6174 682c 2073 7464 6f75 743d 7375 6270  ath, stdout=subp
-000168f0: 726f 6365 7373 2e50 4950 4529 0a20 2020  rocess.PIPE).   
-00016900: 2020 2020 2020 2020 2070 726f 635f 6769           proc_gi
-00016910: 745f 616e 6e65 785f 6669 6e64 5f6d 6973  t_annex_find_mis
-00016920: 7369 6e67 2e63 6865 636b 5f72 6574 7572  sing.check_retur
-00016930: 6e63 6f64 6528 290a 2020 2020 2020 2020  ncode().        
-00016940: 2020 2020 6d73 6720 3d20 7072 6f63 5f67      msg = proc_g
-00016950: 6974 5f61 6e6e 6578 5f66 696e 645f 6d69  it_annex_find_mi
-00016960: 7373 696e 672e 7374 646f 7574 2e64 6563  ssing.stdout.dec
-00016970: 6f64 6528 2775 7466 2d38 2729 0a20 2020  ode('utf-8').   
-00016980: 2020 2020 2020 2020 2023 2060 6d73 6760           # `msg`
-00016990: 2073 686f 756c 6420 6265 2065 6d70 7479   should be empty
-000169a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000169b0: 206d 7367 2021 3d20 2727 3a20 2020 2320   msg != '':   # 
-000169c0: 6966 206e 6f74 2065 6d70 7479 3a0a 2020  if not empty:.  
-000169d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000169e0: 7361 7665 2069 6e74 6f20 6120 6669 6c65  save into a file
-000169f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016a00: 2020 7769 7468 206f 7065 6e28 666e 5f6c    with open(fn_l
-00016a10: 6973 745f 636f 6e74 656e 745f 6d69 7373  ist_content_miss
-00016a20: 696e 672c 2022 7722 2920 6173 2066 3a0a  ing, "w") as f:.
-00016a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a40: 2020 2020 662e 7772 6974 6528 6d73 6729      f.write(msg)
-00016a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016a60: 2020 2020 2066 2e77 7269 7465 2822 5c6e       f.write("\n
-00016a70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00016a80: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-00016a90: 6f6e 2822 556e 6162 6c65 2074 6f20 6669  on("Unable to fi
-00016aa0: 6e64 2066 696c 6520 636f 6e74 656e 7420  nd file content 
-00016ab0: 666f 7220 736f 6d65 2066 696c 6528 7329  for some file(s)
-00016ac0: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ae0: 2020 202b 2022 2054 6865 2069 6e66 6f72     + " The infor
-00016af0: 6d61 7469 6f6e 2068 6173 2062 6565 6e20  mation has been 
-00016b00: 7361 7665 6420 746f 2074 6869 7320 7465  saved to this te
-00016b10: 7874 2066 696c 653a 2027 220a 2020 2020  xt file: '".    
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 2020 2020 2020 2020 2b20 666e              + fn
-00016b40: 5f6c 6973 745f 636f 6e74 656e 745f 6d69  _list_content_mi
-00016b50: 7373 696e 6720 2b20 2227 2e22 290a 0a20  ssing + "'.").. 
-00016b60: 2020 2020 2020 2020 2020 2023 2060 6769             # `gi
-00016b70: 7420 616e 6e65 7820 6465 6164 2068 6572  t annex dead her
-00016b80: 6560 3a0a 2020 2020 2020 2020 2020 2020  e`:.            
-00016b90: 2320 2020 7374 6f70 2074 7261 636b 696e  #   stop trackin
-00016ba0: 6720 636c 6f6e 6520 606d 6572 6765 5f64  g clone `merge_d
-00016bb0: 7360 2c0a 2020 2020 2020 2020 2020 2020  s`,.            
-00016bc0: 2320 2020 692e 652e 2c20 6e6f 7420 746f  #   i.e., not to
-00016bd0: 2067 6574 2064 6174 6120 6672 6f6d 2074   get data from t
-00016be0: 6869 7320 606d 6572 6765 5f64 7360 2073  his `merge_ds` s
-00016bf0: 6962 6c69 6e67 3a0a 2020 2020 2020 2020  ibling:.        
-00016c00: 2020 2020 7072 6f63 5f67 6974 5f61 6e6e      proc_git_ann
-00016c10: 6578 5f64 6561 645f 6865 7265 203d 2073  ex_dead_here = s
-00016c20: 7562 7072 6f63 6573 732e 7275 6e28 0a20  ubprocess.run(. 
-00016c30: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00016c40: 2267 6974 222c 2022 616e 6e65 7822 2c20  "git", "annex", 
-00016c50: 2264 6561 6422 2c20 2268 6572 6522 5d2c  "dead", "here"],
-00016c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c70: 2063 7764 3d6d 6572 6765 5f64 735f 7061   cwd=merge_ds_pa
-00016c80: 7468 2c20 7374 646f 7574 3d73 7562 7072  th, stdout=subpr
-00016c90: 6f63 6573 732e 5049 5045 290a 2020 2020  ocess.PIPE).    
-00016ca0: 2020 2020 2020 2020 7072 6f63 5f67 6974          proc_git
-00016cb0: 5f61 6e6e 6578 5f64 6561 645f 6865 7265  _annex_dead_here
-00016cc0: 2e63 6865 636b 5f72 6574 7572 6e63 6f64  .check_returncod
-00016cd0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-00016ce0: 7072 696e 7428 7072 6f63 5f67 6974 5f61  print(proc_git_a
-00016cf0: 6e6e 6578 5f64 6561 645f 6865 7265 2e73  nnex_dead_here.s
-00016d00: 7464 6f75 742e 6465 636f 6465 2827 7574  tdout.decode('ut
-00016d10: 662d 3827 2929 0a0a 2020 2020 2020 2020  f-8'))..        
-00016d20: 2020 2020 2320 4669 6e61 6c20 6064 6174      # Final `dat
-00016d30: 616c 6164 2070 7573 6860 2074 6f20 6f75  alad push` to ou
-00016d40: 7470 7574 2052 4941 3a0a 2020 2020 2020  tput RIA:.      
-00016d50: 2020 2020 2020 2320 6064 6174 616c 6164        # `datalad
-00016d60: 2070 7573 6820 2d2d 6461 7461 206e 6f74   push --data not
-00016d70: 6869 6e67 603a 0a20 2020 2020 2020 2020  hing`:.         
-00016d80: 2020 2023 2020 2070 7573 6869 6e67 2074     #   pushing t
-00016d90: 6f20 6067 6974 6020 6272 616e 6368 2069  o `git` branch i
-00016da0: 6e20 6f75 7470 7574 2052 4941 3a20 6861  n output RIA: ha
-00016db0: 7320 646f 6e65 2077 6974 6820 6067 6974  s done with `git
-00016dc0: 2070 7573 6860 3b0a 2020 2020 2020 2020   push`;.        
-00016dd0: 2020 2020 2320 2020 7075 7368 696e 6720      #   pushing 
-00016de0: 746f 2060 6769 742d 616e 6e65 7860 2062  to `git-annex` b
-00016df0: 7261 6e63 6820 696e 206f 7574 7075 7420  ranch in output 
-00016e00: 5249 413a 2068 6173 6e27 7420 646f 6e65  RIA: hasn't done
-00016e10: 2061 6674 6572 2060 6769 7420 616e 6e65   after `git anne
-00016e20: 7820 6673 636b 600a 2020 2020 2020 2020  x fsck`.        
-00016e30: 2020 2020 2320 2020 602d 2d64 6174 6120      #   `--data 
-00016e40: 6e6f 7468 696e 6760 3a20 646f 6e27 7420  nothing`: don't 
-00016e50: 7472 616e 7366 6572 2064 6174 6120 6672  transfer data fr
-00016e60: 6f6d 2074 6869 7320 6c6f 6361 6c20 616e  om this local an
-00016e70: 6e65 7820 606d 6572 6765 5f64 7360 0a20  nex `merge_ds`. 
-00016e80: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
-00016e90: 6461 7461 6c61 645f 7075 7368 203d 2073  datalad_push = s
-00016ea0: 7562 7072 6f63 6573 732e 7275 6e28 0a20  ubprocess.run(. 
-00016eb0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00016ec0: 2264 6174 616c 6164 222c 2022 7075 7368  "datalad", "push
-00016ed0: 222c 2022 2d2d 6461 7461 222c 2022 6e6f  ", "--data", "no
-00016ee0: 7468 696e 6722 5d2c 0a20 2020 2020 2020  thing"],.       
-00016ef0: 2020 2020 2020 2020 2063 7764 3d6d 6572           cwd=mer
-00016f00: 6765 5f64 735f 7061 7468 2c20 7374 646f  ge_ds_path, stdo
-00016f10: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
-00016f20: 5045 290a 2020 2020 2020 2020 2020 2020  PE).            
-00016f30: 7072 6f63 5f64 6174 616c 6164 5f70 7573  proc_datalad_pus
-00016f40: 682e 6368 6563 6b5f 7265 7475 726e 636f  h.check_returnco
-00016f50: 6465 2829 0a20 2020 2020 2020 2020 2020  de().           
-00016f60: 2070 7269 6e74 2870 726f 635f 6461 7461   print(proc_data
-00016f70: 6c61 645f 7075 7368 2e73 7464 6f75 742e  lad_push.stdout.
-00016f80: 6465 636f 6465 2827 7574 662d 3827 2929  decode('utf-8'))
-00016f90: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00016fa0: 446f 6e65 3a0a 2020 2020 2020 2020 2020  Done:.          
-00016fb0: 2020 6966 2069 665f 616e 795f 7761 726e    if if_any_warn
-00016fc0: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00016fd0: 2020 2020 2070 7269 6e74 2822 5c6e 6062       print("\n`b
-00016fe0: 6162 732d 6d65 7267 6560 2068 6173 2066  abs-merge` has f
-00016ff0: 696e 6973 6865 6420 6275 7420 6861 6420  inished but had 
-00017000: 7761 726e 696e 6728 7329 2122 0a20 2020  warning(s)!".   
-00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017020: 2020 2022 2050 6c65 6173 6520 6368 6563     " Please chec
-00017030: 6b20 6f75 7420 7468 6520 7761 726e 696e  k out the warnin
-00017040: 6720 6d65 7373 6167 6528 7329 2061 626f  g message(s) abo
-00017050: 7665 2122 290a 2020 2020 2020 2020 2020  ve!").          
-00017060: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00017070: 2020 2020 2020 2020 7072 696e 7428 225c          print("\
-00017080: 6e60 6261 6273 2d6d 6572 6765 6020 7761  n`babs-merge` wa
-00017090: 7320 7375 6363 6573 7366 756c 2122 290a  s successful!").
-000170a0: 0a20 2020 2020 2020 2065 6c73 653a 2020  .        else:  
-000170b0: 2020 2320 602d 2d74 7269 616c 2d72 756e    # `--trial-run
-000170c0: 6020 6973 206f 6e3a 0a20 2020 2020 2020  ` is on:.       
-000170d0: 2020 2020 2070 7269 6e74 2822 2229 2020       print("")  
-000170e0: 2020 2320 6e65 7720 656d 7074 7920 6c69    # new empty li
-000170f0: 6e65 0a20 2020 2020 2020 2020 2020 2077  ne.            w
-00017100: 6172 6e69 6e67 732e 7761 726e 2822 602d  arnings.warn("`-
-00017110: 2d74 7269 616c 2d72 756e 6020 7761 7320  -trial-run` was 
-00017120: 7265 7175 6573 7465 642c 220a 2020 2020  requested,".    
-00017130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017140: 2020 2020 2020 2b20 2220 6e6f 7420 746f        + " not to
-00017150: 2070 7573 6820 6d65 7267 696e 6720 6163   push merging ac
-00017160: 7469 6f6e 7320 746f 206f 7574 7075 7420  tions to output 
-00017170: 5249 412e 2229 0a20 2020 2020 2020 2020  RIA.").         
-00017180: 2020 2070 7269 6e74 2822 5c6e 6062 6162     print("\n`bab
-00017190: 732d 6d65 7267 6560 2064 6964 206e 6f74  s-merge` did not
-000171a0: 2066 756c 6c79 2066 696e 6973 6820 7965   fully finish ye
-000171b0: 7421 2229 0a0a 2020 2020 6465 6620 6261  t!")..    def ba
-000171c0: 6273 5f75 6e7a 6970 2863 6f6e 7461 696e  bs_unzip(contain
-000171d0: 6572 5f63 6f6e 6669 675f 7961 6d6c 5f66  er_config_yaml_f
-000171e0: 696c 6529 3a0a 2020 2020 2020 2020 2222  ile):.        ""
-000171f0: 220a 2020 2020 2020 2020 5468 6973 2066  ".        This f
-00017200: 756e 6374 696f 6e20 756e 7a69 7073 2072  unction unzips r
-00017210: 6573 756c 7473 2061 6e64 2065 7874 7261  esults and extra
-00017220: 6374 2064 6573 6972 6564 2066 696c 6573  ct desired files
-00017230: 2e0a 2020 2020 2020 2020 5468 6973 2069  ..        This i
-00017240: 7320 646f 6e65 2069 6e20 3320 7374 6570  s done in 3 step
-00017250: 733a 0a20 2020 2020 2020 2031 2e20 4765  s:.        1. Ge
-00017260: 6e65 7261 7465 2073 6372 6970 7473 2075  nerate scripts u
-00017270: 7365 6420 6279 2060 6261 6273 2d75 6e7a  sed by `babs-unz
-00017280: 6970 600a 2020 2020 2020 2020 322e 2052  ip`.        2. R
-00017290: 756e 2073 6372 6970 7473 2074 6f20 756e  un scripts to un
-000172a0: 7a69 7020 6461 7461 0a20 2020 2020 2020  zip data.       
-000172b0: 2033 2e20 4d65 7267 6520 616c 6c20 6272   3. Merge all br
-000172c0: 616e 6368 6573 206f 6620 756e 7a69 7070  anches of unzipp
-000172d0: 696e 670a 0a20 2020 2020 2020 2050 6172  ing..        Par
-000172e0: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
-000172f0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a   --------------.
-00017300: 2020 2020 2020 2020 636f 6e66 6967 3a20          config: 
-00017310: 6469 6374 0a20 2020 2020 2020 2020 2020  dict.           
-00017320: 206c 6f61 6465 6420 636f 6e74 6169 6e65   loaded containe
-00017330: 7220 636f 6e66 6967 2079 616d 6c20 6669  r config yaml fi
-00017340: 6c65 0a20 2020 2020 2020 2022 2222 0a0a  le.        """..
-00017350: 2020 2020 2020 2020 2320 3d3d 3d3d 3d3d          # ======
-00017360: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017370: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017380: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20  ==============. 
-00017390: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
-000173a0: 6520 7363 7269 7074 7320 7573 6564 2062  e scripts used b
-000173b0: 7920 6062 6162 732d 756e 7a69 7060 0a20  y `babs-unzip`. 
-000173c0: 2020 2020 2020 2023 203d 3d3d 3d3d 3d3d         # =======
-000173d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000173e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000173f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a 0a20  =============.. 
-00017400: 2020 2020 2020 2023 2050 7265 7061 7265         # Prepare
-00017410: 2069 6e70 7574 5f64 735f 756e 7a69 703a   input_ds_unzip:
-00017420: 0a20 2020 2020 2020 2023 2043 616c 6c20  .        # Call 
-00017430: 6062 6162 735f 626f 6f74 7374 7261 7028  `babs_bootstrap(
-00017440: 2960 3a0a 2020 2020 2020 2020 2320 2020  )`:.        #   
-00017450: 2121 2121 2075 7369 6e67 2062 6162 735f  !!!! using babs_
-00017460: 7072 6f6a 5f75 6e7a 6970 2c20 696e 7374  proj_unzip, inst
-00017470: 6561 6420 6375 7272 656e 7420 6073 656c  ead current `sel
-00017480: 6660 2121 210a 0a20 2020 2020 2020 2070  f`!!!..        p
-00017490: 7269 6e74 2822 544f 444f 2229 0a0a 2020  rint("TODO")..  
-000174a0: 2020 2020 2020 2320 3d3d 3d3d 3d3d 3d3d        # ========
-000174b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000174c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000174d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20 2020  ============.   
-000174e0: 2020 2020 2023 2052 756e 2073 6372 6970       # Run scrip
-000174f0: 7473 2074 6f20 756e 7a69 7020 6461 7461  ts to unzip data
-00017500: 0a20 2020 2020 2020 2023 203d 3d3d 3d3d  .        # =====
+000133b0: 2020 2320 2020 7468 6973 2069 7320 746f    #   this is to
+000133c0: 2075 7064 6174 6520 6061 6c65 7274 5f6d   update `alert_m
+000133d0: 6573 7361 6765 6020 696e 2063 6173 6520  essage` in case 
+000133e0: 7573 6572 2063 6861 6e67 6573 2063 6f6e  user changes con
+000133f0: 6669 6773 2069 6e20 7961 6d6c 0a20 2020  figs in yaml.   
+00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013410: 2020 2020 2061 6c65 7274 5f6d 6573 7361       alert_messa
+00013420: 6765 5f69 6e5f 6c6f 675f 6669 6c65 732c  ge_in_log_files,
+00013430: 2069 665f 6e6f 5f61 6c65 7274 5f69 6e5f   if_no_alert_in_
+00013440: 6c6f 672c 205f 203d 205c 0a20 2020 2020  log, _ = \.     
+00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013460: 2020 2020 2020 2067 6574 5f61 6c65 7274         get_alert
+00013470: 5f6d 6573 7361 6765 5f69 6e5f 6c6f 675f  _message_in_log_
+00013480: 6669 6c65 7328 636f 6e66 6967 5f6d 7367  files(config_msg
+00013490: 5f61 6c65 7274 2c20 6c6f 675f 666e 290a  _alert, log_fn).
+000134a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134b0: 2020 2020 2020 2020 2320 5e5e 2074 6865          # ^^ the
+000134c0: 2066 756e 6374 696f 6e20 7769 6c6c 2068   function will h
+000134d0: 616e 646c 6520 6576 656e 2069 6620 6063  andle even if `c
+000134e0: 6f6e 6669 675f 6d73 675f 616c 6572 743d  onfig_msg_alert=
+000134f0: 4e6f 6e65 600a 2020 2020 2020 2020 2020  None`.          
+00013500: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00013510: 5f6a 6f62 5f75 7064 6174 6564 2e61 745b  _job_updated.at[
+00013520: 695f 6a6f 622c 2022 616c 6572 745f 6d65  i_job, "alert_me
+00013530: 7373 6167 6522 5d20 3d20 5c0a 2020 2020  ssage"] = \.    
+00013540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013550: 2020 2020 2020 2020 616c 6572 745f 6d65          alert_me
+00013560: 7373 6167 655f 696e 5f6c 6f67 5f66 696c  ssage_in_log_fil
+00013570: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00013580: 2020 2023 2044 6f6e 653a 2027 6973 5f64     # Done: 'is_d
+00013590: 6f6e 6527 206a 6f62 732e 0a0a 2020 2020  one' jobs...    
+000135a0: 2020 2020 2020 2020 2020 2020 2320 466f              # Fo
+000135b0: 7220 6a6f 6273 2074 6861 7420 6861 7665  r jobs that have
+000135c0: 6e27 7420 6265 656e 2073 7562 6d69 7474  n't been submitt
+000135d0: 6564 2079 6574 3a0a 2020 2020 2020 2020  ed yet:.        
+000135e0: 2020 2020 2020 2020 2320 2020 6a75 7374          #   just
+000135f0: 2074 6f20 7468 726f 7720 6f75 7420 7761   to throw out wa
+00013600: 726e 696e 6773 2069 6620 602d 2d72 6573  rnings if `--res
+00013610: 7562 6d69 742d 6a6f 6260 2077 6173 2072  ubmit-job` was r
+00013620: 6571 7565 7374 6564 2e2e 2e0a 2020 2020  equested....    
+00013630: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00013640: 665f 7265 7375 626d 6974 5f6a 6f62 5f73  f_resubmit_job_s
+00013650: 7065 6369 6669 6320 6973 206e 6f74 204e  pecific is not N
+00013660: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00013670: 2020 2020 2020 2020 2023 206f 6e6c 7920           # only 
+00013680: 6b65 6570 2074 686f 7365 206e 6f74 2073  keep those not s
+00013690: 7562 6d69 7474 6564 3a0a 2020 2020 2020  ubmitted:.      
+000136a0: 2020 2020 2020 2020 2020 2020 2020 6466                df
+000136b0: 5f6a 6f62 5f6e 6f74 5f73 7562 6d69 7474  _job_not_submitt
+000136c0: 6564 203d 2064 665f 6a6f 625b 7e64 665f  ed = df_job[~df_
+000136d0: 6a6f 625b 2268 6173 5f73 7562 6d69 7474  job["has_submitt
+000136e0: 6564 225d 5d0a 2020 2020 2020 2020 2020  ed"]].          
+000136f0: 2020 2020 2020 2020 2020 2320 6f6e 6c79            # only
+00013700: 206b 6565 7020 636f 6c75 6d6e 7320 6f66   keep columns of
+00013710: 2060 7375 625f 6964 6020 616e 6420 6073   `sub_id` and `s
+00013720: 6573 5f69 6460 3a0a 2020 2020 2020 2020  es_id`:.        
+00013730: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00013740: 656c 662e 7479 7065 5f73 6573 7369 6f6e  elf.type_session
+00013750: 203d 3d20 2273 696e 676c 652d 7365 7322   == "single-ses"
+00013760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013770: 2020 2020 2020 2020 2020 6466 5f6a 6f62            df_job
+00013780: 5f6e 6f74 5f73 7562 6d69 7474 6564 5f73  _not_submitted_s
+00013790: 6c69 6d20 3d20 6466 5f6a 6f62 5f6e 6f74  lim = df_job_not
+000137a0: 5f73 7562 6d69 7474 6564 5b5b 2273 7562  _submitted[["sub
+000137b0: 5f69 6422 5d5d 0a20 2020 2020 2020 2020  _id"]].         
+000137c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000137d0: 7365 6c66 2e74 7970 655f 7365 7373 696f  self.type_sessio
+000137e0: 6e20 3d3d 2022 6d75 6c74 692d 7365 7322  n == "multi-ses"
+000137f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013800: 2020 2020 2020 2020 2020 6466 5f6a 6f62            df_job
+00013810: 5f6e 6f74 5f73 7562 6d69 7474 6564 5f73  _not_submitted_s
+00013820: 6c69 6d20 3d20 6466 5f6a 6f62 5f6e 6f74  lim = df_job_not
+00013830: 5f73 7562 6d69 7474 6564 5b5b 2273 7562  _submitted[["sub
+00013840: 5f69 6422 2c20 2273 6573 5f69 6422 5d5d  _id", "ses_id"]]
+00013850: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013860: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
+00013870: 2060 2d2d 7265 7375 626d 6974 2d6a 6f62   `--resubmit-job
+00013880: 6020 7761 7320 7265 7175 6573 7465 6420  ` was requested 
+00013890: 666f 7220 616e 7920 7468 6573 6520 6a6f  for any these jo
+000138a0: 6273 3a0a 2020 2020 2020 2020 2020 2020  bs:.            
+000138b0: 2020 2020 2020 2020 6466 5f69 6e74 6572          df_inter
+000138c0: 7365 6374 696f 6e20 3d20 6466 5f72 6573  section = df_res
+000138d0: 7562 6d69 745f 6a6f 625f 7370 6563 6966  ubmit_job_specif
+000138e0: 6963 2e6d 6572 6765 2864 665f 6a6f 625f  ic.merge(df_job_
+000138f0: 6e6f 745f 7375 626d 6974 7465 645f 736c  not_submitted_sl
+00013900: 696d 290a 2020 2020 2020 2020 2020 2020  im).            
+00013910: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
+00013920: 665f 696e 7465 7273 6563 7469 6f6e 2920  f_intersection) 
+00013930: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00013940: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00013950: 6e69 6e67 732e 7761 726e 2822 4a6f 6273  nings.warn("Jobs
+00013960: 2066 6f72 2073 6f6d 6520 6f66 2074 6865   for some of the
+00013970: 2073 7562 6a65 6374 7320 2861 6e64 2073   subjects (and s
+00013980: 6573 7369 6f6e 7329 2072 6571 7565 7374  essions) request
+00013990: 6564 2069 6e22 0a20 2020 2020 2020 2020  ed in".         
+000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139b0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+000139c0: 2060 2d2d 7265 7375 626d 6974 2d6a 6f62   `--resubmit-job
+000139d0: 6020 6861 7665 6e27 7420 6265 656e 2073  ` haven't been s
+000139e0: 7562 6d69 7474 6564 2079 6574 2e22 0a20  ubmitted yet.". 
+000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a10: 2020 2020 202b 2022 2050 6c65 6173 6520       + " Please 
+00013a20: 7573 6520 6062 6162 732d 7375 626d 6974  use `babs-submit
+00013a30: 6020 6669 7273 742e 2229 0a20 2020 2020  ` first.").     
+00013a40: 2020 2020 2020 2020 2020 2023 2044 6f6e             # Don
+00013a50: 653a 206a 6f62 7320 7468 6174 2068 6176  e: jobs that hav
+00013a60: 656e 2774 2073 7562 6d69 7474 6564 2079  en't submitted y
+00013a70: 6574 0a0a 2020 2020 2020 2020 2020 2020  et..            
+00013a80: 2020 2020 2320 4669 6e69 7368 2075 7020      # Finish up 
+00013a90: 6062 6162 732d 7374 6174 7573 603a 0a20  `babs-status`:. 
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00013ab0: 2023 2070 7269 6e74 2075 7064 6174 6564   # print updated
+00013ac0: 2064 663a 0a20 2020 2020 2020 2020 2020   df:.           
+00013ad0: 2020 2020 2023 2070 7269 6e74 2822 2229       # print("")
+00013ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013af0: 2023 2077 6974 6820 7064 2e6f 7074 696f   # with pd.optio
+00013b00: 6e5f 636f 6e74 6578 7428 2764 6973 706c  n_context('displ
+00013b10: 6179 2e6d 6178 5f72 6f77 7327 2c20 4e6f  ay.max_rows', No
+00013b20: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00013b30: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00013b40: 2020 2020 2020 2020 2020 2020 2027 6469               'di
+00013b50: 7370 6c61 792e 6d61 785f 636f 6c75 6d6e  splay.max_column
+00013b60: 7327 2c20 4e6f 6e65 2c0a 2020 2020 2020  s', None,.      
+00013b70: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00013b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b90: 2020 2027 6469 7370 6c61 792e 7769 6474     'display.widt
+00013ba0: 6827 2c20 3132 3029 3a20 2020 2320 6465  h', 120):   # de
+00013bb0: 6661 756c 7420 6973 2038 3020 6368 6172  fault is 80 char
+00013bc0: 6163 7465 7273 2e2e 2e0a 2020 2020 2020  acters....      
+00013bd0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00013be0: 2320 5e5e 2070 7269 6e74 2061 6c6c 2063  # ^^ print all c
+00013bf0: 6f6c 756d 6e73 2061 6e64 2072 6f77 7320  olumns and rows 
+00013c00: 2877 6974 6820 7265 7475 726e 7329 0a20  (with returns). 
+00013c10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00013c20: 2020 2020 2070 7269 6e74 2864 665f 6a6f       print(df_jo
+00013c30: 625f 7570 6461 7465 642e 6865 6164 2836  b_updated.head(6
+00013c40: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
+00013c50: 2020 2020 2320 7361 7665 2075 7064 6174      # save updat
+00013c60: 6564 2064 663a 0a20 2020 2020 2020 2020  ed df:.         
+00013c70: 2020 2020 2020 2064 665f 6a6f 625f 7570         df_job_up
+00013c80: 6461 7465 642e 746f 5f63 7376 2873 656c  dated.to_csv(sel
+00013c90: 662e 6a6f 625f 7374 6174 7573 5f70 6174  f.job_status_pat
+00013ca0: 685f 6162 732c 2069 6e64 6578 3d46 616c  h_abs, index=Fal
+00013cb0: 7365 290a 0a20 2020 2020 2020 2020 2020  se)..           
+00013cc0: 2020 2020 2023 2052 6570 6f72 7420 7468       # Report th
+00013cd0: 6520 6a6f 6220 7374 6174 7573 3a0a 2020  e job status:.  
+00013ce0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00013cf0: 706f 7274 5f6a 6f62 5f73 7461 7475 7328  port_job_status(
+00013d00: 6466 5f6a 6f62 5f75 7064 6174 6564 2c20  df_job_updated, 
+00013d10: 7365 6c66 2e61 6e61 6c79 7369 735f 7061  self.analysis_pa
+00013d20: 7468 2c20 636f 6e66 6967 5f6d 7367 5f61  th, config_msg_a
+00013d30: 6c65 7274 290a 0a20 2020 2020 2020 2065  lert)..        e
+00013d40: 7863 6570 7420 5469 6d65 6f75 743a 2020  xcept Timeout:  
+00013d50: 2023 2061 6674 6572 2077 6169 7469 6e67   # after waiting
+00013d60: 2066 6f72 2074 696d 6520 6465 6669 6e65   for time define
+00013d70: 6420 696e 2060 7469 6d65 6f75 7460 3a0a  d in `timeout`:.
+00013d80: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+00013d90: 2061 6e6f 7468 6572 2069 6e73 7461 6e63   another instanc
+00013da0: 6520 616c 736f 2075 7365 7320 6c6f 636b  e also uses lock
+00013db0: 732c 2061 6e64 2069 7320 6375 7272 656e  s, and is curren
+00013dc0: 746c 7920 7275 6e6e 696e 672c 0a20 2020  tly running,.   
+00013dd0: 2020 2020 2020 2020 2023 2020 2074 6865           #   the
+00013de0: 7265 2077 696c 6c20 6265 2061 2074 696d  re will be a tim
+00013df0: 656f 7574 2065 7272 6f72 0a20 2020 2020  eout error.     
+00013e00: 2020 2020 2020 2070 7269 6e74 2822 416e         print("An
+00013e10: 6f74 6865 7220 696e 7374 616e 6365 206f  other instance o
+00013e20: 6620 7468 6973 2061 7070 6c69 6361 7469  f this applicati
+00013e30: 6f6e 2063 7572 7265 6e74 6c79 2068 6f6c  on currently hol
+00013e40: 6473 2074 6865 206c 6f63 6b2e 2229 0a0a  ds the lock.")..
+00013e50: 2020 2020 6465 6620 6261 6273 5f6d 6572      def babs_mer
+00013e60: 6765 2873 656c 662c 2063 6875 6e6b 5f73  ge(self, chunk_s
+00013e70: 697a 652c 2074 7269 616c 5f72 756e 293a  ize, trial_run):
+00013e80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013e90: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+00013ea0: 6f6e 206d 6572 6765 7320 7265 7375 6c74  on merges result
+00013eb0: 7320 616e 6420 7072 6f76 656e 616e 6365  s and provenance
+00013ec0: 2066 726f 6d20 616c 6c20 7375 6363 6573   from all succes
+00013ed0: 7366 756c 6c79 2066 696e 6973 6865 6420  sfully finished 
+00013ee0: 6a6f 6273 2e0a 0a20 2020 2020 2020 2050  jobs...        P
+00013ef0: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+00013f00: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+00013f10: 2d2d 0a20 2020 2020 2020 2063 6875 6e6b  --.        chunk
+00013f20: 5f73 697a 653a 2069 6e74 0a20 2020 2020  _size: int.     
+00013f30: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+00013f40: 2062 7261 6e63 6865 7320 696e 2061 2063   branches in a c
+00013f50: 6875 6e6b 2077 6865 6e20 6d65 7267 696e  hunk when mergin
+00013f60: 6720 6174 2061 2074 696d 652e 0a20 2020  g at a time..   
+00013f70: 2020 2020 2074 7269 616c 5f72 756e 3a20       trial_run: 
+00013f80: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
+00013f90: 2057 6865 7468 6572 2074 6f20 7275 6e20   Whether to run 
+00013fa0: 6173 2061 2074 7269 616c 2072 756e 2077  as a trial run w
+00013fb0: 6869 6368 2077 6f6e 2774 2070 7573 6820  hich won't push 
+00013fc0: 7468 6520 6d65 7267 696e 6720 6163 7469  the merging acti
+00013fd0: 6f6e 7320 6261 636b 2074 6f20 6f75 7470  ons back to outp
+00013fe0: 7574 2052 4941 2e0a 2020 2020 2020 2020  ut RIA..        
+00013ff0: 2020 2020 5468 6973 206f 7074 696f 6e20      This option 
+00014000: 7368 6f75 6c64 206f 6e6c 7920 6265 2075  should only be u
+00014010: 7365 6420 6279 2064 6576 656c 6f70 6572  sed by developer
+00014020: 7320 666f 7220 7465 7374 696e 6720 7075  s for testing pu
+00014030: 7270 6f73 652e 0a20 2020 2020 2020 2022  rpose..        "
+00014040: 2222 0a20 2020 2020 2020 2069 665f 616e  "".        if_an
+00014050: 795f 7761 726e 696e 6720 3d20 4661 6c73  y_warning = Fals
+00014060: 650a 2020 2020 2020 2020 7365 6c66 2e77  e.        self.w
+00014070: 7466 5f6b 6579 5f69 6e66 6f28 2920 2020  tf_key_info()   
+00014080: 2320 6765 7420 6073 656c 662e 616e 616c  # get `self.anal
+00014090: 7973 6973 5f64 6174 6173 6574 5f69 6460  ysis_dataset_id`
+000140a0: 0a20 2020 2020 2020 2023 2070 6174 6820  .        # path 
+000140b0: 746f 2060 6d65 7267 655f 6473 603a 0a20  to `merge_ds`:. 
+000140c0: 2020 2020 2020 206d 6572 6765 5f64 735f         merge_ds_
+000140d0: 7061 7468 203d 206f 702e 6a6f 696e 2873  path = op.join(s
+000140e0: 656c 662e 7072 6f6a 6563 745f 726f 6f74  elf.project_root
+000140f0: 2c20 226d 6572 6765 5f64 7322 290a 0a20  , "merge_ds").. 
+00014100: 2020 2020 2020 2069 6620 6f70 2e65 7869         if op.exi
+00014110: 7374 7328 6d65 7267 655f 6473 5f70 6174  sts(merge_ds_pat
+00014120: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00014130: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00014140: 2246 6f6c 6465 7220 276d 6572 6765 5f64  "Folder 'merge_d
+00014150: 7327 2061 6c72 6561 6479 2065 7869 7374  s' already exist
+00014160: 732e 2060 6261 6273 2d6d 6572 6765 6020  s. `babs-merge` 
+00014170: 776f 6e27 7420 7072 6f63 6565 642e 220a  won't proceed.".
+00014180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014190: 2020 2020 2020 2020 2020 2020 2220 4966              " If
+000141a0: 2079 6f75 2772 6520 7375 7265 2079 6f75   you're sure you
+000141b0: 2077 616e 7420 746f 2072 6572 756e 2060   want to rerun `
+000141c0: 6261 6273 2d6d 6572 6765 602c 220a 2020  babs-merge`,".  
+000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141e0: 2020 2020 2020 2020 2020 2220 706c 6561            " plea
+000141f0: 7365 2072 656d 6f76 6520 7468 6973 2066  se remove this f
+00014200: 6f6c 6465 7220 6265 666f 7265 2079 6f75  older before you
+00014210: 2072 6572 756e 2060 6261 6273 2d6d 6572   rerun `babs-mer
+00014220: 6765 602e 220a 2020 2020 2020 2020 2020  ge`.".          
+00014230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014240: 2020 2220 5061 7468 2074 6f20 276d 6572    " Path to 'mer
+00014250: 6765 5f64 7327 3a20 2722 202b 206d 6572  ge_ds': '" + mer
+00014260: 6765 5f64 735f 7061 7468 202b 2022 272e  ge_ds_path + "'.
+00014270: 2022 290a 0a20 2020 2020 2020 2023 2044   ")..        # D
+00014280: 6566 696e 6520 2870 6f74 656e 7469 616c  efine (potential
+00014290: 2920 7465 7874 2066 696c 6573 3a0a 2020  ) text files:.  
+000142a0: 2020 2020 2020 2320 2020 696e 2027 6d65        #   in 'me
+000142b0: 7267 655f 6473 2f63 6f64 6527 2066 6f6c  rge_ds/code' fol
+000142c0: 6465 720a 2020 2020 2020 2020 2320 2020  der.        #   
+000142d0: 6173 2060 6d65 7267 655f 6473 6020 7368  as `merge_ds` sh
+000142e0: 6f75 6c64 206e 6f74 2065 7869 7374 2061  ould not exist a
+000142f0: 7420 7468 6520 6d6f 6d65 6e74 2c0a 2020  t the moment,.  
+00014300: 2020 2020 2020 2320 2020 6e6f 206e 6565        #   no nee
+00014310: 6420 746f 2063 6865 636b 2065 7869 7374  d to check exist
+00014320: 656e 6365 2f72 656d 6f76 6520 7468 6573  ence/remove thes
+00014330: 6520 6669 6c65 732e 0a20 2020 2020 2020  e files..       
+00014340: 2023 2064 6566 696e 6520 7061 7468 2074   # define path t
+00014350: 6f20 7465 7874 2066 696c 6520 6f66 2069  o text file of i
+00014360: 6e76 616c 6964 206a 6f62 206c 6973 7420  nvalid job list 
+00014370: 6578 6973 7473 3a0a 2020 2020 2020 2020  exists:.        
+00014380: 666e 5f6c 6973 745f 696e 7661 6c69 645f  fn_list_invalid_
+00014390: 6a6f 6273 203d 206f 702e 6a6f 696e 286d  jobs = op.join(m
+000143a0: 6572 6765 5f64 735f 7061 7468 2c20 2263  erge_ds_path, "c
+000143b0: 6f64 6522 2c0a 2020 2020 2020 2020 2020  ode",.          
+000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143d0: 2020 2020 2020 2020 2020 2020 2022 6c69               "li
+000143e0: 7374 5f69 6e76 616c 6964 5f6a 6f62 5f77  st_invalid_job_w
+000143f0: 6865 6e5f 6d65 7267 696e 672e 7478 7422  hen_merging.txt"
+00014400: 290a 2020 2020 2020 2020 2320 6465 6669  ).        # defi
+00014410: 6e65 2070 6174 6820 746f 2074 6578 7420  ne path to text 
+00014420: 6669 6c65 206f 6620 6669 6c65 7320 7769  file of files wi
+00014430: 7468 206d 6973 7369 6e67 2063 6f6e 7465  th missing conte
+00014440: 6e74 3a0a 2020 2020 2020 2020 666e 5f6c  nt:.        fn_l
+00014450: 6973 745f 636f 6e74 656e 745f 6d69 7373  ist_content_miss
+00014460: 696e 6720 3d20 6f70 2e6a 6f69 6e28 6d65  ing = op.join(me
+00014470: 7267 655f 6473 5f70 6174 682c 2022 636f  rge_ds_path, "co
+00014480: 6465 222c 0a20 2020 2020 2020 2020 2020  de",.           
+00014490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000144b0: 6c69 7374 5f63 6f6e 7465 6e74 5f6d 6973  list_content_mis
+000144c0: 7369 6e67 2e74 7874 2229 0a20 2020 2020  sing.txt").     
+000144d0: 2020 2023 2064 6566 696e 6520 7061 7468     # define path
+000144e0: 2074 6f20 7072 696e 7465 6420 6d65 7373   to printed mess
+000144f0: 6167 6573 2066 726f 6d20 6067 6974 2061  ages from `git a
+00014500: 6e6e 6578 2066 7363 6b60 3a0a 2020 2020  nnex fsck`:.    
+00014510: 2020 2020 2320 5e5e 2074 6869 7320 7769      # ^^ this wi
+00014520: 6c6c 2062 6520 6162 736f 6c75 7465 6c79  ll be absolutely
+00014530: 2075 7365 6420 6966 2060 6261 6273 2d6d   used if `babs-m
+00014540: 6572 6765 6020 646f 6573 206e 6f74 2066  erge` does not f
+00014550: 6169 6c3a 0a20 2020 2020 2020 2066 6e5f  ail:.        fn_
+00014560: 6d73 675f 6673 636b 203d 206f 702e 6a6f  msg_fsck = op.jo
+00014570: 696e 286d 6572 6765 5f64 735f 7061 7468  in(merge_ds_path
+00014580: 2c20 2263 6f64 6522 2c0a 2020 2020 2020  , "code",.      
+00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145a0: 2020 2020 2020 2020 226c 6f67 5f67 6974          "log_git
+000145b0: 5f61 6e6e 6578 5f66 7363 6b2e 7478 7422  _annex_fsck.txt"
+000145c0: 290a 0a20 2020 2020 2020 2023 2043 6c6f  )..        # Clo
+000145d0: 6e65 206f 7574 7075 7420 5249 4120 746f  ne output RIA to
+000145e0: 2060 6d65 7267 655f 6473 603a 0a20 2020   `merge_ds`:.   
+000145f0: 2020 2020 2070 7269 6e74 2822 436c 6f6e       print("Clon
+00014600: 696e 6720 6f75 7470 7574 2052 4941 2074  ing output RIA t
+00014610: 6f20 276d 6572 6765 5f64 7327 2e2e 2e22  o 'merge_ds'..."
+00014620: 290a 2020 2020 2020 2020 2320 6765 7420  ).        # get 
+00014630: 7468 6520 7061 7468 2074 6f20 6f75 7470  the path to outp
+00014640: 7574 2052 4941 3a0a 2020 2020 2020 2020  ut RIA:.        
+00014650: 2320 2020 2772 6961 2b66 696c 653a 2f2f  #   'ria+file://
+00014660: 2f70 6174 682f 746f 2f42 4142 535f 7072  /path/to/BABS_pr
+00014670: 6f6a 6563 742f 6f75 7470 7574 5f72 6961  oject/output_ria
+00014680: 2330 3030 3030 3030 2d30 3030 2d78 7878  #0000000-000-xxx
+00014690: 2d78 7878 7878 7878 7827 0a20 2020 2020  -xxxxxxxx'.     
+000146a0: 2020 206f 7574 7075 745f 7269 615f 736f     output_ria_so
+000146b0: 7572 6365 203d 2073 656c 662e 6f75 7470  urce = self.outp
+000146c0: 7574 5f72 6961 5f75 726c 205c 0a20 2020  ut_ria_url \.   
+000146d0: 2020 2020 2020 2020 202b 2022 2322 202b           + "#" +
+000146e0: 2073 656c 662e 616e 616c 7973 6973 5f64   self.analysis_d
+000146f0: 6174 6173 6574 5f69 640a 2020 2020 2020  ataset_id.      
+00014700: 2020 2320 636c 6f6e 653a 2060 6461 7461    # clone: `data
+00014710: 6c61 6420 636c 6f6e 6520 247b 6f75 7470  lad clone ${outp
+00014720: 7574 736f 7572 6365 7d20 6d65 7267 655f  utsource} merge_
+00014730: 6473 600a 2020 2020 2020 2020 646c 6170  ds`.        dlap
+00014740: 692e 636c 6f6e 6528 736f 7572 6365 3d6f  i.clone(source=o
+00014750: 7574 7075 745f 7269 615f 736f 7572 6365  utput_ria_source
+00014760: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014770: 2020 2020 2020 7061 7468 3d6d 6572 6765        path=merge
+00014780: 5f64 735f 7061 7468 290a 0a20 2020 2020  _ds_path)..     
+00014790: 2020 2023 204c 6973 7420 616c 6c20 6272     # List all br
+000147a0: 616e 6368 6573 2069 6e20 6f75 7470 7574  anches in output
+000147b0: 2052 4941 3a0a 2020 2020 2020 2020 7072   RIA:.        pr
+000147c0: 696e 7428 225c 6e4c 6973 7469 6e67 2061  int("\nListing a
+000147d0: 6c6c 2062 7261 6e63 6865 7320 696e 206f  ll branches in o
+000147e0: 7574 7075 7420 5249 412e 2e2e 2229 0a20  utput RIA..."). 
+000147f0: 2020 2020 2020 2023 2067 6574 2061 6c6c         # get all
+00014800: 2062 7261 6e63 6865 733a 0a20 2020 2020   branches:.     
+00014810: 2020 2070 726f 635f 6769 745f 6272 616e     proc_git_bran
+00014820: 6368 5f61 6c6c 203d 2073 7562 7072 6f63  ch_all = subproc
+00014830: 6573 732e 7275 6e28 0a20 2020 2020 2020  ess.run(.       
+00014840: 2020 2020 205b 2267 6974 222c 2022 6272       ["git", "br
+00014850: 616e 6368 222c 2022 2d61 225d 2c0a 2020  anch", "-a"],.  
+00014860: 2020 2020 2020 2020 2020 6377 643d 6d65            cwd=me
+00014870: 7267 655f 6473 5f70 6174 682c 0a20 2020  rge_ds_path,.   
+00014880: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00014890: 7375 6270 726f 6365 7373 2e50 4950 450a  subprocess.PIPE.
+000148a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000148b0: 2020 7072 6f63 5f67 6974 5f62 7261 6e63    proc_git_branc
+000148c0: 685f 616c 6c2e 6368 6563 6b5f 7265 7475  h_all.check_retu
+000148d0: 726e 636f 6465 2829 0a20 2020 2020 2020  rncode().       
+000148e0: 206d 7367 203d 2070 726f 635f 6769 745f   msg = proc_git_
+000148f0: 6272 616e 6368 5f61 6c6c 2e73 7464 6f75  branch_all.stdou
+00014900: 742e 6465 636f 6465 2827 7574 662d 3827  t.decode('utf-8'
+00014910: 290a 2020 2020 2020 2020 6c69 7374 5f62  ).        list_b
+00014920: 7261 6e63 6865 735f 616c 6c20 3d20 6d73  ranches_all = ms
+00014930: 672e 7370 6c69 7428 290a 0a20 2020 2020  g.split()..     
+00014940: 2020 2023 206f 6e6c 7920 6b65 6570 2074     # only keep t
+00014950: 686f 7365 2068 6176 696e 6720 7061 7474  hose having patt
+00014960: 6572 6e20 606a 6f62 2d60 3a0a 2020 2020  ern `job-`:.    
+00014970: 2020 2020 6c69 7374 5f62 7261 6e63 6865      list_branche
+00014980: 735f 6a6f 6273 203d 205b 656c 6520 666f  s_jobs = [ele fo
+00014990: 7220 656c 6520 696e 206c 6973 745f 6272  r ele in list_br
+000149a0: 616e 6368 6573 5f61 6c6c 2069 6620 226a  anches_all if "j
+000149b0: 6f62 2d22 2069 6e20 656c 655d 0a20 2020  ob-" in ele].   
+000149c0: 2020 2020 2023 205e 5e20 5b22 7265 6d6f       # ^^ ["remo
+000149d0: 7465 732f 6f72 6967 696e 2f6a 6f62 2d78  tes/origin/job-x
+000149e0: 7878 222c 2022 7265 6d6f 7465 732f 6f72  xx", "remotes/or
+000149f0: 6967 696e 2f6a 6f62 2d78 7878 222c 202e  igin/job-xxx", .
+00014a00: 2e2e 5d0a 2020 2020 2020 2020 2320 2020  ..].        #   
+00014a10: 6974 2773 206e 6f72 6d61 6c20 616e 6420  it's normal and 
+00014a20: 6e65 6365 7373 6172 7920 746f 2068 6176  necessary to hav
+00014a30: 6520 6072 656d 6f74 6573 2f6f 7269 6769  e `remotes/origi
+00014a40: 6e60 2e20 5365 6520 6e6f 7465 7320 6265  n`. See notes be
+00014a50: 6c6f 772e 0a20 2020 2020 2020 2023 204e  low..        # N
+00014a60: 4f54 453a 206f 7572 206f 7269 6769 6e61  OTE: our origina
+00014a70: 6c20 6261 7368 2073 6372 6970 7420 666f  l bash script fo
+00014a80: 7220 6d65 7267 696e 673a 2060 6d65 7267  r merging: `merg
+00014a90: 655f 6f75 7470 7574 735f 706f 7374 7363  e_outputs_postsc
+00014aa0: 7269 7074 2e73 6860 3a0a 2020 2020 2020  ript.sh`:.      
+00014ab0: 2020 2320 2020 7275 6e20 6067 6974 2062    #   run `git b
+00014ac0: 7261 6e63 6820 2d61 207c 2067 7265 7020  ranch -a | grep 
+00014ad0: 6a6f 622d 207c 2073 6f72 7460 2069 6e20  job- | sort` in 
+00014ae0: 606d 6572 6765 5f64 7360 0a20 2020 2020  `merge_ds`.     
+00014af0: 2020 2023 2020 202d 2d3e 2073 686f 756c     #   --> shoul
+00014b00: 6420 6765 7420 616c 6c20 6272 616e 6368  d get all branch
+00014b10: 6573 2077 686f 7365 206e 616d 6573 2063  es whose names c
+00014b20: 6f6e 7461 696e 2060 2a6a 6f62 2d2a 600a  ontain `*job-*`.
+00014b30: 2020 2020 2020 2020 2320 2020 652e 672e          #   e.g.
+00014b40: 2c20 6072 656d 6f74 6573 2f6f 7269 6769  , `remotes/origi
+00014b50: 6e2f 6a6f 622d 7878 7860 2020 2023 2061  n/job-xxx`   # a
+00014b60: 7320 7275 6e20 696e 2060 6d65 7267 655f  s run in `merge_
+00014b70: 6473 600a 2020 2020 2020 2020 2320 5368  ds`.        # Sh
+00014b80: 6f75 6c64 206e 6f74 2072 756e 2069 6e20  ould not run in 
+00014b90: 6f75 7470 7574 2052 4941 2064 6174 6120  output RIA data 
+00014ba0: 6469 722c 2061 7320 796f 7527 6c6c 2067  dir, as you'll g
+00014bb0: 6574 2062 7261 6e63 6865 7320 7769 7468  et branches with
+00014bc0: 6f75 7420 6072 656d 6f74 6573 2f6f 7269  out `remotes/ori
+00014bd0: 6769 6e60 0a20 2020 2020 2020 2023 2020  gin`.        #  
+00014be0: 202d 2d3e 2072 6169 7365 2065 7272 6f72   --> raise error
+00014bf0: 206f 6620 226d 6572 6765 3a20 6a6f 622d   of "merge: job-
+00014c00: 7878 7878 202d 206e 6f74 2073 6f6d 6574  xxxx - not somet
+00014c10: 6869 6e67 2077 6520 6361 6e20 6d65 7267  hing we can merg
+00014c20: 6522 0a20 2020 2020 2020 2023 2020 2069  e".        #   i
+00014c30: 2e65 2e2c 2063 616e 6e6f 7420 6669 6e64  .e., cannot find
+00014c40: 2074 6865 2062 7261 6e63 6820 746f 206d   the branch to m
+00014c50: 6572 6765 2e0a 0a20 2020 2020 2020 2069  erge...        i
+00014c60: 6620 6c65 6e28 6c69 7374 5f62 7261 6e63  f len(list_branc
+00014c70: 6865 735f 6a6f 6273 2920 3d3d 2030 3a0a  hes_jobs) == 0:.
+00014c80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00014c90: 6520 4578 6365 7074 696f 6e28 2254 6865  e Exception("The
+00014ca0: 7265 2069 7320 6e6f 2073 7563 6365 7373  re is no success
+00014cb0: 6675 6c6c 7920 6669 6e69 7368 6564 206a  fully finished j
+00014cc0: 6f62 2079 6574 2e22 0a20 2020 2020 2020  ob yet.".       
+00014cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ce0: 2020 2020 2022 2050 6c65 6173 6520 7275       " Please ru
+00014cf0: 6e20 6062 6162 732d 7375 626d 6974 6020  n `babs-submit` 
+00014d00: 6669 7273 742e 2229 0a0a 2020 2020 2020  first.")..      
+00014d10: 2020 2320 4669 6e64 2061 6c6c 2076 616c    # Find all val
+00014d20: 6964 2062 7261 6e63 6865 7320 2869 2e65  id branches (i.e
+00014d30: 2e2c 2074 686f 7365 2077 6974 6820 7265  ., those with re
+00014d40: 7375 6c74 7320 2d2d 3e20 6861 7665 2064  sults --> have d
+00014d50: 6966 6665 7265 6e74 2053 4841 5355 4d29  ifferent SHASUM)
+00014d60: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+00014d70: 225c 6e46 696e 6469 6e67 2061 6c6c 2076  "\nFinding all v
+00014d80: 616c 6964 206a 6f62 2062 7261 6e63 6865  alid job branche
+00014d90: 7320 746f 206d 6572 6765 2e2e 2e22 290a  s to merge...").
+00014da0: 2020 2020 2020 2020 2320 6765 7420 6465          # get de
+00014db0: 6661 756c 7420 6272 616e 6368 2773 206e  fault branch's n
+00014dc0: 616d 653a 206d 6173 7465 7220 6f72 206d  ame: master or m
+00014dd0: 6169 6e3a 0a20 2020 2020 2020 2023 2020  ain:.        #  
+00014de0: 2060 6769 7420 7265 6d6f 7465 2073 686f   `git remote sho
+00014df0: 7720 6f72 6967 696e 207c 2073 6564 202d  w origin | sed -
+00014e00: 6e20 272f 4845 4144 2062 7261 6e63 682f  n '/HEAD branch/
+00014e10: 732f 2e2a 3a20 2f2f 7027 600a 2020 2020  s/.*: //p'`.    
+00014e20: 2020 2020 7072 6f63 5f67 6974 5f72 656d      proc_git_rem
+00014e30: 6f74 655f 7368 6f77 5f6f 7269 6769 6e20  ote_show_origin 
+00014e40: 3d20 7375 6270 726f 6365 7373 2e72 756e  = subprocess.run
+00014e50: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
+00014e60: 6769 7422 2c20 2272 656d 6f74 6522 2c20  git", "remote", 
+00014e70: 2273 686f 7722 2c20 276f 7269 6769 6e27  "show", 'origin'
+00014e80: 5d2c 0a20 2020 2020 2020 2020 2020 2063  ],.            c
+00014e90: 7764 3d6d 6572 6765 5f64 735f 7061 7468  wd=merge_ds_path
+00014ea0: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+00014eb0: 646f 7574 3d73 7562 7072 6f63 6573 732e  dout=subprocess.
+00014ec0: 5049 5045 290a 2020 2020 2020 2020 7072  PIPE).        pr
+00014ed0: 6f63 5f67 6974 5f72 656d 6f74 655f 7368  oc_git_remote_sh
+00014ee0: 6f77 5f6f 7269 6769 6e2e 6368 6563 6b5f  ow_origin.check_
+00014ef0: 7265 7475 726e 636f 6465 2829 0a20 2020  returncode().   
+00014f00: 2020 2020 206d 7367 203d 2070 726f 635f       msg = proc_
+00014f10: 6769 745f 7265 6d6f 7465 5f73 686f 775f  git_remote_show_
+00014f20: 6f72 6967 696e 2e73 7464 6f75 742e 6465  origin.stdout.de
+00014f30: 636f 6465 2827 7574 662d 3827 290a 2020  code('utf-8').  
+00014f40: 2020 2020 2020 2320 652e 672e 2c20 272e        # e.g., '.
+00014f50: 2e2e 2048 4541 4420 6272 616e 6368 3a20  .. HEAD branch: 
+00014f60: 6d61 7374 6572 5c6e 2e2e 2e2e 273a 2073  master\n....': s
+00014f70: 6561 7263 6820 6265 7477 6565 6e20 2748  earch between 'H
+00014f80: 4541 4420 6272 616e 6368 3a20 2720 616e  EAD branch: ' an
+00014f90: 6420 275c 6e27 3a0a 2020 2020 2020 2020  d '\n':.        
+00014fa0: 7465 6d70 203d 2072 652e 7365 6172 6368  temp = re.search
+00014fb0: 2827 4845 4144 2062 7261 6e63 683a 2027  ('HEAD branch: '
+00014fc0: 2b27 282e 2b3f 2927 2b27 5c6e 272c 206d  +'(.+?)'+'\n', m
+00014fd0: 7367 290a 2020 2020 2020 2020 6966 2074  sg).        if t
+00014fe0: 656d 703a 2020 2023 206e 6f74 2065 6d70  emp:   # not emp
+00014ff0: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
+00015000: 6465 6661 756c 745f 6272 616e 6368 5f6e  default_branch_n
+00015010: 616d 6520 3d20 7465 6d70 2e67 726f 7570  ame = temp.group
+00015020: 2831 2920 2020 2320 7768 6174 2773 2062  (1)   # what's b
+00015030: 6574 7765 656e 2074 686f 7365 2074 776f  etween those two
+00015040: 206b 6579 776f 7264 730a 2020 2020 2020   keywords.      
+00015050: 2020 2020 2020 2320 616e 6f74 6865 7220        # another 
+00015060: 7761 793a 2060 6465 6661 756c 745f 6272  way: `default_br
+00015070: 616e 6368 5f6e 616d 6520 3d20 6d73 672e  anch_name = msg.
+00015080: 7370 6c69 7428 2248 4541 4420 6272 616e  split("HEAD bran
+00015090: 6368 3a20 2229 5b31 5d2e 7370 6c69 7428  ch: ")[1].split(
+000150a0: 225c 6e22 295b 305d 600a 2020 2020 2020  "\n")[0]`.      
+000150b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000150c0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+000150d0: 696f 6e28 2254 6865 7265 2069 7320 6e6f  ion("There is no
+000150e0: 2048 4541 4420 6272 616e 6368 2069 6e20   HEAD branch in 
+000150f0: 6f75 7470 7574 2052 4941 2122 290a 2020  output RIA!").  
+00015100: 2020 2020 2020 7072 696e 7428 2247 6974        print("Git
+00015110: 2064 6566 6175 6c74 2062 7261 6e63 6827   default branch'
+00015120: 7320 6e61 6d65 206f 6620 6f75 7470 7574  s name of output
+00015130: 2052 4941 2069 733a 2027 2220 2b20 6465   RIA is: '" + de
+00015140: 6661 756c 745f 6272 616e 6368 5f6e 616d  fault_branch_nam
+00015150: 6520 2b20 2227 2229 0a0a 2020 2020 2020  e + "'")..      
+00015160: 2020 2320 6765 7420 6375 7272 656e 7420    # get current 
+00015170: 6769 7420 636f 6d6d 6974 2053 4841 5355  git commit SHASU
+00015180: 4d20 6265 666f 7265 206d 6572 6769 6e67  M before merging
+00015190: 2061 7320 6120 7265 6665 7265 6e63 653a   as a reference:
+000151a0: 0a20 2020 2020 2020 2067 6974 5f72 6566  .        git_ref
+000151b0: 2c20 5f20 3d20 6765 745f 6769 745f 7368  , _ = get_git_sh
+000151c0: 6f77 5f72 6566 5f73 6861 7375 6d28 6465  ow_ref_shasum(de
+000151d0: 6661 756c 745f 6272 616e 6368 5f6e 616d  fault_branch_nam
+000151e0: 652c 206d 6572 6765 5f64 735f 7061 7468  e, merge_ds_path
+000151f0: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
+00015200: 636b 2069 6620 6561 6368 206a 6f62 2062  ck if each job b
+00015210: 7261 6e63 6820 6861 7320 6120 6e65 7720  ranch has a new 
+00015220: 636f 6d6d 6974 0a20 2020 2020 2020 2023  commit.        #
+00015230: 2020 2074 6861 7427 7320 6469 6666 6572     that's differ
+00015240: 656e 7420 6672 6f6d 2063 7572 7265 6e74  ent from current
+00015250: 2067 6974 2063 6f6d 6d69 7420 5348 4153   git commit SHAS
+00015260: 554d 2028 6067 6974 5f72 6566 6029 3a0a  UM (`git_ref`):.
+00015270: 2020 2020 2020 2020 6c69 7374 5f62 7261          list_bra
+00015280: 6e63 6865 735f 6e6f 5f72 6573 756c 7473  nches_no_results
+00015290: 203d 205b 5d0a 2020 2020 2020 2020 6c69   = [].        li
+000152a0: 7374 5f62 7261 6e63 6865 735f 7769 7468  st_branches_with
+000152b0: 5f72 6573 756c 7473 203d 205b 5d0a 2020  _results = [].  
+000152c0: 2020 2020 2020 666f 7220 6272 616e 6368        for branch
+000152d0: 5f6a 6f62 2069 6e20 6c69 7374 5f62 7261  _job in list_bra
+000152e0: 6e63 6865 735f 6a6f 6273 3a0a 2020 2020  nches_jobs:.    
+000152f0: 2020 2020 2020 2020 2320 6765 7420 7468          # get th
+00015300: 6520 6a6f 6227 7320 6067 6974 2073 686f  e job's `git sho
+00015310: 772d 7265 6660 3a0a 2020 2020 2020 2020  w-ref`:.        
+00015320: 2020 2020 6769 745f 7265 665f 6272 616e      git_ref_bran
+00015330: 6368 5f6a 6f62 2c20 5f20 3d20 5c0a 2020  ch_job, _ = \.  
+00015340: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+00015350: 745f 6769 745f 7368 6f77 5f72 6566 5f73  t_git_show_ref_s
+00015360: 6861 7375 6d28 6272 616e 6368 5f6a 6f62  hasum(branch_job
+00015370: 2c20 6d65 7267 655f 6473 5f70 6174 6829  , merge_ds_path)
+00015380: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00015390: 6769 745f 7265 665f 6272 616e 6368 5f6a  git_ref_branch_j
+000153a0: 6f62 203d 3d20 6769 745f 7265 663a 2020  ob == git_ref:  
+000153b0: 2023 206e 6f20 6e65 7720 636f 6d6d 6974   # no new commit
+000153c0: 202d 2d3e 206e 6f20 7265 7375 6c74 7320   --> no results 
+000153d0: 696e 2074 6869 7320 6272 616e 6368 0a20  in this branch. 
+000153e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000153f0: 6973 745f 6272 616e 6368 6573 5f6e 6f5f  ist_branches_no_
+00015400: 7265 7375 6c74 732e 6170 7065 6e64 2862  results.append(b
+00015410: 7261 6e63 685f 6a6f 6229 0a20 2020 2020  ranch_job).     
+00015420: 2020 2020 2020 2065 6c73 653a 2020 2023         else:   #
+00015430: 2068 6173 2072 6573 756c 7473 3a0a 2020   has results:.  
+00015440: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00015450: 7374 5f62 7261 6e63 6865 735f 7769 7468  st_branches_with
+00015460: 5f72 6573 756c 7473 2e61 7070 656e 6428  _results.append(
+00015470: 6272 616e 6368 5f6a 6f62 290a 0a20 2020  branch_job)..   
+00015480: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+00015490: 7468 6572 6520 6973 2061 6e79 2076 616c  there is any val
+000154a0: 6964 206a 6f62 2028 7769 7468 2072 6573  id job (with res
+000154b0: 756c 7473 293a 0a20 2020 2020 2020 2069  ults):.        i
+000154c0: 6620 6c65 6e28 6c69 7374 5f62 7261 6e63  f len(list_branc
+000154d0: 6865 735f 7769 7468 5f72 6573 756c 7473  hes_with_results
+000154e0: 2920 3d3d 2030 3a20 2020 2320 656d 7074  ) == 0:   # empt
+000154f0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00015500: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+00015510: 5468 6572 6520 6973 206e 6f20 6a6f 6220  There is no job 
+00015520: 6272 616e 6368 2069 6e20 6f75 7470 7574  branch in output
+00015530: 2052 4941 2074 6861 7420 6861 7320 7265   RIA that has re
+00015540: 7375 6c74 7320 7965 742c 220a 2020 2020  sults yet,".    
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 2020 2020 2b20 2220 692e 652e          + " i.e.
+00015570: 2c20 7468 6572 6520 6973 206e 6f20 7375  , there is no su
+00015580: 6363 6573 7366 756c 6c79 2066 696e 6973  ccessfully finis
+00015590: 6865 6420 6a6f 6220 7965 742e 220a 2020  hed job yet.".  
+000155a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155b0: 2020 2020 2020 2020 2020 2b20 2220 506c            + " Pl
+000155c0: 6561 7365 2072 756e 2060 6261 6273 2d73  ease run `babs-s
+000155d0: 7562 6d69 7460 2066 6972 7374 2e22 290a  ubmit` first.").
+000155e0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+000155f0: 2069 6620 7468 6572 6520 6973 2069 6e76   if there is inv
+00015600: 616c 6964 206a 6f62 2028 7769 7468 6f75  alid job (withou
+00015610: 7420 7265 7375 6c74 7329 3a0a 2020 2020  t results):.    
+00015620: 2020 2020 6966 206c 656e 286c 6973 745f      if len(list_
+00015630: 6272 616e 6368 6573 5f6e 6f5f 7265 7375  branches_no_resu
+00015640: 6c74 7329 203e 2030 3a20 2020 2320 6e6f  lts) > 0:   # no
+00015650: 7420 656d 7074 790a 2020 2020 2020 2020  t empty.        
+00015660: 2020 2020 2320 7361 7665 2074 6f20 6120      # save to a 
+00015670: 7465 7874 2066 696c 653a 0a20 2020 2020  text file:.     
+00015680: 2020 2020 2020 2023 2020 206e 6f74 653a         #   note:
+00015690: 2074 6869 7320 6669 6c65 2068 6173 2062   this file has b
+000156a0: 6565 6e20 7265 6d6f 7665 6420 6174 2074  een removed at t
+000156b0: 6865 2062 6567 696e 6e69 6e67 206f 6620  he beginning of 
+000156c0: 6261 6273 5f6d 6572 6765 2829 2069 6620  babs_merge() if 
+000156d0: 6974 2065 7869 7374 6564 290a 2020 2020  it existed).    
+000156e0: 2020 2020 2020 2020 6966 5f61 6e79 5f77          if_any_w
+000156f0: 6172 6e69 6e67 203d 2054 7275 650a 2020  arning = True.  
+00015700: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00015710: 6773 2e77 6172 6e28 2254 6865 7265 2061  gs.warn("There a
+00015720: 7265 2069 6e76 616c 6964 206a 6f62 2062  re invalid job b
+00015730: 7261 6e63 6828 6573 2920 696e 206f 7574  ranch(es) in out
+00015740: 7075 7420 5249 412c 220a 2020 2020 2020  put RIA,".      
+00015750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015760: 2020 2020 2b20 2220 616e 6420 7468 6573      + " and thes
+00015770: 6520 6a6f 6228 7329 2064 6f20 6e6f 7420  e job(s) do not 
+00015780: 6861 7665 2072 6573 756c 7473 2e22 0a20  have results.". 
+00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157a0: 2020 2020 2020 2020 202b 2022 2054 6865           + " The
+000157b0: 206c 6973 7420 6f66 2073 7563 6820 696e   list of such in
+000157c0: 7661 6c69 6420 6a6f 6273 2077 696c 6c20  valid jobs will 
+000157d0: 6265 2073 6176 6564 2074 6f22 0a20 2020  be saved to".   
+000157e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157f0: 2020 2020 2020 202b 2022 2074 6865 2066         + " the f
+00015800: 6f6c 6c6f 7769 6e67 2074 6578 7420 6669  ollowing text fi
+00015810: 6c65 3a20 2722 202b 2066 6e5f 6c69 7374  le: '" + fn_list
+00015820: 5f69 6e76 616c 6964 5f6a 6f62 7320 2b20  _invalid_jobs + 
+00015830: 2227 2e22 0a20 2020 2020 2020 2020 2020  "'.".           
+00015840: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00015850: 2022 2050 6c65 6173 6520 7265 7669 6577   " Please review
+00015860: 2069 742e 2229 0a20 2020 2020 2020 2020   it.").         
+00015870: 2020 2077 6974 6820 6f70 656e 2866 6e5f     with open(fn_
+00015880: 6c69 7374 5f69 6e76 616c 6964 5f6a 6f62  list_invalid_job
+00015890: 732c 2022 7722 2920 6173 2066 3a0a 2020  s, "w") as f:.  
+000158a0: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+000158b0: 7772 6974 6528 275c 6e27 2e6a 6f69 6e28  write('\n'.join(
+000158c0: 6c69 7374 5f62 7261 6e63 6865 735f 6e6f  list_branches_no
+000158d0: 5f72 6573 756c 7473 2929 0a20 2020 2020  _results)).     
+000158e0: 2020 2020 2020 2020 2020 2066 2e77 7269             f.wri
+000158f0: 7465 2822 5c6e 2229 2020 2023 2061 6464  te("\n")   # add
+00015900: 2061 206e 6577 206c 696e 6520 6174 2074   a new line at t
+00015910: 6865 2065 6e64 0a20 2020 2020 2020 2023  he end.        #
+00015920: 204e 4f54 4520 746f 2064 6576 656c 6f70   NOTE to develop
+00015930: 6572 733a 2077 6865 6e20 7465 7374 696e  ers: when testin
+00015940: 6720 5e5e 3a0a 2020 2020 2020 2020 2320  g ^^:.        # 
+00015950: 2020 596f 7520 6361 6e20 6067 6974 2062    You can `git b
+00015960: 7261 6e63 6820 6a6f 622d 7465 7374 6020  ranch job-test` 
+00015970: 696e 2060 6f75 7470 7574 5f72 6961 2f30  in `output_ria/0
+00015980: 3030 2f30 3030 2d30 3030 6020 746f 206d  00/000-000` to m
+00015990: 616b 6520 6120 6661 6b65 2062 7261 6e63  ake a fake branc
+000159a0: 680a 2020 2020 2020 2020 2320 2020 2020  h.        #     
+000159b0: 2020 7468 6174 2068 6173 2074 6865 2073    that has the s
+000159c0: 616d 6520 5348 4153 554d 2061 7320 6d61  ame SHASUM as ma
+000159d0: 7374 6572 2062 7261 6e63 6827 730a 2020  ster branch's.  
+000159e0: 2020 2020 2020 2320 2020 2020 2020 7468        #       th
+000159f0: 656e 2079 6f75 2073 686f 756c 6420 7365  en you should se
+00015a00: 6520 6162 6f76 6520 7761 726e 696e 672e  e above warning.
+00015a10: 0a20 2020 2020 2020 2023 2020 2048 6f77  .        #   How
+00015a20: 6576 6572 2c20 6966 2079 6f75 2066 696e  ever, if you fin
+00015a30: 6973 6820 7275 6e6e 696e 6720 6062 6162  ish running `bab
+00015a40: 732d 6d65 7267 6560 2c20 7468 6973 2062  s-merge`, this b
+00015a50: 7261 6e63 6820 606a 6f62 2d74 6573 7460  ranch `job-test`
+00015a60: 2077 696c 6c20 6861 7665 0a20 2020 2020   will have.     
+00015a70: 2020 2023 2020 2020 2020 2061 202a 6469     #       a *di
+00015a80: 6666 6572 656e 742a 2053 4841 5355 4d20  fferent* SHASUM 
+00015a90: 6672 6f6d 206d 6173 7465 7227 732c 206d  from master's, m
+00015aa0: 616b 696e 6720 6974 2061 2022 7661 6c69  aking it a "vali
+00015ab0: 6422 206a 6f62 206e 6f77 2e0a 2020 2020  d" job now..    
+00015ac0: 2020 2020 2320 2020 546f 2063 6f6e 7469      #   To conti
+00015ad0: 6e75 6520 7465 7374 696e 6720 6162 6f76  nue testing abov
+00015ae0: 6520 7761 726e 696e 672c 2079 6f75 206e  e warning, you n
+00015af0: 6565 6420 746f 2064 656c 6574 6520 7468  eed to delete th
+00015b00: 6973 2062 7261 6e63 683a 0a20 2020 2020  is branch:.     
+00015b10: 2020 2023 2020 2020 2020 2060 6769 7420     #       `git 
+00015b20: 6272 616e 6368 202d 2d64 656c 6574 6520  branch --delete 
+00015b30: 6a6f 622d 7465 7374 6020 696e 2060 6f75  job-test` in `ou
+00015b40: 7470 7574 5f72 6961 2f30 3030 2f30 3030  tput_ria/000/000
+00015b50: 2d30 3030 600a 2020 2020 2020 2020 2320  -000`.        # 
+00015b60: 2020 2020 2020 7468 656e 2072 652d 6372        then re-cr
+00015b70: 6561 7465 2061 206e 6577 206f 6e65 3a20  eate a new one: 
+00015b80: 6067 6974 2062 7261 6e63 6820 6a6f 622d  `git branch job-
+00015b90: 7465 7374 600a 0a20 2020 2020 2020 2023  test`..        #
+00015ba0: 204d 6572 6765 2076 616c 6964 2062 7261   Merge valid bra
+00015bb0: 6e63 6865 7320 6368 756e 6b20 6279 2063  nches chunk by c
+00015bc0: 6875 6e6b 3a0a 2020 2020 2020 2020 7072  hunk:.        pr
+00015bd0: 696e 7428 225c 6e4d 6572 6769 6e67 2076  int("\nMerging v
+00015be0: 616c 6964 206a 6f62 2062 7261 6e63 6865  alid job branche
+00015bf0: 7320 6368 756e 6b20 6279 2063 6875 6e6b  s chunk by chunk
+00015c00: 2e2e 2e22 290a 2020 2020 2020 2020 7072  ...").        pr
+00015c10: 696e 7428 2254 6f74 616c 206e 756d 6265  int("Total numbe
+00015c20: 7220 6f66 206a 6f62 2062 7261 6e63 6865  r of job branche
+00015c30: 7320 746f 206d 6572 6765 203d 2022 202b  s to merge = " +
+00015c40: 2073 7472 286c 656e 286c 6973 745f 6272   str(len(list_br
+00015c50: 616e 6368 6573 5f77 6974 685f 7265 7375  anches_with_resu
+00015c60: 6c74 7329 2929 0a20 2020 2020 2020 2070  lts))).        p
+00015c70: 7269 6e74 2822 4368 756e 6b20 7369 7a65  rint("Chunk size
+00015c80: 2028 6e75 6d62 6572 206f 6620 6a6f 6220   (number of job 
+00015c90: 6272 616e 6368 6573 2070 6572 2063 6875  branches per chu
+00015ca0: 6e6b 2920 3d20 2220 2b20 7374 7228 6368  nk) = " + str(ch
+00015cb0: 756e 6b5f 7369 7a65 2929 0a20 2020 2020  unk_size)).     
+00015cc0: 2020 2023 2074 7572 6e20 7468 6520 6c69     # turn the li
+00015cd0: 7374 2069 6e74 6f20 6e75 6d70 7920 6172  st into numpy ar
+00015ce0: 7261 793a 0a20 2020 2020 2020 2061 7272  ray:.        arr
+00015cf0: 203d 206e 702e 6173 6172 7261 7928 6c69   = np.asarray(li
+00015d00: 7374 5f62 7261 6e63 6865 735f 7769 7468  st_branches_with
+00015d10: 5f72 6573 756c 7473 290a 2020 2020 2020  _results).      
+00015d20: 2020 2320 5e5e 2065 2e67 2e2c 2061 7272    # ^^ e.g., arr
+00015d30: 6179 285b 312c 2037 2c20 302c 2036 2c20  ay([1, 7, 0, 6, 
+00015d40: 322c 2035 2c20 365d 2920 2020 2320 6275  2, 5, 6])   # bu
+00015d50: 7420 7769 7468 2060 6474 7970 653d 273c  t with `dtype='<
+00015d60: 5532 3427 600a 2020 2020 2020 2020 2320  U24'`.        # 
+00015d70: 7370 6c69 7420 696e 746f 2073 6576 6572  split into sever
+00015d80: 616c 2063 6875 6e6b 733a 0a20 2020 2020  al chunks:.     
+00015d90: 2020 206e 756d 5f63 6875 6e6b 7320 3d20     num_chunks = 
+00015da0: 6365 696c 6469 7628 6c65 6e28 6172 7229  ceildiv(len(arr)
+00015db0: 2c20 6368 756e 6b5f 7369 7a65 290a 2020  , chunk_size).  
+00015dc0: 2020 2020 2020 7072 696e 7428 222d 2d3e        print("-->
+00015dd0: 204e 756d 6265 7220 6f66 2063 6875 6e6b   Number of chunk
+00015de0: 7320 3d20 2220 2b20 7374 7228 6e75 6d5f  s = " + str(num_
+00015df0: 6368 756e 6b73 2929 0a20 2020 2020 2020  chunks)).       
+00015e00: 2061 6c6c 5f63 6875 6e6b 7320 3d20 6e70   all_chunks = np
+00015e10: 2e61 7272 6179 5f73 706c 6974 2861 7272  .array_split(arr
+00015e20: 2c20 6e75 6d5f 6368 756e 6b73 290a 2020  , num_chunks).  
+00015e30: 2020 2020 2020 2320 5e5e 2065 2e67 2e2c        # ^^ e.g.,
+00015e40: 205b 6172 7261 7928 5b31 2c20 372c 2030   [array([1, 7, 0
+00015e50: 5d29 2c20 6172 7261 7928 5b36 2c20 325d  ]), array([6, 2]
+00015e60: 292c 2061 7272 6179 285b 352c 2036 5d29  ), array([5, 6])
+00015e70: 5d0a 0a20 2020 2020 2020 2023 2069 7465  ]..        # ite
+00015e80: 7261 7465 2061 6372 6f73 7320 6368 756e  rate across chun
+00015e90: 6b73 3a0a 2020 2020 2020 2020 666f 7220  ks:.        for 
+00015ea0: 695f 6368 756e 6b20 696e 2072 616e 6765  i_chunk in range
+00015eb0: 2830 2c20 6e75 6d5f 6368 756e 6b73 293a  (0, num_chunks):
+00015ec0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00015ed0: 6e74 2822 4d65 7267 696e 6720 6368 756e  nt("Merging chun
+00015ee0: 6b20 2322 202b 2073 7472 2869 5f63 6875  k #" + str(i_chu
+00015ef0: 6e6b 2b31 290a 2020 2020 2020 2020 2020  nk+1).          
+00015f00: 2020 2020 2020 2020 2b20 2220 2874 6f74          + " (tot
+00015f10: 616c 206f 6620 2220 2b20 7374 7228 6e75  al of " + str(nu
+00015f20: 6d5f 6368 756e 6b73 2920 2b20 2220 6368  m_chunks) + " ch
+00015f30: 756e 6b5b 735d 2074 6f20 6d65 7267 6529  unk[s] to merge)
+00015f40: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00015f50: 2020 7468 655f 6368 756e 6b20 3d20 616c    the_chunk = al
+00015f60: 6c5f 6368 756e 6b73 5b69 5f63 6875 6e6b  l_chunks[i_chunk
+00015f70: 5d20 2023 2065 2e67 2e2c 2061 7272 6179  ]  # e.g., array
+00015f80: 285b 2761 272c 2027 6227 2c20 2763 275d  (['a', 'b', 'c']
+00015f90: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00015fa0: 6a6f 696e 2061 6c6c 2062 7261 6e63 6865  join all branche
+00015fb0: 7320 696e 2074 6869 7320 6368 756e 6b3a  s in this chunk:
+00015fc0: 0a20 2020 2020 2020 2020 2020 206a 6f69  .            joi
+00015fd0: 6e65 645f 6279 5f73 7061 6365 203d 2022  ned_by_space = "
+00015fe0: 2022 2e6a 6f69 6e28 7468 655f 6368 756e   ".join(the_chun
+00015ff0: 6b29 2020 2023 2065 2e67 2e2c 2027 6120  k)   # e.g., 'a 
+00016000: 6220 6327 0a20 2020 2020 2020 2020 2020  b c'.           
+00016010: 2023 2063 6f6d 6d61 6e64 2074 6f20 7275   # command to ru
+00016020: 6e3a 0a20 2020 2020 2020 2020 2020 2063  n:.            c
+00016030: 6f6d 6d69 745f 6d73 6720 3d20 226d 6572  ommit_msg = "mer
+00016040: 6765 2072 6573 756c 7473 2063 6875 6e6b  ge results chunk
+00016050: 2022 205c 0a20 2020 2020 2020 2020 2020   " \.           
+00016060: 2020 2020 202b 2073 7472 2869 5f63 6875       + str(i_chu
+00016070: 6e6b 2b31 2920 2b20 222f 2220 2b20 7374  nk+1) + "/" + st
+00016080: 7228 6e75 6d5f 6368 756e 6b73 290a 2020  r(num_chunks).  
+00016090: 2020 2020 2020 2020 2020 2320 5e5e 206f            # ^^ o
+000160a0: 6b61 7920 746f 206e 6f74 2074 6f20 6265  kay to not to be
+000160b0: 2071 756f 7465 642c 0a20 2020 2020 2020   quoted,.       
+000160c0: 2020 2020 2023 2020 2061 7320 696e 2060       #   as in `
+000160d0: 7375 6270 726f 6365 7373 2e72 756e 6020  subprocess.run` 
+000160e0: 7468 6973 2069 7320 6120 7365 7061 7261  this is a separa
+000160f0: 7465 2065 6c65 6d65 6e74 2069 6e20 7468  te element in th
+00016100: 6520 6063 6d64 6020 6c69 7374 0a20 2020  e `cmd` list.   
+00016110: 2020 2020 2020 2020 2063 6d64 203d 205b           cmd = [
+00016120: 2267 6974 222c 2022 6d65 7267 6522 2c20  "git", "merge", 
+00016130: 222d 6d22 2c20 636f 6d6d 6974 5f6d 7367  "-m", commit_msg
+00016140: 5d20 5c0a 2020 2020 2020 2020 2020 2020  ] \.            
+00016150: 2020 2020 2b20 6a6f 696e 6564 5f62 795f      + joined_by_
+00016160: 7370 6163 652e 7370 6c69 7428 2220 2229  space.split(" ")
+00016170: 2020 2023 2073 706c 6974 2062 7920 7370     # split by sp
+00016180: 6163 650a 2020 2020 2020 2020 2020 2020  ace.            
+00016190: 7072 6f63 5f67 6974 5f6d 6572 6765 203d  proc_git_merge =
+000161a0: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
+000161b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161c0: 2063 6d64 2c0a 2020 2020 2020 2020 2020   cmd,.          
+000161d0: 2020 2020 2020 6377 643d 6d65 7267 655f        cwd=merge_
+000161e0: 6473 5f70 6174 682c 0a20 2020 2020 2020  ds_path,.       
+000161f0: 2020 2020 2020 2020 2073 7464 6f75 743d           stdout=
+00016200: 7375 6270 726f 6365 7373 2e50 4950 4529  subprocess.PIPE)
+00016210: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00016220: 635f 6769 745f 6d65 7267 652e 6368 6563  c_git_merge.chec
+00016230: 6b5f 7265 7475 726e 636f 6465 2829 0a20  k_returncode(). 
+00016240: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00016250: 2870 726f 635f 6769 745f 6d65 7267 652e  (proc_git_merge.
+00016260: 7374 646f 7574 2e64 6563 6f64 6528 2775  stdout.decode('u
+00016270: 7466 2d38 2729 290a 0a20 2020 2020 2020  tf-8'))..       
+00016280: 2023 2050 7573 6820 6d65 7267 696e 6720   # Push merging 
+00016290: 6163 7469 6f6e 7320 6261 636b 2074 6f20  actions back to 
+000162a0: 6f75 7470 7574 2052 4941 3a0a 2020 2020  output RIA:.    
+000162b0: 2020 2020 6966 206e 6f74 2074 7269 616c      if not trial
+000162c0: 5f72 756e 3a0a 2020 2020 2020 2020 2020  _run:.          
+000162d0: 2020 7072 696e 7428 225c 6e50 7573 6869    print("\nPushi
+000162e0: 6e67 206d 6572 6769 6e67 2061 6374 696f  ng merging actio
+000162f0: 6e73 2074 6f20 6f75 7470 7574 2052 4941  ns to output RIA
+00016300: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00016310: 2020 2320 6067 6974 2070 7573 6860 3a0a    # `git push`:.
+00016320: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00016330: 5f67 6974 5f70 7573 6820 3d20 7375 6270  _git_push = subp
+00016340: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
+00016350: 2020 2020 2020 2020 2020 2020 5b22 6769              ["gi
+00016360: 7422 2c20 2270 7573 6822 5d2c 0a20 2020  t", "push"],.   
+00016370: 2020 2020 2020 2020 2020 2020 2063 7764               cwd
+00016380: 3d6d 6572 6765 5f64 735f 7061 7468 2c20  =merge_ds_path, 
+00016390: 7374 646f 7574 3d73 7562 7072 6f63 6573  stdout=subproces
+000163a0: 732e 5049 5045 290a 2020 2020 2020 2020  s.PIPE).        
+000163b0: 2020 2020 7072 6f63 5f67 6974 5f70 7573      proc_git_pus
+000163c0: 682e 6368 6563 6b5f 7265 7475 726e 636f  h.check_returnco
+000163d0: 6465 2829 0a20 2020 2020 2020 2020 2020  de().           
+000163e0: 2070 7269 6e74 2870 726f 635f 6769 745f   print(proc_git_
+000163f0: 7075 7368 2e73 7464 6f75 742e 6465 636f  push.stdout.deco
+00016400: 6465 2827 7574 662d 3827 2929 0a0a 2020  de('utf-8'))..  
+00016410: 2020 2020 2020 2020 2020 2320 4765 7420            # Get 
+00016420: 6669 6c65 2061 7661 696c 6162 696c 6974  file availabilit
+00016430: 7920 696e 666f 726d 6174 696f 6e3a 2077  y information: w
+00016440: 6869 6368 2069 7320 7665 7279 2069 6d70  hich is very imp
+00016450: 6f72 7461 6e74 210a 2020 2020 2020 2020  ortant!.        
+00016460: 2020 2020 2320 6067 6974 2061 6e6e 6578      # `git annex
+00016470: 2066 7363 6b20 2d2d 6661 7374 202d 6620   fsck --fast -f 
+00016480: 6f75 7470 7574 2d73 746f 7261 6765 603a  output-storage`:
+00016490: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+000164a0: 2060 6769 7420 616e 6e65 7820 6673 636b   `git annex fsck
+000164b0: 6020 3d20 6669 6c65 2073 7973 7465 6d20  ` = file system 
+000164c0: 6368 6563 6b0a 2020 2020 2020 2020 2020  check.          
+000164d0: 2020 2320 2020 5765 2776 6520 646f 6e65    #   We've done
+000164e0: 2074 6865 2067 6974 206d 6572 6765 206f   the git merge o
+000164f0: 6620 7468 6520 7379 6d6c 696e 6b73 206f  f the symlinks o
+00016500: 6620 7468 6520 6669 6c65 732c 0a20 2020  f the files,.   
+00016510: 2020 2020 2020 2020 2023 2020 206e 6f77           #   now
+00016520: 2077 6520 6e65 6564 2074 6f20 6d61 7463   we need to matc
+00016530: 6820 7468 6520 7379 6d6c 696e 6b73 2077  h the symlinks w
+00016540: 6974 6820 7468 6520 6461 7461 2063 6f6e  ith the data con
+00016550: 7465 6e74 2069 6e20 606f 7574 7075 742d  tent in `output-
+00016560: 7374 6f72 6167 6560 2e0a 2020 2020 2020  storage`..      
+00016570: 2020 2020 2020 2320 2020 602d 2d66 6173        #   `--fas
+00016580: 7460 3a20 6a75 7374 2075 7365 2074 6865  t`: just use the
+00016590: 2065 7869 7374 696e 6720 4d44 352c 206e   existing MD5, n
+000165a0: 6f74 2074 6f20 7265 2d63 7265 6174 6520  ot to re-create 
+000165b0: 6120 6e65 7720 6f6e 650a 2020 2020 2020  a new one.      
+000165c0: 2020 2020 2020 7072 6f63 5f67 6974 5f61        proc_git_a
+000165d0: 6e6e 6578 5f66 7363 6b20 3d20 7375 6270  nnex_fsck = subp
+000165e0: 726f 6365 7373 2e72 756e 280a 2020 2020  rocess.run(.    
+000165f0: 2020 2020 2020 2020 2020 2020 5b22 6769              ["gi
+00016600: 7422 2c20 2261 6e6e 6578 222c 2022 6673  t", "annex", "fs
+00016610: 636b 222c 2022 2d2d 6661 7374 222c 2022  ck", "--fast", "
+00016620: 2d66 222c 2022 6f75 7470 7574 2d73 746f  -f", "output-sto
+00016630: 7261 6765 225d 2c0a 2020 2020 2020 2020  rage"],.        
+00016640: 2020 2020 2020 2020 6377 643d 6d65 7267          cwd=merg
+00016650: 655f 6473 5f70 6174 682c 2073 7464 6f75  e_ds_path, stdou
+00016660: 743d 7375 6270 726f 6365 7373 2e50 4950  t=subprocess.PIP
+00016670: 4529 0a20 2020 2020 2020 2020 2020 2070  E).            p
+00016680: 726f 635f 6769 745f 616e 6e65 785f 6673  roc_git_annex_fs
+00016690: 636b 2e63 6865 636b 5f72 6574 7572 6e63  ck.check_returnc
+000166a0: 6f64 6528 290a 2020 2020 2020 2020 2020  ode().          
+000166b0: 2020 2320 6966 2070 7269 6e74 696e 6720    # if printing 
+000166c0: 7468 6520 7265 7475 726e 6564 206d 7367  the returned msg
+000166d0: 2c0a 2020 2020 2020 2020 2020 2020 2320  ,.            # 
+000166e0: 2020 7769 6c6c 2062 6520 6120 6c6f 6e67    will be a long
+000166f0: 206c 6973 7420 6f66 2022 6673 636b 2078   list of "fsck x
+00016700: 7878 2e7a 6970 2028 6669 7869 6e67 206c  xx.zip (fixing l
+00016710: 6f63 6174 696f 6e20 6c6f 6729 206f 6b22  ocation log) ok"
+00016720: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00016730: 206f 7220 2266 7363 6b20 7878 782e 7a69   or "fsck xxx.zi
+00016740: 7020 6f6b 220a 2020 2020 2020 2020 2020  p ok".          
+00016750: 2020 2320 696e 7374 6561 642c 2073 6176    # instead, sav
+00016760: 6520 6974 2069 6e74 6f20 6120 7465 7874  e it into a text
+00016770: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
+00016780: 2020 2077 6974 6820 6f70 656e 2866 6e5f     with open(fn_
+00016790: 6d73 675f 6673 636b 2c20 2277 2229 2061  msg_fsck, "w") a
+000167a0: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+000167b0: 2020 2020 2066 2e77 7269 7465 2822 2320       f.write("# 
+000167c0: 4265 6c6f 7720 6172 6520 7072 696e 7465  Below are printe
+000167d0: 6420 6d65 7373 6167 6573 2066 726f 6d22  d messages from"
+000167e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000167f0: 2020 2020 2020 2020 2022 2060 6769 7420           " `git 
+00016800: 616e 6e65 7820 6673 636b 202d 2d66 6173  annex fsck --fas
+00016810: 7420 2d66 206f 7574 7075 742d 7374 6f72  t -f output-stor
+00016820: 6167 6560 3a5c 6e5c 6e22 290a 2020 2020  age`:\n\n").    
+00016830: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+00016840: 6974 6528 7072 6f63 5f67 6974 5f61 6e6e  ite(proc_git_ann
+00016850: 6578 5f66 7363 6b2e 7374 646f 7574 2e64  ex_fsck.stdout.d
+00016860: 6563 6f64 6528 2775 7466 2d38 2729 290a  ecode('utf-8')).
+00016870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016880: 662e 7772 6974 6528 225c 6e22 290a 2020  f.write("\n").  
+00016890: 2020 2020 2020 2020 2020 2320 6e6f 7720            # now 
+000168a0: 7765 2063 616e 2064 656c 6574 6520 6070  we can delete `p
+000168b0: 726f 635f 6769 745f 616e 6e65 785f 6673  roc_git_annex_fs
+000168c0: 636b 6020 746f 2073 6176 6520 6d65 6d6f  ck` to save memo
+000168d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000168e0: 6465 6c20 7072 6f63 5f67 6974 5f61 6e6e  del proc_git_ann
+000168f0: 6578 5f66 7363 6b0a 0a20 2020 2020 2020  ex_fsck..       
+00016900: 2020 2020 2023 2044 6f75 626c 6520 6368       # Double ch
+00016910: 6563 6b3a 2074 6865 7265 2073 686f 756c  eck: there shoul
+00016920: 6420 6e6f 7420 6265 2066 696c 6520 636f  d not be file co
+00016930: 6e74 656e 7420 7468 6174 2773 206e 6f74  ntent that's not
+00016940: 2069 6e20 606f 7574 7075 742d 7374 6f72   in `output-stor
+00016950: 6167 6560 3a0a 2020 2020 2020 2020 2020  age`:.          
+00016960: 2020 2320 2020 5468 6973 2073 686f 756c    #   This shoul
+00016970: 6420 6e6f 7420 7072 696e 7420 616e 7974  d not print anyt
+00016980: 6869 6e67 202d 2077 6520 6e65 7665 7220  hing - we never 
+00016990: 6861 7320 7468 6973 2065 7272 6f72 2062  has this error b
+000169a0: 6566 6f72 650a 2020 2020 2020 2020 2020  efore.          
+000169b0: 2020 2320 6067 6974 2061 6e6e 6578 2066    # `git annex f
+000169c0: 696e 6420 2d2d 6e6f 7420 2d2d 696e 206f  ind --not --in o
+000169d0: 7574 7075 742d 7374 6f72 6167 6560 0a20  utput-storage`. 
+000169e0: 2020 2020 2020 2020 2020 2070 726f 635f             proc_
+000169f0: 6769 745f 616e 6e65 785f 6669 6e64 5f6d  git_annex_find_m
+00016a00: 6973 7369 6e67 203d 2073 7562 7072 6f63  issing = subproc
+00016a10: 6573 732e 7275 6e28 0a20 2020 2020 2020  ess.run(.       
+00016a20: 2020 2020 2020 2020 205b 2267 6974 222c           ["git",
+00016a30: 2022 616e 6e65 7822 2c20 2266 696e 6422   "annex", "find"
+00016a40: 2c20 222d 2d6e 6f74 222c 2022 2d2d 696e  , "--not", "--in
+00016a50: 222c 2022 6f75 7470 7574 2d73 746f 7261  ", "output-stora
+00016a60: 6765 225d 2c0a 2020 2020 2020 2020 2020  ge"],.          
+00016a70: 2020 2020 2020 6377 643d 6d65 7267 655f        cwd=merge_
+00016a80: 6473 5f70 6174 682c 2073 7464 6f75 743d  ds_path, stdout=
+00016a90: 7375 6270 726f 6365 7373 2e50 4950 4529  subprocess.PIPE)
+00016aa0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+00016ab0: 635f 6769 745f 616e 6e65 785f 6669 6e64  c_git_annex_find
+00016ac0: 5f6d 6973 7369 6e67 2e63 6865 636b 5f72  _missing.check_r
+00016ad0: 6574 7572 6e63 6f64 6528 290a 2020 2020  eturncode().    
+00016ae0: 2020 2020 2020 2020 6d73 6720 3d20 7072          msg = pr
+00016af0: 6f63 5f67 6974 5f61 6e6e 6578 5f66 696e  oc_git_annex_fin
+00016b00: 645f 6d69 7373 696e 672e 7374 646f 7574  d_missing.stdout
+00016b10: 2e64 6563 6f64 6528 2775 7466 2d38 2729  .decode('utf-8')
+00016b20: 0a20 2020 2020 2020 2020 2020 2023 2060  .            # `
+00016b30: 6d73 6760 2073 686f 756c 6420 6265 2065  msg` should be e
+00016b40: 6d70 7479 3a0a 2020 2020 2020 2020 2020  mpty:.          
+00016b50: 2020 6966 206d 7367 2021 3d20 2727 3a20    if msg != '': 
+00016b60: 2020 2320 6966 206e 6f74 2065 6d70 7479    # if not empty
+00016b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016b80: 2020 2320 7361 7665 2069 6e74 6f20 6120    # save into a 
+00016b90: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
+00016ba0: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00016bb0: 666e 5f6c 6973 745f 636f 6e74 656e 745f  fn_list_content_
+00016bc0: 6d69 7373 696e 672c 2022 7722 2920 6173  missing, "w") as
+00016bd0: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+00016be0: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
+00016bf0: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
+00016c00: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+00016c10: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
+00016c20: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00016c30: 6570 7469 6f6e 2822 556e 6162 6c65 2074  eption("Unable t
+00016c40: 6f20 6669 6e64 2066 696c 6520 636f 6e74  o find file cont
+00016c50: 656e 7420 666f 7220 736f 6d65 2066 696c  ent for some fil
+00016c60: 6528 7329 2e22 0a20 2020 2020 2020 2020  e(s).".         
+00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c80: 2020 2020 2020 202b 2022 2054 6865 2069         + " The i
+00016c90: 6e66 6f72 6d61 7469 6f6e 2068 6173 2062  nformation has b
+00016ca0: 6565 6e20 7361 7665 6420 746f 2074 6869  een saved to thi
+00016cb0: 7320 7465 7874 2066 696c 653a 2027 220a  s text file: '".
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ce0: 2b20 666e 5f6c 6973 745f 636f 6e74 656e  + fn_list_conten
+00016cf0: 745f 6d69 7373 696e 6720 2b20 2227 2e22  t_missing + "'."
+00016d00: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00016d10: 2060 6769 7420 616e 6e65 7820 6465 6164   `git annex dead
+00016d20: 2068 6572 6560 3a0a 2020 2020 2020 2020   here`:.        
+00016d30: 2020 2020 2320 2020 7374 6f70 2074 7261      #   stop tra
+00016d40: 636b 696e 6720 636c 6f6e 6520 606d 6572  cking clone `mer
+00016d50: 6765 5f64 7360 2c0a 2020 2020 2020 2020  ge_ds`,.        
+00016d60: 2020 2020 2320 2020 692e 652e 2c20 6e6f      #   i.e., no
+00016d70: 7420 746f 2067 6574 2064 6174 6120 6672  t to get data fr
+00016d80: 6f6d 2074 6869 7320 606d 6572 6765 5f64  om this `merge_d
+00016d90: 7360 2073 6962 6c69 6e67 3a0a 2020 2020  s` sibling:.    
+00016da0: 2020 2020 2020 2020 7072 6f63 5f67 6974          proc_git
+00016db0: 5f61 6e6e 6578 5f64 6561 645f 6865 7265  _annex_dead_here
+00016dc0: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00016dd0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00016de0: 2020 205b 2267 6974 222c 2022 616e 6e65     ["git", "anne
+00016df0: 7822 2c20 2264 6561 6422 2c20 2268 6572  x", "dead", "her
+00016e00: 6522 5d2c 0a20 2020 2020 2020 2020 2020  e"],.           
+00016e10: 2020 2020 2063 7764 3d6d 6572 6765 5f64       cwd=merge_d
+00016e20: 735f 7061 7468 2c20 7374 646f 7574 3d73  s_path, stdout=s
+00016e30: 7562 7072 6f63 6573 732e 5049 5045 290a  ubprocess.PIPE).
+00016e40: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00016e50: 5f67 6974 5f61 6e6e 6578 5f64 6561 645f  _git_annex_dead_
+00016e60: 6865 7265 2e63 6865 636b 5f72 6574 7572  here.check_retur
+00016e70: 6e63 6f64 6528 290a 2020 2020 2020 2020  ncode().        
+00016e80: 2020 2020 7072 696e 7428 7072 6f63 5f67      print(proc_g
+00016e90: 6974 5f61 6e6e 6578 5f64 6561 645f 6865  it_annex_dead_he
+00016ea0: 7265 2e73 7464 6f75 742e 6465 636f 6465  re.stdout.decode
+00016eb0: 2827 7574 662d 3827 2929 0a0a 2020 2020  ('utf-8'))..    
+00016ec0: 2020 2020 2020 2020 2320 4669 6e61 6c20          # Final 
+00016ed0: 6064 6174 616c 6164 2070 7573 6860 2074  `datalad push` t
+00016ee0: 6f20 6f75 7470 7574 2052 4941 3a0a 2020  o output RIA:.  
+00016ef0: 2020 2020 2020 2020 2020 2320 6064 6174            # `dat
+00016f00: 616c 6164 2070 7573 6820 2d2d 6461 7461  alad push --data
+00016f10: 206e 6f74 6869 6e67 603a 0a20 2020 2020   nothing`:.     
+00016f20: 2020 2020 2020 2023 2020 2070 7573 6869         #   pushi
+00016f30: 6e67 2074 6f20 6067 6974 6020 6272 616e  ng to `git` bran
+00016f40: 6368 2069 6e20 6f75 7470 7574 2052 4941  ch in output RIA
+00016f50: 3a20 6861 7320 646f 6e65 2077 6974 6820  : has done with 
+00016f60: 6067 6974 2070 7573 6860 3b0a 2020 2020  `git push`;.    
+00016f70: 2020 2020 2020 2020 2320 2020 7075 7368          #   push
+00016f80: 696e 6720 746f 2060 6769 742d 616e 6e65  ing to `git-anne
+00016f90: 7860 2062 7261 6e63 6820 696e 206f 7574  x` branch in out
+00016fa0: 7075 7420 5249 413a 2068 6173 6e27 7420  put RIA: hasn't 
+00016fb0: 646f 6e65 2061 6674 6572 2060 6769 7420  done after `git 
+00016fc0: 616e 6e65 7820 6673 636b 600a 2020 2020  annex fsck`.    
+00016fd0: 2020 2020 2020 2020 2320 2020 602d 2d64          #   `--d
+00016fe0: 6174 6120 6e6f 7468 696e 6760 3a20 646f  ata nothing`: do
+00016ff0: 6e27 7420 7472 616e 7366 6572 2064 6174  n't transfer dat
+00017000: 6120 6672 6f6d 2074 6869 7320 6c6f 6361  a from this loca
+00017010: 6c20 616e 6e65 7820 606d 6572 6765 5f64  l annex `merge_d
+00017020: 7360 0a20 2020 2020 2020 2020 2020 2070  s`.            p
+00017030: 726f 635f 6461 7461 6c61 645f 7075 7368  roc_datalad_push
+00017040: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
+00017050: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00017060: 2020 205b 2264 6174 616c 6164 222c 2022     ["datalad", "
+00017070: 7075 7368 222c 2022 2d2d 6461 7461 222c  push", "--data",
+00017080: 2022 6e6f 7468 696e 6722 5d2c 0a20 2020   "nothing"],.   
+00017090: 2020 2020 2020 2020 2020 2020 2063 7764               cwd
+000170a0: 3d6d 6572 6765 5f64 735f 7061 7468 2c20  =merge_ds_path, 
+000170b0: 7374 646f 7574 3d73 7562 7072 6f63 6573  stdout=subproces
+000170c0: 732e 5049 5045 290a 2020 2020 2020 2020  s.PIPE).        
+000170d0: 2020 2020 7072 6f63 5f64 6174 616c 6164      proc_datalad
+000170e0: 5f70 7573 682e 6368 6563 6b5f 7265 7475  _push.check_retu
+000170f0: 726e 636f 6465 2829 0a20 2020 2020 2020  rncode().       
+00017100: 2020 2020 2070 7269 6e74 2870 726f 635f       print(proc_
+00017110: 6461 7461 6c61 645f 7075 7368 2e73 7464  datalad_push.std
+00017120: 6f75 742e 6465 636f 6465 2827 7574 662d  out.decode('utf-
+00017130: 3827 2929 0a0a 2020 2020 2020 2020 2020  8'))..          
+00017140: 2020 2320 446f 6e65 3a0a 2020 2020 2020    # Done:.      
+00017150: 2020 2020 2020 6966 2069 665f 616e 795f        if if_any_
+00017160: 7761 726e 696e 673a 0a20 2020 2020 2020  warning:.       
+00017170: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00017180: 5c6e 6062 6162 732d 6d65 7267 6560 2068  \n`babs-merge` h
+00017190: 6173 2066 696e 6973 6865 6420 6275 7420  as finished but 
+000171a0: 6861 6420 7761 726e 696e 6728 7329 2122  had warning(s)!"
+000171b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000171c0: 2020 2020 2020 2022 2050 6c65 6173 6520         " Please 
+000171d0: 6368 6563 6b20 6f75 7420 7468 6520 7761  check out the wa
+000171e0: 726e 696e 6720 6d65 7373 6167 6528 7329  rning message(s)
+000171f0: 2061 626f 7665 2122 290a 2020 2020 2020   above!").      
+00017200: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00017210: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00017220: 7428 225c 6e60 6261 6273 2d6d 6572 6765  t("\n`babs-merge
+00017230: 6020 7761 7320 7375 6363 6573 7366 756c  ` was successful
+00017240: 2122 290a 0a20 2020 2020 2020 2065 6c73  !")..        els
+00017250: 653a 2020 2020 2320 602d 2d74 7269 616c  e:    # `--trial
+00017260: 2d72 756e 6020 6973 206f 6e3a 0a20 2020  -run` is on:.   
+00017270: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00017280: 2229 2020 2020 2320 6e65 7720 656d 7074  ")    # new empt
+00017290: 7920 6c69 6e65 0a20 2020 2020 2020 2020  y line.         
+000172a0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+000172b0: 2822 602d 2d74 7269 616c 2d72 756e 6020  ("`--trial-run` 
+000172c0: 7761 7320 7265 7175 6573 7465 642c 220a  was requested,".
+000172d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172e0: 2020 2020 2020 2020 2020 2b20 2220 6e6f            + " no
+000172f0: 7420 746f 2070 7573 6820 6d65 7267 696e  t to push mergin
+00017300: 6720 6163 7469 6f6e 7320 746f 206f 7574  g actions to out
+00017310: 7075 7420 5249 412e 2229 0a20 2020 2020  put RIA.").     
+00017320: 2020 2020 2020 2070 7269 6e74 2822 5c6e         print("\n
+00017330: 6062 6162 732d 6d65 7267 6560 2064 6964  `babs-merge` did
+00017340: 206e 6f74 2066 756c 6c79 2066 696e 6973   not fully finis
+00017350: 6820 7965 7421 2229 0a0a 2020 2020 6465  h yet!")..    de
+00017360: 6620 6261 6273 5f75 6e7a 6970 2863 6f6e  f babs_unzip(con
+00017370: 7461 696e 6572 5f63 6f6e 6669 675f 7961  tainer_config_ya
+00017380: 6d6c 5f66 696c 6529 3a0a 2020 2020 2020  ml_file):.      
+00017390: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+000173a0: 6973 2066 756e 6374 696f 6e20 756e 7a69  is function unzi
+000173b0: 7073 2072 6573 756c 7473 2061 6e64 2065  ps results and e
+000173c0: 7874 7261 6374 2064 6573 6972 6564 2066  xtract desired f
+000173d0: 696c 6573 2e0a 2020 2020 2020 2020 5468  iles..        Th
+000173e0: 6973 2069 7320 646f 6e65 2069 6e20 3320  is is done in 3 
+000173f0: 7374 6570 733a 0a20 2020 2020 2020 2031  steps:.        1
+00017400: 2e20 4765 6e65 7261 7465 2073 6372 6970  . Generate scrip
+00017410: 7473 2075 7365 6420 6279 2060 6261 6273  ts used by `babs
+00017420: 2d75 6e7a 6970 600a 2020 2020 2020 2020  -unzip`.        
+00017430: 322e 2052 756e 2073 6372 6970 7473 2074  2. Run scripts t
+00017440: 6f20 756e 7a69 7020 6461 7461 0a20 2020  o unzip data.   
+00017450: 2020 2020 2033 2e20 4d65 7267 6520 616c       3. Merge al
+00017460: 6c20 6272 616e 6368 6573 206f 6620 756e  l branches of un
+00017470: 7a69 7070 696e 670a 0a20 2020 2020 2020  zipping..       
+00017480: 2050 6172 616d 6574 6572 733a 0a20 2020   Parameters:.   
+00017490: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d       -----------
+000174a0: 2d2d 2d0a 2020 2020 2020 2020 636f 6e66  ---.        conf
+000174b0: 6967 3a20 6469 6374 0a20 2020 2020 2020  ig: dict.       
+000174c0: 2020 2020 206c 6f61 6465 6420 636f 6e74       loaded cont
+000174d0: 6169 6e65 7220 636f 6e66 6967 2079 616d  ainer config yam
+000174e0: 6c20 6669 6c65 0a20 2020 2020 2020 2022  l file.        "
+000174f0: 2222 0a0a 2020 2020 2020 2020 2320 3d3d  ""..        # ==
+00017500: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00017510: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
 00017520: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017530: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00017540: 0a20 2020 2020 2020 2023 203d 3d3d 3d3d  .        # =====
-00017550: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017560: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00017570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d0a  ===============.
-00017580: 2020 2020 2020 2020 2320 4d65 7267 6520          # Merge 
-00017590: 616c 6c20 6272 616e 6368 6573 206f 6620  all branches of 
-000175a0: 756e 7a69 7070 696e 670a 2020 2020 2020  unzipping.      
-000175b0: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
-000175c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000175d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000175e0: 3d3d 3d3d 3d3d 3d3d 0a0a 0a63 6c61 7373  ========...class
-000175f0: 2049 6e70 7574 5f64 7328 293a 0a20 2020   Input_ds():.   
-00017600: 2022 2222 5468 6973 2063 6c61 7373 2069   """This class i
-00017610: 7320 666f 7220 696e 7075 7420 6461 7461  s for input data
-00017620: 7365 7428 7329 2222 220a 0a20 2020 2064  set(s)"""..    d
-00017630: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00017640: 2c20 696e 7075 745f 636c 6929 3a0a 2020  , input_cli):.  
-00017650: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00017660: 2020 5468 6973 2069 7320 746f 2069 6e69    This is to ini
-00017670: 7469 616c 697a 6520 6049 6e70 7574 5f64  tialize `Input_d
-00017680: 7360 2063 6c61 7373 2e0a 0a20 2020 2020  s` class...     
-00017690: 2020 2050 6172 616d 6574 6572 733a 0a20     Parameters:. 
-000176a0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-000176b0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 696e  -----.        in
-000176c0: 7075 745f 636c 693a 206e 6573 7465 6420  put_cli: nested 
-000176d0: 6c69 7374 206f 6620 7374 7269 6e67 730a  list of strings.
-000176e0: 2020 2020 2020 2020 2020 2020 7365 6520              see 
-000176f0: 434c 4920 6062 6162 732d 696e 6974 202d  CLI `babs-init -
-00017700: 2d69 6e70 7574 6020 666f 7220 6d6f 7265  -input` for more
-00017710: 0a0a 2020 2020 2020 2020 4174 7472 6962  ..        Attrib
-00017720: 7574 6573 3a0a 2020 2020 2020 2020 2d2d  utes:.        --
-00017730: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-00017740: 2020 2020 2064 663a 2070 616e 6461 7320       df: pandas 
-00017750: 4461 7461 4672 616d 650a 2020 2020 2020  DataFrame.      
-00017760: 2020 2020 2020 696e 636c 7564 6573 206e        includes n
-00017770: 6563 6573 7361 7279 2069 6e66 6f72 6d61  ecessary informa
-00017780: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00017790: 2020 2d20 6e61 6d65 3a20 7374 723a 2061    - name: str: a
-000177a0: 206e 616d 6520 7468 6520 7573 6572 2067   name the user g
-000177b0: 6976 6573 0a20 2020 2020 2020 2020 2020  ives.           
-000177c0: 202d 2070 6174 685f 696e 3a20 7374 723a   - path_in: str:
-000177d0: 2074 6865 2070 6174 6820 746f 2074 6865   the path to the
-000177e0: 2069 6e70 7574 2064 730a 2020 2020 2020   input ds.      
-000177f0: 2020 2020 2020 2d20 7061 7468 5f6e 6f77        - path_now
-00017800: 5f72 656c 3a20 7468 6520 7061 7468 2074  _rel: the path t
-00017810: 6f20 7768 6572 6520 7468 6520 696e 7075  o where the inpu
-00017820: 7420 6473 2069 7320 636c 6f6e 6564 2c20  t ds is cloned, 
-00017830: 7265 6c61 7469 7665 2074 6f20 6061 6e61  relative to `ana
-00017840: 6c79 7369 7360 2066 6f6c 6465 720a 2020  lysis` folder.  
-00017850: 2020 2020 2020 2020 2020 2d20 7061 7468            - path
-00017860: 5f6e 6f77 5f61 6273 3a20 7468 6520 6162  _now_abs: the ab
-00017870: 736f 6c75 7465 2070 6174 6820 746f 2074  solute path to t
-00017880: 6865 2069 6e70 7574 2064 730a 2020 2020  he input ds.    
-00017890: 2020 2020 2020 2020 2d20 7061 7468 5f64          - path_d
-000178a0: 6174 615f 7265 6c3a 2074 6865 2070 6174  ata_rel: the pat
-000178b0: 6820 746f 2077 6865 7265 2074 6865 2069  h to where the i
-000178c0: 6e70 7574 2064 6174 6120 2866 6f72 2061  nput data (for a
-000178d0: 2073 7562 206f 7220 6120 7365 7329 2069   sub or a ses) i
-000178e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000178f0: 2020 2072 656c 6174 6976 6520 746f 2060     relative to `
-00017900: 616e 616c 7973 6973 6020 666f 6c64 6572  analysis` folder
-00017910: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017920: 2020 4966 2069 7427 7320 7a69 7070 6564    If it's zipped
-00017930: 2064 732c 2060 7061 7468 5f64 6174 615f   ds, `path_data_
-00017940: 7265 6c60 203d 2060 7061 7468 5f6e 6f77  rel` = `path_now
-00017950: 5f72 656c 602f 606e 616d 6560 2c0a 2020  _rel`/`name`,.  
-00017960: 2020 2020 2020 2020 2020 2020 2020 692e                i.
-00017970: 652e 2c20 6578 7472 6120 6c61 7965 7220  e., extra layer 
-00017980: 6f66 2066 6f6c 6465 7220 676f 7420 6672  of folder got fr
-00017990: 6f6d 2075 6e7a 6970 7069 6e67 0a20 2020  om unzipping.   
-000179a0: 2020 2020 2020 2020 2020 2020 2049 6620               If 
-000179b0: 6974 2773 2061 6e20 756e 7a69 7070 6564  it's an unzipped
-000179c0: 2064 732c 2060 7061 7468 5f64 6174 615f   ds, `path_data_
-000179d0: 7265 6c60 203d 2060 7061 7468 5f6e 6f77  rel` = `path_now
-000179e0: 5f72 656c 600a 2020 2020 2020 2020 2020  _rel`.          
-000179f0: 2020 2d20 6973 5f7a 6970 7065 643a 2054    - is_zipped: T
-00017a00: 7275 6520 6f72 2046 616c 7365 2c20 6973  rue or False, is
-00017a10: 2074 6865 2069 6e70 7574 2064 6174 6120   the input data 
-00017a20: 7a69 7070 6564 206f 7220 6e6f 740a 2020  zipped or not.  
-00017a30: 2020 2020 2020 6e75 6d5f 6473 3a20 696e        num_ds: in
-00017a40: 740a 2020 2020 2020 2020 2020 2020 6e75  t.            nu
-00017a50: 6d62 6572 206f 6620 696e 7075 7420 6461  mber of input da
-00017a60: 7461 7365 7428 7329 0a20 2020 2020 2020  taset(s).       
-00017a70: 2069 6e69 7469 616c 5f69 6e63 6c75 5f64   initial_inclu_d
-00017a80: 663a 2070 616e 6461 7320 4461 7461 4672  f: pandas DataFr
-00017a90: 616d 6520 6f72 204e 6f6e 650a 2020 2020  ame or None.    
-00017aa0: 2020 2020 2020 2020 676f 7420 6279 206d          got by m
-00017ab0: 6574 686f 6420 6067 6574 5f69 6e69 7469  ethod `get_initi
-00017ac0: 616c 5f69 6e63 6c75 5f64 6628 2960 2c20  al_inclu_df()`, 
-00017ad0: 6261 7365 6420 6f6e 2060 6c69 7374 5f73  based on `list_s
-00017ae0: 7562 5f66 696c 6560 0a20 2020 2020 2020  ub_file`.       
-00017af0: 2020 2020 2041 7373 6967 6e20 604e 6f6e       Assign `Non
-00017b00: 6560 2066 6f72 206e 6f77 2c20 6265 666f  e` for now, befo
-00017b10: 7265 2063 616c 6c69 6e67 2074 6861 7420  re calling that 
-00017b20: 6d65 7468 6f64 0a20 2020 2020 2020 2020  method.         
-00017b30: 2020 2053 6565 2074 6861 7420 6d65 7468     See that meth
-00017b40: 6f64 2066 6f72 206d 6f72 652e 0a20 2020  od for more..   
-00017b50: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00017b60: 2020 2320 4162 6f75 7420 696e 7075 7420    # About input 
-00017b70: 6461 7461 7365 7428 7329 3a20 2d2d 2d2d  dataset(s): ----
-00017b80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00017b90: 2d2d 2d2d 0a20 2020 2020 2020 2023 2063  ----.        # c
-00017ba0: 7265 6174 6520 616e 2065 6d70 7479 2070  reate an empty p
-00017bb0: 616e 6461 7320 4461 7461 4672 616d 653a  andas DataFrame:
-00017bc0: 0a20 2020 2020 2020 2073 656c 662e 6466  .        self.df
-00017bd0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-00017be0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00017bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c00: 2020 2020 2069 6e64 6578 3d6c 6973 7428       index=list(
-00017c10: 7261 6e67 6528 302c 206c 656e 2869 6e70  range(0, len(inp
-00017c20: 7574 5f63 6c69 2929 292c 0a20 2020 2020  ut_cli))),.     
-00017c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c40: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00017c50: 733d 5b27 6e61 6d65 272c 2027 7061 7468  s=['name', 'path
-00017c60: 5f69 6e27 2c20 2770 6174 685f 6e6f 775f  _in', 'path_now_
-00017c70: 7265 6c27 2c0a 2020 2020 2020 2020 2020  rel',.          
-00017c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017c90: 2020 2020 2020 2020 2020 2020 2020 2770                'p
-00017ca0: 6174 685f 6e6f 775f 6162 7327 2c20 2770  ath_now_abs', 'p
-00017cb0: 6174 685f 6461 7461 5f72 656c 272c 0a20  ath_data_rel',. 
-00017cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ce0: 2020 2020 2020 2027 6973 5f7a 6970 7065         'is_zippe
-00017cf0: 6427 5d29 0a0a 2020 2020 2020 2020 2320  d'])..        # 
-00017d00: 6e75 6d62 6572 206f 6620 6461 7461 7365  number of datase
-00017d10: 7428 7329 3a0a 2020 2020 2020 2020 7365  t(s):.        se
-00017d20: 6c66 2e6e 756d 5f64 7320 3d20 7365 6c66  lf.num_ds = self
-00017d30: 2e64 662e 7368 6170 655b 305d 2020 2023  .df.shape[0]   #
-00017d40: 206e 756d 6265 7220 6f66 2072 6f77 7320   number of rows 
-00017d50: 696e 2060 6466 600a 0a20 2020 2020 2020  in `df`..       
-00017d60: 2023 2063 6861 6e67 6520 7468 6520 6069   # change the `i
-00017d70: 6e70 7574 5f63 6c69 6020 6672 6f6d 206e  nput_cli` from n
-00017d80: 6573 7465 6420 6c69 7374 2074 6f20 6120  ested list to a 
-00017d90: 7061 6e64 6173 2064 6174 6166 7261 6d65  pandas dataframe
-00017da0: 3a0a 2020 2020 2020 2020 666f 7220 6920  :.        for i 
-00017db0: 696e 2072 616e 6765 2830 2c20 7365 6c66  in range(0, self
-00017dc0: 2e6e 756d 5f64 7329 3a0a 2020 2020 2020  .num_ds):.      
-00017dd0: 2020 2020 2020 7365 6c66 2e64 665b 226e        self.df["n
-00017de0: 616d 6522 5d5b 695d 203d 2069 6e70 7574  ame"][i] = input
-00017df0: 5f63 6c69 5b69 5d5b 305d 0a20 2020 2020  _cli[i][0].     
-00017e00: 2020 2020 2020 2073 656c 662e 6466 5b22         self.df["
-00017e10: 7061 7468 5f69 6e22 5d5b 695d 203d 2069  path_in"][i] = i
-00017e20: 6e70 7574 5f63 6c69 5b69 5d5b 315d 0a20  nput_cli[i][1]. 
-00017e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017e40: 6466 5b22 7061 7468 5f6e 6f77 5f72 656c  df["path_now_rel
-00017e50: 225d 5b69 5d20 3d20 6f70 2e6a 6f69 6e28  "][i] = op.join(
-00017e60: 2269 6e70 7574 732f 6461 7461 222c 2073  "inputs/data", s
-00017e70: 656c 662e 6466 5b22 6e61 6d65 225d 5b69  elf.df["name"][i
-00017e80: 5d29 0a0a 2020 2020 2020 2020 2320 7361  ])..        # sa
-00017e90: 6e69 7479 2063 6865 636b 3a20 696e 7075  nity check: inpu
-00017ea0: 7420 6473 206e 616d 6573 2073 686f 756c  t ds names shoul
-00017eb0: 6420 6e6f 7420 6265 2069 6465 6e74 6963  d not be identic
-00017ec0: 616c 3a0a 2020 2020 2020 2020 6966 206c  al:.        if l
-00017ed0: 656e 2873 6574 2873 656c 662e 6466 5b22  en(set(self.df["
-00017ee0: 6e61 6d65 225d 2e74 6f6c 6973 7428 2929  name"].tolist())
-00017ef0: 2920 213d 2073 656c 662e 6e75 6d5f 6473  ) != self.num_ds
-00017f00: 3a20 2023 206c 656e 6774 6820 6f66 2074  :  # length of t
-00017f10: 6865 2073 6574 203d 206e 756d 6265 7220  he set = number 
-00017f20: 6f66 2064 730a 2020 2020 2020 2020 2020  of ds.          
-00017f30: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-00017f40: 6e28 2254 6865 7265 2061 7265 2069 6465  n("There are ide
-00017f50: 6e74 6963 616c 206e 616d 6573 2069 6e20  ntical names in 
-00017f60: 696e 7075 7420 6461 7461 7365 7473 2720  input datasets' 
-00017f70: 6e61 6d65 7321 2229 0a0a 2020 2020 2020  names!")..      
-00017f80: 2020 2320 496e 6974 6961 6c69 7a65 206f    # Initialize o
-00017f90: 7468 6572 2061 7474 7269 6275 7465 733a  ther attributes:
-00017fa0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
-00017fb0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
-00017fc0: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
-00017fd0: 7469 616c 5f69 6e63 6c75 5f64 6620 3d20  tial_inclu_df = 
-00017fe0: 4e6f 6e65 0a0a 2020 2020 6465 6620 6765  None..    def ge
-00017ff0: 745f 696e 6974 6961 6c5f 696e 636c 755f  t_initial_inclu_
-00018000: 6466 2873 656c 662c 206c 6973 745f 7375  df(self, list_su
-00018010: 625f 6669 6c65 2c20 7479 7065 5f73 6573  b_file, type_ses
-00018020: 7369 6f6e 293a 0a20 2020 2020 2020 2022  sion):.        "
-00018030: 2222 0a20 2020 2020 2020 2044 6566 696e  "".        Defin
-00018040: 6520 6174 7472 6962 7574 6520 6069 6e69  e attribute `ini
-00018050: 7469 616c 5f69 6e63 6c75 5f64 6660 2c20  tial_inclu_df`, 
-00018060: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-00018070: 6d65 206f 7220 4e6f 6e65 0a20 2020 2020  me or None.     
-00018080: 2020 2020 2020 2062 6173 6564 206f 6e20         based on 
-00018090: 606c 6973 745f 7375 625f 6669 6c65 600a  `list_sub_file`.
-000180a0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-000180b0: 6c65 2d73 6573 7369 6f6e 2064 6174 613a  le-session data:
-000180c0: 2063 6f6c 756d 6e20 6f66 2027 7375 625f   column of 'sub_
-000180d0: 6964 273b 0a20 2020 2020 2020 2020 2020  id';.           
-000180e0: 206d 756c 7469 2d73 6573 7369 6f6e 2064   multi-session d
-000180f0: 6174 613a 2063 6f6c 756d 6e73 206f 6620  ata: columns of 
-00018100: 2773 7562 5f69 6427 2061 6e64 2027 7365  'sub_id' and 'se
-00018110: 735f 6964 270a 0a20 2020 2020 2020 2050  s_id'..        P
-00018120: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
-00018130: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-00018140: 2d2d 2d0a 2020 2020 2020 2020 6c69 7374  ---.        list
-00018150: 5f73 7562 5f66 696c 653a 2073 7472 206f  _sub_file: str o
-00018160: 7220 4e6f 6e65 0a20 2020 2020 2020 2020  r None.         
-00018170: 2020 2050 6174 6820 746f 2074 6865 2043     Path to the C
-00018180: 5356 2066 696c 6520 7468 6174 206c 6973  SV file that lis
-00018190: 7473 2074 6865 2073 7562 6a65 6374 2028  ts the subject (
-000181a0: 616e 6420 7365 7373 696f 6e73 2920 746f  and sessions) to
-000181b0: 2061 6e61 6c79 7a65 3b0a 2020 2020 2020   analyze;.      
-000181c0: 2020 2020 2020 6f72 2060 4e6f 6e65 6020        or `None` 
-000181d0: 6966 2074 6861 7420 434c 4920 666c 6167  if that CLI flag
-000181e0: 2077 6173 206e 6f74 2073 7065 6369 6669   was not specifi
-000181f0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00018200: 7369 6e67 6c65 2d73 6573 2064 6174 613a  single-ses data:
-00018210: 2063 6f6c 756d 6e20 6f66 2027 7375 625f   column of 'sub_
-00018220: 6964 273b 0a20 2020 2020 2020 2020 2020  id';.           
-00018230: 206d 756c 7469 2d73 6573 2064 6174 613a   multi-ses data:
-00018240: 2063 6f6c 756d 6e73 206f 6620 2773 7562   columns of 'sub
-00018250: 5f69 6427 2061 6e64 2027 7365 735f 6964  _id' and 'ses_id
-00018260: 270a 2020 2020 2020 2020 7479 7065 5f73  '.        type_s
-00018270: 6573 7369 6f6e 3a20 7374 720a 2020 2020  ession: str.    
-00018280: 2020 2020 2020 2020 226d 756c 7469 2d73          "multi-s
-00018290: 6573 2220 6f72 2022 7369 6e67 6c65 2d73  es" or "single-s
-000182a0: 6573 220a 2020 2020 2020 2020 2222 220a  es".        """.
-000182b0: 2020 2020 2020 2020 2320 4765 7420 7468          # Get th
-000182c0: 6520 696e 6974 6961 6c20 696e 636c 7564  e initial includ
-000182d0: 6564 2073 7562 2f73 6573 206c 6973 7420  ed sub/ses list 
-000182e0: 6672 6f6d 2060 6c69 7374 5f73 7562 5f66  from `list_sub_f
-000182f0: 696c 6560 2043 5356 3a0a 2020 2020 2020  ile` CSV:.      
-00018300: 2020 6966 206c 6973 745f 7375 625f 6669    if list_sub_fi
-00018310: 6c65 2069 7320 4e6f 6e65 3a20 2023 2069  le is None:  # i
-00018320: 6620 6e6f 7420 746f 2073 7065 6369 6679  f not to specify
-00018330: 2074 6861 7420 666c 6167 2069 6e20 434c   that flag in CL
-00018340: 492c 2069 7427 6c6c 2062 6520 604e 6f6e  I, it'll be `Non
-00018350: 6560 0a20 2020 2020 2020 2020 2020 2073  e`.            s
-00018360: 656c 662e 696e 6974 6961 6c5f 696e 636c  elf.initial_incl
-00018370: 755f 6466 203d 204e 6f6e 650a 2020 2020  u_df = None.    
-00018380: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018390: 2020 2020 2020 6966 206f 702e 6578 6973        if op.exis
-000183a0: 7473 286c 6973 745f 7375 625f 6669 6c65  ts(list_sub_file
-000183b0: 2920 6973 2046 616c 7365 3a20 2020 2023  ) is False:    #
-000183c0: 2064 6f65 7320 6e6f 7420 6578 6973 743a   does not exist:
-000183d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000183e0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-000183f0: 2822 606c 6973 745f 7375 625f 6669 6c65  ("`list_sub_file
-00018400: 6020 646f 6573 206e 6f74 2065 7869 7374  ` does not exist
-00018410: 7321 2050 6c65 6173 6520 6368 6563 6b3a  s! Please check:
-00018420: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00018430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018440: 2020 202b 206c 6973 745f 7375 625f 6669     + list_sub_fi
-00018450: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00018460: 656c 7365 3a20 2020 2320 6578 6973 7473  else:   # exists
-00018470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018480: 2020 7365 6c66 2e69 6e69 7469 616c 5f69    self.initial_i
-00018490: 6e63 6c75 5f64 6620 3d20 7064 2e72 6561  nclu_df = pd.rea
-000184a0: 645f 6373 7628 6c69 7374 5f73 7562 5f66  d_csv(list_sub_f
-000184b0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-000184c0: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
-000184d0: 7465 5f69 6e69 7469 616c 5f69 6e63 6c75  te_initial_inclu
-000184e0: 5f64 6628 7479 7065 5f73 6573 7369 6f6e  _df(type_session
-000184f0: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
-00018500: 6174 655f 696e 6974 6961 6c5f 696e 636c  ate_initial_incl
-00018510: 755f 6466 2873 656c 662c 2074 7970 655f  u_df(self, type_
-00018520: 7365 7373 696f 6e29 3a0a 2020 2020 2020  session):.      
-00018530: 2020 2320 5361 6e69 7479 2063 6865 636b    # Sanity check
-00018540: 3a20 7468 6572 6520 6172 6520 6578 7065  : there are expe
-00018550: 6374 6564 2063 6f6c 756d 6e28 7329 3a0a  cted column(s):.
-00018560: 2020 2020 2020 2020 6966 2022 7375 625f          if "sub_
-00018570: 6964 2220 6e6f 7420 696e 206c 6973 7428  id" not in list(
-00018580: 7365 6c66 2e69 6e69 7469 616c 5f69 6e63  self.initial_inc
-00018590: 6c75 5f64 662e 636f 6c75 6d6e 7329 3a0a  lu_df.columns):.
-000185a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000185b0: 6520 4578 6365 7074 696f 6e28 2254 6865  e Exception("The
-000185c0: 7265 2069 7320 6e6f 2027 7375 625f 6964  re is no 'sub_id
-000185d0: 2720 636f 6c75 6d6e 2069 6e20 606c 6973  ' column in `lis
-000185e0: 745f 7375 625f 6669 6c65 6021 2229 0a20  t_sub_file`!"). 
-000185f0: 2020 2020 2020 2069 6620 7479 7065 5f73         if type_s
-00018600: 6573 7369 6f6e 203d 3d20 226d 756c 7469  ession == "multi
-00018610: 2d73 6573 223a 0a20 2020 2020 2020 2020  -ses":.         
-00018620: 2020 2069 6620 2273 6573 5f69 6422 206e     if "ses_id" n
-00018630: 6f74 2069 6e20 6c69 7374 2873 656c 662e  ot in list(self.
-00018640: 696e 6974 6961 6c5f 696e 636c 755f 6466  initial_inclu_df
-00018650: 2e63 6f6c 756d 6e73 293a 0a20 2020 2020  .columns):.     
-00018660: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00018670: 2045 7863 6570 7469 6f6e 2822 5468 6572   Exception("Ther
-00018680: 6520 6973 206e 6f20 2773 6573 5f69 6427  e is no 'ses_id'
-00018690: 2063 6f6c 756d 6e20 696e 2060 6c69 7374   column in `list
-000186a0: 5f73 7562 5f66 696c 6560 2122 0a20 2020  _sub_file`!".   
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186c0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-000186d0: 2049 7420 6973 2065 7870 6563 7465 6420   It is expected 
-000186e0: 6173 2074 6869 7320 6973 2061 206d 756c  as this is a mul
-000186f0: 7469 2d73 6573 7369 6f6e 2064 6174 6173  ti-session datas
-00018700: 6574 2e22 290a 0a20 2020 2020 2020 2023  et.")..        #
-00018710: 2053 616e 6974 7920 6368 6563 6b3a 206e   Sanity check: n
-00018720: 6f20 7265 7065 6174 6564 2073 7562 2028  o repeated sub (
-00018730: 6f72 2073 6573 7369 6f6e 7329 3a0a 2020  or sessions):.  
-00018740: 2020 2020 2020 6966 2074 7970 655f 7365        if type_se
-00018750: 7373 696f 6e20 3d3d 2022 7369 6e67 6c65  ssion == "single
-00018760: 2d73 6573 223a 0a20 2020 2020 2020 2020  -ses":.         
-00018770: 2020 2023 2074 6865 7265 2073 686f 756c     # there shoul
-00018780: 6420 6f6e 6c79 2062 6520 6f6e 6520 6f63  d only be one oc
-00018790: 6375 7272 656e 6365 2070 6572 2073 7562  currence per sub
-000187a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000187b0: 206c 656e 2873 6574 2873 656c 662e 696e   len(set(self.in
-000187c0: 6974 6961 6c5f 696e 636c 755f 6466 5b22  itial_inclu_df["
-000187d0: 7375 625f 6964 225d 2929 2021 3d20 5c0a  sub_id"])) != \.
-000187e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187f0: 2020 2020 6c65 6e28 7365 6c66 2e69 6e69      len(self.ini
-00018800: 7469 616c 5f69 6e63 6c75 5f64 665b 2273  tial_inclu_df["s
-00018810: 7562 5f69 6422 5d29 3a0a 2020 2020 2020  ub_id"]):.      
-00018820: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00018830: 4578 6365 7074 696f 6e28 2254 6865 7265  Exception("There
-00018840: 2061 7265 2072 6570 6561 7465 6420 2773   are repeated 's
-00018850: 7562 5f69 6427 2069 6e22 0a20 2020 2020  ub_id' in".     
+00017530: 3d3d 0a20 2020 2020 2020 2023 2047 656e  ==.        # Gen
+00017540: 6572 6174 6520 7363 7269 7074 7320 7573  erate scripts us
+00017550: 6564 2062 7920 6062 6162 732d 756e 7a69  ed by `babs-unzi
+00017560: 7060 0a20 2020 2020 2020 2023 203d 3d3d  p`.        # ===
+00017570: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017580: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017590: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000175a0: 3d0a 0a20 2020 2020 2020 2023 2050 7265  =..        # Pre
+000175b0: 7061 7265 2069 6e70 7574 5f64 735f 756e  pare input_ds_un
+000175c0: 7a69 703a 0a20 2020 2020 2020 2023 2043  zip:.        # C
+000175d0: 616c 6c20 6062 6162 735f 626f 6f74 7374  all `babs_bootst
+000175e0: 7261 7028 2960 3a0a 2020 2020 2020 2020  rap()`:.        
+000175f0: 2320 2020 2121 2121 2075 7369 6e67 2062  #   !!!! using b
+00017600: 6162 735f 7072 6f6a 5f75 6e7a 6970 2c20  abs_proj_unzip, 
+00017610: 696e 7374 6561 6420 6375 7272 656e 7420  instead current 
+00017620: 6073 656c 6660 2121 210a 0a20 2020 2020  `self`!!!..     
+00017630: 2020 2070 7269 6e74 2822 544f 444f 2229     print("TODO")
+00017640: 0a0a 2020 2020 2020 2020 2320 3d3d 3d3d  ..        # ====
+00017650: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017660: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017670: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017680: 0a20 2020 2020 2020 2023 2052 756e 2073  .        # Run s
+00017690: 6372 6970 7473 2074 6f20 756e 7a69 7020  cripts to unzip 
+000176a0: 6461 7461 0a20 2020 2020 2020 2023 203d  data.        # =
+000176b0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000176c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000176d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000176e0: 3d3d 3d0a 0a20 2020 2020 2020 2023 203d  ===..        # =
+000176f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017700: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017710: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017720: 3d3d 3d0a 2020 2020 2020 2020 2320 4d65  ===.        # Me
+00017730: 7267 6520 616c 6c20 6272 616e 6368 6573  rge all branches
+00017740: 206f 6620 756e 7a69 7070 696e 670a 2020   of unzipping.  
+00017750: 2020 2020 2020 2320 3d3d 3d3d 3d3d 3d3d        # ========
+00017760: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017770: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00017780: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 0a63  ============...c
+00017790: 6c61 7373 2049 6e70 7574 5f64 7328 293a  lass Input_ds():
+000177a0: 0a20 2020 2022 2222 5468 6973 2063 6c61  .    """This cla
+000177b0: 7373 2069 7320 666f 7220 696e 7075 7420  ss is for input 
+000177c0: 6461 7461 7365 7428 7329 2222 220a 0a20  dataset(s)""".. 
+000177d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+000177e0: 7365 6c66 2c20 696e 7075 745f 636c 6929  self, input_cli)
+000177f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00017800: 2020 2020 2020 5468 6973 2069 7320 746f        This is to
+00017810: 2069 6e69 7469 616c 697a 6520 6049 6e70   initialize `Inp
+00017820: 7574 5f64 7360 2063 6c61 7373 2e0a 0a20  ut_ds` class... 
+00017830: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00017840: 733a 0a20 2020 2020 2020 202d 2d2d 2d2d  s:.        -----
+00017850: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+00017860: 2020 696e 7075 745f 636c 693a 206e 6573    input_cli: nes
+00017870: 7465 6420 6c69 7374 206f 6620 7374 7269  ted list of stri
+00017880: 6e67 730a 2020 2020 2020 2020 2020 2020  ngs.            
+00017890: 7365 6520 434c 4920 6062 6162 732d 696e  see CLI `babs-in
+000178a0: 6974 202d 2d69 6e70 7574 6020 666f 7220  it --input` for 
+000178b0: 6d6f 7265 0a0a 2020 2020 2020 2020 4174  more..        At
+000178c0: 7472 6962 7574 6573 3a0a 2020 2020 2020  tributes:.      
+000178d0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    --------------
+000178e0: 0a20 2020 2020 2020 2064 663a 2070 616e  .        df: pan
+000178f0: 6461 7320 4461 7461 4672 616d 650a 2020  das DataFrame.  
+00017900: 2020 2020 2020 2020 2020 696e 636c 7564            includ
+00017910: 6573 206e 6563 6573 7361 7279 2069 6e66  es necessary inf
+00017920: 6f72 6d61 7469 6f6e 3a0a 2020 2020 2020  ormation:.      
+00017930: 2020 2020 2020 2d20 6e61 6d65 3a20 7374        - name: st
+00017940: 723a 2061 206e 616d 6520 7468 6520 7573  r: a name the us
+00017950: 6572 2067 6976 6573 0a20 2020 2020 2020  er gives.       
+00017960: 2020 2020 202d 2070 6174 685f 696e 3a20       - path_in: 
+00017970: 7374 723a 2074 6865 2070 6174 6820 746f  str: the path to
+00017980: 2074 6865 2069 6e70 7574 2064 730a 2020   the input ds.  
+00017990: 2020 2020 2020 2020 2020 2d20 7061 7468            - path
+000179a0: 5f6e 6f77 5f72 656c 3a20 7468 6520 7061  _now_rel: the pa
+000179b0: 7468 2074 6f20 7768 6572 6520 7468 6520  th to where the 
+000179c0: 696e 7075 7420 6473 2069 7320 636c 6f6e  input ds is clon
+000179d0: 6564 2c20 7265 6c61 7469 7665 2074 6f20  ed, relative to 
+000179e0: 6061 6e61 6c79 7369 7360 2066 6f6c 6465  `analysis` folde
+000179f0: 720a 2020 2020 2020 2020 2020 2020 2d20  r.            - 
+00017a00: 7061 7468 5f6e 6f77 5f61 6273 3a20 7468  path_now_abs: th
+00017a10: 6520 6162 736f 6c75 7465 2070 6174 6820  e absolute path 
+00017a20: 746f 2074 6865 2069 6e70 7574 2064 730a  to the input ds.
+00017a30: 2020 2020 2020 2020 2020 2020 2d20 7061              - pa
+00017a40: 7468 5f64 6174 615f 7265 6c3a 2074 6865  th_data_rel: the
+00017a50: 2070 6174 6820 746f 2077 6865 7265 2074   path to where t
+00017a60: 6865 2069 6e70 7574 2064 6174 6120 2866  he input data (f
+00017a70: 6f72 2061 2073 7562 206f 7220 6120 7365  or a sub or a se
+00017a80: 7329 2069 732c 0a20 2020 2020 2020 2020  s) is,.         
+00017a90: 2020 2020 2020 2072 656c 6174 6976 6520         relative 
+00017aa0: 746f 2060 616e 616c 7973 6973 6020 666f  to `analysis` fo
+00017ab0: 6c64 6572 2e0a 2020 2020 2020 2020 2020  lder..          
+00017ac0: 2020 2020 2020 4966 2069 7427 7320 7a69        If it's zi
+00017ad0: 7070 6564 2064 732c 2060 7061 7468 5f64  pped ds, `path_d
+00017ae0: 6174 615f 7265 6c60 203d 2060 7061 7468  ata_rel` = `path
+00017af0: 5f6e 6f77 5f72 656c 602f 606e 616d 6560  _now_rel`/`name`
+00017b00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017b10: 2020 692e 652e 2c20 6578 7472 6120 6c61    i.e., extra la
+00017b20: 7965 7220 6f66 2066 6f6c 6465 7220 676f  yer of folder go
+00017b30: 7420 6672 6f6d 2075 6e7a 6970 7069 6e67  t from unzipping
+00017b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017b50: 2049 6620 6974 2773 2061 6e20 756e 7a69   If it's an unzi
+00017b60: 7070 6564 2064 732c 2060 7061 7468 5f64  pped ds, `path_d
+00017b70: 6174 615f 7265 6c60 203d 2060 7061 7468  ata_rel` = `path
+00017b80: 5f6e 6f77 5f72 656c 600a 2020 2020 2020  _now_rel`.      
+00017b90: 2020 2020 2020 2d20 6973 5f7a 6970 7065        - is_zippe
+00017ba0: 643a 2054 7275 6520 6f72 2046 616c 7365  d: True or False
+00017bb0: 2c20 6973 2074 6865 2069 6e70 7574 2064  , is the input d
+00017bc0: 6174 6120 7a69 7070 6564 206f 7220 6e6f  ata zipped or no
+00017bd0: 740a 2020 2020 2020 2020 6e75 6d5f 6473  t.        num_ds
+00017be0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+00017bf0: 2020 6e75 6d62 6572 206f 6620 696e 7075    number of inpu
+00017c00: 7420 6461 7461 7365 7428 7329 0a20 2020  t dataset(s).   
+00017c10: 2020 2020 2069 6e69 7469 616c 5f69 6e63       initial_inc
+00017c20: 6c75 5f64 663a 2070 616e 6461 7320 4461  lu_df: pandas Da
+00017c30: 7461 4672 616d 6520 6f72 204e 6f6e 650a  taFrame or None.
+00017c40: 2020 2020 2020 2020 2020 2020 676f 7420              got 
+00017c50: 6279 206d 6574 686f 6420 6067 6574 5f69  by method `get_i
+00017c60: 6e69 7469 616c 5f69 6e63 6c75 5f64 6628  nitial_inclu_df(
+00017c70: 2960 2c20 6261 7365 6420 6f6e 2060 6c69  )`, based on `li
+00017c80: 7374 5f73 7562 5f66 696c 6560 0a20 2020  st_sub_file`.   
+00017c90: 2020 2020 2020 2020 2041 7373 6967 6e20           Assign 
+00017ca0: 604e 6f6e 6560 2066 6f72 206e 6f77 2c20  `None` for now, 
+00017cb0: 6265 666f 7265 2063 616c 6c69 6e67 2074  before calling t
+00017cc0: 6861 7420 6d65 7468 6f64 0a20 2020 2020  hat method.     
+00017cd0: 2020 2020 2020 2053 6565 2074 6861 7420         See that 
+00017ce0: 6d65 7468 6f64 2066 6f72 206d 6f72 652e  method for more.
+00017cf0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00017d00: 2020 2020 2020 2320 4162 6f75 7420 696e        # About in
+00017d10: 7075 7420 6461 7461 7365 7428 7329 3a20  put dataset(s): 
+00017d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00017d30: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00017d40: 2023 2063 7265 6174 6520 616e 2065 6d70   # create an emp
+00017d50: 7479 2070 616e 6461 7320 4461 7461 4672  ty pandas DataFr
+00017d60: 616d 653a 0a20 2020 2020 2020 2073 656c  ame:.        sel
+00017d70: 662e 6466 203d 2070 642e 4461 7461 4672  f.df = pd.DataFr
+00017d80: 616d 6528 4e6f 6e65 2c0a 2020 2020 2020  ame(None,.      
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017da0: 2020 2020 2020 2020 2069 6e64 6578 3d6c           index=l
+00017db0: 6973 7428 7261 6e67 6528 302c 206c 656e  ist(range(0, len
+00017dc0: 2869 6e70 7574 5f63 6c69 2929 292c 0a20  (input_cli))),. 
+00017dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017de0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00017df0: 6c75 6d6e 733d 5b27 6e61 6d65 272c 2027  lumns=['name', '
+00017e00: 7061 7468 5f69 6e27 2c20 2770 6174 685f  path_in', 'path_
+00017e10: 6e6f 775f 7265 6c27 2c0a 2020 2020 2020  now_rel',.      
+00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e40: 2020 2770 6174 685f 6e6f 775f 6162 7327    'path_now_abs'
+00017e50: 2c20 2770 6174 685f 6461 7461 5f72 656c  , 'path_data_rel
+00017e60: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e80: 2020 2020 2020 2020 2020 2027 6973 5f7a             'is_z
+00017e90: 6970 7065 6427 5d29 0a0a 2020 2020 2020  ipped'])..      
+00017ea0: 2020 2320 6e75 6d62 6572 206f 6620 6461    # number of da
+00017eb0: 7461 7365 7428 7329 3a0a 2020 2020 2020  taset(s):.      
+00017ec0: 2020 7365 6c66 2e6e 756d 5f64 7320 3d20    self.num_ds = 
+00017ed0: 7365 6c66 2e64 662e 7368 6170 655b 305d  self.df.shape[0]
+00017ee0: 2020 2023 206e 756d 6265 7220 6f66 2072     # number of r
+00017ef0: 6f77 7320 696e 2060 6466 600a 0a20 2020  ows in `df`..   
+00017f00: 2020 2020 2023 2063 6861 6e67 6520 7468       # change th
+00017f10: 6520 6069 6e70 7574 5f63 6c69 6020 6672  e `input_cli` fr
+00017f20: 6f6d 206e 6573 7465 6420 6c69 7374 2074  om nested list t
+00017f30: 6f20 6120 7061 6e64 6173 2064 6174 6166  o a pandas dataf
+00017f40: 7261 6d65 3a0a 2020 2020 2020 2020 666f  rame:.        fo
+00017f50: 7220 6920 696e 2072 616e 6765 2830 2c20  r i in range(0, 
+00017f60: 7365 6c66 2e6e 756d 5f64 7329 3a0a 2020  self.num_ds):.  
+00017f70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00017f80: 665b 226e 616d 6522 5d5b 695d 203d 2069  f["name"][i] = i
+00017f90: 6e70 7574 5f63 6c69 5b69 5d5b 305d 0a20  nput_cli[i][0]. 
+00017fa0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00017fb0: 6466 5b22 7061 7468 5f69 6e22 5d5b 695d  df["path_in"][i]
+00017fc0: 203d 2069 6e70 7574 5f63 6c69 5b69 5d5b   = input_cli[i][
+00017fd0: 315d 0a20 2020 2020 2020 2020 2020 2073  1].            s
+00017fe0: 656c 662e 6466 5b22 7061 7468 5f6e 6f77  elf.df["path_now
+00017ff0: 5f72 656c 225d 5b69 5d20 3d20 6f70 2e6a  _rel"][i] = op.j
+00018000: 6f69 6e28 2269 6e70 7574 732f 6461 7461  oin("inputs/data
+00018010: 222c 2073 656c 662e 6466 5b22 6e61 6d65  ", self.df["name
+00018020: 225d 5b69 5d29 0a0a 2020 2020 2020 2020  "][i])..        
+00018030: 2320 7361 6e69 7479 2063 6865 636b 3a20  # sanity check: 
+00018040: 696e 7075 7420 6473 206e 616d 6573 2073  input ds names s
+00018050: 686f 756c 6420 6e6f 7420 6265 2069 6465  hould not be ide
+00018060: 6e74 6963 616c 3a0a 2020 2020 2020 2020  ntical:.        
+00018070: 6966 206c 656e 2873 6574 2873 656c 662e  if len(set(self.
+00018080: 6466 5b22 6e61 6d65 225d 2e74 6f6c 6973  df["name"].tolis
+00018090: 7428 2929 2920 213d 2073 656c 662e 6e75  t())) != self.nu
+000180a0: 6d5f 6473 3a20 2023 206c 656e 6774 6820  m_ds:  # length 
+000180b0: 6f66 2074 6865 2073 6574 203d 206e 756d  of the set = num
+000180c0: 6265 7220 6f66 2064 730a 2020 2020 2020  ber of ds.      
+000180d0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+000180e0: 7074 696f 6e28 2254 6865 7265 2061 7265  ption("There are
+000180f0: 2069 6465 6e74 6963 616c 206e 616d 6573   identical names
+00018100: 2069 6e20 696e 7075 7420 6461 7461 7365   in input datase
+00018110: 7473 2720 6e61 6d65 7321 2229 0a0a 2020  ts' names!")..  
+00018120: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+00018130: 7a65 206f 7468 6572 2061 7474 7269 6275  ze other attribu
+00018140: 7465 733a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  tes: -----------
+00018150: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00018160: 2d2d 2d0a 2020 2020 2020 2020 7365 6c66  ---.        self
+00018170: 2e69 6e69 7469 616c 5f69 6e63 6c75 5f64  .initial_inclu_d
+00018180: 6620 3d20 4e6f 6e65 0a0a 2020 2020 6465  f = None..    de
+00018190: 6620 6765 745f 696e 6974 6961 6c5f 696e  f get_initial_in
+000181a0: 636c 755f 6466 2873 656c 662c 206c 6973  clu_df(self, lis
+000181b0: 745f 7375 625f 6669 6c65 2c20 7479 7065  t_sub_file, type
+000181c0: 5f73 6573 7369 6f6e 293a 0a20 2020 2020  _session):.     
+000181d0: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
+000181e0: 6566 696e 6520 6174 7472 6962 7574 6520  efine attribute 
+000181f0: 6069 6e69 7469 616c 5f69 6e63 6c75 5f64  `initial_inclu_d
+00018200: 6660 2c20 6120 7061 6e64 6173 2044 6174  f`, a pandas Dat
+00018210: 6146 7261 6d65 206f 7220 4e6f 6e65 0a20  aFrame or None. 
+00018220: 2020 2020 2020 2020 2020 2062 6173 6564             based
+00018230: 206f 6e20 606c 6973 745f 7375 625f 6669   on `list_sub_fi
+00018240: 6c65 600a 2020 2020 2020 2020 2020 2020  le`.            
+00018250: 7369 6e67 6c65 2d73 6573 7369 6f6e 2064  single-session d
+00018260: 6174 613a 2063 6f6c 756d 6e20 6f66 2027  ata: column of '
+00018270: 7375 625f 6964 273b 0a20 2020 2020 2020  sub_id';.       
+00018280: 2020 2020 206d 756c 7469 2d73 6573 7369       multi-sessi
+00018290: 6f6e 2064 6174 613a 2063 6f6c 756d 6e73  on data: columns
+000182a0: 206f 6620 2773 7562 5f69 6427 2061 6e64   of 'sub_id' and
+000182b0: 2027 7365 735f 6964 270a 0a20 2020 2020   'ses_id'..     
+000182c0: 2020 2050 6172 616d 6574 6572 733a 0a20     Parameters:. 
+000182d0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+000182e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+000182f0: 6c69 7374 5f73 7562 5f66 696c 653a 2073  list_sub_file: s
+00018300: 7472 206f 7220 4e6f 6e65 0a20 2020 2020  tr or None.     
+00018310: 2020 2020 2020 2050 6174 6820 746f 2074         Path to t
+00018320: 6865 2043 5356 2066 696c 6520 7468 6174  he CSV file that
+00018330: 206c 6973 7473 2074 6865 2073 7562 6a65   lists the subje
+00018340: 6374 2028 616e 6420 7365 7373 696f 6e73  ct (and sessions
+00018350: 2920 746f 2061 6e61 6c79 7a65 3b0a 2020  ) to analyze;.  
+00018360: 2020 2020 2020 2020 2020 6f72 2060 4e6f            or `No
+00018370: 6e65 6020 6966 2074 6861 7420 434c 4920  ne` if that CLI 
+00018380: 666c 6167 2077 6173 206e 6f74 2073 7065  flag was not spe
+00018390: 6369 6669 6564 2e0a 2020 2020 2020 2020  cified..        
+000183a0: 2020 2020 7369 6e67 6c65 2d73 6573 2064      single-ses d
+000183b0: 6174 613a 2063 6f6c 756d 6e20 6f66 2027  ata: column of '
+000183c0: 7375 625f 6964 273b 0a20 2020 2020 2020  sub_id';.       
+000183d0: 2020 2020 206d 756c 7469 2d73 6573 2064       multi-ses d
+000183e0: 6174 613a 2063 6f6c 756d 6e73 206f 6620  ata: columns of 
+000183f0: 2773 7562 5f69 6427 2061 6e64 2027 7365  'sub_id' and 'se
+00018400: 735f 6964 270a 2020 2020 2020 2020 7479  s_id'.        ty
+00018410: 7065 5f73 6573 7369 6f6e 3a20 7374 720a  pe_session: str.
+00018420: 2020 2020 2020 2020 2020 2020 226d 756c              "mul
+00018430: 7469 2d73 6573 2220 6f72 2022 7369 6e67  ti-ses" or "sing
+00018440: 6c65 2d73 6573 220a 2020 2020 2020 2020  le-ses".        
+00018450: 2222 220a 2020 2020 2020 2020 2320 4765  """.        # Ge
+00018460: 7420 7468 6520 696e 6974 6961 6c20 696e  t the initial in
+00018470: 636c 7564 6564 2073 7562 2f73 6573 206c  cluded sub/ses l
+00018480: 6973 7420 6672 6f6d 2060 6c69 7374 5f73  ist from `list_s
+00018490: 7562 5f66 696c 6560 2043 5356 3a0a 2020  ub_file` CSV:.  
+000184a0: 2020 2020 2020 6966 206c 6973 745f 7375        if list_su
+000184b0: 625f 6669 6c65 2069 7320 4e6f 6e65 3a20  b_file is None: 
+000184c0: 2023 2069 6620 6e6f 7420 746f 2073 7065   # if not to spe
+000184d0: 6369 6679 2074 6861 7420 666c 6167 2069  cify that flag i
+000184e0: 6e20 434c 492c 2069 7427 6c6c 2062 6520  n CLI, it'll be 
+000184f0: 604e 6f6e 6560 0a20 2020 2020 2020 2020  `None`.         
+00018500: 2020 2073 656c 662e 696e 6974 6961 6c5f     self.initial_
+00018510: 696e 636c 755f 6466 203d 204e 6f6e 650a  inclu_df = None.
+00018520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018530: 2020 2020 2020 2020 2020 6966 206f 702e            if op.
+00018540: 6578 6973 7473 286c 6973 745f 7375 625f  exists(list_sub_
+00018550: 6669 6c65 2920 6973 2046 616c 7365 3a20  file) is False: 
+00018560: 2020 2023 2064 6f65 7320 6e6f 7420 6578     # does not ex
+00018570: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00018580: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+00018590: 7469 6f6e 2822 606c 6973 745f 7375 625f  tion("`list_sub_
+000185a0: 6669 6c65 6020 646f 6573 206e 6f74 2065  file` does not e
+000185b0: 7869 7374 7321 2050 6c65 6173 6520 6368  xists! Please ch
+000185c0: 6563 6b3a 2022 0a20 2020 2020 2020 2020  eck: ".         
+000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185e0: 2020 2020 2020 202b 206c 6973 745f 7375         + list_su
+000185f0: 625f 6669 6c65 290a 2020 2020 2020 2020  b_file).        
+00018600: 2020 2020 656c 7365 3a20 2020 2320 6578      else:   # ex
+00018610: 6973 7473 3a0a 2020 2020 2020 2020 2020  ists:.          
+00018620: 2020 2020 2020 7365 6c66 2e69 6e69 7469        self.initi
+00018630: 616c 5f69 6e63 6c75 5f64 6620 3d20 7064  al_inclu_df = pd
+00018640: 2e72 6561 645f 6373 7628 6c69 7374 5f73  .read_csv(list_s
+00018650: 7562 5f66 696c 6529 0a20 2020 2020 2020  ub_file).       
+00018660: 2020 2020 2020 2020 2073 656c 662e 7661           self.va
+00018670: 6c69 6461 7465 5f69 6e69 7469 616c 5f69  lidate_initial_i
+00018680: 6e63 6c75 5f64 6628 7479 7065 5f73 6573  nclu_df(type_ses
+00018690: 7369 6f6e 290a 0a20 2020 2064 6566 2076  sion)..    def v
+000186a0: 616c 6964 6174 655f 696e 6974 6961 6c5f  alidate_initial_
+000186b0: 696e 636c 755f 6466 2873 656c 662c 2074  inclu_df(self, t
+000186c0: 7970 655f 7365 7373 696f 6e29 3a0a 2020  ype_session):.  
+000186d0: 2020 2020 2020 2320 5361 6e69 7479 2063        # Sanity c
+000186e0: 6865 636b 3a20 7468 6572 6520 6172 6520  heck: there are 
+000186f0: 6578 7065 6374 6564 2063 6f6c 756d 6e28  expected column(
+00018700: 7329 3a0a 2020 2020 2020 2020 6966 2022  s):.        if "
+00018710: 7375 625f 6964 2220 6e6f 7420 696e 206c  sub_id" not in l
+00018720: 6973 7428 7365 6c66 2e69 6e69 7469 616c  ist(self.initial
+00018730: 5f69 6e63 6c75 5f64 662e 636f 6c75 6d6e  _inclu_df.column
+00018740: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00018750: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00018760: 2254 6865 7265 2069 7320 6e6f 2027 7375  "There is no 'su
+00018770: 625f 6964 2720 636f 6c75 6d6e 2069 6e20  b_id' column in 
+00018780: 606c 6973 745f 7375 625f 6669 6c65 6021  `list_sub_file`!
+00018790: 2229 0a20 2020 2020 2020 2069 6620 7479  ").        if ty
+000187a0: 7065 5f73 6573 7369 6f6e 203d 3d20 226d  pe_session == "m
+000187b0: 756c 7469 2d73 6573 223a 0a20 2020 2020  ulti-ses":.     
+000187c0: 2020 2020 2020 2069 6620 2273 6573 5f69         if "ses_i
+000187d0: 6422 206e 6f74 2069 6e20 6c69 7374 2873  d" not in list(s
+000187e0: 656c 662e 696e 6974 6961 6c5f 696e 636c  elf.initial_incl
+000187f0: 755f 6466 2e63 6f6c 756d 6e73 293a 0a20  u_df.columns):. 
+00018800: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018810: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+00018820: 5468 6572 6520 6973 206e 6f20 2773 6573  There is no 'ses
+00018830: 5f69 6427 2063 6f6c 756d 6e20 696e 2060  _id' column in `
+00018840: 6c69 7374 5f73 7562 5f66 696c 6560 2122  list_sub_file`!"
+00018850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018870: 2020 2020 2020 2020 2020 202b 2022 606c             + "`l
-00018880: 6973 745f 7375 625f 6669 6c65 6021 2229  ist_sub_file`!")
-00018890: 0a20 2020 2020 2020 2065 6c69 6620 7479  .        elif ty
-000188a0: 7065 5f73 6573 7369 6f6e 203d 3d20 226d  pe_session == "m
-000188b0: 756c 7469 2d73 6573 223a 0a20 2020 2020  ulti-ses":.     
-000188c0: 2020 2020 2020 2023 2074 6865 7265 2073         # there s
-000188d0: 686f 756c 6420 6e6f 7420 6265 2072 6570  hould not be rep
-000188e0: 6561 7465 6420 636f 6d62 696e 6174 696f  eated combinatio
-000188f0: 6e73 206f 6620 6073 7562 5f69 6460 2061  ns of `sub_id` a
-00018900: 6e64 2060 7365 735f 6964 603a 0a20 2020  nd `ses_id`:.   
-00018910: 2020 2020 2020 2020 2061 6674 6572 5f64           after_d
-00018920: 726f 7070 696e 6720 3d20 5c0a 2020 2020  ropping = \.    
-00018930: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018940: 2e69 6e69 7469 616c 5f69 6e63 6c75 5f64  .initial_inclu_d
-00018950: 662e 6472 6f70 5f64 7570 6c69 6361 7465  f.drop_duplicate
-00018960: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00018970: 2020 2020 2020 2073 7562 7365 743d 5b27         subset=['
-00018980: 7375 625f 6964 272c 2027 7365 735f 6964  sub_id', 'ses_id
-00018990: 275d 2c20 6b65 6570 3d27 6669 7273 7427  '], keep='first'
-000189a0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-000189b0: 5e5e 2072 656d 6f76 6520 6475 706c 6963  ^^ remove duplic
-000189c0: 6174 696f 6e73 2069 6e20 7370 6563 6966  ations in specif
-000189d0: 6963 2063 6f6c 732c 2061 6e64 206b 6565  ic cols, and kee
-000189e0: 7020 7468 6520 6669 7273 7420 6f63 6375  p the first occu
-000189f0: 7272 656e 6365 0a20 2020 2020 2020 2020  rrence.         
-00018a00: 2020 2069 6620 6166 7465 725f 6472 6f70     if after_drop
-00018a10: 7069 6e67 2e73 6861 7065 5b30 5d20 3c20  ping.shape[0] < 
-00018a20: 7365 6c66 2e69 6e69 7469 616c 5f69 6e63  self.initial_inc
-00018a30: 6c75 5f64 662e 7368 6170 655b 305d 3a0a  lu_df.shape[0]:.
-00018a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a50: 7072 696e 7428 2243 6f6d 6269 6e61 7469  print("Combinati
-00018a60: 6f6e 7320 6f66 2027 7375 625f 6964 2720  ons of 'sub_id' 
-00018a70: 616e 6420 2773 6573 5f69 6427 2069 6e20  and 'ses_id' in 
-00018a80: 736f 6d65 2072 6f77 7320 6172 6520 6475  some rows are du
-00018a90: 706c 6963 6174 6564 2e22 0a20 2020 2020  plicated.".     
-00018aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ab0: 202b 2022 2057 696c 6c20 6f6e 6c79 206b   + " Will only k
-00018ac0: 6565 7020 7468 6520 6669 7273 7420 6f63  eep the first oc
-00018ad0: 6375 7272 656e 6365 2e2e 2e22 290a 2020  currence...").  
-00018ae0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018af0: 6c66 2e69 6e69 7469 616c 5f69 6e63 6c75  lf.initial_inclu
-00018b00: 5f64 6620 3d20 6166 7465 725f 6472 6f70  _df = after_drop
-00018b10: 7069 6e67 0a0a 2020 2020 2020 2020 2320  ping..        # 
-00018b20: 536f 7274 3a0a 2020 2020 2020 2020 6966  Sort:.        if
-00018b30: 2074 7970 655f 7365 7373 696f 6e20 3d3d   type_session ==
-00018b40: 2022 7369 6e67 6c65 2d73 6573 223a 0a20   "single-ses":. 
-00018b50: 2020 2020 2020 2020 2020 2023 2073 6f72             # sor
-00018b60: 743a 0a20 2020 2020 2020 2020 2020 2073  t:.            s
-00018b70: 656c 662e 696e 6974 6961 6c5f 696e 636c  elf.initial_incl
-00018b80: 755f 6466 203d 205c 0a20 2020 2020 2020  u_df = \.       
-00018b90: 2020 2020 2020 2020 2073 656c 662e 696e           self.in
-00018ba0: 6974 6961 6c5f 696e 636c 755f 6466 2e73  itial_inclu_df.s
-00018bb0: 6f72 745f 7661 6c75 6573 2862 793d 5b27  ort_values(by=['
-00018bc0: 7375 625f 6964 275d 290a 2020 2020 2020  sub_id']).      
-00018bd0: 2020 2020 2020 2320 7265 7365 7420 7468        # reset th
-00018be0: 6520 696e 6465 782c 2061 6e64 2072 656d  e index, and rem
-00018bf0: 6f76 6520 7468 6520 6164 6469 7469 6f6e  ove the addition
-00018c00: 616c 2063 6f6c 756d 653a 0a20 2020 2020  al colume:.     
-00018c10: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
-00018c20: 6961 6c5f 696e 636c 755f 6466 203d 205c  ial_inclu_df = \
-00018c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c40: 2073 656c 662e 696e 6974 6961 6c5f 696e   self.initial_in
-00018c50: 636c 755f 6466 2e72 6573 6574 5f69 6e64  clu_df.reset_ind
-00018c60: 6578 2829 2e64 726f 7028 636f 6c75 6d6e  ex().drop(column
-00018c70: 733d 5b27 696e 6465 7827 5d29 0a20 2020  s=['index']).   
-00018c80: 2020 2020 2065 6c69 6620 7479 7065 5f73       elif type_s
-00018c90: 6573 7369 6f6e 203d 3d20 226d 756c 7469  ession == "multi
-00018ca0: 2d73 6573 223a 0a20 2020 2020 2020 2020  -ses":.         
-00018cb0: 2020 2073 656c 662e 696e 6974 6961 6c5f     self.initial_
-00018cc0: 696e 636c 755f 6466 203d 205c 0a20 2020  inclu_df = \.   
-00018cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018ce0: 662e 696e 6974 6961 6c5f 696e 636c 755f  f.initial_inclu_
-00018cf0: 6466 2e73 6f72 745f 7661 6c75 6573 2862  df.sort_values(b
-00018d00: 793d 5b27 7375 625f 6964 272c 2027 7365  y=['sub_id', 'se
-00018d10: 735f 6964 275d 290a 2020 2020 2020 2020  s_id']).        
-00018d20: 2020 2020 7365 6c66 2e69 6e69 7469 616c      self.initial
-00018d30: 5f69 6e63 6c75 5f64 6620 3d20 5c0a 2020  _inclu_df = \.  
-00018d40: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00018d50: 6c66 2e69 6e69 7469 616c 5f69 6e63 6c75  lf.initial_inclu
-00018d60: 5f64 662e 7265 7365 745f 696e 6465 7828  _df.reset_index(
-00018d70: 292e 6472 6f70 2863 6f6c 756d 6e73 3d5b  ).drop(columns=[
-00018d80: 2769 6e64 6578 275d 290a 0a20 2020 2064  'index'])..    d
-00018d90: 6566 2061 7373 6967 6e5f 7061 7468 5f6e  ef assign_path_n
-00018da0: 6f77 5f61 6273 2873 656c 662c 2061 6e61  ow_abs(self, ana
-00018db0: 6c79 7369 735f 7061 7468 293a 0a20 2020  lysis_path):.   
-00018dc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00018dd0: 2054 6869 7320 6973 2074 6865 2061 7373   This is the ass
-00018de0: 6967 6e20 7468 6520 6162 736f 6c75 7465  ign the absolute
-00018df0: 2070 6174 6820 746f 2069 6e70 7574 2064   path to input d
-00018e00: 6174 6173 6574 0a0a 2020 2020 2020 2020  ataset..        
-00018e10: 5061 7261 6d65 7465 7273 3a0a 2020 2020  Parameters:.    
-00018e20: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00018e30: 2d2d 0a20 2020 2020 2020 2061 6e61 6c79  --.        analy
-00018e40: 7369 735f 7061 7468 3a20 7374 720a 2020  sis_path: str.  
-00018e50: 2020 2020 2020 2020 2020 6162 736f 6c75            absolu
-00018e60: 7465 2070 6174 6820 746f 2074 6865 2060  te path to the `
-00018e70: 616e 616c 7973 6973 6020 666f 6c64 6572  analysis` folder
-00018e80: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00018e90: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00018ea0: 7261 6e67 6528 302c 2073 656c 662e 6e75  range(0, self.nu
-00018eb0: 6d5f 6473 293a 0a20 2020 2020 2020 2020  m_ds):.         
-00018ec0: 2020 2073 656c 662e 6466 5b22 7061 7468     self.df["path
-00018ed0: 5f6e 6f77 5f61 6273 225d 5b69 5d20 3d20  _now_abs"][i] = 
-00018ee0: 6f70 2e6a 6f69 6e28 616e 616c 7973 6973  op.join(analysis
-00018ef0: 5f70 6174 682c 0a20 2020 2020 2020 2020  _path,.         
-00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f20: 2020 2020 2020 2020 7365 6c66 2e64 665b          self.df[
-00018f30: 2270 6174 685f 6e6f 775f 7265 6c22 5d5b  "path_now_rel"][
-00018f40: 695d 290a 0a20 2020 2064 6566 2063 6865  i])..    def che
-00018f50: 636b 5f69 665f 7a69 7070 6564 2873 656c  ck_if_zipped(sel
-00018f60: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-00018f70: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-00018f80: 746f 2063 6865 636b 2069 6620 6561 6368  to check if each
-00018f90: 2069 6e70 7574 2064 6174 6173 6574 2069   input dataset i
-00018fa0: 7320 7a69 7070 6564 2c20 616e 6420 6173  s zipped, and as
-00018fb0: 7369 676e 2060 7061 7468 5f64 6174 615f  sign `path_data_
-00018fc0: 7265 6c60 2e0a 2020 2020 2020 2020 4966  rel`..        If
-00018fd0: 2069 7427 7320 6120 7a69 7070 6564 2064   it's a zipped d
-00018fe0: 733a 2060 7061 7468 5f64 6174 615f 7265  s: `path_data_re
-00018ff0: 6c60 203d 2060 7061 7468 5f6e 6f77 5f72  l` = `path_now_r
-00019000: 656c 602f 606e 616d 6560 2c0a 2020 2020  el`/`name`,.    
-00019010: 2020 2020 2020 2020 2020 2020 692e 652e              i.e.
-00019020: 2c20 6578 7472 6120 6c61 7965 7220 6f66  , extra layer of
-00019030: 2066 6f6c 6465 7220 676f 7420 6672 6f6d   folder got from
-00019040: 2075 6e7a 6970 7069 6e67 0a20 2020 2020   unzipping.     
-00019050: 2020 2049 6620 6974 2773 2061 6e20 756e     If it's an un
-00019060: 7a69 7070 6564 2064 732c 2060 7061 7468  zipped ds, `path
-00019070: 5f64 6174 615f 7265 6c60 203d 2060 7061  _data_rel` = `pa
-00019080: 7468 5f6e 6f77 5f72 656c 600a 2020 2020  th_now_rel`.    
-00019090: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-000190a0: 2023 2044 6574 6572 6d69 6e65 2069 6620   # Determine if 
-000190b0: 6974 2773 2061 207a 6970 7065 6420 6461  it's a zipped da
-000190c0: 7461 7365 742c 2066 6f72 2065 6163 6820  taset, for each 
-000190d0: 696e 7075 7420 6473 3a0a 2020 2020 2020  input ds:.      
-000190e0: 2020 666f 7220 695f 6473 2069 6e20 7261    for i_ds in ra
-000190f0: 6e67 6528 302c 2073 656c 662e 6e75 6d5f  nge(0, self.num_
-00019100: 6473 293a 0a20 2020 2020 2020 2020 2020  ds):.           
-00019110: 2074 656d 705f 6c69 7374 203d 2067 6c6f   temp_list = glo
-00019120: 622e 676c 6f62 2873 656c 662e 6466 5b22  b.glob(self.df["
-00019130: 7061 7468 5f6e 6f77 5f61 6273 225d 5b69  path_now_abs"][i
-00019140: 5f64 735d 202b 2022 2f73 7562 2d2a 2229  _ds] + "/sub-*")
-00019150: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
-00019160: 6e74 5f7a 6970 203d 2030 0a20 2020 2020  nt_zip = 0.     
-00019170: 2020 2020 2020 2063 6f75 6e74 5f64 6972         count_dir
-00019180: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00019190: 2066 6f72 2069 5f74 656d 7020 696e 2072   for i_temp in r
-000191a0: 616e 6765 2830 2c20 6c65 6e28 7465 6d70  ange(0, len(temp
-000191b0: 5f6c 6973 7429 293a 0a20 2020 2020 2020  _list)):.       
-000191c0: 2020 2020 2020 2020 2069 6620 6f70 2e69           if op.i
-000191d0: 7364 6972 2874 656d 705f 6c69 7374 5b69  sdir(temp_list[i
-000191e0: 5f74 656d 705d 293a 0a20 2020 2020 2020  _temp]):.       
-000191f0: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
-00019200: 6e74 5f64 6972 202b 3d20 310a 2020 2020  nt_dir += 1.    
-00019210: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00019220: 2074 656d 705f 6c69 7374 5b69 5f74 656d   temp_list[i_tem
-00019230: 705d 5b2d 343a 5d20 3d3d 2022 2e7a 6970  p][-4:] == ".zip
-00019240: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00019250: 2020 2020 2020 2063 6f75 6e74 5f7a 6970         count_zip
-00019260: 202b 3d20 310a 0a20 2020 2020 2020 2020   += 1..         
-00019270: 2020 2069 6620 2863 6f75 6e74 5f7a 6970     if (count_zip
-00019280: 203e 2030 2920 2620 2863 6f75 6e74 5f64   > 0) & (count_d
-00019290: 6972 203d 3d20 3029 3a20 2020 2320 616c  ir == 0):   # al
-000192a0: 6c20 6172 6520 7a69 7020 6669 6c65 733a  l are zip files:
-000192b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000192c0: 2073 656c 662e 6466 5b22 6973 5f7a 6970   self.df["is_zip
-000192d0: 7065 6422 5d5b 695f 6473 5d20 3d20 5472  ped"][i_ds] = Tr
-000192e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000192f0: 2020 2070 7269 6e74 2822 696e 7075 7420     print("input 
-00019300: 6461 7461 7365 7420 2722 202b 2073 656c  dataset '" + sel
-00019310: 662e 6466 5b22 6e61 6d65 225d 5b69 5f64  f.df["name"][i_d
-00019320: 735d 202b 2022 2722 0a20 2020 2020 2020  s] + "'".       
-00019330: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-00019340: 2022 2069 7320 636f 6e73 6964 6572 6564   " is considered
-00019350: 2061 7320 6120 7a69 7070 6564 2064 6174   as a zipped dat
-00019360: 6173 6574 2e22 290a 2020 2020 2020 2020  aset.").        
-00019370: 2020 2020 656c 6966 2028 636f 756e 745f      elif (count_
-00019380: 6469 7220 3e20 3029 2026 2028 636f 756e  dir > 0) & (coun
-00019390: 745f 7a69 7020 3d3d 2030 293a 2020 2023  t_zip == 0):   #
-000193a0: 2061 6c6c 2061 7265 2064 6972 6563 746f   all are directo
-000193b0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-000193c0: 2020 2020 2020 7365 6c66 2e64 665b 2269        self.df["i
-000193d0: 735f 7a69 7070 6564 225d 5b69 5f64 735d  s_zipped"][i_ds]
-000193e0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000193f0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00019400: 696e 7075 7420 6461 7461 7365 7420 2722  input dataset '"
-00019410: 202b 2073 656c 662e 6466 5b22 6e61 6d65   + self.df["name
-00019420: 225d 5b69 5f64 735d 202b 2022 2722 0a20  "][i_ds] + "'". 
-00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019440: 2020 2020 202b 2022 2069 7320 636f 6e73       + " is cons
-00019450: 6964 6572 6564 2061 7320 616e 2075 6e7a  idered as an unz
-00019460: 6970 7065 6420 6461 7461 7365 742e 2229  ipped dataset.")
-00019470: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00019480: 6620 2863 6f75 6e74 5f7a 6970 203e 2030  f (count_zip > 0
-00019490: 2920 2620 2863 6f75 6e74 5f64 6972 203e  ) & (count_dir >
-000194a0: 2030 293a 2020 2320 6465 7465 6374 2062   0):  # detect b
-000194b0: 6f74 683a 0a20 2020 2020 2020 2020 2020  oth:.           
-000194c0: 2020 2020 2073 656c 662e 6466 5b22 6973       self.df["is
-000194d0: 5f7a 6970 7065 6422 5d5b 695f 6473 5d20  _zipped"][i_ds] 
-000194e0: 3d20 5472 7565 2020 2023 2063 6f6e 7369  = True   # consi
-000194f0: 6465 7220 6173 207a 6970 7065 640a 2020  der as zipped.  
-00019500: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00019510: 696e 7428 2269 6e70 7574 2064 6174 6173  int("input datas
-00019520: 6574 2027 2220 2b20 7365 6c66 2e64 665b  et '" + self.df[
-00019530: 226e 616d 6522 5d5b 695f 6473 5d20 2b20  "name"][i_ds] + 
-00019540: 2227 220a 2020 2020 2020 2020 2020 2020  "'".            
-00019550: 2020 2020 2020 2020 2020 2b20 2220 6861            + " ha
-00019560: 7320 626f 7468 207a 6970 7065 6420 6669  s both zipped fi
-00019570: 6c65 7320 616e 6420 756e 7a69 7070 6564  les and unzipped
-00019580: 2066 6f6c 6465 7273 3b22 0a20 2020 2020   folders;".     
-00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195a0: 202b 2022 2074 6875 7320 6974 2773 2063   + " thus it's c
-000195b0: 6f6e 7369 6465 7265 6420 6173 2061 207a  onsidered as a z
-000195c0: 6970 7065 6420 6461 7461 7365 742e 2229  ipped dataset.")
-000195d0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000195e0: 653a 2020 2023 2064 6964 206e 6f74 2064  e:   # did not d
-000195f0: 6574 6563 7420 616e 7920 6f66 2074 6865  etect any of the
-00019600: 6d2e 2e2e 0a20 2020 2020 2020 2020 2020  m....           
-00019610: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00019620: 7469 6f6e 2822 4241 4253 2064 6964 206e  tion("BABS did n
-00019630: 6f74 2064 6574 6563 7420 616e 7920 666f  ot detect any fo
-00019640: 6c64 6572 206f 7220 7a69 7020 6669 6c65  lder or zip file
-00019650: 206f 6620 6073 7562 2d2a 6022 0a20 2020   of `sub-*`".   
-00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-00019680: 2069 6e20 696e 7075 7420 6461 7461 7365   in input datase
-00019690: 7420 2722 202b 2073 656c 662e 6466 5b22  t '" + self.df["
-000196a0: 6e61 6d65 225d 5b69 5f64 735d 202b 2022  name"][i_ds] + "
-000196b0: 272e 2229 0a0a 2020 2020 2020 2020 2320  '.")..        # 
-000196c0: 4173 7369 676e 2060 7061 7468 5f64 6174  Assign `path_dat
-000196d0: 615f 7265 6c60 3a0a 2020 2020 2020 2020  a_rel`:.        
-000196e0: 666f 7220 695f 6473 2069 6e20 7261 6e67  for i_ds in rang
-000196f0: 6528 302c 2073 656c 662e 6e75 6d5f 6473  e(0, self.num_ds
-00019700: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00019710: 6620 7365 6c66 2e64 665b 2269 735f 7a69  f self.df["is_zi
-00019720: 7070 6564 225d 5b69 5f64 735d 2069 7320  pped"][i_ds] is 
-00019730: 5472 7565 3a20 2020 2320 7a69 7070 6564  True:   # zipped
-00019740: 2064 730a 2020 2020 2020 2020 2020 2020   ds.            
-00019750: 2020 2020 7365 6c66 2e64 665b 2270 6174      self.df["pat
-00019760: 685f 6461 7461 5f72 656c 225d 5b69 5f64  h_data_rel"][i_d
-00019770: 735d 203d 206f 702e 6a6f 696e 2873 656c  s] = op.join(sel
-00019780: 662e 6466 5b22 7061 7468 5f6e 6f77 5f72  f.df["path_now_r
-00019790: 656c 225d 5b69 5f64 735d 2c0a 2020 2020  el"][i_ds],.    
-000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197d0: 2020 2020 2073 656c 662e 6466 5b22 6e61       self.df["na
-000197e0: 6d65 225d 5b69 5f64 735d 290a 2020 2020  me"][i_ds]).    
-000197f0: 2020 2020 2020 2020 656c 7365 3a20 2020          else:   
-00019800: 2320 756e 7a69 7070 6564 2064 733a 0a20  # unzipped ds:. 
-00019810: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00019820: 656c 662e 6466 5b22 7061 7468 5f64 6174  elf.df["path_dat
-00019830: 615f 7265 6c22 5d5b 695f 6473 5d20 3d20  a_rel"][i_ds] = 
-00019840: 7365 6c66 2e64 665b 2270 6174 685f 6e6f  self.df["path_no
-00019850: 775f 7265 6c22 5d5b 695f 6473 5d0a 0a20  w_rel"][i_ds].. 
-00019860: 2020 2064 6566 2063 6865 636b 5f76 616c     def check_val
-00019870: 6964 6974 795f 7a69 7070 6564 5f69 6e70  idity_zipped_inp
-00019880: 7574 5f64 6174 6173 6574 2873 656c 662c  ut_dataset(self,
-00019890: 2074 7970 655f 7365 7373 696f 6e29 3a0a   type_session):.
-000198a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000198b0: 2020 2020 5468 6973 2069 7320 746f 2070      This is to p
-000198c0: 6572 666f 726d 2074 776f 2073 616e 6974  erform two sanit
-000198d0: 7920 6368 6563 6b73 206f 6e20 6561 6368  y checks on each
-000198e0: 207a 6970 7065 6420 696e 7075 7420 6461   zipped input da
-000198f0: 7461 7365 743a 0a20 2020 2020 2020 2031  taset:.        1
-00019900: 2920 7361 6e69 7479 2063 6865 636b 206f  ) sanity check o
-00019910: 6e20 7468 6520 7a69 7020 6669 6c65 6e61  n the zip filena
-00019920: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
-00019930: 6966 206d 756c 7469 2d73 6573 3a20 7375  if multi-ses: su
-00019940: 622d 2a5f 7365 732d 2a5f 3c69 6e70 7574  b-*_ses-*_<input
-00019950: 5f64 735f 6e61 6d65 3e2a 2e7a 6970 0a20  _ds_name>*.zip. 
-00019960: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-00019970: 6e67 6c65 2d73 6573 3a20 7375 622d 2a5f  ngle-ses: sub-*_
-00019980: 3c69 6e70 7574 5f64 735f 6e61 6d65 3e2a  <input_ds_name>*
-00019990: 2e7a 6970 0a20 2020 2020 2020 2032 2920  .zip.        2) 
-000199a0: 7361 6e69 7479 2063 6865 636b 2074 6f20  sanity check to 
-000199b0: 6d61 6b65 2073 7572 6520 7468 6520 3173  make sure the 1s
-000199c0: 7420 6c65 7665 6c20 666f 6c64 6572 2069  t level folder i
-000199d0: 6e20 7a69 7066 696c 650a 2020 2020 2020  n zipfile.      
-000199e0: 2020 2020 2020 6973 2063 6f6e 7369 7374        is consist
-000199f0: 656e 7420 746f 2074 6869 7320 696e 7075  ent to this inpu
-00019a00: 7420 6461 7461 7365 7427 7320 6e61 6d65  t dataset's name
-00019a10: 3b0a 2020 2020 2020 2020 2020 2020 4f6e  ;.            On
-00019a20: 6c79 2063 6865 636b 7320 7468 6520 6669  ly checks the fi
-00019a30: 7273 7420 7a69 7066 696c 652e 0a0a 2020  rst zipfile...  
-00019a40: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00019a50: 3a0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  :.        ------
-00019a60: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2074  ------.        t
-00019a70: 7970 655f 7365 7373 696f 6e3a 2073 7472  ype_session: str
-00019a80: 0a20 2020 2020 2020 2020 2020 2022 6d75  .            "mu
-00019a90: 6c74 692d 7365 7322 206f 7220 2273 696e  lti-ses" or "sin
-00019aa0: 676c 652d 7365 7322 0a20 2020 2020 2020  gle-ses".       
-00019ab0: 2063 6f6e 7461 696e 6572 5f6e 616d 653a   container_name:
-00019ac0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-00019ad0: 204e 616d 6520 6f66 2074 6865 2063 6f6e   Name of the con
-00019ae0: 7461 696e 6572 0a20 2020 2020 2020 2022  tainer.        "
-00019af0: 2222 0a0a 2020 2020 2020 2020 6966 2054  ""..        if T
-00019b00: 7275 6520 696e 206c 6973 7428 7365 6c66  rue in list(self
-00019b10: 2e64 665b 2269 735f 7a69 7070 6564 225d  .df["is_zipped"]
-00019b20: 293a 2020 2320 7468 6572 6520 6973 2061  ):  # there is a
-00019b30: 7420 6c65 6173 7420 6f6e 6520 6461 7461  t least one data
-00019b40: 7365 7420 6973 207a 6970 7065 640a 2020  set is zipped.  
-00019b50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00019b60: 2250 6572 666f 726d 696e 6720 7361 6e69  "Performing sani
-00019b70: 7479 2063 6865 636b 2066 6f72 2061 6e79  ty check for any
-00019b80: 207a 6970 7065 6420 696e 7075 7420 6461   zipped input da
-00019b90: 7461 7365 742e 2e2e 220a 2020 2020 2020  taset...".      
-00019ba0: 2020 2020 2020 2020 2020 2020 2220 4765              " Ge
-00019bb0: 7474 696e 6720 6578 616d 706c 6520 7a69  tting example zi
-00019bc0: 7020 6669 6c65 2873 2920 746f 2063 6865  p file(s) to che
-00019bd0: 636b 2e2e 2e22 290a 2020 2020 2020 2020  ck...").        
-00019be0: 666f 7220 695f 6473 2069 6e20 7261 6e67  for i_ds in rang
-00019bf0: 6528 302c 2073 656c 662e 6e75 6d5f 6473  e(0, self.num_ds
-00019c00: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00019c10: 6620 7365 6c66 2e64 665b 2269 735f 7a69  f self.df["is_zi
-00019c20: 7070 6564 225d 5b69 5f64 735d 2069 7320  pped"][i_ds] is 
-00019c30: 5472 7565 3a20 2020 2320 7a69 7070 6564  True:   # zipped
-00019c40: 2064 730a 2020 2020 2020 2020 2020 2020   ds.            
-00019c50: 2020 2020 2320 5361 6e69 7479 2063 6865      # Sanity che
-00019c60: 636b 2023 313a 207a 6970 2066 696c 656e  ck #1: zip filen
-00019c70: 616d 653a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  ame: -----------
-00019c80: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00019c90: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00019ca0: 2020 2020 2020 2020 6966 2074 7970 655f          if type_
-00019cb0: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
-00019cc0: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
-00019cd0: 2020 2020 2020 2020 2020 2020 2320 6368              # ch
-00019ce0: 6563 6b20 6966 206d 6174 6368 6573 2074  eck if matches t
-00019cf0: 6865 2070 6174 7465 726e 206f 6620 6073  he pattern of `s
-00019d00: 7562 2d2a 5f73 6573 2d2a 5f3c 696e 7075  ub-*_ses-*_<inpu
-00019d10: 745f 6473 5f6e 616d 653e 2a2e 7a69 7060  t_ds_name>*.zip`
-00019d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019d30: 2020 2020 2020 7465 6d70 5f6c 6973 7420        temp_list 
-00019d40: 3d20 676c 6f62 2e67 6c6f 6228 7365 6c66  = glob.glob(self
-00019d50: 2e64 665b 2270 6174 685f 6e6f 775f 6162  .df["path_now_ab
-00019d60: 7322 5d5b 695f 6473 5d0a 2020 2020 2020  s"][i_ds].      
-00019d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d90: 2020 2020 2b20 222f 7375 622d 2a5f 7365      + "/sub-*_se
-00019da0: 732d 2a5f 2220 2b20 7365 6c66 2e64 665b  s-*_" + self.df[
-00019db0: 226e 616d 6522 5d5b 695f 6473 5d20 2b20  "name"][i_ds] + 
-00019dc0: 222a 2e7a 6970 2229 0a20 2020 2020 2020  "*.zip").       
-00019dd0: 2020 2020 2020 2020 2020 2020 2074 656d               tem
-00019de0: 705f 6c69 7374 203d 2073 6f72 7465 6428  p_list = sorted(
-00019df0: 7465 6d70 5f6c 6973 7429 2020 2023 2073  temp_list)   # s
-00019e00: 6f72 7420 6279 206e 616d 650a 2020 2020  ort by name.    
-00019e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e20: 6966 206c 656e 2874 656d 705f 6c69 7374  if len(temp_list
-00019e30: 2920 3d3d 2030 3a20 2020 2023 2064 6964  ) == 0:    # did
-00019e40: 206e 6f74 2066 696e 6420 616e 7920 6d61   not find any ma
-00019e50: 7463 6865 640a 2020 2020 2020 2020 2020  tched.          
-00019e60: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00019e70: 6973 6520 4578 6365 7074 696f 6e28 2249  ise Exception("I
-00019e80: 6e20 7a69 7070 6564 2069 6e70 7574 2064  n zipped input d
-00019e90: 6174 6173 6574 2023 2220 2b20 7374 7228  ataset #" + str(
-00019ea0: 695f 6473 202b 2031 290a 2020 2020 2020  i_ds + 1).      
-00019eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ed0: 2020 2b20 2220 286e 616d 6564 2027 2220    + " (named '" 
-00019ee0: 2b20 7365 6c66 2e64 665b 226e 616d 6522  + self.df["name"
-00019ef0: 5d5b 695f 6473 5d20 2b20 2227 292c 220a  ][i_ds] + "'),".
-00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018870: 202b 2022 2049 7420 6973 2065 7870 6563   + " It is expec
+00018880: 7465 6420 6173 2074 6869 7320 6973 2061  ted as this is a
+00018890: 206d 756c 7469 2d73 6573 7369 6f6e 2064   multi-session d
+000188a0: 6174 6173 6574 2e22 290a 0a20 2020 2020  ataset.")..     
+000188b0: 2020 2023 2053 616e 6974 7920 6368 6563     # Sanity chec
+000188c0: 6b3a 206e 6f20 7265 7065 6174 6564 2073  k: no repeated s
+000188d0: 7562 2028 6f72 2073 6573 7369 6f6e 7329  ub (or sessions)
+000188e0: 3a0a 2020 2020 2020 2020 6966 2074 7970  :.        if typ
+000188f0: 655f 7365 7373 696f 6e20 3d3d 2022 7369  e_session == "si
+00018900: 6e67 6c65 2d73 6573 223a 0a20 2020 2020  ngle-ses":.     
+00018910: 2020 2020 2020 2023 2074 6865 7265 2073         # there s
+00018920: 686f 756c 6420 6f6e 6c79 2062 6520 6f6e  hould only be on
+00018930: 6520 6f63 6375 7272 656e 6365 2070 6572  e occurrence per
+00018940: 2073 7562 3a0a 2020 2020 2020 2020 2020   sub:.          
+00018950: 2020 6966 206c 656e 2873 6574 2873 656c    if len(set(sel
+00018960: 662e 696e 6974 6961 6c5f 696e 636c 755f  f.initial_inclu_
+00018970: 6466 5b22 7375 625f 6964 225d 2929 2021  df["sub_id"])) !
+00018980: 3d20 5c0a 2020 2020 2020 2020 2020 2020  = \.            
+00018990: 2020 2020 2020 2020 6c65 6e28 7365 6c66          len(self
+000189a0: 2e69 6e69 7469 616c 5f69 6e63 6c75 5f64  .initial_inclu_d
+000189b0: 665b 2273 7562 5f69 6422 5d29 3a0a 2020  f["sub_id"]):.  
+000189c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000189d0: 6973 6520 4578 6365 7074 696f 6e28 2254  ise Exception("T
+000189e0: 6865 7265 2061 7265 2072 6570 6561 7465  here are repeate
+000189f0: 6420 2773 7562 5f69 6427 2069 6e22 0a20  d 'sub_id' in". 
+00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00018a20: 2022 606c 6973 745f 7375 625f 6669 6c65   "`list_sub_file
+00018a30: 6021 2229 0a20 2020 2020 2020 2065 6c69  `!").        eli
+00018a40: 6620 7479 7065 5f73 6573 7369 6f6e 203d  f type_session =
+00018a50: 3d20 226d 756c 7469 2d73 6573 223a 0a20  = "multi-ses":. 
+00018a60: 2020 2020 2020 2020 2020 2023 2074 6865             # the
+00018a70: 7265 2073 686f 756c 6420 6e6f 7420 6265  re should not be
+00018a80: 2072 6570 6561 7465 6420 636f 6d62 696e   repeated combin
+00018a90: 6174 696f 6e73 206f 6620 6073 7562 5f69  ations of `sub_i
+00018aa0: 6460 2061 6e64 2060 7365 735f 6964 603a  d` and `ses_id`:
+00018ab0: 0a20 2020 2020 2020 2020 2020 2061 6674  .            aft
+00018ac0: 6572 5f64 726f 7070 696e 6720 3d20 5c0a  er_dropping = \.
+00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ae0: 7365 6c66 2e69 6e69 7469 616c 5f69 6e63  self.initial_inc
+00018af0: 6c75 5f64 662e 6472 6f70 5f64 7570 6c69  lu_df.drop_dupli
+00018b00: 6361 7465 7328 0a20 2020 2020 2020 2020  cates(.         
+00018b10: 2020 2020 2020 2020 2020 2073 7562 7365             subse
+00018b20: 743d 5b27 7375 625f 6964 272c 2027 7365  t=['sub_id', 'se
+00018b30: 735f 6964 275d 2c20 6b65 6570 3d27 6669  s_id'], keep='fi
+00018b40: 7273 7427 290a 2020 2020 2020 2020 2020  rst').          
+00018b50: 2020 2320 5e5e 2072 656d 6f76 6520 6475    # ^^ remove du
+00018b60: 706c 6963 6174 696f 6e73 2069 6e20 7370  plications in sp
+00018b70: 6563 6966 6963 2063 6f6c 732c 2061 6e64  ecific cols, and
+00018b80: 206b 6565 7020 7468 6520 6669 7273 7420   keep the first 
+00018b90: 6f63 6375 7272 656e 6365 0a20 2020 2020  occurrence.     
+00018ba0: 2020 2020 2020 2069 6620 6166 7465 725f         if after_
+00018bb0: 6472 6f70 7069 6e67 2e73 6861 7065 5b30  dropping.shape[0
+00018bc0: 5d20 3c20 7365 6c66 2e69 6e69 7469 616c  ] < self.initial
+00018bd0: 5f69 6e63 6c75 5f64 662e 7368 6170 655b  _inclu_df.shape[
+00018be0: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
+00018bf0: 2020 2020 7072 696e 7428 2243 6f6d 6269      print("Combi
+00018c00: 6e61 7469 6f6e 7320 6f66 2027 7375 625f  nations of 'sub_
+00018c10: 6964 2720 616e 6420 2773 6573 5f69 6427  id' and 'ses_id'
+00018c20: 2069 6e20 736f 6d65 2072 6f77 7320 6172   in some rows ar
+00018c30: 6520 6475 706c 6963 6174 6564 2e22 0a20  e duplicated.". 
+00018c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c50: 2020 2020 202b 2022 2057 696c 6c20 6f6e       + " Will on
+00018c60: 6c79 206b 6565 7020 7468 6520 6669 7273  ly keep the firs
+00018c70: 7420 6f63 6375 7272 656e 6365 2e2e 2e22  t occurrence..."
+00018c80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018c90: 2020 7365 6c66 2e69 6e69 7469 616c 5f69    self.initial_i
+00018ca0: 6e63 6c75 5f64 6620 3d20 6166 7465 725f  nclu_df = after_
+00018cb0: 6472 6f70 7069 6e67 0a0a 2020 2020 2020  dropping..      
+00018cc0: 2020 2320 536f 7274 3a0a 2020 2020 2020    # Sort:.      
+00018cd0: 2020 6966 2074 7970 655f 7365 7373 696f    if type_sessio
+00018ce0: 6e20 3d3d 2022 7369 6e67 6c65 2d73 6573  n == "single-ses
+00018cf0: 223a 0a20 2020 2020 2020 2020 2020 2023  ":.            #
+00018d00: 2073 6f72 743a 0a20 2020 2020 2020 2020   sort:.         
+00018d10: 2020 2073 656c 662e 696e 6974 6961 6c5f     self.initial_
+00018d20: 696e 636c 755f 6466 203d 205c 0a20 2020  inclu_df = \.   
+00018d30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00018d40: 662e 696e 6974 6961 6c5f 696e 636c 755f  f.initial_inclu_
+00018d50: 6466 2e73 6f72 745f 7661 6c75 6573 2862  df.sort_values(b
+00018d60: 793d 5b27 7375 625f 6964 275d 290a 2020  y=['sub_id']).  
+00018d70: 2020 2020 2020 2020 2020 2320 7265 7365            # rese
+00018d80: 7420 7468 6520 696e 6465 782c 2061 6e64  t the index, and
+00018d90: 2072 656d 6f76 6520 7468 6520 6164 6469   remove the addi
+00018da0: 7469 6f6e 616c 2063 6f6c 756d 653a 0a20  tional colume:. 
+00018db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018dc0: 696e 6974 6961 6c5f 696e 636c 755f 6466  initial_inclu_df
+00018dd0: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+00018de0: 2020 2020 2073 656c 662e 696e 6974 6961       self.initia
+00018df0: 6c5f 696e 636c 755f 6466 2e72 6573 6574  l_inclu_df.reset
+00018e00: 5f69 6e64 6578 2829 2e64 726f 7028 636f  _index().drop(co
+00018e10: 6c75 6d6e 733d 5b27 696e 6465 7827 5d29  lumns=['index'])
+00018e20: 0a20 2020 2020 2020 2065 6c69 6620 7479  .        elif ty
+00018e30: 7065 5f73 6573 7369 6f6e 203d 3d20 226d  pe_session == "m
+00018e40: 756c 7469 2d73 6573 223a 0a20 2020 2020  ulti-ses":.     
+00018e50: 2020 2020 2020 2073 656c 662e 696e 6974         self.init
+00018e60: 6961 6c5f 696e 636c 755f 6466 203d 205c  ial_inclu_df = \
+00018e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018e80: 2073 656c 662e 696e 6974 6961 6c5f 696e   self.initial_in
+00018e90: 636c 755f 6466 2e73 6f72 745f 7661 6c75  clu_df.sort_valu
+00018ea0: 6573 2862 793d 5b27 7375 625f 6964 272c  es(by=['sub_id',
+00018eb0: 2027 7365 735f 6964 275d 290a 2020 2020   'ses_id']).    
+00018ec0: 2020 2020 2020 2020 7365 6c66 2e69 6e69          self.ini
+00018ed0: 7469 616c 5f69 6e63 6c75 5f64 6620 3d20  tial_inclu_df = 
+00018ee0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00018ef0: 2020 7365 6c66 2e69 6e69 7469 616c 5f69    self.initial_i
+00018f00: 6e63 6c75 5f64 662e 7265 7365 745f 696e  nclu_df.reset_in
+00018f10: 6465 7828 292e 6472 6f70 2863 6f6c 756d  dex().drop(colum
+00018f20: 6e73 3d5b 2769 6e64 6578 275d 290a 0a20  ns=['index']).. 
+00018f30: 2020 2064 6566 2061 7373 6967 6e5f 7061     def assign_pa
+00018f40: 7468 5f6e 6f77 5f61 6273 2873 656c 662c  th_now_abs(self,
+00018f50: 2061 6e61 6c79 7369 735f 7061 7468 293a   analysis_path):
+00018f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018f70: 2020 2020 2054 6869 7320 6973 2074 6865       This is the
+00018f80: 2061 7373 6967 6e20 7468 6520 6162 736f   assign the abso
+00018f90: 6c75 7465 2070 6174 6820 746f 2069 6e70  lute path to inp
+00018fa0: 7574 2064 6174 6173 6574 0a0a 2020 2020  ut dataset..    
+00018fb0: 2020 2020 5061 7261 6d65 7465 7273 3a0a      Parameters:.
+00018fc0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00018fd0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2061  ------.        a
+00018fe0: 6e61 6c79 7369 735f 7061 7468 3a20 7374  nalysis_path: st
+00018ff0: 720a 2020 2020 2020 2020 2020 2020 6162  r.            ab
+00019000: 736f 6c75 7465 2070 6174 6820 746f 2074  solute path to t
+00019010: 6865 2060 616e 616c 7973 6973 6020 666f  he `analysis` fo
+00019020: 6c64 6572 2e0a 2020 2020 2020 2020 2222  lder..        ""
+00019030: 220a 0a20 2020 2020 2020 2066 6f72 2069  "..        for i
+00019040: 2069 6e20 7261 6e67 6528 302c 2073 656c   in range(0, sel
+00019050: 662e 6e75 6d5f 6473 293a 0a20 2020 2020  f.num_ds):.     
+00019060: 2020 2020 2020 2073 656c 662e 6466 5b22         self.df["
+00019070: 7061 7468 5f6e 6f77 5f61 6273 225d 5b69  path_now_abs"][i
+00019080: 5d20 3d20 6f70 2e6a 6f69 6e28 616e 616c  ] = op.join(anal
+00019090: 7973 6973 5f70 6174 682c 0a20 2020 2020  ysis_path,.     
+000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000190d0: 2e64 665b 2270 6174 685f 6e6f 775f 7265  .df["path_now_re
+000190e0: 6c22 5d5b 695d 290a 0a20 2020 2064 6566  l"][i])..    def
+000190f0: 2063 6865 636b 5f69 665f 7a69 7070 6564   check_if_zipped
+00019100: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00019110: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
+00019120: 2069 7320 746f 2063 6865 636b 2069 6620   is to check if 
+00019130: 6561 6368 2069 6e70 7574 2064 6174 6173  each input datas
+00019140: 6574 2069 7320 7a69 7070 6564 2c20 616e  et is zipped, an
+00019150: 6420 6173 7369 676e 2060 7061 7468 5f64  d assign `path_d
+00019160: 6174 615f 7265 6c60 2e0a 2020 2020 2020  ata_rel`..      
+00019170: 2020 4966 2069 7427 7320 6120 7a69 7070    If it's a zipp
+00019180: 6564 2064 733a 2060 7061 7468 5f64 6174  ed ds: `path_dat
+00019190: 615f 7265 6c60 203d 2060 7061 7468 5f6e  a_rel` = `path_n
+000191a0: 6f77 5f72 656c 602f 606e 616d 6560 2c0a  ow_rel`/`name`,.
+000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191c0: 692e 652e 2c20 6578 7472 6120 6c61 7965  i.e., extra laye
+000191d0: 7220 6f66 2066 6f6c 6465 7220 676f 7420  r of folder got 
+000191e0: 6672 6f6d 2075 6e7a 6970 7069 6e67 0a20  from unzipping. 
+000191f0: 2020 2020 2020 2049 6620 6974 2773 2061         If it's a
+00019200: 6e20 756e 7a69 7070 6564 2064 732c 2060  n unzipped ds, `
+00019210: 7061 7468 5f64 6174 615f 7265 6c60 203d  path_data_rel` =
+00019220: 2060 7061 7468 5f6e 6f77 5f72 656c 600a   `path_now_rel`.
+00019230: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00019240: 2020 2020 2023 2044 6574 6572 6d69 6e65       # Determine
+00019250: 2069 6620 6974 2773 2061 207a 6970 7065   if it's a zippe
+00019260: 6420 6461 7461 7365 742c 2066 6f72 2065  d dataset, for e
+00019270: 6163 6820 696e 7075 7420 6473 3a0a 2020  ach input ds:.  
+00019280: 2020 2020 2020 666f 7220 695f 6473 2069        for i_ds i
+00019290: 6e20 7261 6e67 6528 302c 2073 656c 662e  n range(0, self.
+000192a0: 6e75 6d5f 6473 293a 0a20 2020 2020 2020  num_ds):.       
+000192b0: 2020 2020 2074 656d 705f 6c69 7374 203d       temp_list =
+000192c0: 2067 6c6f 622e 676c 6f62 2873 656c 662e   glob.glob(self.
+000192d0: 6466 5b22 7061 7468 5f6e 6f77 5f61 6273  df["path_now_abs
+000192e0: 225d 5b69 5f64 735d 202b 2022 2f73 7562  "][i_ds] + "/sub
+000192f0: 2d2a 2229 0a20 2020 2020 2020 2020 2020  -*").           
+00019300: 2063 6f75 6e74 5f7a 6970 203d 2030 0a20   count_zip = 0. 
+00019310: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+00019320: 5f64 6972 203d 2030 0a20 2020 2020 2020  _dir = 0.       
+00019330: 2020 2020 2066 6f72 2069 5f74 656d 7020       for i_temp 
+00019340: 696e 2072 616e 6765 2830 2c20 6c65 6e28  in range(0, len(
+00019350: 7465 6d70 5f6c 6973 7429 293a 0a20 2020  temp_list)):.   
+00019360: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019370: 6f70 2e69 7364 6972 2874 656d 705f 6c69  op.isdir(temp_li
+00019380: 7374 5b69 5f74 656d 705d 293a 0a20 2020  st[i_temp]):.   
+00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193a0: 2063 6f75 6e74 5f64 6972 202b 3d20 310a   count_dir += 1.
+000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193c0: 656c 6966 2074 656d 705f 6c69 7374 5b69  elif temp_list[i
+000193d0: 5f74 656d 705d 5b2d 343a 5d20 3d3d 2022  _temp][-4:] == "
+000193e0: 2e7a 6970 223a 0a20 2020 2020 2020 2020  .zip":.         
+000193f0: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+00019400: 5f7a 6970 202b 3d20 310a 0a20 2020 2020  _zip += 1..     
+00019410: 2020 2020 2020 2069 6620 2863 6f75 6e74         if (count
+00019420: 5f7a 6970 203e 2030 2920 2620 2863 6f75  _zip > 0) & (cou
+00019430: 6e74 5f64 6972 203d 3d20 3029 3a20 2020  nt_dir == 0):   
+00019440: 2320 616c 6c20 6172 6520 7a69 7020 6669  # all are zip fi
+00019450: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00019460: 2020 2020 2073 656c 662e 6466 5b22 6973       self.df["is
+00019470: 5f7a 6970 7065 6422 5d5b 695f 6473 5d20  _zipped"][i_ds] 
+00019480: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00019490: 2020 2020 2020 2070 7269 6e74 2822 696e         print("in
+000194a0: 7075 7420 6461 7461 7365 7420 2722 202b  put dataset '" +
+000194b0: 2073 656c 662e 6466 5b22 6e61 6d65 225d   self.df["name"]
+000194c0: 5b69 5f64 735d 202b 2022 2722 0a20 2020  [i_ds] + "'".   
+000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194e0: 2020 202b 2022 2069 7320 636f 6e73 6964     + " is consid
+000194f0: 6572 6564 2061 7320 6120 7a69 7070 6564  ered as a zipped
+00019500: 2064 6174 6173 6574 2e22 290a 2020 2020   dataset.").    
+00019510: 2020 2020 2020 2020 656c 6966 2028 636f          elif (co
+00019520: 756e 745f 6469 7220 3e20 3029 2026 2028  unt_dir > 0) & (
+00019530: 636f 756e 745f 7a69 7020 3d3d 2030 293a  count_zip == 0):
+00019540: 2020 2023 2061 6c6c 2061 7265 2064 6972     # all are dir
+00019550: 6563 746f 7269 6573 3a0a 2020 2020 2020  ectories:.      
+00019560: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00019570: 665b 2269 735f 7a69 7070 6564 225d 5b69  f["is_zipped"][i
+00019580: 5f64 735d 203d 2046 616c 7365 0a20 2020  _ds] = False.   
+00019590: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+000195a0: 6e74 2822 696e 7075 7420 6461 7461 7365  nt("input datase
+000195b0: 7420 2722 202b 2073 656c 662e 6466 5b22  t '" + self.df["
+000195c0: 6e61 6d65 225d 5b69 5f64 735d 202b 2022  name"][i_ds] + "
+000195d0: 2722 0a20 2020 2020 2020 2020 2020 2020  '".             
+000195e0: 2020 2020 2020 2020 202b 2022 2069 7320           + " is 
+000195f0: 636f 6e73 6964 6572 6564 2061 7320 616e  considered as an
+00019600: 2075 6e7a 6970 7065 6420 6461 7461 7365   unzipped datase
+00019610: 742e 2229 0a20 2020 2020 2020 2020 2020  t.").           
+00019620: 2065 6c69 6620 2863 6f75 6e74 5f7a 6970   elif (count_zip
+00019630: 203e 2030 2920 2620 2863 6f75 6e74 5f64   > 0) & (count_d
+00019640: 6972 203e 2030 293a 2020 2320 6465 7465  ir > 0):  # dete
+00019650: 6374 2062 6f74 683a 0a20 2020 2020 2020  ct both:.       
+00019660: 2020 2020 2020 2020 2073 656c 662e 6466           self.df
+00019670: 5b22 6973 5f7a 6970 7065 6422 5d5b 695f  ["is_zipped"][i_
+00019680: 6473 5d20 3d20 5472 7565 2020 2023 2063  ds] = True   # c
+00019690: 6f6e 7369 6465 7220 6173 207a 6970 7065  onsider as zippe
+000196a0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+000196b0: 2020 7072 696e 7428 2269 6e70 7574 2064    print("input d
+000196c0: 6174 6173 6574 2027 2220 2b20 7365 6c66  ataset '" + self
+000196d0: 2e64 665b 226e 616d 6522 5d5b 695f 6473  .df["name"][i_ds
+000196e0: 5d20 2b20 2227 220a 2020 2020 2020 2020  ] + "'".        
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00019700: 2220 6861 7320 626f 7468 207a 6970 7065  " has both zippe
+00019710: 6420 6669 6c65 7320 616e 6420 756e 7a69  d files and unzi
+00019720: 7070 6564 2066 6f6c 6465 7273 3b22 0a20  pped folders;". 
+00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019740: 2020 2020 202b 2022 2074 6875 7320 6974       + " thus it
+00019750: 2773 2063 6f6e 7369 6465 7265 6420 6173  's considered as
+00019760: 2061 207a 6970 7065 6420 6461 7461 7365   a zipped datase
+00019770: 742e 2229 0a20 2020 2020 2020 2020 2020  t.").           
+00019780: 2065 6c73 653a 2020 2023 2064 6964 206e   else:   # did n
+00019790: 6f74 2064 6574 6563 7420 616e 7920 6f66  ot detect any of
+000197a0: 2074 6865 6d2e 2e2e 0a20 2020 2020 2020   them....       
+000197b0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+000197c0: 7863 6570 7469 6f6e 2822 4241 4253 2064  xception("BABS d
+000197d0: 6964 206e 6f74 2064 6574 6563 7420 616e  id not detect an
+000197e0: 7920 666f 6c64 6572 206f 7220 7a69 7020  y folder or zip 
+000197f0: 6669 6c65 206f 6620 6073 7562 2d2a 6022  file of `sub-*`"
+00019800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019820: 202b 2022 2069 6e20 696e 7075 7420 6461   + " in input da
+00019830: 7461 7365 7420 2722 202b 2073 656c 662e  taset '" + self.
+00019840: 6466 5b22 6e61 6d65 225d 5b69 5f64 735d  df["name"][i_ds]
+00019850: 202b 2022 272e 2229 0a0a 2020 2020 2020   + "'.")..      
+00019860: 2020 2320 4173 7369 676e 2060 7061 7468    # Assign `path
+00019870: 5f64 6174 615f 7265 6c60 3a0a 2020 2020  _data_rel`:.    
+00019880: 2020 2020 666f 7220 695f 6473 2069 6e20      for i_ds in 
+00019890: 7261 6e67 6528 302c 2073 656c 662e 6e75  range(0, self.nu
+000198a0: 6d5f 6473 293a 0a20 2020 2020 2020 2020  m_ds):.         
+000198b0: 2020 2069 6620 7365 6c66 2e64 665b 2269     if self.df["i
+000198c0: 735f 7a69 7070 6564 225d 5b69 5f64 735d  s_zipped"][i_ds]
+000198d0: 2069 7320 5472 7565 3a20 2020 2320 7a69   is True:   # zi
+000198e0: 7070 6564 2064 730a 2020 2020 2020 2020  pped ds.        
+000198f0: 2020 2020 2020 2020 7365 6c66 2e64 665b          self.df[
+00019900: 2270 6174 685f 6461 7461 5f72 656c 225d  "path_data_rel"]
+00019910: 5b69 5f64 735d 203d 206f 702e 6a6f 696e  [i_ds] = op.join
+00019920: 2873 656c 662e 6466 5b22 7061 7468 5f6e  (self.df["path_n
+00019930: 6f77 5f72 656c 225d 5b69 5f64 735d 2c0a  ow_rel"][i_ds],.
+00019940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019970: 2020 2020 2020 2020 2073 656c 662e 6466           self.df
+00019980: 5b22 6e61 6d65 225d 5b69 5f64 735d 290a  ["name"][i_ds]).
+00019990: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000199a0: 3a20 2020 2320 756e 7a69 7070 6564 2064  :   # unzipped d
+000199b0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000199c0: 2020 2073 656c 662e 6466 5b22 7061 7468     self.df["path
+000199d0: 5f64 6174 615f 7265 6c22 5d5b 695f 6473  _data_rel"][i_ds
+000199e0: 5d20 3d20 7365 6c66 2e64 665b 2270 6174  ] = self.df["pat
+000199f0: 685f 6e6f 775f 7265 6c22 5d5b 695f 6473  h_now_rel"][i_ds
+00019a00: 5d0a 0a20 2020 2064 6566 2063 6865 636b  ]..    def check
+00019a10: 5f76 616c 6964 6974 795f 7a69 7070 6564  _validity_zipped
+00019a20: 5f69 6e70 7574 5f64 6174 6173 6574 2873  _input_dataset(s
+00019a30: 656c 662c 2074 7970 655f 7365 7373 696f  elf, type_sessio
+00019a40: 6e29 3a0a 2020 2020 2020 2020 2222 220a  n):.        """.
+00019a50: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+00019a60: 746f 2070 6572 666f 726d 2074 776f 2073  to perform two s
+00019a70: 616e 6974 7920 6368 6563 6b73 206f 6e20  anity checks on 
+00019a80: 6561 6368 207a 6970 7065 6420 696e 7075  each zipped inpu
+00019a90: 7420 6461 7461 7365 743a 0a20 2020 2020  t dataset:.     
+00019aa0: 2020 2031 2920 7361 6e69 7479 2063 6865     1) sanity che
+00019ab0: 636b 206f 6e20 7468 6520 7a69 7020 6669  ck on the zip fi
+00019ac0: 6c65 6e61 6d65 3a0a 2020 2020 2020 2020  lename:.        
+00019ad0: 2020 2020 6966 206d 756c 7469 2d73 6573      if multi-ses
+00019ae0: 3a20 7375 622d 2a5f 7365 732d 2a5f 3c69  : sub-*_ses-*_<i
+00019af0: 6e70 7574 5f64 735f 6e61 6d65 3e2a 2e7a  nput_ds_name>*.z
+00019b00: 6970 0a20 2020 2020 2020 2020 2020 2069  ip.            i
+00019b10: 6620 7369 6e67 6c65 2d73 6573 3a20 7375  f single-ses: su
+00019b20: 622d 2a5f 3c69 6e70 7574 5f64 735f 6e61  b-*_<input_ds_na
+00019b30: 6d65 3e2a 2e7a 6970 0a20 2020 2020 2020  me>*.zip.       
+00019b40: 2032 2920 7361 6e69 7479 2063 6865 636b   2) sanity check
+00019b50: 2074 6f20 6d61 6b65 2073 7572 6520 7468   to make sure th
+00019b60: 6520 3173 7420 6c65 7665 6c20 666f 6c64  e 1st level fold
+00019b70: 6572 2069 6e20 7a69 7066 696c 650a 2020  er in zipfile.  
+00019b80: 2020 2020 2020 2020 2020 6973 2063 6f6e            is con
+00019b90: 7369 7374 656e 7420 746f 2074 6869 7320  sistent to this 
+00019ba0: 696e 7075 7420 6461 7461 7365 7427 7320  input dataset's 
+00019bb0: 6e61 6d65 3b0a 2020 2020 2020 2020 2020  name;.          
+00019bc0: 2020 4f6e 6c79 2063 6865 636b 7320 7468    Only checks th
+00019bd0: 6520 6669 7273 7420 7a69 7066 696c 652e  e first zipfile.
+00019be0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00019bf0: 7465 7273 3a0a 2020 2020 2020 2020 2d2d  ters:.        --
+00019c00: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
+00019c10: 2020 2074 7970 655f 7365 7373 696f 6e3a     type_session:
+00019c20: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+00019c30: 2022 6d75 6c74 692d 7365 7322 206f 7220   "multi-ses" or 
+00019c40: 2273 696e 676c 652d 7365 7322 0a20 2020  "single-ses".   
+00019c50: 2020 2020 2063 6f6e 7461 696e 6572 5f6e       container_n
+00019c60: 616d 653a 2073 7472 0a20 2020 2020 2020  ame: str.       
+00019c70: 2020 2020 204e 616d 6520 6f66 2074 6865       Name of the
+00019c80: 2063 6f6e 7461 696e 6572 0a20 2020 2020   container.     
+00019c90: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00019ca0: 6966 2054 7275 6520 696e 206c 6973 7428  if True in list(
+00019cb0: 7365 6c66 2e64 665b 2269 735f 7a69 7070  self.df["is_zipp
+00019cc0: 6564 225d 293a 2020 2320 7468 6572 6520  ed"]):  # there 
+00019cd0: 6973 2061 7420 6c65 6173 7420 6f6e 6520  is at least one 
+00019ce0: 6461 7461 7365 7420 6973 207a 6970 7065  dataset is zippe
+00019cf0: 640a 2020 2020 2020 2020 2020 2020 7072  d.            pr
+00019d00: 696e 7428 2250 6572 666f 726d 696e 6720  int("Performing 
+00019d10: 7361 6e69 7479 2063 6865 636b 2066 6f72  sanity check for
+00019d20: 2061 6e79 207a 6970 7065 6420 696e 7075   any zipped inpu
+00019d30: 7420 6461 7461 7365 742e 2e2e 220a 2020  t dataset...".  
+00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d50: 2220 4765 7474 696e 6720 6578 616d 706c  " Getting exampl
+00019d60: 6520 7a69 7020 6669 6c65 2873 2920 746f  e zip file(s) to
+00019d70: 2063 6865 636b 2e2e 2e22 290a 2020 2020   check...").    
+00019d80: 2020 2020 666f 7220 695f 6473 2069 6e20      for i_ds in 
+00019d90: 7261 6e67 6528 302c 2073 656c 662e 6e75  range(0, self.nu
+00019da0: 6d5f 6473 293a 0a20 2020 2020 2020 2020  m_ds):.         
+00019db0: 2020 2069 6620 7365 6c66 2e64 665b 2269     if self.df["i
+00019dc0: 735f 7a69 7070 6564 225d 5b69 5f64 735d  s_zipped"][i_ds]
+00019dd0: 2069 7320 5472 7565 3a20 2020 2320 7a69   is True:   # zi
+00019de0: 7070 6564 2064 730a 2020 2020 2020 2020  pped ds.        
+00019df0: 2020 2020 2020 2020 2320 5361 6e69 7479          # Sanity
+00019e00: 2063 6865 636b 2023 313a 207a 6970 2066   check #1: zip f
+00019e10: 696c 656e 616d 653a 202d 2d2d 2d2d 2d2d  ilename: -------
+00019e20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00019e30: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+00019e40: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00019e50: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
+00019e60: 6d75 6c74 692d 7365 7322 3a0a 2020 2020  multi-ses":.    
+00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e80: 2320 6368 6563 6b20 6966 206d 6174 6368  # check if match
+00019e90: 6573 2074 6865 2070 6174 7465 726e 206f  es the pattern o
+00019ea0: 6620 6073 7562 2d2a 5f73 6573 2d2a 5f3c  f `sub-*_ses-*_<
+00019eb0: 696e 7075 745f 6473 5f6e 616d 653e 2a2e  input_ds_name>*.
+00019ec0: 7a69 7060 3a0a 2020 2020 2020 2020 2020  zip`:.          
+00019ed0: 2020 2020 2020 2020 2020 7465 6d70 5f6c            temp_l
+00019ee0: 6973 7420 3d20 676c 6f62 2e67 6c6f 6228  ist = glob.glob(
+00019ef0: 7365 6c66 2e64 665b 2270 6174 685f 6e6f  self.df["path_no
+00019f00: 775f 6162 7322 5d5b 695f 6473 5d0a 2020  w_abs"][i_ds].  
 00019f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f20: 2020 2020 2020 2020 2b20 2220 6e6f 207a          + " no z
-00019f30: 6970 2066 696c 656e 616d 6520 6d61 7463  ip filename matc
-00019f40: 6865 7320 7468 6520 7061 7474 6572 6e20  hes the pattern 
-00019f50: 6f66 220a 2020 2020 2020 2020 2020 2020  of".            
-00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f70: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-00019f80: 2773 7562 2d2a 5f73 6573 2d2a 5f22 0a20  'sub-*_ses-*_". 
-00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fb0: 2020 2020 2020 202b 2073 656c 662e 6466         + self.df
-00019fc0: 5b22 6e61 6d65 225d 5b69 5f64 735d 202b  ["name"][i_ds] +
-00019fd0: 2022 2a2e 7a69 7027 2229 0a20 2020 2020   "*.zip'").     
-00019fe0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00019ff0: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
-0001a000: 2273 696e 676c 652d 7365 7322 3a0a 2020  "single-ses":.  
-0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a020: 2020 7465 6d70 5f6c 6973 7420 3d20 676c    temp_list = gl
-0001a030: 6f62 2e67 6c6f 6228 7365 6c66 2e64 665b  ob.glob(self.df[
-0001a040: 2270 6174 685f 6e6f 775f 6162 7322 5d5b  "path_now_abs"][
-0001a050: 695f 6473 5d0a 2020 2020 2020 2020 2020  i_ds].          
+00019f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f30: 2020 2020 2020 2020 2b20 222f 7375 622d          + "/sub-
+00019f40: 2a5f 7365 732d 2a5f 2220 2b20 7365 6c66  *_ses-*_" + self
+00019f50: 2e64 665b 226e 616d 6522 5d5b 695f 6473  .df["name"][i_ds
+00019f60: 5d20 2b20 222a 2e7a 6970 2229 0a20 2020  ] + "*.zip").   
+00019f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f80: 2074 656d 705f 6c69 7374 203d 2073 6f72   temp_list = sor
+00019f90: 7465 6428 7465 6d70 5f6c 6973 7429 2020  ted(temp_list)  
+00019fa0: 2023 2073 6f72 7420 6279 206e 616d 650a   # sort by name.
+00019fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fc0: 2020 2020 6966 206c 656e 2874 656d 705f      if len(temp_
+00019fd0: 6c69 7374 2920 3d3d 2030 3a20 2020 2023  list) == 0:    #
+00019fe0: 2064 6964 206e 6f74 2066 696e 6420 616e   did not find an
+00019ff0: 7920 6d61 7463 6865 640a 2020 2020 2020  y matched.      
+0001a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a010: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+0001a020: 6e28 2249 6e20 7a69 7070 6564 2069 6e70  n("In zipped inp
+0001a030: 7574 2064 6174 6173 6574 2023 2220 2b20  ut dataset #" + 
+0001a040: 7374 7228 695f 6473 202b 2031 290a 2020  str(i_ds + 1).  
+0001a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a080: 2b20 222f 7375 622d 2a5f 2220 2b20 7365  + "/sub-*_" + se
-0001a090: 6c66 2e64 665b 226e 616d 6522 5d5b 695f  lf.df["name"][i_
-0001a0a0: 6473 5d20 2b20 222a 2e7a 6970 2229 0a20  ds] + "*.zip"). 
+0001a070: 2020 2020 2020 2b20 2220 286e 616d 6564        + " (named
+0001a080: 2027 2220 2b20 7365 6c66 2e64 665b 226e   '" + self.df["n
+0001a090: 616d 6522 5d5b 695f 6473 5d20 2b20 2227  ame"][i_ds] + "'
+0001a0a0: 292c 220a 2020 2020 2020 2020 2020 2020  ),".            
 0001a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a0c0: 2020 2074 656d 705f 6c69 7374 203d 2073     temp_list = s
-0001a0d0: 6f72 7465 6428 7465 6d70 5f6c 6973 7429  orted(temp_list)
-0001a0e0: 2020 2023 2073 6f72 7420 6279 206e 616d     # sort by nam
-0001a0f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a100: 2020 2020 2020 6966 206c 656e 2874 656d        if len(tem
-0001a110: 705f 6c69 7374 2920 3d3d 2030 3a20 2020  p_list) == 0:   
-0001a120: 2023 2064 6964 206e 6f74 2066 696e 6420   # did not find 
-0001a130: 616e 7920 6d61 7463 6865 640a 2020 2020  any matched.    
+0001a0c0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+0001a0d0: 6e6f 207a 6970 2066 696c 656e 616d 6520  no zip filename 
+0001a0e0: 6d61 7463 6865 7320 7468 6520 7061 7474  matches the patt
+0001a0f0: 6572 6e20 6f66 220a 2020 2020 2020 2020  ern of".        
+0001a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a120: 2b20 2220 2773 7562 2d2a 5f73 6573 2d2a  + " 'sub-*_ses-*
+0001a130: 5f22 0a20 2020 2020 2020 2020 2020 2020  _".             
 0001a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a150: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0001a160: 696f 6e28 2249 6e20 7a69 7070 6564 2069  ion("In zipped i
-0001a170: 6e70 7574 2064 6174 6173 6574 2023 2220  nput dataset #" 
-0001a180: 2b20 7374 7228 695f 6473 202b 2031 290a  + str(i_ds + 1).
-0001a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1b0: 2020 2020 2020 2020 2b20 2220 286e 616d          + " (nam
-0001a1c0: 6564 2027 2220 2b20 7365 6c66 2e64 665b  ed '" + self.df[
-0001a1d0: 226e 616d 6522 5d5b 695f 6473 5d20 2b20  "name"][i_ds] + 
-0001a1e0: 2227 292c 220a 2020 2020 2020 2020 2020  "'),".          
-0001a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a200: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a210: 2220 6e6f 207a 6970 2066 696c 656e 616d  " no zip filenam
-0001a220: 6520 6d61 7463 6865 7320 7468 6520 7061  e matches the pa
-0001a230: 7474 6572 6e20 6f66 220a 2020 2020 2020  ttern of".      
-0001a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a260: 2020 2b20 2220 2773 7562 2d2a 5f22 0a20    + " 'sub-*_". 
-0001a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2020 2020 2020 202b 2073 656c 662e 6466         + self.df
-0001a2a0: 5b22 6e61 6d65 225d 5b69 5f64 735d 202b  ["name"][i_ds] +
-0001a2b0: 2022 2a2e 7a69 7027 2229 0a20 2020 2020   "*.zip'").     
-0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a2d0: 206e 6f74 2074 6f20 6368 6563 6b20 6265   not to check be
-0001a2e0: 6c6f 7720 7374 7566 6620 616e 796d 6f72  low stuff anymor
-0001a2f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a300: 2020 2020 2020 2023 2023 2061 6c73 6f20         # # also 
-0001a310: 6368 6563 6b20 7468 6572 6520 7368 6f75  check there shou
-0001a320: 6c64 206e 6f74 2062 6520 605f 7365 732d  ld not be `_ses-
-0001a330: 2a5f 600a 2020 2020 2020 2020 2020 2020  *_`.            
-0001a340: 2020 2020 2020 2020 2320 7465 6d70 5f6c          # temp_l
-0001a350: 6973 745f 3220 3d20 676c 6f62 2e67 6c6f  ist_2 = glob.glo
-0001a360: 6228 7365 6c66 2e64 665b 2270 6174 685f  b(self.df["path_
-0001a370: 6e6f 775f 6162 7322 5d5b 695f 6473 5d0a  now_abs"][i_ds].
-0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a390: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001a3b0: 222f 2a5f 7365 732d 2a5f 2a2e 7a69 7022  "/*_ses-*_*.zip"
-0001a3c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a3d0: 2020 2020 2020 2320 6966 206c 656e 2874        # if len(t
-0001a3e0: 656d 705f 6c69 7374 5f32 2920 3e20 303a  emp_list_2) > 0:
-0001a3f0: 2020 2023 2065 7869 7374 733a 0a20 2020     # exists:.   
-0001a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a410: 2023 2020 2020 2072 6169 7365 2045 7863   #     raise Exc
-0001a420: 6570 7469 6f6e 2822 496e 207a 6970 7065  eption("In zippe
-0001a430: 6420 696e 7075 7420 6461 7461 7365 7420  d input dataset 
-0001a440: 2322 202b 2073 7472 2869 5f64 7320 2b20  #" + str(i_ds + 
-0001a450: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-0001a460: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0001a470: 2020 2020 2020 2020 2020 2020 202b 2022               + "
-0001a480: 2028 6e61 6d65 6420 2722 202b 2073 656c   (named '" + sel
-0001a490: 662e 6466 5b22 6e61 6d65 225d 5b69 5f64  f.df["name"][i_d
-0001a4a0: 735d 202b 2022 2729 2c22 0a20 2020 2020  s] + "'),".     
-0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a4d0: 2020 2020 202b 2022 2061 7320 6974 2773       + " as it's
-0001a4e0: 2061 2073 696e 676c 652d 7365 7320 6461   a single-ses da
-0001a4f0: 7461 7365 742c 220a 2020 2020 2020 2020  taset,".        
-0001a500: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0001a510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a520: 2020 2b20 2220 7a69 7020 6669 6c65 6e61    + " zip filena
-0001a530: 6d65 2073 686f 756c 6420 6e6f 7420 636f  me should not co
-0001a540: 6e74 6169 6e22 0a20 2020 2020 2020 2020  ntain".         
-0001a550: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0001a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a570: 202b 2022 2027 5f73 6573 2d2a 5f27 2229   + " '_ses-*_'")
-0001a580: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a590: 2020 2320 5361 6e69 7479 2063 6865 636b    # Sanity check
-0001a5a0: 2023 323a 2066 6f6c 6465 726e 616d 6520   #2: foldername 
-0001a5b0: 7769 7468 696e 207a 6970 7065 6420 6669  within zipped fi
-0001a5c0: 6c65 3a20 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  le: ------------
-0001a5d0: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001a5e0: 2020 2020 2020 2020 7465 6d70 5f7a 6970          temp_zip
-0001a5f0: 6669 6c65 203d 2074 656d 705f 6c69 7374  file = temp_list
-0001a600: 5b30 5d20 2020 2320 7472 7920 6f75 7420  [0]   # try out 
-0001a610: 7468 6520 6669 7273 7420 7a69 7066 696c  the first zipfil
-0001a620: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a630: 2020 7465 6d70 5f7a 6970 6669 6c65 6e61    temp_zipfilena
-0001a640: 6d65 203d 206f 702e 6261 7365 6e61 6d65  me = op.basename
-0001a650: 2874 656d 705f 7a69 7066 696c 6529 0a20  (temp_zipfile). 
-0001a660: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001a670: 6c61 7069 2e67 6574 2870 6174 683d 7465  lapi.get(path=te
-0001a680: 6d70 5f7a 6970 6669 6c65 2c20 6461 7461  mp_zipfile, data
-0001a690: 7365 743d 7365 6c66 2e64 665b 2270 6174  set=self.df["pat
-0001a6a0: 685f 6e6f 775f 6162 7322 5d5b 695f 6473  h_now_abs"][i_ds
-0001a6b0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001a6c0: 2020 2023 2075 6e7a 6970 2074 6f20 6120     # unzip to a 
-0001a6d0: 7465 6d70 6f72 6172 7920 666f 6c64 6572  temporary folder
-0001a6e0: 2061 6e64 2067 6574 2074 6865 2066 6f6c   and get the fol
-0001a6f0: 6465 726e 616d 650a 2020 2020 2020 2020  dername.        
-0001a700: 2020 2020 2020 2020 7465 6d70 5f75 6e7a          temp_unz
-0001a710: 6970 5f74 6f20 3d20 7465 6d70 6669 6c65  ip_to = tempfile
-0001a720: 2e6d 6b64 7465 6d70 2829 0a20 2020 2020  .mkdtemp().     
-0001a730: 2020 2020 2020 2020 2020 2073 6875 7469             shuti
-0001a740: 6c2e 756e 7061 636b 5f61 7263 6869 7665  l.unpack_archive
-0001a750: 2874 656d 705f 7a69 7066 696c 652c 2074  (temp_zipfile, t
-0001a760: 656d 705f 756e 7a69 705f 746f 290a 2020  emp_unzip_to).  
-0001a770: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0001a780: 7374 5f75 6e7a 6970 5f66 6f6c 6465 726e  st_unzip_foldern
-0001a790: 616d 6573 203d 2067 6574 5f69 6d6d 6564  ames = get_immed
-0001a7a0: 6961 7465 5f73 7562 6469 7265 6374 6f72  iate_subdirector
-0001a7b0: 6965 7328 7465 6d70 5f75 6e7a 6970 5f74  ies(temp_unzip_t
-0001a7c0: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
-0001a7d0: 2020 2023 2072 656d 6f76 6520 7468 6520     # remove the 
-0001a7e0: 7465 6d70 6f72 6172 7920 666f 6c64 6572  temporary folder
-0001a7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a800: 2020 7368 7574 696c 2e72 6d74 7265 6528    shutil.rmtree(
-0001a810: 7465 6d70 5f75 6e7a 6970 5f74 6f29 0a20  temp_unzip_to). 
-0001a820: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a830: 2060 6461 7461 6c61 6420 6472 6f70 6020   `datalad drop` 
-0001a840: 7468 6520 7a69 7066 696c 653a 0a20 2020  the zipfile:.   
-0001a850: 2020 2020 2020 2020 2020 2020 2064 6c61               dla
-0001a860: 7069 2e64 726f 7028 7061 7468 3d74 656d  pi.drop(path=tem
-0001a870: 705f 7a69 7066 696c 652c 2064 6174 6173  p_zipfile, datas
-0001a880: 6574 3d73 656c 662e 6466 5b22 7061 7468  et=self.df["path
-0001a890: 5f6e 6f77 5f61 6273 225d 5b69 5f64 735d  _now_abs"][i_ds]
-0001a8a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001a8b0: 2020 2023 2063 6865 636b 2069 6620 7468     # check if th
-0001a8c0: 6572 6520 6973 2066 6f6c 6465 7220 6e61  ere is folder na
-0001a8d0: 6d65 6420 6173 2064 7327 7320 6e61 6d65  med as ds's name
-0001a8e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a8f0: 2020 6966 2073 656c 662e 6466 5b22 6e61    if self.df["na
-0001a900: 6d65 225d 5b69 5f64 735d 206e 6f74 2069  me"][i_ds] not i
-0001a910: 6e20 6c69 7374 5f75 6e7a 6970 5f66 6f6c  n list_unzip_fol
-0001a920: 6465 726e 616d 6573 3a0a 2020 2020 2020  dernames:.      
-0001a930: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001a940: 726e 696e 6773 2e77 6172 6e28 2249 6e20  rnings.warn("In 
-0001a950: 696e 7075 7420 6461 7461 7365 7420 2322  input dataset #"
-0001a960: 202b 2073 7472 2869 5f64 7320 2b20 3129   + str(i_ds + 1)
-0001a970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a990: 2020 202b 2022 2028 6e61 6d65 6420 2722     + " (named '"
-0001a9a0: 202b 2073 656c 662e 6466 5b22 6e61 6d65   + self.df["name
-0001a9b0: 225d 5b69 5f64 735d 0a20 2020 2020 2020  "][i_ds].       
-0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9d0: 2020 2020 2020 2020 2020 202b 2022 2729             + "')
-0001a9e0: 2c20 7468 6572 6520 6973 206e 6f20 666f  , there is no fo
-0001a9f0: 6c64 6572 2063 616c 6c65 6420 2722 0a20  lder called '". 
-0001aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa20: 202b 2073 656c 662e 6466 5b22 6e61 6d65   + self.df["name
-0001aa30: 225d 5b69 5f64 735d 202b 2022 2720 696e  "][i_ds] + "' in
-0001aa40: 207a 6970 7065 6420 696e 7075 7420 6669   zipped input fi
-0001aa50: 6c65 2027 220a 2020 2020 2020 2020 2020  le '".          
-0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa70: 2020 2020 2020 2020 2b20 7465 6d70 5f7a          + temp_z
-0001aa80: 6970 6669 6c65 6e61 6d65 202b 2022 272e  ipfilename + "'.
-0001aa90: 2054 6869 7320 6d61 7920 6361 7573 6520   This may cause 
-0001aaa0: 6572 726f 7222 0a20 2020 2020 2020 2020  error".         
-0001aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aac0: 2020 2020 2020 2020 202b 2022 2077 6865           + " whe
-0001aad0: 6e20 7275 6e6e 696e 6720 4249 4453 2041  n running BIDS A
-0001aae0: 7070 2066 6f72 2074 6869 7320 7375 626a  pp for this subj
-0001aaf0: 6563 742f 7365 7373 696f 6e22 290a 0a0a  ect/session")...
-0001ab00: 636c 6173 7320 5379 7374 656d 2829 3a0a  class System():.
-0001ab10: 2020 2020 2222 2254 6869 7320 636c 6173      """This clas
-0001ab20: 7320 6973 2066 6f72 2063 6c75 7374 6572  s is for cluster
-0001ab30: 206d 616e 6167 656d 656e 7420 7379 7374   management syst
-0001ab40: 656d 2222 220a 0a20 2020 2064 6566 205f  em"""..    def _
-0001ab50: 5f69 6e69 745f 5f28 7365 6c66 2c20 7379  _init__(self, sy
-0001ab60: 7374 656d 5f74 7970 6529 3a0a 2020 2020  stem_type):.    
-0001ab70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001ab80: 5468 6973 2069 7320 746f 2069 6e69 7469  This is to initi
-0001ab90: 616c 697a 6520 5379 7374 656d 2063 6c61  alize System cla
-0001aba0: 7373 2e0a 0a20 2020 2020 2020 2050 6172  ss...        Par
-0001abb0: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
-0001abc0: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20   -------------. 
-0001abd0: 2020 2020 2020 2073 7973 7465 6d5f 7479         system_ty
-0001abe0: 7065 3a20 7374 720a 2020 2020 2020 2020  pe: str.        
-0001abf0: 2020 2020 5479 7065 206f 6620 7468 6520      Type of the 
-0001ac00: 636c 7573 7465 7220 6d61 6e61 6765 6d65  cluster manageme
-0001ac10: 6e74 2073 7973 7465 6d2e 0a20 2020 2020  nt system..     
-0001ac20: 2020 2020 2020 204f 7074 696f 6e73 2061         Options a
-0001ac30: 7265 3a20 2273 6765 2220 616e 6420 2273  re: "sge" and "s
-0001ac40: 6c75 726d 220a 0a20 2020 2020 2020 2041  lurm"..        A
-0001ac50: 7474 7269 6275 7465 733a 0a20 2020 2020  ttributes:.     
-0001ac60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-0001ac70: 0a20 2020 2020 2020 2074 7970 653a 2073  .        type: s
-0001ac80: 7472 0a20 2020 2020 2020 2020 2020 2054  tr.            T
-0001ac90: 7970 6520 6f66 2074 6865 2063 6c75 7374  ype of the clust
-0001aca0: 6572 206d 616e 6167 656d 656e 7420 7379  er management sy
-0001acb0: 7374 656d 2e0a 2020 2020 2020 2020 2020  stem..          
-0001acc0: 2020 4f70 7469 6f6e 7320 6172 653a 2022    Options are: "
-0001acd0: 7367 6522 2061 6e64 2022 736c 7572 6d22  sge" and "slurm"
-0001ace0: 0a20 2020 2020 2020 2064 6963 743a 2064  .        dict: d
-0001acf0: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
-0001ad00: 4775 6964 616e 6365 2064 6963 7420 286c  Guidance dict (l
-0001ad10: 6f61 6465 6420 6672 6f6d 2060 6469 6374  oaded from `dict
-0001ad20: 5f63 6c75 7374 6572 5f73 7973 7465 6d73  _cluster_systems
-0001ad30: 2e79 616d 6c60 290a 2020 2020 2020 2020  .yaml`).        
-0001ad40: 2020 2020 666f 7220 686f 7720 746f 2072      for how to r
-0001ad50: 756e 2074 6869 7320 7479 7065 206f 6620  un this type of 
-0001ad60: 636c 7573 7465 722e 0a20 2020 2020 2020  cluster..       
-0001ad70: 2022 2222 0a20 2020 2020 2020 2023 2076   """.        # v
-0001ad80: 616c 6964 6174 6520 616e 6420 6173 7369  alidate and assi
-0001ad90: 676e 2074 6f20 6174 7472 6962 7574 6520  gn to attribute 
-0001ada0: 6074 7970 6560 3a0a 2020 2020 2020 2020  `type`:.        
-0001adb0: 7365 6c66 2e74 7970 6520 3d20 7661 6c69  self.type = vali
-0001adc0: 6461 7465 5f74 7970 655f 7379 7374 656d  date_type_system
-0001add0: 2873 7973 7465 6d5f 7479 7065 290a 0a20  (system_type).. 
-0001ade0: 2020 2020 2020 2023 2067 6574 2061 7474         # get att
-0001adf0: 7269 6275 7465 2060 6469 6374 6020 2d20  ribute `dict` - 
-0001ae00: 7468 6520 6775 6964 616e 6365 2064 6963  the guidance dic
-0001ae10: 7420 666f 7220 686f 7720 746f 2072 756e  t for how to run
-0001ae20: 2074 6869 7320 7479 7065 206f 6620 636c   this type of cl
-0001ae30: 7573 7465 723a 0a20 2020 2020 2020 2073  uster:.        s
-0001ae40: 656c 662e 6765 745f 6469 6374 2829 0a0a  elf.get_dict()..
-0001ae50: 2020 2020 6465 6620 6765 745f 6469 6374      def get_dict
-0001ae60: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001ae70: 2320 6c6f 6361 7469 6f6e 206f 6620 6375  # location of cu
-0001ae80: 7272 656e 7420 7079 7468 6f6e 2073 6372  rrent python scr
-0001ae90: 6970 743a 0a20 2020 2020 2020 2023 2020  ipt:.        #  
-0001aea0: 2060 6f70 2e61 6273 7061 7468 2829 6020   `op.abspath()` 
-0001aeb0: 6973 2074 6f20 6d61 6b65 2073 7572 6520  is to make sure 
-0001aec0: 616c 7761 7973 2072 6574 7572 6e73 2061  always returns a
-0001aed0: 6273 2070 6174 682c 2072 6567 6172 646c  bs path, regardl
-0001aee0: 6573 7320 6f66 2070 7974 686f 6e20 7665  ess of python ve
-0001aef0: 7273 696f 6e0a 2020 2020 2020 2020 2320  rsion.        # 
-0001af00: 2020 7265 663a 2068 7474 7073 3a2f 2f6e    ref: https://n
-0001af10: 6f74 652e 6e6b 6d6b 2e6d 652f 656e 2f70  ote.nkmk.me/en/p
-0001af20: 7974 686f 6e2d 7363 7269 7074 2d66 696c  ython-script-fil
-0001af30: 652d 7061 7468 2f0a 2020 2020 2020 2020  e-path/.        
-0001af40: 5f5f 6c6f 6361 7469 6f6e 5f5f 203d 206f  __location__ = o
-0001af50: 702e 7265 616c 7061 7468 286f 702e 6469  p.realpath(op.di
-0001af60: 726e 616d 6528 6f70 2e61 6273 7061 7468  rname(op.abspath
-0001af70: 285f 5f66 696c 655f 5f29 2929 0a0a 2020  (__file__)))..  
-0001af80: 2020 2020 2020 666e 5f64 6963 745f 636c        fn_dict_cl
-0001af90: 7573 7465 725f 7379 7374 656d 735f 7961  uster_systems_ya
-0001afa0: 6d6c 203d 206f 702e 6a6f 696e 285f 5f6c  ml = op.join(__l
-0001afb0: 6f63 6174 696f 6e5f 5f2c 2022 6469 6374  ocation__, "dict
-0001afc0: 5f63 6c75 7374 6572 5f73 7973 7465 6d73  _cluster_systems
-0001afd0: 2e79 616d 6c22 290a 2020 2020 2020 2020  .yaml").        
-0001afe0: 7769 7468 206f 7065 6e28 666e 5f64 6963  with open(fn_dic
-0001aff0: 745f 636c 7573 7465 725f 7379 7374 656d  t_cluster_system
-0001b000: 735f 7961 6d6c 2920 6173 2066 3a0a 2020  s_yaml) as f:.  
-0001b010: 2020 2020 2020 2020 2020 6469 6374 203d            dict =
-0001b020: 2079 616d 6c2e 6c6f 6164 2866 2c20 4c6f   yaml.load(f, Lo
-0001b030: 6164 6572 3d79 616d 6c2e 4675 6c6c 4c6f  ader=yaml.FullLo
-0001b040: 6164 6572 290a 2020 2020 2020 2020 2020  ader).          
-0001b050: 2020 2320 5e5e 2064 6963 7420 6973 2061    # ^^ dict is a
-0001b060: 2064 6963 743b 2065 6c65 6d65 6e74 7320   dict; elements 
-0001b070: 6361 6e20 6265 2061 6363 6573 7365 6420  can be accessed 
-0001b080: 6279 2060 6469 6374 5b22 6b65 7922 5d5b  by `dict["key"][
-0001b090: 2273 7562 2d6b 6579 225d 600a 0a20 2020  "sub-key"]`..   
-0001b0a0: 2020 2020 2023 2073 616e 6974 7920 6368       # sanity ch
-0001b0b0: 6563 6b3a 0a20 2020 2020 2020 2069 6620  eck:.        if 
-0001b0c0: 7365 6c66 2e74 7970 6520 6e6f 7420 696e  self.type not in
-0001b0d0: 2064 6963 743a 0a20 2020 2020 2020 2020   dict:.         
-0001b0e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0001b0f0: 6f6e 2822 5468 6572 6520 6973 206e 6f20  on("There is no 
-0001b100: 6b65 7920 6361 6c6c 6564 2027 2220 2b20  key called '" + 
-0001b110: 7365 6c66 2e74 7970 6520 2b20 2227 2069  self.type + "' i
-0001b120: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-0001b130: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001b140: 2022 2066 696c 6520 6064 6963 745f 636c   " file `dict_cl
-0001b150: 7573 7465 725f 7379 7374 656d 732e 7961  uster_systems.ya
-0001b160: 6d6c 6021 2229 0a0a 2020 2020 2020 2020  ml`!")..        
-0001b170: 7365 6c66 2e64 6963 7420 3d20 6469 6374  self.dict = dict
-0001b180: 5b73 656c 662e 7479 7065 5d0a 2020 2020  [self.type].    
-0001b190: 2020 2020 662e 636c 6f73 6528 290a 0a0a      f.close()...
-0001b1a0: 636c 6173 7320 436f 6e74 6169 6e65 7228  class Container(
-0001b1b0: 293a 0a20 2020 2022 2222 5468 6973 2063  ):.    """This c
-0001b1c0: 6c61 7373 2069 7320 666f 7220 7468 6520  lass is for the 
-0001b1d0: 4249 4453 2041 7070 2043 6f6e 7461 696e  BIDS App Contain
-0001b1e0: 6572 2222 220a 0a20 2020 2064 6566 205f  er"""..    def _
-0001b1f0: 5f69 6e69 745f 5f28 7365 6c66 2c20 636f  _init__(self, co
-0001b200: 6e74 6169 6e65 725f 6473 2c20 636f 6e74  ntainer_ds, cont
-0001b210: 6169 6e65 725f 6e61 6d65 2c20 636f 6e66  ainer_name, conf
-0001b220: 6967 5f79 616d 6c5f 6669 6c65 293a 0a20  ig_yaml_file):. 
-0001b230: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001b240: 2020 2054 6869 7320 6973 2074 6f20 696e     This is to in
-0001b250: 6974 6961 6c69 7a65 2043 6f6e 7461 696e  itialize Contain
-0001b260: 6572 2063 6c61 7373 2e0a 0a20 2020 2020  er class...     
-0001b270: 2020 2050 6172 616d 6574 6572 733a 0a20     Parameters:. 
-0001b280: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
-0001b290: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
-0001b2a0: 6e74 6169 6e65 725f 6473 3a20 7374 720a  ntainer_ds: str.
-0001b2b0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
-0001b2c0: 7061 7468 2074 6f20 7468 6520 636f 6e74  path to the cont
-0001b2d0: 6169 6e65 7220 6461 7461 6c61 6420 6461  ainer datalad da
-0001b2e0: 7461 7365 7420 6173 2074 6865 2069 6e70  taset as the inp
-0001b2f0: 7574 206f 6620 6062 6162 732d 696e 6974  ut of `babs-init
-0001b300: 602e 0a20 2020 2020 2020 2020 2020 2054  `..            T
-0001b310: 6869 7320 636f 6e74 6169 6e65 7220 6461  his container da
-0001b320: 7461 6c61 6420 6473 2069 7320 7072 6570  talad ds is prep
-0001b330: 6172 6564 2062 7920 7468 6520 7573 6572  ared by the user
-0001b340: 2e0a 2020 2020 2020 2020 636f 6e74 6169  ..        contai
-0001b350: 6e65 725f 6e61 6d65 3a20 7374 720a 2020  ner_name: str.  
-0001b360: 2020 2020 2020 2020 2020 5468 6520 6e61            The na
-0001b370: 6d65 206f 6620 7468 6520 636f 6e74 6169  me of the contai
-0001b380: 6e65 7220 7768 656e 2061 6464 696e 6720  ner when adding 
-0001b390: 746f 2064 6174 616c 6164 2064 6174 6173  to datalad datas
-0001b3a0: 6574 2865 2e67 2e2c 2060 4e41 4d45 6020  et(e.g., `NAME` 
-0001b3b0: 696e 0a20 2020 2020 2020 2020 2020 2060  in.            `
-0001b3c0: 6461 7461 6c61 6420 636f 6e74 6169 6e65  datalad containe
-0001b3d0: 7273 2d61 6464 204e 414d 4560 292c 0a20  rs-add NAME`),. 
-0001b3e0: 2020 2020 2020 2020 2020 2020 652e 672e              e.g.
-0001b3f0: 2c20 666d 7269 7072 6570 2d30 2d30 2d30  , fmriprep-0-0-0
-0001b400: 0a20 2020 2020 2020 2063 6f6e 6669 675f  .        config_
-0001b410: 7961 6d6c 5f66 696c 653a 2073 7472 0a20  yaml_file: str. 
-0001b420: 2020 2020 2020 2020 2020 2054 6865 2059             The Y
-0001b430: 414d 4c20 6669 6c65 2074 6861 7420 636f  AML file that co
-0001b440: 6e74 6169 6e73 2074 6865 2063 6f6e 6669  ntains the confi
-0001b450: 6775 7261 7469 6f6e 7320 6f66 2068 6f77  gurations of how
-0001b460: 2074 6f20 7275 6e20 7468 6520 636f 6e74   to run the cont
-0001b470: 6169 6e65 720a 0a20 2020 2020 2020 2041  ainer..        A
-0001b480: 7474 7269 6275 7465 733a 0a20 2020 2020  ttributes:.     
-0001b490: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
-0001b4a0: 2d0a 2020 2020 2020 2020 636f 6e74 6169  -.        contai
-0001b4b0: 6e65 725f 6473 3a20 7374 720a 2020 2020  ner_ds: str.    
-0001b4c0: 2020 2020 2020 2020 5468 6520 7061 7468          The path
-0001b4d0: 2074 6f20 7468 6520 636f 6e74 6169 6e65   to the containe
-0001b4e0: 7220 6461 7461 6c61 6420 6461 7461 7365  r datalad datase
-0001b4f0: 7420 6173 2074 6865 2069 6e70 7574 206f  t as the input o
-0001b500: 6620 6062 6162 732d 696e 6974 602e 0a20  f `babs-init`.. 
-0001b510: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-0001b520: 636f 6e74 6169 6e65 7220 6461 7461 6c61  container datala
-0001b530: 6420 6473 2069 7320 7072 6570 6172 6564  d ds is prepared
-0001b540: 2062 7920 7468 6520 7573 6572 2c20 6e6f   by the user, no
-0001b550: 7420 7468 6520 636c 6f6e 6564 206f 6e65  t the cloned one
-0001b560: 2e0a 2020 2020 2020 2020 636f 6e74 6169  ..        contai
-0001b570: 6e65 725f 6e61 6d65 3a20 7374 720a 2020  ner_name: str.  
-0001b580: 2020 2020 2020 2020 2020 5468 6520 6e61            The na
-0001b590: 6d65 206f 6620 7468 6520 636f 6e74 6169  me of the contai
-0001b5a0: 6e65 7220 7768 656e 2061 6464 696e 6720  ner when adding 
-0001b5b0: 746f 2064 6174 616c 6164 2064 6174 6173  to datalad datas
-0001b5c0: 6574 2865 2e67 2e2c 2060 4e41 4d45 6020  et(e.g., `NAME` 
-0001b5d0: 696e 0a20 2020 2020 2020 2020 2020 2060  in.            `
-0001b5e0: 6461 7461 6c61 6420 636f 6e74 6169 6e65  datalad containe
-0001b5f0: 7273 2d61 6464 204e 414d 4560 292c 0a20  rs-add NAME`),. 
-0001b600: 2020 2020 2020 2020 2020 2020 652e 672e              e.g.
-0001b610: 2c20 666d 7269 7072 6570 2d30 2d30 2d30  , fmriprep-0-0-0
-0001b620: 0a20 2020 2020 2020 2063 6f6e 6669 675f  .        config_
-0001b630: 7961 6d6c 5f66 696c 653a 2073 7472 0a20  yaml_file: str. 
-0001b640: 2020 2020 2020 2020 2020 2054 6865 2059             The Y
-0001b650: 414d 4c20 6669 6c65 2074 6861 7420 636f  AML file that co
-0001b660: 6e74 6169 6e73 2074 6865 2063 6f6e 6669  ntains the confi
-0001b670: 6775 7261 7469 6f6e 7320 6f66 2068 6f77  gurations of how
-0001b680: 2074 6f20 7275 6e20 7468 6520 636f 6e74   to run the cont
-0001b690: 6169 6e65 720a 2020 2020 2020 2020 2020  ainer.          
-0001b6a0: 2020 5468 6973 2069 7320 6f70 7469 6f6e    This is option
-0001b6b0: 616c 2061 7267 756d 656e 7420 286f 6620  al argument (of 
-0001b6c0: 7468 6520 434c 4920 6062 6162 732d 696e  the CLI `babs-in
-0001b6d0: 6974 6029 0a20 2020 2020 2020 2063 6f6e  it`).        con
-0001b6e0: 6669 673a 2064 6963 740a 2020 2020 2020  fig: dict.      
-0001b6f0: 2020 2020 2020 5468 6520 636f 6e66 6967        The config
-0001b700: 7572 6174 696f 6e73 2072 6567 6172 6469  urations regardi
-0001b710: 6e67 2072 756e 6e69 6e67 2074 6865 2042  ng running the B
-0001b720: 4944 5320 4170 7020 6f6e 2061 2063 6c75  IDS App on a clu
-0001b730: 7374 6572 0a20 2020 2020 2020 2020 2020  ster.           
-0001b740: 2072 6561 6420 6672 6f6d 2060 636f 6e66   read from `conf
-0001b750: 6967 5f79 616d 6c5f 6669 6c65 602e 0a20  ig_yaml_file`.. 
-0001b760: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
-0001b770: 5f70 6174 685f 7265 6c54 6f41 6e61 6c79  _path_relToAnaly
-0001b780: 7369 733a 2073 7472 0a20 2020 2020 2020  sis: str.       
-0001b790: 2020 2020 2054 6865 2070 6174 6820 746f       The path to
-0001b7a0: 2074 6865 2063 6f6e 7461 696e 6572 2069   the container i
-0001b7b0: 6d61 6765 2073 6176 6564 2069 6e20 4241  mage saved in BA
-0001b7c0: 4253 2070 726f 6a65 6374 3b0a 2020 2020  BS project;.    
-0001b7d0: 2020 2020 2020 2020 7468 6973 2070 6174          this pat
-0001b7e0: 6820 6973 2072 656c 6174 6976 6520 746f  h is relative to
-0001b7f0: 2060 616e 616c 7973 6973 6020 666f 6c64   `analysis` fold
-0001b800: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-0001b810: 652e 672e 2c20 6063 6f6e 7461 696e 6572  e.g., `container
-0001b820: 732f 2e64 6174 616c 6164 2f65 6e76 6972  s/.datalad/envir
-0001b830: 6f6e 6d65 6e74 732f 666d 7269 7072 6570  onments/fmriprep
-0001b840: 2d30 2d30 2d30 2f69 6d61 6765 600a 2020  -0-0-0/image`.  
-0001b850: 2020 2020 2020 2020 2020 5468 6973 2060            This `
-0001b860: 696d 6167 6560 2063 6f75 6c64 2062 6520  image` could be 
-0001b870: 6120 7379 6d6c 696e 6b20 2860 6f70 2e69  a symlink (`op.i
-0001b880: 736c 696e 6b28 2960 2c20 6d6f 7265 206c  slink()`, more l
-0001b890: 696b 656c 7920 666f 7220 7369 6e67 756c  ikely for singul
-0001b8a0: 6172 6974 7920 636f 6e74 6169 6e65 7229  arity container)
-0001b8b0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-0001b8c0: 6120 666f 6c64 6572 2028 606f 702e 6973  a folder (`op.is
-0001b8d0: 6469 7228 2960 2c20 6d6f 7265 206c 696b  dir()`, more lik
-0001b8e0: 656c 7920 666f 7220 646f 636b 6572 2063  ely for docker c
-0001b8f0: 6f6e 7461 696e 6572 290a 2020 2020 2020  ontainer).      
-0001b900: 2020 2222 220a 0a20 2020 2020 2020 2073    """..        s
-0001b910: 656c 662e 636f 6e74 6169 6e65 725f 6473  elf.container_ds
-0001b920: 203d 2063 6f6e 7461 696e 6572 5f64 730a   = container_ds.
-0001b930: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-0001b940: 7461 696e 6572 5f6e 616d 6520 3d20 636f  tainer_name = co
-0001b950: 6e74 6169 6e65 725f 6e61 6d65 0a20 2020  ntainer_name.   
-0001b960: 2020 2020 2073 656c 662e 636f 6e66 6967       self.config
-0001b970: 5f79 616d 6c5f 6669 6c65 203d 2063 6f6e  _yaml_file = con
-0001b980: 6669 675f 7961 6d6c 5f66 696c 650a 0a20  fig_yaml_file.. 
-0001b990: 2020 2020 2020 2023 2073 616e 6974 7920         # sanity 
-0001b9a0: 6368 6563 6b20 6966 2060 636f 6e66 6967  check if `config
-0001b9b0: 5f79 616d 6c5f 6669 6c65 6020 6578 6973  _yaml_file` exis
-0001b9c0: 7473 3a0a 2020 2020 2020 2020 6966 206f  ts:.        if o
-0001b9d0: 702e 6578 6973 7473 2873 656c 662e 636f  p.exists(self.co
-0001b9e0: 6e66 6967 5f79 616d 6c5f 6669 6c65 2920  nfig_yaml_file) 
-0001b9f0: 6973 2046 616c 7365 3a0a 2020 2020 2020  is False:.      
-0001ba00: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0001ba10: 7074 696f 6e28 2254 6865 2079 616d 6c20  ption("The yaml 
-0001ba20: 6669 6c65 206f 6620 7468 6520 636f 6e74  file of the cont
-0001ba30: 6169 6e65 7227 7320 636f 6e66 6967 7572  ainer's configur
-0001ba40: 6174 696f 6e73 2027 220a 2020 2020 2020  ations '".      
-0001ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba60: 2020 2020 2020 2b20 7365 6c66 2e63 6f6e        + self.con
-0001ba70: 6669 675f 7961 6d6c 5f66 696c 6520 2b20  fig_yaml_file + 
-0001ba80: 2227 2064 6f65 7320 6e6f 7420 6578 6973  "' does not exis
-0001ba90: 7421 2229 0a0a 2020 2020 2020 2020 2320  t!")..        # 
-0001baa0: 7265 6164 2074 6865 2063 6f6e 7461 696e  read the contain
-0001bab0: 6572 2773 2063 6f6e 6669 6720 7961 6d6c  er's config yaml
-0001bac0: 2066 696c 6520 616e 6420 6765 7420 7468   file and get th
-0001bad0: 6520 6063 6f6e 6669 6760 3a0a 2020 2020  e `config`:.    
-0001bae0: 2020 2020 7365 6c66 2e72 6561 645f 636f      self.read_co
-0001baf0: 6e74 6169 6e65 725f 636f 6e66 6967 5f79  ntainer_config_y
-0001bb00: 616d 6c28 290a 0a20 2020 2020 2020 2073  aml()..        s
-0001bb10: 656c 662e 636f 6e74 6169 6e65 725f 7061  elf.container_pa
-0001bb20: 7468 5f72 656c 546f 416e 616c 7973 6973  th_relToAnalysis
-0001bb30: 203d 206f 702e 6a6f 696e 2822 636f 6e74   = op.join("cont
-0001bb40: 6169 6e65 7273 222c 2022 2e64 6174 616c  ainers", ".datal
-0001bb50: 6164 222c 2022 656e 7669 726f 6e6d 656e  ad", "environmen
-0001bb60: 7473 222c 0a20 2020 2020 2020 2020 2020  ts",.           
-0001bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb90: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0001bba0: 6e74 6169 6e65 725f 6e61 6d65 2c20 2269  ntainer_name, "i
-0001bbb0: 6d61 6765 2229 0a0a 2020 2020 6465 6620  mage")..    def 
-0001bbc0: 7361 6e69 7479 5f63 6865 636b 2873 656c  sanity_check(sel
-0001bbd0: 662c 2061 6e61 6c79 7369 735f 7061 7468  f, analysis_path
-0001bbe0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001bbf0: 2020 2020 2020 2054 6869 7320 6973 2061         This is a
-0001bc00: 2073 616e 6974 7920 6368 6563 6b20 746f   sanity check to
-0001bc10: 2076 616c 6964 6174 6520 7468 6520 636c   validate the cl
-0001bc20: 6f6e 6564 2063 6f6e 7461 696e 6572 2064  oned container d
-0001bc30: 732e 0a0a 2020 2020 2020 2020 5061 7261  s...        Para
-0001bc40: 6d65 7465 7273 3a0a 2020 2020 2020 2020  meters:.        
-0001bc50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-0001bc60: 2020 2020 2061 6e61 6c79 7369 735f 7061       analysis_pa
-0001bc70: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
-0001bc80: 2020 2020 4162 736f 6c75 7465 2070 6174      Absolute pat
-0001bc90: 6820 746f 2074 6865 2060 616e 616c 7973  h to the `analys
-0001bca0: 6973 6020 666f 6c64 6572 2069 6e20 6120  is` folder in a 
-0001bcb0: 4241 4253 2070 726f 6a65 6374 2e0a 2020  BABS project..  
-0001bcc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001bcd0: 2020 2320 7061 7468 2074 6f20 7468 6520    # path to the 
-0001bce0: 7379 6d6c 696e 6b2f 666f 6c64 6572 2060  symlink/folder `
-0001bcf0: 696d 6167 6560 3a0a 2020 2020 2020 2020  image`:.        
-0001bd00: 636f 6e74 6169 6e65 725f 7061 7468 5f61  container_path_a
-0001bd10: 6273 203d 206f 702e 6a6f 696e 2861 6e61  bs = op.join(ana
-0001bd20: 6c79 7369 735f 7061 7468 2c20 7365 6c66  lysis_path, self
-0001bd30: 2e63 6f6e 7461 696e 6572 5f70 6174 685f  .container_path_
-0001bd40: 7265 6c54 6f41 6e61 6c79 7369 7329 0a20  relToAnalysis). 
-0001bd50: 2020 2020 2020 2023 2065 2e67 2e3a 0a20         # e.g.:. 
-0001bd60: 2020 2020 2020 2023 2020 2027 2f70 6174         #   '/pat
-0001bd70: 682f 746f 2f42 4142 535f 7072 6f6a 6563  h/to/BABS_projec
-0001bd80: 742f 616e 616c 7973 6973 2f63 6f6e 7461  t/analysis/conta
-0001bd90: 696e 6572 732f 2e64 6174 616c 6164 2f65  iners/.datalad/e
-0001bda0: 6e76 6972 6f6e 6d65 6e74 732f 636f 6e74  nvironments/cont
-0001bdb0: 6169 6e65 725f 6e61 6d65 2f69 6d61 6765  ainer_name/image
-0001bdc0: 270a 0a20 2020 2020 2020 2023 2053 616e  '..        # San
-0001bdd0: 6974 7920 6368 6563 6b3a 2074 6865 2070  ity check: the p
-0001bde0: 6174 6820 746f 2060 636f 6e74 6169 6e65  ath to `containe
-0001bdf0: 725f 6e61 6d65 6020 7368 6f75 6c64 2065  r_name` should e
-0001be00: 7869 7374 2069 6e20 7468 6520 636c 6f6e  xist in the clon
-0001be10: 6564 2060 636f 6e74 6169 6e65 725f 6473  ed `container_ds
-0001be20: 603a 0a20 2020 2020 2020 2023 2065 2e67  `:.        # e.g
-0001be30: 2e2c 2027 2f70 6174 682f 746f 2f42 4142  ., '/path/to/BAB
-0001be40: 535f 7072 6f6a 6563 742f 616e 616c 7973  S_project/analys
-0001be50: 6973 2f63 6f6e 7461 696e 6572 732f 2e64  is/containers/.d
-0001be60: 6174 616c 6164 2f65 6e76 6972 6f6e 6d65  atalad/environme
-0001be70: 6e74 732f 636f 6e74 6169 6e65 725f 6e61  nts/container_na
-0001be80: 6d65 270a 2020 2020 2020 2020 6173 7365  me'.        asse
-0001be90: 7274 206f 702e 6578 6973 7473 286f 702e  rt op.exists(op.
-0001bea0: 6469 726e 616d 6528 636f 6e74 6169 6e65  dirname(containe
-0001beb0: 725f 7061 7468 5f61 6273 2929 2c20 5c0a  r_path_abs)), \.
-0001bec0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-0001bed0: 7265 2069 7320 6e6f 2076 616c 6964 2069  re is no valid i
-0001bee0: 6d61 6765 206e 616d 6564 2027 2220 2b20  mage named '" + 
-0001bef0: 7365 6c66 2e63 6f6e 7461 696e 6572 5f6e  self.container_n
-0001bf00: 616d 6520 5c0a 2020 2020 2020 2020 2020  ame \.          
-0001bf10: 2020 2b20 2227 2069 6e20 7468 6520 7072    + "' in the pr
-0001bf20: 6f76 6964 6564 2063 6f6e 7461 696e 6572  ovided container
-0001bf30: 2044 6174 614c 6164 2064 6174 6173 6574   DataLad dataset
-0001bf40: 2122 0a0a 2020 2020 2020 2020 2320 7468  !"..        # th
-0001bf50: 6520 2769 6d61 6765 2720 7379 6d6c 696e  e 'image' symlin
-0001bf60: 6b20 6f72 2066 6f6c 6465 7220 7368 6f75  k or folder shou
-0001bf70: 6c64 2065 7869 7374 3a0a 2020 2020 2020  ld exist:.      
-0001bf80: 2020 6173 7365 7274 206f 702e 6578 6973    assert op.exis
-0001bf90: 7473 2863 6f6e 7461 696e 6572 5f70 6174  ts(container_pat
-0001bfa0: 685f 6162 7329 206f 7220 6f70 2e69 736c  h_abs) or op.isl
-0001bfb0: 696e 6b28 636f 6e74 6169 6e65 725f 7061  ink(container_pa
-0001bfc0: 7468 5f61 6273 292c 205c 0a20 2020 2020  th_abs), \.     
-0001bfd0: 2020 2020 2020 2022 7468 6520 666f 6c64         "the fold
-0001bfe0: 6572 2027 696d 6167 6527 206f 6620 636f  er 'image' of co
-0001bff0: 6e74 6169 6e65 7220 4461 7461 4c61 6420  ntainer DataLad 
-0001c000: 6461 7461 7365 7420 646f 6573 206e 6f74  dataset does not
-0001c010: 2065 7869 7374 2c22 205c 0a20 2020 2020   exist," \.     
-0001c020: 2020 2020 2020 202b 2022 2061 6e64 2074         + " and t
-0001c030: 6865 7265 2069 7320 6e6f 2073 796d 6c69  here is no symli
-0001c040: 6e6b 2063 616c 6c65 6420 2769 6d61 6765  nk called 'image
-0001c050: 2720 6569 7468 6572 3b22 205c 0a20 2020  ' either;" \.   
-0001c060: 2020 2020 2020 2020 202b 2022 2050 6174           + " Pat
-0001c070: 6820 746f 2027 696d 6167 6527 2069 6e20  h to 'image' in 
-0001c080: 636c 6f6e 6564 2063 6f6e 7461 696e 6572  cloned container
-0001c090: 2044 6174 614c 6164 2064 6174 6173 6574   DataLad dataset
-0001c0a0: 2073 686f 756c 6420 6265 3a20 2722 205c   should be: '" \
-0001c0b0: 0a20 2020 2020 2020 2020 2020 202b 2063  .            + c
-0001c0c0: 6f6e 7461 696e 6572 5f70 6174 685f 6162  ontainer_path_ab
-0001c0d0: 7320 2b20 2227 2e22 0a0a 2020 2020 6465  s + "'."..    de
-0001c0e0: 6620 7265 6164 5f63 6f6e 7461 696e 6572  f read_container
-0001c0f0: 5f63 6f6e 6669 675f 7961 6d6c 2873 656c  _config_yaml(sel
-0001c100: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-0001c110: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-0001c120: 746f 2067 6574 2074 6865 2063 6f6e 6669  to get the confi
-0001c130: 6720 6469 6374 2066 726f 6d20 6063 6f6e  g dict from `con
-0001c140: 6669 675f 7961 6d6c 5f66 696c 6560 0a20  fig_yaml_file`. 
-0001c150: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001c160: 2020 2077 6974 6820 6f70 656e 2873 656c     with open(sel
-0001c170: 662e 636f 6e66 6967 5f79 616d 6c5f 6669  f.config_yaml_fi
-0001c180: 6c65 2920 6173 2066 3a0a 2020 2020 2020  le) as f:.      
-0001c190: 2020 2020 2020 7365 6c66 2e63 6f6e 6669        self.confi
-0001c1a0: 6720 3d20 7961 6d6c 2e6c 6f61 6428 662c  g = yaml.load(f,
-0001c1b0: 204c 6f61 6465 723d 7961 6d6c 2e46 756c   Loader=yaml.Ful
-0001c1c0: 6c4c 6f61 6465 7229 0a20 2020 2020 2020  lLoader).       
-0001c1d0: 2020 2020 2023 205e 5e20 636f 6e66 6967       # ^^ config
-0001c1e0: 2069 7320 6120 6469 6374 3b20 656c 656d   is a dict; elem
-0001c1f0: 656e 7473 2063 616e 2062 6520 6163 6365  ents can be acce
-0001c200: 7373 6564 2062 7920 6063 6f6e 6669 675b  ssed by `config[
-0001c210: 226b 6579 225d 5b22 7375 622d 6b65 7922  "key"]["sub-key"
-0001c220: 5d60 0a20 2020 2020 2020 2066 2e63 6c6f  ]`.        f.clo
-0001c230: 7365 2829 0a0a 2020 2020 6465 6620 6765  se()..    def ge
-0001c240: 6e65 7261 7465 5f62 6173 685f 7275 6e5f  nerate_bash_run_
-0001c250: 6269 6473 6170 7028 7365 6c66 2c20 6261  bidsapp(self, ba
-0001c260: 7368 5f70 6174 682c 2069 6e70 7574 5f64  sh_path, input_d
-0001c270: 732c 2074 7970 655f 7365 7373 696f 6e29  s, type_session)
-0001c280: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001c290: 2020 2020 2020 5468 6973 2069 7320 746f        This is to
-0001c2a0: 2067 656e 6572 6174 6520 6120 6261 7368   generate a bash
-0001c2b0: 2073 6372 6970 7420 7468 6174 2072 756e   script that run
-0001c2c0: 7320 7468 6520 4249 4453 2041 7070 2073  s the BIDS App s
-0001c2d0: 696e 6775 6c61 7269 7479 2069 6d61 6765  ingularity image
-0001c2e0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-0001c2f0: 6574 6572 733a 0a20 2020 2020 2020 202d  eters:.        -
-0001c300: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
-0001c310: 2020 2020 2062 6173 685f 7061 7468 3a20       bash_path: 
-0001c320: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
-0001c330: 5468 6520 7061 7468 2074 6f20 7468 6520  The path to the 
-0001c340: 6261 7368 2066 696c 6520 746f 2062 6520  bash file to be 
-0001c350: 6765 6e65 7261 7465 642e 2049 7420 7368  generated. It sh
-0001c360: 6f75 6c64 2062 6520 696e 2074 6865 2060  ould be in the `
-0001c370: 616e 616c 7973 6973 2f63 6f64 6560 2066  analysis/code` f
-0001c380: 6f6c 6465 722e 0a20 2020 2020 2020 2069  older..        i
-0001c390: 6e70 7574 5f64 733a 2063 6c61 7373 2060  nput_ds: class `
-0001c3a0: 496e 7075 745f 6473 600a 2020 2020 2020  Input_ds`.      
-0001c3b0: 2020 2020 2020 696e 7075 7420 6461 7461        input data
-0001c3c0: 7365 7428 7329 2069 6e66 6f72 6d61 7469  set(s) informati
-0001c3d0: 6f6e 0a20 2020 2020 2020 2074 7970 655f  on.        type_
-0001c3e0: 7365 7373 696f 6e3a 2073 7472 0a20 2020  session: str.   
-0001c3f0: 2020 2020 2020 2020 206d 756c 7469 2d73           multi-s
-0001c400: 6573 206f 7220 7369 6e67 6c65 2d73 6573  es or single-ses
-0001c410: 2e0a 0a20 2020 2020 2020 204e 6f74 6573  ...        Notes
-0001c420: 3a0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  :.        ------
-0001c430: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0001c440: 2057 6865 6e20 7772 6974 696e 6720 6073   When writing `s
-0001c450: 696e 6775 6c61 7269 7479 2072 756e 6020  ingularity run` 
-0001c460: 7061 7274 2c20 6561 6368 2063 6875 6e6b  part, each chunk
-0001c470: 2074 6f20 7772 6974 6520 7368 6f75 6c64   to write should
-0001c480: 2073 7461 7274 2077 6974 6820 2220 5c5c   start with " \\
-0001c490: 2220 2b20 225c 6e5c 7422 2c0a 2020 2020  " + "\n\t",.    
-0001c4a0: 2020 2020 6d65 616e 696e 672c 2073 7461      meaning, sta
-0001c4b0: 7274 696e 6720 7769 7468 2073 7061 6365  rting with space
-0001c4c0: 2c20 6120 6261 636b 7761 7264 2073 6c61  , a backward sla
-0001c4d0: 7368 2c20 6120 7265 7475 726e 2c20 616e  sh, a return, an
-0001c4e0: 6420 6120 7461 622e 0a20 2020 2020 2020  d a tab..       
-0001c4f0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-0001c500: 6d20 2e63 6f6e 7374 616e 7473 2069 6d70  m .constants imp
-0001c510: 6f72 7420 5041 5448 5f46 535f 4c49 4345  ort PATH_FS_LICE
-0001c520: 4e53 455f 494e 5f43 4f4e 5441 494e 4552  NSE_IN_CONTAINER
-0001c530: 2c20 4f55 5450 5554 5f4d 4149 4e5f 464f  , OUTPUT_MAIN_FO
-0001c540: 4c44 4552 4e41 4d45 0a0a 2020 2020 2020  LDERNAME..      
-0001c550: 2020 7479 7065 5f73 6573 7369 6f6e 203d    type_session =
-0001c560: 2076 616c 6964 6174 655f 7479 7065 5f73   validate_type_s
-0001c570: 6573 7369 6f6e 2874 7970 655f 7365 7373  ession(type_sess
-0001c580: 696f 6e29 0a0a 2020 2020 2020 2020 2320  ion)..        # 
-0001c590: 4368 6563 6b20 6966 2074 6865 2066 6f6c  Check if the fol
-0001c5a0: 6465 7220 6578 6973 743b 2069 6620 6e6f  der exist; if no
-0001c5b0: 742c 2063 7265 6174 6520 6974 3a0a 2020  t, create it:.  
-0001c5c0: 2020 2020 2020 6261 7368 5f64 6972 203d        bash_dir =
-0001c5d0: 206f 702e 6469 726e 616d 6528 6261 7368   op.dirname(bash
-0001c5e0: 5f70 6174 6829 0a20 2020 2020 2020 2069  _path).        i
-0001c5f0: 6620 6e6f 7420 6f70 2e65 7869 7374 7328  f not op.exists(
-0001c600: 6261 7368 5f64 6972 293a 0a20 2020 2020  bash_dir):.     
-0001c610: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-0001c620: 7273 2862 6173 685f 6469 7229 0a0a 2020  rs(bash_dir)..  
-0001c630: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-0001c640: 2060 7365 6c66 2e63 6f6e 6669 6760 2066   `self.config` f
-0001c650: 726f 6d20 7468 6520 5941 4d4c 2066 696c  rom the YAML fil
-0001c660: 6520 636f 6e74 6169 6e73 2069 6e66 6f72  e contains infor
-0001c670: 6d61 7469 6f6e 2077 6520 6e65 6564 3a0a  mation we need:.
-0001c680: 2020 2020 2020 2020 2320 312e 2063 6865          # 1. che
-0001c690: 636b 2060 7369 6e67 756c 6172 6974 795f  ck `singularity_
-0001c6a0: 7275 6e60 2073 6563 7469 6f6e 3a0a 2020  run` section:.  
-0001c6b0: 2020 2020 2020 6966 2022 7369 6e67 756c        if "singul
-0001c6c0: 6172 6974 795f 7275 6e22 206e 6f74 2069  arity_run" not i
-0001c6d0: 6e20 7365 6c66 2e63 6f6e 6669 673a 0a20  n self.config:. 
-0001c6e0: 2020 2020 2020 2020 2020 2023 2073 616e             # san
-0001c6f0: 6974 7920 6368 6563 6b3a 2074 6865 7265  ity check: there
-0001c700: 2073 686f 756c 6420 6265 206f 6e6c 7920   should be only 
-0001c710: 6f6e 6520 696e 7075 7420 6473 0a20 2020  one input ds.   
-0001c720: 2020 2020 2020 2020 2023 2020 206f 7468           #   oth
-0001c730: 6572 7769 7365 206e 6565 6420 746f 2073  erwise need to s
-0001c740: 7065 6369 6679 2069 6e20 7468 6973 2073  pecify in this s
-0001c750: 6563 7469 6f6e 3a0a 2020 2020 2020 2020  ection:.        
-0001c760: 2020 2020 6173 7365 7274 2069 6e70 7574      assert input
-0001c770: 5f64 732e 6e75 6d5f 6473 203d 3d20 312c  _ds.num_ds == 1,
-0001c780: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-0001c790: 2020 2022 5365 6374 696f 6e20 2773 696e     "Section 'sin
-0001c7a0: 6775 6c61 7269 7479 5f72 756e 2720 6973  gularity_run' is
-0001c7b0: 206d 6973 7369 6e67 2069 6e20 7468 6520   missing in the 
-0001c7c0: 7072 6f76 6964 6564 2220 5c0a 2020 2020  provided" \.    
-0001c7d0: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0001c7e0: 6063 6f6e 7461 696e 6572 5f63 6f6e 6669  `container_confi
-0001c7f0: 675f 7961 6d6c 5f66 696c 6560 2e20 4173  g_yaml_file`. As
-0001c800: 2074 6865 7265 2061 7265 206d 6f72 6520   there are more 
-0001c810: 7468 616e 206f 6e65 2220 5c0a 2020 2020  than one" \.    
-0001c820: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-0001c830: 696e 7075 7420 6461 7461 7365 742c 2079  input dataset, y
-0001c840: 6f75 206d 7573 7420 696e 636c 7564 6520  ou must include 
-0001c850: 7468 6973 2073 6563 7469 6f6e 2074 6f20  this section to 
-0001c860: 7370 6563 6966 7922 205c 0a20 2020 2020  specify" \.     
-0001c870: 2020 2020 2020 2020 2020 202b 2022 2074             + " t
-0001c880: 6f20 7768 6963 6820 6172 6775 6d65 6e74  o which argument
-0001c890: 2074 6861 7420 6561 6368 2069 6e70 7574   that each input
-0001c8a0: 2064 6174 6173 6574 2077 696c 6c20 676f   dataset will go
-0001c8b0: 2e22 0a20 2020 2020 2020 2020 2020 2023  .".            #
-0001c8c0: 2069 6620 7468 6572 6520 6973 206f 6e6c   if there is onl
-0001c8d0: 7920 6f6e 6520 696e 7075 7420 6473 2c20  y one input ds, 
-0001c8e0: 6669 6e65 3a0a 2020 2020 2020 2020 2020  fine:.          
-0001c8f0: 2020 7072 696e 7428 2253 6563 7469 6f6e    print("Section
-0001c900: 2027 7369 6e67 756c 6172 6974 795f 7275   'singularity_ru
-0001c910: 6e27 2077 6173 206e 6f74 2069 6e63 6c75  n' was not inclu
-0001c920: 6465 6420 220a 2020 2020 2020 2020 2020  ded ".          
-0001c930: 2020 2020 2020 2020 2269 6e20 7468 6520          "in the 
-0001c940: 6063 6f6e 7461 696e 6572 5f63 6f6e 6669  `container_confi
-0001c950: 675f 7961 6d6c 5f66 696c 6560 2e20 2229  g_yaml_file`. ")
-0001c960: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
-0001c970: 5f73 696e 6775 6c61 7269 7479 5f66 6c61  _singularity_fla
-0001c980: 6773 203d 2022 2220 2020 2320 7368 6f75  gs = ""   # shou
-0001c990: 6c64 2062 6520 656d 7074 790a 2020 2020  ld be empty.    
-0001c9a0: 2020 2020 2020 2020 2320 4d61 6b65 2073          # Make s
-0001c9b0: 7572 6520 6f74 6865 7220 7265 7475 726e  ure other return
-0001c9c0: 6564 2076 6172 6961 626c 6573 2066 726f  ed variables fro
-0001c9d0: 6d20 6067 656e 6572 6174 655f 636d 645f  m `generate_cmd_
-0001c9e0: 7369 6e67 756c 6172 6974 7952 756e 5f66  singularityRun_f
-0001c9f0: 726f 6d5f 636f 6e66 6967 600a 2020 2020  rom_config`.    
-0001ca00: 2020 2020 2020 2020 2320 2020 616c 736f          #   also
-0001ca10: 2068 6176 6520 7661 6c75 6573 3a0a 2020   have values:.  
-0001ca20: 2020 2020 2020 2020 2020 2320 6173 2022            # as "
-0001ca30: 2d2d 6673 2d6c 6963 656e 7365 2d66 696c  --fs-license-fil
-0001ca40: 6522 2077 6173 206e 6f74 206f 6e65 206f  e" was not one o
-0001ca50: 6620 7468 6520 7661 6c75 6520 696e 2060  f the value in `
-0001ca60: 7369 6e67 756c 6172 6974 795f 7275 6e60  singularity_run`
-0001ca70: 2073 6563 7469 6f6e 3a0a 2020 2020 2020   section:.      
-0001ca80: 2020 2020 2020 666c 6167 5f66 735f 6c69        flag_fs_li
-0001ca90: 6365 6e73 6520 3d20 4661 6c73 650a 2020  cense = False.  
-0001caa0: 2020 2020 2020 2020 2020 7061 7468 5f66            path_f
-0001cab0: 735f 6c69 6365 6e73 6520 3d20 4e6f 6e65  s_license = None
-0001cac0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0001cad0: 6f70 6965 6420 6672 6f6d 2060 6765 6e65  opied from `gene
-0001cae0: 7261 7465 5f63 6d64 5f73 696e 6775 6c61  rate_cmd_singula
-0001caf0: 7269 7479 5275 6e5f 6672 6f6d 5f63 6f6e  rityRun_from_con
-0001cb00: 6669 6760 3a0a 2020 2020 2020 2020 2020  fig`:.          
-0001cb10: 2020 7369 6e67 7552 756e 5f69 6e70 7574    singuRun_input
-0001cb20: 5f64 6972 203d 2069 6e70 7574 5f64 732e  _dir = input_ds.
-0001cb30: 6466 5b22 7061 7468 5f64 6174 615f 7265  df["path_data_re
-0001cb40: 6c22 5d5b 305d 0a20 2020 2020 2020 2065  l"][0].        e
-0001cb50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001cb60: 2023 2070 7269 6e74 2822 4765 6e65 7261   # print("Genera
-0001cb70: 7465 2073 696e 6775 6c61 7269 7479 2072  te singularity r
-0001cb80: 756e 2063 6f6d 6d61 6e64 2066 726f 6d20  un command from 
-0001cb90: 6063 6f6e 7461 696e 6572 5f63 6f6e 6669  `container_confi
-0001cba0: 675f 7961 6d6c 5f66 696c 6560 2229 0a20  g_yaml_file`"). 
-0001cbb0: 2020 2020 2020 2020 2020 2023 2023 2063             # # c
-0001cbc0: 6f6e 7461 696e 205c 2066 6f72 2065 6163  ontain \ for eac
-0001cbd0: 6820 6b65 792d 7661 6c75 650a 0a20 2020  h key-value..   
-0001cbe0: 2020 2020 2020 2020 2023 2072 6561 6420           # read 
-0001cbf0: 636f 6e66 6967 2066 726f 6d20 7468 6520  config from the 
-0001cc00: 7961 6d6c 2066 696c 653a 0a20 2020 2020  yaml file:.     
-0001cc10: 2020 2020 2020 2063 6d64 5f73 696e 6775         cmd_singu
-0001cc20: 6c61 7269 7479 5f66 6c61 6773 2c20 666c  larity_flags, fl
-0001cc30: 6167 5f66 735f 6c69 6365 6e73 652c 2070  ag_fs_license, p
-0001cc40: 6174 685f 6673 5f6c 6963 656e 7365 2c20  ath_fs_license, 
-0001cc50: 7369 6e67 7552 756e 5f69 6e70 7574 5f64  singuRun_input_d
-0001cc60: 6972 203d 205c 0a20 2020 2020 2020 2020  ir = \.         
-0001cc70: 2020 2020 2020 2067 656e 6572 6174 655f         generate_
-0001cc80: 636d 645f 7369 6e67 756c 6172 6974 7952  cmd_singularityR
-0001cc90: 756e 5f66 726f 6d5f 636f 6e66 6967 2873  un_from_config(s
-0001cca0: 656c 662e 636f 6e66 6967 2c20 696e 7075  elf.config, inpu
-0001ccb0: 745f 6473 290a 0a20 2020 2020 2020 2023  t_ds)..        #
-0001ccc0: 2054 4f44 4f3a 2061 6c73 6f20 636f 7270   TODO: also corp
-0001ccd0: 6f72 6174 6520 7468 6520 6063 616c 6c2d  orate the `call-
-0001cce0: 666d 7460 2069 6e20 6064 6174 616c 6164  fmt` in `datalad
-0001ccf0: 2063 6f6e 7461 696e 6572 732d 6164 6460   containers-add`
-0001cd00: 0a0a 2020 2020 2020 2020 2320 322e 2063  ..        # 2. c
-0001cd10: 6865 636b 2060 7a69 705f 666f 6c64 6572  heck `zip_folder
-0001cd20: 6e61 6d65 7360 2073 6563 7469 6f6e 3a0a  names` section:.
-0001cd30: 2020 2020 2020 2020 6469 6374 5f7a 6970          dict_zip
-0001cd40: 5f66 6f6c 6465 726e 616d 6573 2c20 6966  _foldernames, if
-0001cd50: 5f6d 6b5f 6f75 7470 7574 5f66 6f6c 6465  _mk_output_folde
-0001cd60: 722c 2070 6174 685f 6f75 7470 7574 5f66  r, path_output_f
-0001cd70: 6f6c 6465 7220 3d20 5c0a 2020 2020 2020  older = \.      
-0001cd80: 2020 2020 2020 6765 745f 696e 666f 5f7a        get_info_z
-0001cd90: 6970 5f66 6f6c 6465 726e 616d 6573 2873  ip_foldernames(s
-0001cda0: 656c 662e 636f 6e66 6967 290a 0a20 2020  elf.config)..   
-0001cdb0: 2020 2020 2070 7269 6e74 2829 0a0a 2020       print()..  
-0001cdc0: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-0001cdd0: 2074 6865 2062 6173 6820 6669 6c65 2061   the bash file a
-0001cde0: 6c72 6561 6479 2065 7869 7374 3a0a 2020  lready exist:.  
-0001cdf0: 2020 2020 2020 6966 206f 702e 6578 6973        if op.exis
-0001ce00: 7473 2862 6173 685f 7061 7468 293a 0a20  ts(bash_path):. 
-0001ce10: 2020 2020 2020 2020 2020 206f 732e 7265             os.re
-0001ce20: 6d6f 7665 2862 6173 685f 7061 7468 2920  move(bash_path) 
-0001ce30: 2023 2072 656d 6f76 6520 6974 0a0a 2020   # remove it..  
-0001ce40: 2020 2020 2020 2320 5772 6974 6520 696e        # Write in
-0001ce50: 746f 2074 6865 2062 6173 6820 6669 6c65  to the bash file
-0001ce60: 3a0a 2020 2020 2020 2020 6261 7368 5f66  :.        bash_f
-0001ce70: 696c 6520 3d20 6f70 656e 2862 6173 685f  ile = open(bash_
-0001ce80: 7061 7468 2c20 2261 2229 2020 2023 206f  path, "a")   # o
-0001ce90: 7065 6e20 696e 2061 7070 656e 6420 6d6f  pen in append mo
-0001cea0: 6465 0a0a 2020 2020 2020 2020 6261 7368  de..        bash
-0001ceb0: 5f66 696c 652e 7772 6974 6528 2223 212f  _file.write("#!/
-0001cec0: 6269 6e2f 6261 7368 5c6e 2229 0a20 2020  bin/bash\n").   
-0001ced0: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001cee0: 7269 7465 2822 7365 7420 2d65 202d 7520  rite("set -e -u 
-0001cef0: 2d78 5c6e 2229 0a0a 2020 2020 2020 2020  -x\n")..        
-0001cf00: 636f 756e 745f 696e 7075 7473 5f62 6173  count_inputs_bas
-0001cf10: 6820 3d20 300a 2020 2020 2020 2020 6261  h = 0.        ba
-0001cf20: 7368 5f66 696c 652e 7772 6974 6528 275c  sh_file.write('\
-0001cf30: 6e73 7562 6964 3d22 2431 225c 6e27 290a  nsubid="$1"\n').
-0001cf40: 2020 2020 2020 2020 636f 756e 745f 696e          count_in
-0001cf50: 7075 7473 5f62 6173 6820 2b3d 2031 0a0a  puts_bash += 1..
-0001cf60: 2020 2020 2020 2020 6966 2074 7970 655f          if type_
-0001cf70: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
-0001cf80: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
-0001cf90: 2020 2020 2320 616c 736f 2068 6176 6520      # also have 
-0001cfa0: 7468 6520 696e 7075 7420 6f66 2060 7365  the input of `se
-0001cfb0: 7369 6460 3a0a 2020 2020 2020 2020 2020  sid`:.          
-0001cfc0: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
-0001cfd0: 6528 2773 6573 6964 3d22 2432 225c 6e27  e('sesid="$2"\n'
-0001cfe0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-0001cff0: 756e 745f 696e 7075 7473 5f62 6173 6820  unt_inputs_bash 
-0001d000: 2b3d 2031 0a0a 2020 2020 2020 2020 2320  += 1..        # 
-0001d010: 7a69 7020 6669 6c65 6e61 6d65 2061 7320  zip filename as 
-0001d020: 696e 7075 7420 6f66 2062 6173 6820 6669  input of bash fi
-0001d030: 6c65 3a0a 2020 2020 2020 2020 666f 7220  le:.        for 
-0001d040: 695f 6473 2069 6e20 7261 6e67 6528 302c  i_ds in range(0,
-0001d050: 2069 6e70 7574 5f64 732e 6e75 6d5f 6473   input_ds.num_ds
-0001d060: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001d070: 6620 696e 7075 745f 6473 2e64 665b 2269  f input_ds.df["i
-0001d080: 735f 7a69 7070 6564 225d 5b69 5f64 735d  s_zipped"][i_ds]
-0001d090: 2069 7320 5472 7565 3a20 2023 2069 7320   is True:  # is 
-0001d0a0: 7a69 7070 6564 3a0a 2020 2020 2020 2020  zipped:.        
-0001d0b0: 2020 2020 2020 2020 636f 756e 745f 696e          count_in
-0001d0c0: 7075 7473 5f62 6173 6820 2b3d 2031 0a20  puts_bash += 1. 
-0001d0d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001d0e0: 6173 685f 6669 6c65 2e77 7269 7465 2869  ash_file.write(i
-0001d0f0: 6e70 7574 5f64 732e 6466 5b22 6e61 6d65  nput_ds.df["name
-0001d100: 225d 5b69 5f64 735d 2e75 7070 6572 2829  "][i_ds].upper()
-0001d110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d130: 202b 2027 5f5a 4950 3d22 2427 202b 2073   + '_ZIP="$' + s
-0001d140: 7472 2863 6f75 6e74 5f69 6e70 7574 735f  tr(count_inputs_
-0001d150: 6261 7368 2920 2b20 2722 5c6e 2729 0a0a  bash) + '"\n')..
-0001d160: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
-0001d170: 652e 7772 6974 6528 225c 6e22 290a 0a20  e.write("\n").. 
-0001d180: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-0001d190: 6620 602d 2d62 6964 732d 6669 6c74 6572  f `--bids-filter
-0001d1a0: 2d66 696c 6520 2224 7b66 696c 7465 7266  -file "${filterf
-0001d1b0: 696c 657d 2260 2069 7320 6e65 6564 6564  ile}"` is needed
-0001d1c0: 3a0a 2020 2020 2020 2020 666c 6167 5f66  :.        flag_f
-0001d1d0: 696c 7465 7266 696c 6520 3d20 4661 6c73  ilterfile = Fals
-0001d1e0: 650a 2020 2020 2020 2020 6966 2074 7970  e.        if typ
-0001d1f0: 655f 7365 7373 696f 6e20 3d3d 2022 6d75  e_session == "mu
-0001d200: 6c74 692d 7365 7322 3a0a 2020 2020 2020  lti-ses":.      
-0001d210: 2020 2020 2020 6966 2061 6e79 2865 6c65        if any(ele
-0001d220: 2069 6e20 7365 6c66 2e63 6f6e 7461 696e   in self.contain
-0001d230: 6572 5f6e 616d 652e 6c6f 7765 7228 2920  er_name.lower() 
-0001d240: 666f 7220 656c 6520 696e 205b 2266 6d72  for ele in ["fmr
-0001d250: 6970 7265 7022 2c20 2271 7369 7072 6570  iprep", "qsiprep
-0001d260: 225d 293a 0a20 2020 2020 2020 2020 2020  "]):.           
-0001d270: 2020 2020 2023 205e 5e20 6966 2074 6865       # ^^ if the
-0001d280: 2063 6f6e 7461 696e 6572 5f6e 616d 6520   container_name 
-0001d290: 636f 6e74 6169 6e73 2060 666d 7269 7072  contains `fmripr
-0001d2a0: 6570 6020 6f72 2060 7173 6970 7265 7060  ep` or `qsiprep`
-0001d2b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d2c0: 2020 2320 5e5e 2063 6173 6520 696e 7365    # ^^ case inse
-0001d2d0: 6e73 6974 6976 6520 2861 7320 6861 7665  nsitive (as have
-0001d2e0: 2063 6861 6e67 6564 2074 6f20 6c6f 7765   changed to lowe
-0001d2f0: 7220 6361 7365 292c 2061 6363 6570 7420  r case), accept 
-0001d300: 2266 4d52 4950 7265 702d 302d 302d 3022  "fMRIPrep-0-0-0"
-0001d310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d320: 2066 6c61 675f 6669 6c74 6572 6669 6c65   flag_filterfile
-0001d330: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
-0001d340: 2020 2020 2020 2020 2023 2067 656e 6572           # gener
-0001d350: 6174 6520 7468 6520 636f 6d6d 616e 6420  ate the command 
-0001d360: 6f66 2067 656e 6572 6174 696e 6720 7468  of generating th
-0001d370: 6520 6024 6669 6c74 6572 6669 6c65 602c  e `$filterfile`,
-0001d380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d390: 2023 2069 2e65 2e2c 2060 247b 7365 7369   # i.e., `${sesi
-0001d3a0: 647d 5f66 696c 7465 722e 6a73 6f6e 603a  d}_filter.json`:
-0001d3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d3c0: 2063 6d64 5f66 696c 7465 7266 696c 6520   cmd_filterfile 
-0001d3d0: 3d20 6765 6e65 7261 7465 5f63 6d64 5f66  = generate_cmd_f
-0001d3e0: 696c 7465 7266 696c 6528 7365 6c66 2e63  ilterfile(self.c
-0001d3f0: 6f6e 7461 696e 6572 5f6e 616d 6529 0a20  ontainer_name). 
-0001d400: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001d410: 6173 685f 6669 6c65 2e77 7269 7465 2863  ash_file.write(c
-0001d420: 6d64 5f66 696c 7465 7266 696c 6529 0a0a  md_filterfile)..
-0001d430: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0001d440: 6966 2061 6e79 2064 6174 6173 6574 2069  if any dataset i
-0001d450: 7320 7a69 7070 6564 3b20 6966 2073 6f2c  s zipped; if so,
-0001d460: 2061 6464 2063 6f6d 6d61 6e64 7320 6f66   add commands of
-0001d470: 2075 6e7a 6970 7069 6e67 3a0a 2020 2020   unzipping:.    
-0001d480: 2020 2020 636d 645f 756e 7a69 705f 696e      cmd_unzip_in
-0001d490: 7075 7464 7320 3d20 6765 6e65 7261 7465  putds = generate
-0001d4a0: 5f63 6d64 5f75 6e7a 6970 5f69 6e70 7574  _cmd_unzip_input
-0001d4b0: 6473 2869 6e70 7574 5f64 732c 2074 7970  ds(input_ds, typ
-0001d4c0: 655f 7365 7373 696f 6e29 0a20 2020 2020  e_session).     
-0001d4d0: 2020 2069 6620 6c65 6e28 636d 645f 756e     if len(cmd_un
-0001d4e0: 7a69 705f 696e 7075 7464 7329 203e 2030  zip_inputds) > 0
-0001d4f0: 3a20 2020 2320 6e6f 7420 2222 3a0a 2020  :   # not "":.  
-0001d500: 2020 2020 2020 2020 2020 6261 7368 5f66            bash_f
-0001d510: 696c 652e 7772 6974 6528 636d 645f 756e  ile.write(cmd_un
-0001d520: 7a69 705f 696e 7075 7464 7329 0a0a 2020  zip_inputds)..  
-0001d530: 2020 2020 2020 2320 4f74 6865 7220 6e65        # Other ne
-0001d540: 6365 7373 6172 7920 636f 6d6d 616e 6473  cessary commands
-0001d550: 2066 6f72 2070 7265 7061 7261 7469 6f6e   for preparation
-0001d560: 3a0a 2020 2020 2020 2020 6261 7368 5f66  :.        bash_f
-0001d570: 696c 652e 7772 6974 6528 225c 6e22 290a  ile.write("\n").
-0001d580: 0a20 2020 2020 2020 2023 2045 6e76 6972  .        # Envir
-0001d590: 6f6e 6d65 6e74 2076 6172 6961 626c 6573  onment variables
-0001d5a0: 2069 6e20 636f 6e74 6169 6e65 723a 0a20   in container:. 
-0001d5b0: 2020 2020 2020 2023 2067 6574 2065 6e76         # get env
-0001d5c0: 6972 6f6e 6d65 6e74 2076 6172 6961 626c  ironment variabl
-0001d5d0: 6573 2074 6f20 6265 2069 6e6a 6563 7465  es to be injecte
-0001d5e0: 6420 696e 746f 2063 6f6e 7461 696e 6572  d into container
-0001d5f0: 2061 6e64 2077 686f 7365 2076 616c 7565   and whose value
-0001d600: 2074 6f20 6265 2062 6f75 6e64 3a0a 2020   to be bound:.  
-0001d610: 2020 2020 2020 636d 645f 656e 765f 7465        cmd_env_te
-0001d620: 6d70 6c61 7465 666c 6f77 2c20 7465 6d70  mplateflow, temp
-0001d630: 6c61 7465 666c 6f77 5f68 6f6d 652c 2074  lateflow_home, t
-0001d640: 656d 706c 6174 6566 6c6f 775f 696e 5f63  emplateflow_in_c
-0001d650: 6f6e 7461 696e 6572 203d 205c 0a20 2020  ontainer = \.   
-0001d660: 2020 2020 2020 2020 2067 656e 6572 6174           generat
-0001d670: 655f 636d 645f 7365 745f 656e 7676 6172  e_cmd_set_envvar
-0001d680: 2822 5445 4d50 4c41 5445 464c 4f57 5f48  ("TEMPLATEFLOW_H
-0001d690: 4f4d 4522 290a 0a20 2020 2020 2020 2023  OME")..        #
-0001d6a0: 2057 7269 7465 2074 6865 2068 6561 6420   Write the head 
-0001d6b0: 6f66 2074 6865 2063 6f6d 6d61 6e64 2060  of the command `
-0001d6c0: 7369 6e67 756c 6172 6974 7920 7275 6e60  singularity run`
-0001d6d0: 3a0a 2020 2020 2020 2020 6261 7368 5f66  :.        bash_f
-0001d6e0: 696c 652e 7772 6974 6528 226d 6b64 6972  ile.write("mkdir
-0001d6f0: 202d 7020 247b 5057 447d 2f2e 6769 742f   -p ${PWD}/.git/
-0001d700: 746d 702f 776b 6469 725c 6e22 290a 2020  tmp/wkdir\n").  
-0001d710: 2020 2020 2020 636d 645f 6865 6164 5f73        cmd_head_s
-0001d720: 696e 6775 6c61 7269 7479 5275 6e20 3d20  ingularityRun = 
-0001d730: 2273 696e 6775 6c61 7269 7479 2072 756e  "singularity run
-0001d740: 202d 2d63 6c65 616e 656e 7622 0a20 2020   --cleanenv".   
-0001d750: 2020 2020 2023 2062 696e 6469 6e67 3a0a       # binding:.
-0001d760: 2020 2020 2020 2020 636d 645f 6865 6164          cmd_head
-0001d770: 5f73 696e 6775 6c61 7269 7479 5275 6e20  _singularityRun 
-0001d780: 2b3d 2022 205c 5c22 202b 2022 5c6e 5c74  += " \\" + "\n\t
-0001d790: 2220 2b20 222d 4220 247b 5057 447d 220a  " + "-B ${PWD}".
-0001d7a0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-0001d7b0: 2069 6620 6074 656d 706c 6174 6566 6c6f   if `templateflo
-0001d7c0: 775f 686f 6d65 6020 6e65 6564 7320 746f  w_home` needs to
-0001d7d0: 2062 6520 626f 756e 643a 0a20 2020 2020   be bound:.     
-0001d7e0: 2020 2069 6620 7465 6d70 6c61 7465 666c     if templatefl
-0001d7f0: 6f77 5f68 6f6d 6520 6973 206e 6f74 204e  ow_home is not N
-0001d800: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001d810: 2023 2061 6464 2060 2d42 202f 7061 7468   # add `-B /path
-0001d820: 2f74 6f2f 7465 6d70 6c61 7465 666c 6f77  /to/templateflow
-0001d830: 5f68 6f6d 653a 2f54 454d 504c 4154 4546  _home:/TEMPLATEF
-0001d840: 4c4f 575f 484f 4d45 603a 0a20 2020 2020  LOW_HOME`:.     
-0001d850: 2020 2020 2020 2023 2066 6f72 206d 756c         # for mul
-0001d860: 7469 706c 6520 6269 6e64 696e 6773 3a20  tiple bindings: 
-0001d870: 6d75 6c74 6970 6c65 2060 2d42 6020 6f72  multiple `-B` or
-0001d880: 2073 6570 6172 6174 6520 7061 7468 2077   separate path w
-0001d890: 6974 6820 636f 6d6d 6120 2874 6f6f 206c  ith comma (too l
-0001d8a0: 6f6e 6729 0a20 2020 2020 2020 2020 2020  ong).           
-0001d8b0: 2063 6d64 5f68 6561 645f 7369 6e67 756c   cmd_head_singul
-0001d8c0: 6172 6974 7952 756e 202b 3d20 2220 5c5c  arityRun += " \\
-0001d8d0: 2220 2b20 225c 6e5c 7422 202b 2022 2d42  " + "\n\t" + "-B
-0001d8e0: 2022 0a20 2020 2020 2020 2020 2020 2063   ".            c
-0001d8f0: 6d64 5f68 6561 645f 7369 6e67 756c 6172  md_head_singular
-0001d900: 6974 7952 756e 202b 3d20 7465 6d70 6c61  ityRun += templa
-0001d910: 7465 666c 6f77 5f68 6f6d 6520 2b20 223a  teflow_home + ":
-0001d920: 220a 2020 2020 2020 2020 2020 2020 636d  ".            cm
-0001d930: 645f 6865 6164 5f73 696e 6775 6c61 7269  d_head_singulari
-0001d940: 7479 5275 6e20 2b3d 2074 656d 706c 6174  tyRun += templat
-0001d950: 6566 6c6f 775f 696e 5f63 6f6e 7461 696e  eflow_in_contain
-0001d960: 6572 0a20 2020 2020 2020 2020 2020 2023  er.            #
-0001d970: 205e 5e20 6269 6e64 2074 6f20 6469 7220   ^^ bind to dir 
-0001d980: 696e 2063 6f6e 7461 696e 6572 0a0a 2020  in container..  
-0001d990: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
-0001d9a0: 2060 6672 6565 7375 7266 6572 5f68 6f6d   `freesurfer_hom
-0001d9b0: 6560 206e 6565 6473 2074 6f20 6265 2062  e` needs to be b
-0001d9c0: 6f75 6e64 3a0a 2020 2020 2020 2020 6966  ound:.        if
-0001d9d0: 2066 6c61 675f 6673 5f6c 6963 656e 7365   flag_fs_license
-0001d9e0: 2069 7320 5472 7565 3a0a 2020 2020 2020   is True:.      
-0001d9f0: 2020 2020 2020 2320 6164 6420 602d 4220        # add `-B 
-0001da00: 2f70 6174 682f 746f 2f6c 6963 656e 7365  /path/to/license
-0001da10: 2e74 7874 3a2f 5347 4c52 2f46 5245 4553  .txt:/SGLR/FREES
-0001da20: 5552 4645 525f 484f 4d45 2f6c 6963 656e  URFER_HOME/licen
-0001da30: 7365 2e74 7874 603a 0a20 2020 2020 2020  se.txt`:.       
-0001da40: 2020 2020 2063 6d64 5f68 6561 645f 7369       cmd_head_si
-0001da50: 6e67 756c 6172 6974 7952 756e 202b 3d20  ngularityRun += 
-0001da60: 2220 5c5c 2220 2b20 225c 6e5c 7422 202b  " \\" + "\n\t" +
-0001da70: 2022 2d42 2022 0a20 2020 2020 2020 2020   "-B ".         
-0001da80: 2020 2063 6d64 5f68 6561 645f 7369 6e67     cmd_head_sing
-0001da90: 756c 6172 6974 7952 756e 202b 3d20 7061  ularityRun += pa
-0001daa0: 7468 5f66 735f 6c69 6365 6e73 6520 2b20  th_fs_license + 
-0001dab0: 223a 220a 2020 2020 2020 2020 2020 2020  ":".            
-0001dac0: 636d 645f 6865 6164 5f73 696e 6775 6c61  cmd_head_singula
-0001dad0: 7269 7479 5275 6e20 2b3d 2050 4154 485f  rityRun += PATH_
-0001dae0: 4653 5f4c 4943 454e 5345 5f49 4e5f 434f  FS_LICENSE_IN_CO
-0001daf0: 4e54 4149 4e45 520a 0a20 2020 2020 2020  NTAINER..       
-0001db00: 2023 2069 6e6a 6563 7420 656e 7620 7661   # inject env va
-0001db10: 7269 6162 6c65 2069 6e74 6f20 636f 6e74  riable into cont
-0001db20: 6169 6e65 723a 0a20 2020 2020 2020 2069  ainer:.        i
-0001db30: 6620 7465 6d70 6c61 7465 666c 6f77 5f68  f templateflow_h
-0001db40: 6f6d 6520 6973 206e 6f74 204e 6f6e 653a  ome is not None:
-0001db50: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
-0001db60: 6464 2060 2d2d 656e 7620 5445 4d50 4c41  dd `--env TEMPLA
-0001db70: 5445 464c 4f57 5f48 4f4d 453d 2f54 454d  TEFLOW_HOME=/TEM
-0001db80: 504c 4154 4546 4c4f 575f 484f 4d45 603a  PLATEFLOW_HOME`:
-0001db90: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
-0001dba0: 5f68 6561 645f 7369 6e67 756c 6172 6974  _head_singularit
-0001dbb0: 7952 756e 202b 3d20 2220 5c5c 2220 2b20  yRun += " \\" + 
-0001dbc0: 225c 6e5c 7422 0a20 2020 2020 2020 2020  "\n\t".         
-0001dbd0: 2020 2063 6d64 5f68 6561 645f 7369 6e67     cmd_head_sing
-0001dbe0: 756c 6172 6974 7952 756e 202b 3d20 636d  ularityRun += cm
-0001dbf0: 645f 656e 765f 7465 6d70 6c61 7465 666c  d_env_templatefl
-0001dc00: 6f77 0a0a 2020 2020 2020 2020 636d 645f  ow..        cmd_
-0001dc10: 6865 6164 5f73 696e 6775 6c61 7269 7479  head_singularity
-0001dc20: 5275 6e20 2b3d 2022 205c 5c22 202b 2022  Run += " \\" + "
-0001dc30: 5c6e 5c74 220a 2020 2020 2020 2020 636d  \n\t".        cm
-0001dc40: 645f 6865 6164 5f73 696e 6775 6c61 7269  d_head_singulari
-0001dc50: 7479 5275 6e20 2b3d 2073 656c 662e 636f  tyRun += self.co
-0001dc60: 6e74 6169 6e65 725f 7061 7468 5f72 656c  ntainer_path_rel
-0001dc70: 546f 416e 616c 7973 6973 0a20 2020 2020  ToAnalysis.     
-0001dc80: 2020 2063 6d64 5f68 6561 645f 7369 6e67     cmd_head_sing
-0001dc90: 756c 6172 6974 7952 756e 202b 3d20 2220  ularityRun += " 
-0001dca0: 5c5c 2220 2b20 225c 6e5c 7422 0a20 2020  \\" + "\n\t".   
-0001dcb0: 2020 2020 2063 6d64 5f68 6561 645f 7369       cmd_head_si
-0001dcc0: 6e67 756c 6172 6974 7952 756e 202b 3d20  ngularityRun += 
-0001dcd0: 7369 6e67 7552 756e 5f69 6e70 7574 5f64  singuRun_input_d
-0001dce0: 6972 2020 2320 696e 7075 7473 2f64 6174  ir  # inputs/dat
-0001dcf0: 612f 3c6e 616d 653e 0a20 2020 2020 2020  a/<name>.       
-0001dd00: 2063 6d64 5f68 6561 645f 7369 6e67 756c   cmd_head_singul
-0001dd10: 6172 6974 7952 756e 202b 3d20 2220 5c5c  arityRun += " \\
-0001dd20: 2220 2b20 225c 6e5c 7422 0a20 2020 2020  " + "\n\t".     
-0001dd30: 2020 2063 6d64 5f68 6561 645f 7369 6e67     cmd_head_sing
-0001dd40: 756c 6172 6974 7952 756e 202b 3d20 7061  ularityRun += pa
-0001dd50: 7468 5f6f 7574 7075 745f 666f 6c64 6572  th_output_folder
-0001dd60: 2020 2020 2320 6465 6669 6e65 6420 6162      # defined ab
-0001dd70: 6f76 650a 0a20 2020 2020 2020 2023 2063  ove..        # c
-0001dd80: 7572 7265 6e74 6c79 2061 6c6c 2042 4944  urrently all BID
-0001dd90: 5320 4170 7020 7375 7070 6f72 7420 6070  S App support `p
-0001dda0: 6172 7469 6369 7061 6e74 6020 706f 7369  articipant` posi
-0001ddb0: 7469 6f6e 616c 2061 7267 753a 0a20 2020  tional argu:.   
-0001ddc0: 2020 2020 2063 6d64 5f68 6561 645f 7369       cmd_head_si
-0001ddd0: 6e67 756c 6172 6974 7952 756e 202b 3d20  ngularityRun += 
-0001dde0: 2220 5c5c 2220 2b20 225c 6e5c 7422 0a20  " \\" + "\n\t". 
-0001ddf0: 2020 2020 2020 2063 6d64 5f68 6561 645f         cmd_head_
-0001de00: 7369 6e67 756c 6172 6974 7952 756e 202b  singularityRun +
-0001de10: 3d20 2270 6172 7469 6369 7061 6e74 2220  = "participant" 
-0001de20: 2023 2061 7420 7061 7274 6963 6970 616e   # at participan
-0001de30: 742d 6c65 7665 6c0a 0a20 2020 2020 2020  t-level..       
-0001de40: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
-0001de50: 2863 6d64 5f68 6561 645f 7369 6e67 756c  (cmd_head_singul
-0001de60: 6172 6974 7952 756e 290a 0a20 2020 2020  arityRun)..     
-0001de70: 2020 2023 2057 7269 7465 2074 6865 206e     # Write the n
-0001de80: 616d 6564 2061 7267 756d 656e 7473 202b  amed arguments +
-0001de90: 2076 616c 7565 733a 0a20 2020 2020 2020   values:.       
-0001dea0: 2023 2061 6464 206d 6f72 6520 6172 6775   # add more argu
-0001deb0: 6d65 6e74 7320 7468 6174 2061 7265 2063  ments that are c
-0001dec0: 6f76 6572 6564 2062 7920 4241 4253 2028  overed by BABS (
-0001ded0: 696e 7374 6561 6420 6f66 2075 7365 7273  instead of users
-0001dee0: 293a 0a20 2020 2020 2020 2069 6620 666c  ):.        if fl
-0001def0: 6167 5f66 696c 7465 7266 696c 6520 6973  ag_filterfile is
-0001df00: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-0001df10: 2020 2023 2061 6c73 6f20 6e65 6564 7320     # also needs 
-0001df20: 6120 2466 696c 7465 7266 696c 6520 666c  a $filterfile fl
-0001df30: 6167 3a0a 2020 2020 2020 2020 2020 2020  ag:.            
-0001df40: 636d 645f 7369 6e67 756c 6172 6974 795f  cmd_singularity_
-0001df50: 666c 6167 7320 2b3d 2022 205c 5c22 202b  flags += " \\" +
-0001df60: 2022 5c6e 5c74 220a 2020 2020 2020 2020   "\n\t".        
-0001df70: 2020 2020 636d 645f 7369 6e67 756c 6172      cmd_singular
-0001df80: 6974 795f 666c 6167 7320 2b3d 2027 2d2d  ity_flags += '--
-0001df90: 6269 6473 2d66 696c 7465 722d 6669 6c65  bids-filter-file
-0001dfa0: 2022 247b 6669 6c74 6572 6669 6c65 7d22   "${filterfile}"
-0001dfb0: 2720 2023 203c 2d20 544f 444f 3a20 7465  '  # <- TODO: te
-0001dfc0: 7374 206f 7574 2121 0a0a 2020 2020 2020  st out!!..      
-0001dfd0: 2020 636d 645f 7369 6e67 756c 6172 6974    cmd_singularit
-0001dfe0: 795f 666c 6167 7320 2b3d 2022 205c 5c22  y_flags += " \\"
-0001dff0: 202b 2022 5c6e 5c74 220a 2020 2020 2020   + "\n\t".      
-0001e000: 2020 636d 645f 7369 6e67 756c 6172 6974    cmd_singularit
-0001e010: 795f 666c 6167 7320 2b3d 2027 2d2d 7061  y_flags += '--pa
-0001e020: 7274 6963 6970 616e 742d 6c61 6265 6c20  rticipant-label 
-0001e030: 2224 7b73 7562 6964 7d22 2720 2020 2320  "${subid}"'   # 
-0001e040: 7374 616e 6461 7264 2061 7267 756d 656e  standard argumen
-0001e050: 7420 696e 2042 4944 5320 4170 700a 0a20  t in BIDS App.. 
-0001e060: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
-0001e070: 2e77 7269 7465 2863 6d64 5f73 696e 6775  .write(cmd_singu
-0001e080: 6c61 7269 7479 5f66 6c61 6773 290a 2020  larity_flags).  
-0001e090: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-0001e0a0: 7772 6974 6528 225c 6e5c 6e22 290a 0a20  write("\n\n").. 
-0001e0b0: 2020 2020 2020 2070 7269 6e74 2822 4265         print("Be
-0001e0c0: 6c6f 7720 6973 2074 6865 2067 656e 6572  low is the gener
-0001e0d0: 6174 6564 2060 7369 6e67 756c 6172 6974  ated `singularit
-0001e0e0: 7920 7275 6e60 2063 6f6d 6d61 6e64 3a22  y run` command:"
-0001e0f0: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0001e100: 636d 645f 6865 6164 5f73 696e 6775 6c61  cmd_head_singula
-0001e110: 7269 7479 5275 6e20 2b20 636d 645f 7369  rityRun + cmd_si
-0001e120: 6e67 756c 6172 6974 795f 666c 6167 7329  ngularity_flags)
-0001e130: 0a0a 2020 2020 2020 2020 2320 5a69 703a  ..        # Zip:
-0001e140: 0a20 2020 2020 2020 2063 6d64 5f7a 6970  .        cmd_zip
-0001e150: 203d 2067 656e 6572 6174 655f 636d 645f   = generate_cmd_
-0001e160: 7a69 7070 696e 675f 6672 6f6d 5f63 6f6e  zipping_from_con
-0001e170: 6669 6728 6469 6374 5f7a 6970 5f66 6f6c  fig(dict_zip_fol
-0001e180: 6465 726e 616d 6573 2c20 7479 7065 5f73  dernames, type_s
-0001e190: 6573 7369 6f6e 290a 2020 2020 2020 2020  ession).        
-0001e1a0: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
-0001e1b0: 636d 645f 7a69 7029 0a0a 2020 2020 2020  cmd_zip)..      
-0001e1c0: 2020 2320 4465 6c65 7465 2066 6f6c 6465    # Delete folde
-0001e1d0: 7273 2061 6e64 2066 696c 6573 3a0a 2020  rs and files:.  
-0001e1e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e1f0: 2020 726d 202d 7266 2070 7265 7020 2e67    rm -rf prep .g
-0001e200: 6974 2f74 6d70 2f77 6b64 6972 0a20 2020  it/tmp/wkdir.   
-0001e210: 2020 2020 2072 6d20 247b 6669 6c74 6572       rm ${filter
-0001e220: 6669 6c65 7d0a 2020 2020 2020 2020 2222  file}.        ""
-0001e230: 220a 2020 2020 2020 2020 636d 645f 636c  ".        cmd_cl
-0001e240: 6561 6e20 3d20 2272 6d20 2d72 6620 2220  ean = "rm -rf " 
-0001e250: 2b20 4f55 5450 5554 5f4d 4149 4e5f 464f  + OUTPUT_MAIN_FO
-0001e260: 4c44 4552 4e41 4d45 202b 2022 2022 202b  LDERNAME + " " +
-0001e270: 2022 2e67 6974 2f74 6d70 2f77 6b64 6972   ".git/tmp/wkdir
-0001e280: 2220 2b20 225c 6e22 0a20 2020 2020 2020  " + "\n".       
-0001e290: 2023 205e 5e20 726d 2074 6865 2065 6e74   # ^^ rm the ent
-0001e2a0: 6972 6520 6f75 7470 7574 2066 6f6c 6465  ire output folde
-0001e2b0: 7220 606f 7574 7075 7473 600a 2020 2020  r `outputs`.    
-0001e2c0: 2020 2020 6966 2066 6c61 675f 6669 6c74      if flag_filt
-0001e2d0: 6572 6669 6c65 2069 7320 5472 7565 3a0a  erfile is True:.
-0001e2e0: 2020 2020 2020 2020 2020 2020 636d 645f              cmd_
-0001e2f0: 636c 6561 6e20 2b3d 2022 726d 2024 7b66  clean += "rm ${f
-0001e300: 696c 7465 7266 696c 657d 2220 2b20 2220  ilterfile}" + " 
-0001e310: 5c6e 220a 0a20 2020 2020 2020 2062 6173  \n"..        bas
-0001e320: 685f 6669 6c65 2e77 7269 7465 2863 6d64  h_file.write(cmd
-0001e330: 5f63 6c65 616e 290a 0a20 2020 2020 2020  _clean)..       
-0001e340: 2023 2044 6f6e 6520 6765 6e65 7261 7469   # Done generati
-0001e350: 6e67 2060 3c63 6f6e 7461 696e 6572 4e61  ng `<containerNa
-0001e360: 6d65 3e5f 7a69 702e 7368 603a 0a20 2020  me>_zip.sh`:.   
-0001e370: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001e380: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
-0001e390: 2020 2062 6173 685f 6669 6c65 2e63 6c6f     bash_file.clo
-0001e3a0: 7365 2829 0a0a 2020 2020 2020 2020 2320  se()..        # 
-0001e3b0: 4578 6563 7574 6520 6e65 6365 7373 6172  Execute necessar
-0001e3c0: 7920 636f 6d6d 616e 6473 3a0a 2020 2020  y commands:.    
-0001e3d0: 2020 2020 2320 6368 616e 6765 2074 6865      # change the
-0001e3e0: 2070 6572 6d69 7373 696f 6e20 6f66 2074   permission of t
-0001e3f0: 6869 7320 6261 7368 2066 696c 653a 0a20  his bash file:. 
-0001e400: 2020 2020 2020 2070 726f 635f 6368 6d6f         proc_chmo
-0001e410: 645f 6261 7368 6669 6c65 203d 2073 7562  d_bashfile = sub
-0001e420: 7072 6f63 6573 732e 7275 6e28 0a20 2020  process.run(.   
-0001e430: 2020 2020 2020 2020 205b 2263 686d 6f64           ["chmod
-0001e440: 222c 2022 2b78 222c 2062 6173 685f 7061  ", "+x", bash_pa
-0001e450: 7468 5d2c 2020 2320 652e 672e 2c20 6368  th],  # e.g., ch
-0001e460: 6d6f 6420 2b78 2063 6f64 652f 666d 7269  mod +x code/fmri
-0001e470: 7072 6570 5f7a 6970 2e73 680a 2020 2020  prep_zip.sh.    
-0001e480: 2020 2020 2020 2020 7374 646f 7574 3d73          stdout=s
-0001e490: 7562 7072 6f63 6573 732e 5049 5045 0a20  ubprocess.PIPE. 
-0001e4a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001e4b0: 2020 2020 2070 726f 635f 6368 6d6f 645f       proc_chmod_
-0001e4c0: 6261 7368 6669 6c65 2e63 6865 636b 5f72  bashfile.check_r
-0001e4d0: 6574 7572 6e63 6f64 6528 290a 0a20 2020  eturncode()..   
-0001e4e0: 2064 6566 2067 656e 6572 6174 655f 6261   def generate_ba
-0001e4f0: 7368 5f70 6172 7469 6369 7061 6e74 5f6a  sh_participant_j
-0001e500: 6f62 2873 656c 662c 2062 6173 685f 7061  ob(self, bash_pa
-0001e510: 7468 2c20 696e 7075 745f 6473 2c20 7479  th, input_ds, ty
-0001e520: 7065 5f73 6573 7369 6f6e 2c0a 2020 2020  pe_session,.    
-0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e550: 2020 7379 7374 656d 293a 0a20 2020 2020    system):.     
-0001e560: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
-0001e570: 6869 7320 6973 2074 6f20 6765 6e65 7261  his is to genera
-0001e580: 7465 2061 2062 6173 6820 7363 7269 7074  te a bash script
-0001e590: 2074 6861 7420 7275 6e73 206a 6f62 7320   that runs jobs 
-0001e5a0: 666f 7220 6561 6368 2070 6172 7469 6369  for each partici
-0001e5b0: 7061 6e74 2028 6f72 2073 6573 7369 6f6e  pant (or session
-0001e5c0: 292e 0a0a 2020 2020 2020 2020 5061 7261  )...        Para
-0001e5d0: 6d65 7465 7273 3a0a 2020 2020 2020 2020  meters:.        
-0001e5e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-0001e5f0: 2020 2020 2020 6261 7368 5f70 6174 683a        bash_path:
-0001e600: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-0001e610: 2054 6865 2070 6174 6820 746f 2074 6865   The path to the
-0001e620: 2062 6173 6820 6669 6c65 2074 6f20 6265   bash file to be
-0001e630: 2067 656e 6572 6174 6564 2e20 4974 2073   generated. It s
-0001e640: 686f 756c 6420 6265 2069 6e20 7468 6520  hould be in the 
-0001e650: 6061 6e61 6c79 7369 732f 636f 6465 6020  `analysis/code` 
-0001e660: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
-0001e670: 696e 7075 745f 6473 3a20 636c 6173 7320  input_ds: class 
-0001e680: 6049 6e70 7574 5f64 7360 0a20 2020 2020  `Input_ds`.     
-0001e690: 2020 2020 2020 2069 6e70 7574 2064 6174         input dat
-0001e6a0: 6173 6574 2873 2920 696e 666f 726d 6174  aset(s) informat
-0001e6b0: 696f 6e0a 2020 2020 2020 2020 7479 7065  ion.        type
-0001e6c0: 5f73 6573 7369 6f6e 3a20 7374 720a 2020  _session: str.  
-0001e6d0: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
-0001e6e0: 2d73 6573 2220 6f72 2022 7369 6e67 6c65  -ses" or "single
-0001e6f0: 2d73 6573 222e 0a20 2020 2020 2020 2073  -ses"..        s
-0001e700: 7973 7465 6d3a 2063 6c61 7373 2060 5379  ystem: class `Sy
-0001e710: 7374 656d 600a 2020 2020 2020 2020 2020  stem`.          
-0001e720: 2020 696e 666f 726d 6174 696f 6e20 6f6e    information on
-0001e730: 2063 6c75 7374 6572 206d 616e 6167 656d   cluster managem
-0001e740: 656e 7420 7379 7374 656d 0a20 2020 2020  ent system.     
-0001e750: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0001e760: 2320 5361 6e69 7479 2063 6865 636b 3a0a  # Sanity check:.
-0001e770: 2020 2020 2020 2020 6966 2074 7970 655f          if type_
-0001e780: 7365 7373 696f 6e20 6e6f 7420 696e 205b  session not in [
-0001e790: 226d 756c 7469 2d73 6573 222c 2022 7369  "multi-ses", "si
-0001e7a0: 6e67 6c65 2d73 6573 225d 3a0a 2020 2020  ngle-ses"]:.    
-0001e7b0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001e7c0: 6365 7074 696f 6e28 2249 6e76 616c 6964  ception("Invalid
-0001e7d0: 2060 7479 7065 5f73 6573 7369 6f6e 603a   `type_session`:
-0001e7e0: 2022 202b 2074 7970 655f 7365 7373 696f   " + type_sessio
-0001e7f0: 6e29 0a0a 2020 2020 2020 2020 2320 4368  n)..        # Ch
-0001e800: 6563 6b20 6966 2074 6865 2062 6173 6820  eck if the bash 
-0001e810: 6669 6c65 2061 6c72 6561 6479 2065 7869  file already exi
-0001e820: 7374 3a0a 2020 2020 2020 2020 6966 206f  st:.        if o
-0001e830: 702e 6578 6973 7473 2862 6173 685f 7061  p.exists(bash_pa
-0001e840: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-0001e850: 206f 732e 7265 6d6f 7665 2862 6173 685f   os.remove(bash_
-0001e860: 7061 7468 2920 2023 2072 656d 6f76 6520  path)  # remove 
-0001e870: 6974 0a0a 2020 2020 2020 2020 2320 5772  it..        # Wr
-0001e880: 6974 6520 696e 746f 2074 6865 2062 6173  ite into the bas
-0001e890: 6820 6669 6c65 3a0a 2020 2020 2020 2020  h file:.        
-0001e8a0: 6261 7368 5f66 696c 6520 3d20 6f70 656e  bash_file = open
-0001e8b0: 2862 6173 685f 7061 7468 2c20 2261 2229  (bash_path, "a")
-0001e8c0: 2020 2023 206f 7065 6e20 696e 2061 7070     # open in app
-0001e8d0: 656e 6420 6d6f 6465 0a0a 2020 2020 2020  end mode..      
-0001e8e0: 2020 2320 4e4f 5445 3a20 6e6f 7420 746f    # NOTE: not to
-0001e8f0: 2061 7574 6f6d 6174 6963 616c 6c79 2067   automatically g
-0001e900: 656e 6572 6174 6520 7468 6520 696e 7465  enerate the inte
-0001e910: 7270 7265 7469 6e67 2073 6865 6c6c 3b0a  rpreting shell;.
-0001e920: 2020 2020 2020 2020 2320 2020 696e 7374          #   inst
-0001e930: 6561 642c 206c 6574 2075 7365 7273 2073  ead, let users s
-0001e940: 7065 6369 6679 2069 7420 696e 2074 6865  pecify it in the
-0001e950: 2063 6f6e 7461 696e 6572 2063 6f6e 6669   container confi
-0001e960: 6720 7961 6d6c 2066 696c 650a 2020 2020  g yaml file.    
-0001e970: 2020 2020 2320 2020 7573 696e 6720 6069      #   using `i
-0001e980: 6e74 6572 7072 6574 696e 675f 7368 656c  nterpreting_shel
-0001e990: 6c60 0a0a 2020 2020 2020 2020 2320 436c  l`..        # Cl
-0001e9a0: 7573 7465 7220 7265 736f 7572 6365 7320  uster resources 
-0001e9b0: 7265 7175 6573 7469 6e67 3a0a 2020 2020  requesting:.    
-0001e9c0: 2020 2020 636d 645f 6261 7368 6865 6164      cmd_bashhead
-0001e9d0: 5f72 6573 6f75 7263 6573 203d 2067 656e  _resources = gen
-0001e9e0: 6572 6174 655f 6261 7368 6865 6164 5f72  erate_bashhead_r
-0001e9f0: 6573 6f75 7263 6573 2873 7973 7465 6d2c  esources(system,
-0001ea00: 2073 656c 662e 636f 6e66 6967 290a 2020   self.config).  
-0001ea10: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-0001ea20: 7772 6974 6528 636d 645f 6261 7368 6865  write(cmd_bashhe
-0001ea30: 6164 5f72 6573 6f75 7263 6573 290a 0a20  ad_resources).. 
-0001ea40: 2020 2020 2020 2023 2053 6372 6970 7420         # Script 
-0001ea50: 7072 6561 6d62 6c65 733a 0a20 2020 2020  preambles:.     
-0001ea60: 2020 2063 6d64 5f73 6372 6970 745f 7072     cmd_script_pr
-0001ea70: 6561 6d62 6c65 203d 2067 656e 6572 6174  eamble = generat
-0001ea80: 655f 636d 645f 7363 7269 7074 5f70 7265  e_cmd_script_pre
-0001ea90: 616d 626c 6528 7365 6c66 2e63 6f6e 6669  amble(self.confi
-0001eaa0: 6729 0a20 2020 2020 2020 2062 6173 685f  g).        bash_
-0001eab0: 6669 6c65 2e77 7269 7465 2863 6d64 5f73  file.write(cmd_s
-0001eac0: 6372 6970 745f 7072 6561 6d62 6c65 290a  cript_preamble).
-0001ead0: 0a20 2020 2020 2020 2023 2043 6861 6e67  .        # Chang
-0001eae0: 6520 686f 7720 7468 6973 2062 6173 6820  e how this bash 
-0001eaf0: 6669 6c65 2069 7320 7275 6e3a 0a20 2020  file is run:.   
-0001eb00: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001eb10: 7269 7465 2822 5c6e 2320 4661 696c 2077  rite("\n# Fail w
-0001eb20: 6865 6e65 7665 7220 736f 6d65 7468 696e  henever somethin
-0001eb30: 6720 6973 2066 6973 6879 2c22 0a20 2020  g is fishy,".   
-0001eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb50: 2020 2020 202b 2022 2075 7365 202d 7820       + " use -x 
-0001eb60: 746f 2067 6574 2076 6572 626f 7365 206c  to get verbose l
-0001eb70: 6f67 6669 6c65 733a 5c6e 2229 0a20 2020  ogfiles:\n").   
-0001eb80: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001eb90: 7269 7465 2822 7365 7420 2d65 202d 7520  rite("set -e -u 
-0001eba0: 2d78 5c6e 2229 0a0a 2020 2020 2020 2020  -x\n")..        
-0001ebb0: 2320 496e 7075 7473 206f 6620 7468 6520  # Inputs of the 
-0001ebc0: 6261 7368 2073 6372 6970 743a 0a20 2020  bash script:.   
-0001ebd0: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001ebe0: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
-0001ebf0: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-0001ec00: 7465 2827 6473 736f 7572 6365 3d22 2431  te('dssource="$1
-0001ec10: 225c 7423 2069 2e65 2e2c 2060 696e 7075  "\t# i.e., `inpu
-0001ec20: 745f 7269 6160 5c6e 2729 0a20 2020 2020  t_ria`\n').     
-0001ec30: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-0001ec40: 7465 2827 7075 7368 6769 7472 656d 6f74  te('pushgitremot
-0001ec50: 653d 2224 3222 5c74 2320 692e 652e 2c20  e="$2"\t# i.e., 
-0001ec60: 606f 7574 7075 745f 7269 6160 5c6e 2729  `output_ria`\n')
-0001ec70: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
-0001ec80: 6c65 2e77 7269 7465 2827 7375 6269 643d  le.write('subid=
-0001ec90: 2224 3322 5c6e 2729 0a0a 2020 2020 2020  "$3"\n')..      
-0001eca0: 2020 6966 2074 7970 655f 7365 7373 696f    if type_sessio
-0001ecb0: 6e20 3d3d 2022 6d75 6c74 692d 7365 7322  n == "multi-ses"
-0001ecc0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001ecd0: 616c 736f 2068 6176 6520 7468 6520 696e  also have the in
-0001ece0: 7075 7420 6f66 2060 7365 7369 6460 3a0a  put of `sesid`:.
-0001ecf0: 2020 2020 2020 2020 2020 2020 6261 7368              bash
-0001ed00: 5f66 696c 652e 7772 6974 6528 2773 6573  _file.write('ses
-0001ed10: 6964 3d22 2434 225c 6e27 290a 0a20 2020  id="$4"\n')..   
-0001ed20: 2020 2020 2023 2043 6861 6e67 6520 7061       # Change pa
-0001ed30: 7468 2074 6f20 6120 7465 6d70 6f72 6172  th to a temporar
-0001ed40: 7920 6a6f 6220 636f 6d70 7574 6520 776f  y job compute wo
-0001ed50: 726b 7370 6163 653a 0a20 2020 2020 2020  rkspace:.       
-0001ed60: 2023 2020 2074 6865 2070 6174 6820 6973   #   the path is
-0001ed70: 2062 6173 6564 206f 6e20 7768 6174 2075   based on what u
-0001ed80: 7365 7273 2070 726f 7669 6465 2069 6e20  sers provide in 
-0001ed90: 7365 6374 696f 6e20 276a 6f62 5f63 6f6d  section 'job_com
-0001eda0: 7075 7465 5f73 7061 6365 2720 696e 2059  pute_space' in Y
-0001edb0: 414d 4c20 6669 6c65 3a0a 2020 2020 2020  AML file:.      
-0001edc0: 2020 636d 645f 6a6f 625f 636f 6d70 7574    cmd_job_comput
-0001edd0: 655f 7370 6163 6520 3d20 6765 6e65 7261  e_space = genera
-0001ede0: 7465 5f63 6d64 5f6a 6f62 5f63 6f6d 7075  te_cmd_job_compu
-0001edf0: 7465 5f73 7061 6365 2873 656c 662e 636f  te_space(self.co
-0001ee00: 6e66 6967 290a 2020 2020 2020 2020 6261  nfig).        ba
-0001ee10: 7368 5f66 696c 652e 7772 6974 6528 636d  sh_file.write(cm
-0001ee20: 645f 6a6f 625f 636f 6d70 7574 655f 7370  d_job_compute_sp
-0001ee30: 6163 6529 0a0a 2020 2020 2020 2020 2320  ace)..        # 
-0001ee40: 5365 7475 7073 3a20 2d2d 2d2d 2d2d 2d2d  Setups: --------
-0001ee50: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ee60: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ee70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001ee80: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0001ee90: 2320 7365 7420 7570 2074 6865 2062 7261  # set up the bra
-0001eea0: 6e63 683a 0a20 2020 2020 2020 2062 6173  nch:.        bas
-0001eeb0: 685f 6669 6c65 2e77 7269 7465 2822 5c6e  h_file.write("\n
-0001eec0: 2320 4272 616e 6368 206e 616d 6520 2861  # Branch name (a
-0001eed0: 6c73 6f20 7573 6564 2061 7320 7465 6d70  lso used as temp
-0001eee0: 6f72 6172 7920 6469 7265 6374 6f72 7929  orary directory)
-0001eef0: 3a5c 6e22 290a 2020 2020 2020 2020 6966  :\n").        if
-0001ef00: 2073 7973 7465 6d2e 7479 7065 203d 3d20   system.type == 
-0001ef10: 2273 6765 223a 0a20 2020 2020 2020 2020  "sge":.         
-0001ef20: 2020 2076 6172 6e61 6d65 5f6a 6f62 6964     varname_jobid
-0001ef30: 203d 2022 4a4f 425f 4944 220a 2020 2020   = "JOB_ID".    
-0001ef40: 2020 2020 656c 6966 2073 7973 7465 6d2e      elif system.
-0001ef50: 7479 7065 203d 3d20 2273 6c75 726d 223a  type == "slurm":
-0001ef60: 0a20 2020 2020 2020 2020 2020 2076 6172  .            var
-0001ef70: 6e61 6d65 5f6a 6f62 6964 203d 2022 534c  name_jobid = "SL
-0001ef80: 5552 4d5f 4a4f 4249 4422 0a0a 2020 2020  URM_JOBID"..    
-0001ef90: 2020 2020 6966 2074 7970 655f 7365 7373      if type_sess
-0001efa0: 696f 6e20 3d3d 2022 6d75 6c74 692d 7365  ion == "multi-se
-0001efb0: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-0001efc0: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
-0001efd0: 2742 5241 4e43 483d 226a 6f62 2d24 7b27  'BRANCH="job-${'
-0001efe0: 202b 2076 6172 6e61 6d65 5f6a 6f62 6964   + varname_jobid
-0001eff0: 202b 2027 7d2d 247b 7375 6269 647d 2d24   + '}-${subid}-$
-0001f000: 7b73 6573 6964 7d22 2720 2b20 275c 6e27  {sesid}"' + '\n'
-0001f010: 290a 2020 2020 2020 2020 656c 6966 2074  ).        elif t
-0001f020: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
-0001f030: 7369 6e67 6c65 2d73 6573 223a 0a20 2020  single-ses":.   
-0001f040: 2020 2020 2020 2020 2062 6173 685f 6669           bash_fi
-0001f050: 6c65 2e77 7269 7465 2827 4252 414e 4348  le.write('BRANCH
-0001f060: 3d22 6a6f 622d 247b 2720 2b20 7661 726e  ="job-${' + varn
-0001f070: 616d 655f 6a6f 6269 6420 2b20 277d 2d24  ame_jobid + '}-$
-0001f080: 7b73 7562 6964 7d22 2720 2b20 275c 6e27  {subid}"' + '\n'
-0001f090: 290a 0a20 2020 2020 2020 2062 6173 685f  )..        bash_
-0001f0a0: 6669 6c65 2e77 7269 7465 2827 6d6b 6469  file.write('mkdi
-0001f0b0: 7220 247b 4252 414e 4348 7d27 202b 2027  r ${BRANCH}' + '
-0001f0c0: 5c6e 2729 0a20 2020 2020 2020 2062 6173  \n').        bas
-0001f0d0: 685f 6669 6c65 2e77 7269 7465 2827 6364  h_file.write('cd
-0001f0e0: 2024 7b42 5241 4e43 487d 2720 2b20 275c   ${BRANCH}' + '\
-0001f0f0: 6e27 290a 0a20 2020 2020 2020 2023 2064  n')..        # d
-0001f100: 6174 616c 6164 2063 6c6f 6e65 2074 6865  atalad clone the
-0001f110: 2069 6e70 7574 2072 6961 3a0a 2020 2020   input ria:.    
-0001f120: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
-0001f130: 6974 6528 225c 6e23 2043 6c6f 6e65 2074  ite("\n# Clone t
-0001f140: 6865 2064 6174 6120 6672 6f6d 2069 6e70  he data from inp
-0001f150: 7574 2052 4941 3a5c 6e22 290a 2020 2020  ut RIA:\n").    
+0001a150: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
+0001a160: 662e 6466 5b22 6e61 6d65 225d 5b69 5f64  f.df["name"][i_d
+0001a170: 735d 202b 2022 2a2e 7a69 7027 2229 0a20  s] + "*.zip'"). 
+0001a180: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a190: 6c69 6620 7479 7065 5f73 6573 7369 6f6e  lif type_session
+0001a1a0: 203d 3d20 2273 696e 676c 652d 7365 7322   == "single-ses"
+0001a1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a1c0: 2020 2020 2020 7465 6d70 5f6c 6973 7420        temp_list 
+0001a1d0: 3d20 676c 6f62 2e67 6c6f 6228 7365 6c66  = glob.glob(self
+0001a1e0: 2e64 665b 2270 6174 685f 6e6f 775f 6162  .df["path_now_ab
+0001a1f0: 7322 5d5b 695f 6473 5d0a 2020 2020 2020  s"][i_ds].      
+0001a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a220: 2020 2020 2b20 222f 7375 622d 2a5f 2220      + "/sub-*_" 
+0001a230: 2b20 7365 6c66 2e64 665b 226e 616d 6522  + self.df["name"
+0001a240: 5d5b 695f 6473 5d20 2b20 222a 2e7a 6970  ][i_ds] + "*.zip
+0001a250: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001a260: 2020 2020 2020 2074 656d 705f 6c69 7374         temp_list
+0001a270: 203d 2073 6f72 7465 6428 7465 6d70 5f6c   = sorted(temp_l
+0001a280: 6973 7429 2020 2023 2073 6f72 7420 6279  ist)   # sort by
+0001a290: 206e 616d 650a 2020 2020 2020 2020 2020   name.          
+0001a2a0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001a2b0: 2874 656d 705f 6c69 7374 2920 3d3d 2030  (temp_list) == 0
+0001a2c0: 3a20 2020 2023 2064 6964 206e 6f74 2066  :    # did not f
+0001a2d0: 696e 6420 616e 7920 6d61 7463 6865 640a  ind any matched.
+0001a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2f0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001a300: 6365 7074 696f 6e28 2249 6e20 7a69 7070  ception("In zipp
+0001a310: 6564 2069 6e70 7574 2064 6174 6173 6574  ed input dataset
+0001a320: 2023 2220 2b20 7374 7228 695f 6473 202b   #" + str(i_ds +
+0001a330: 2031 290a 2020 2020 2020 2020 2020 2020   1).            
+0001a340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a350: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
+0001a360: 286e 616d 6564 2027 2220 2b20 7365 6c66  (named '" + self
+0001a370: 2e64 665b 226e 616d 6522 5d5b 695f 6473  .df["name"][i_ds
+0001a380: 5d20 2b20 2227 292c 220a 2020 2020 2020  ] + "'),".      
+0001a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3b0: 2020 2b20 2220 6e6f 207a 6970 2066 696c    + " no zip fil
+0001a3c0: 656e 616d 6520 6d61 7463 6865 7320 7468  ename matches th
+0001a3d0: 6520 7061 7474 6572 6e20 6f66 220a 2020  e pattern of".  
+0001a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a400: 2020 2020 2020 2b20 2220 2773 7562 2d2a        + " 'sub-*
+0001a410: 5f22 0a20 2020 2020 2020 2020 2020 2020  _".             
+0001a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a430: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
+0001a440: 662e 6466 5b22 6e61 6d65 225d 5b69 5f64  f.df["name"][i_d
+0001a450: 735d 202b 2022 2a2e 7a69 7027 2229 0a20  s] + "*.zip'"). 
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a470: 2020 2023 206e 6f74 2074 6f20 6368 6563     # not to chec
+0001a480: 6b20 6265 6c6f 7720 7374 7566 6620 616e  k below stuff an
+0001a490: 796d 6f72 653a 0a20 2020 2020 2020 2020  ymore:.         
+0001a4a0: 2020 2020 2020 2020 2020 2023 2023 2061             # # a
+0001a4b0: 6c73 6f20 6368 6563 6b20 7468 6572 6520  lso check there 
+0001a4c0: 7368 6f75 6c64 206e 6f74 2062 6520 605f  should not be `_
+0001a4d0: 7365 732d 2a5f 600a 2020 2020 2020 2020  ses-*_`.        
+0001a4e0: 2020 2020 2020 2020 2020 2020 2320 7465              # te
+0001a4f0: 6d70 5f6c 6973 745f 3220 3d20 676c 6f62  mp_list_2 = glob
+0001a500: 2e67 6c6f 6228 7365 6c66 2e64 665b 2270  .glob(self.df["p
+0001a510: 6174 685f 6e6f 775f 6162 7322 5d5b 695f  ath_now_abs"][i_
+0001a520: 6473 5d0a 2020 2020 2020 2020 2020 2020  ds].            
+0001a530: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a550: 2020 2b20 222f 2a5f 7365 732d 2a5f 2a2e    + "/*_ses-*_*.
+0001a560: 7a69 7022 290a 2020 2020 2020 2020 2020  zip").          
+0001a570: 2020 2020 2020 2020 2020 2320 6966 206c            # if l
+0001a580: 656e 2874 656d 705f 6c69 7374 5f32 2920  en(temp_list_2) 
+0001a590: 3e20 303a 2020 2023 2065 7869 7374 733a  > 0:   # exists:
+0001a5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a5b0: 2020 2020 2023 2020 2020 2072 6169 7365       #     raise
+0001a5c0: 2045 7863 6570 7469 6f6e 2822 496e 207a   Exception("In z
+0001a5d0: 6970 7065 6420 696e 7075 7420 6461 7461  ipped input data
+0001a5e0: 7365 7420 2322 202b 2073 7472 2869 5f64  set #" + str(i_d
+0001a5f0: 7320 2b20 3129 0a20 2020 2020 2020 2020  s + 1).         
+0001a600: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a620: 202b 2022 2028 6e61 6d65 6420 2722 202b   + " (named '" +
+0001a630: 2073 656c 662e 6466 5b22 6e61 6d65 225d   self.df["name"]
+0001a640: 5b69 5f64 735d 202b 2022 2729 2c22 0a20  [i_ds] + "'),". 
+0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a660: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0001a670: 2020 2020 2020 2020 202b 2022 2061 7320           + " as 
+0001a680: 6974 2773 2061 2073 696e 676c 652d 7365  it's a single-se
+0001a690: 7320 6461 7461 7365 742c 220a 2020 2020  s dataset,".    
+0001a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6b0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001a6c0: 2020 2020 2020 2b20 2220 7a69 7020 6669        + " zip fi
+0001a6d0: 6c65 6e61 6d65 2073 686f 756c 6420 6e6f  lename should no
+0001a6e0: 7420 636f 6e74 6169 6e22 0a20 2020 2020  t contain".     
+0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a710: 2020 2020 202b 2022 2027 5f73 6573 2d2a       + " '_ses-*
+0001a720: 5f27 2229 0a0a 2020 2020 2020 2020 2020  _'")..          
+0001a730: 2020 2020 2020 2320 5361 6e69 7479 2063        # Sanity c
+0001a740: 6865 636b 2023 323a 2066 6f6c 6465 726e  heck #2: foldern
+0001a750: 616d 6520 7769 7468 696e 207a 6970 7065  ame within zippe
+0001a760: 6420 6669 6c65 3a20 2d2d 2d2d 2d2d 2d2d  d file: --------
+0001a770: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+0001a780: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0001a790: 5f7a 6970 6669 6c65 203d 2074 656d 705f  _zipfile = temp_
+0001a7a0: 6c69 7374 5b30 5d20 2020 2320 7472 7920  list[0]   # try 
+0001a7b0: 6f75 7420 7468 6520 6669 7273 7420 7a69  out the first zi
+0001a7c0: 7066 696c 650a 2020 2020 2020 2020 2020  pfile.          
+0001a7d0: 2020 2020 2020 7465 6d70 5f7a 6970 6669        temp_zipfi
+0001a7e0: 6c65 6e61 6d65 203d 206f 702e 6261 7365  lename = op.base
+0001a7f0: 6e61 6d65 2874 656d 705f 7a69 7066 696c  name(temp_zipfil
+0001a800: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001a810: 2020 2064 6c61 7069 2e67 6574 2870 6174     dlapi.get(pat
+0001a820: 683d 7465 6d70 5f7a 6970 6669 6c65 2c20  h=temp_zipfile, 
+0001a830: 6461 7461 7365 743d 7365 6c66 2e64 665b  dataset=self.df[
+0001a840: 2270 6174 685f 6e6f 775f 6162 7322 5d5b  "path_now_abs"][
+0001a850: 695f 6473 5d29 0a20 2020 2020 2020 2020  i_ds]).         
+0001a860: 2020 2020 2020 2023 2075 6e7a 6970 2074         # unzip t
+0001a870: 6f20 6120 7465 6d70 6f72 6172 7920 666f  o a temporary fo
+0001a880: 6c64 6572 2061 6e64 2067 6574 2074 6865  lder and get the
+0001a890: 2066 6f6c 6465 726e 616d 650a 2020 2020   foldername.    
+0001a8a0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0001a8b0: 5f75 6e7a 6970 5f74 6f20 3d20 7465 6d70  _unzip_to = temp
+0001a8c0: 6669 6c65 2e6d 6b64 7465 6d70 2829 0a20  file.mkdtemp(). 
+0001a8d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a8e0: 6875 7469 6c2e 756e 7061 636b 5f61 7263  hutil.unpack_arc
+0001a8f0: 6869 7665 2874 656d 705f 7a69 7066 696c  hive(temp_zipfil
+0001a900: 652c 2074 656d 705f 756e 7a69 705f 746f  e, temp_unzip_to
+0001a910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a920: 2020 6c69 7374 5f75 6e7a 6970 5f66 6f6c    list_unzip_fol
+0001a930: 6465 726e 616d 6573 203d 2067 6574 5f69  dernames = get_i
+0001a940: 6d6d 6564 6961 7465 5f73 7562 6469 7265  mmediate_subdire
+0001a950: 6374 6f72 6965 7328 7465 6d70 5f75 6e7a  ctories(temp_unz
+0001a960: 6970 5f74 6f29 0a20 2020 2020 2020 2020  ip_to).         
+0001a970: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
+0001a980: 7468 6520 7465 6d70 6f72 6172 7920 666f  the temporary fo
+0001a990: 6c64 6572 3a0a 2020 2020 2020 2020 2020  lder:.          
+0001a9a0: 2020 2020 2020 7368 7574 696c 2e72 6d74        shutil.rmt
+0001a9b0: 7265 6528 7465 6d70 5f75 6e7a 6970 5f74  ree(temp_unzip_t
+0001a9c0: 6f29 0a20 2020 2020 2020 2020 2020 2020  o).             
+0001a9d0: 2020 2023 2060 6461 7461 6c61 6420 6472     # `datalad dr
+0001a9e0: 6f70 6020 7468 6520 7a69 7066 696c 653a  op` the zipfile:
+0001a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aa00: 2064 6c61 7069 2e64 726f 7028 7061 7468   dlapi.drop(path
+0001aa10: 3d74 656d 705f 7a69 7066 696c 652c 2064  =temp_zipfile, d
+0001aa20: 6174 6173 6574 3d73 656c 662e 6466 5b22  ataset=self.df["
+0001aa30: 7061 7468 5f6e 6f77 5f61 6273 225d 5b69  path_now_abs"][i
+0001aa40: 5f64 735d 290a 0a20 2020 2020 2020 2020  _ds])..         
+0001aa50: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+0001aa60: 6620 7468 6572 6520 6973 2066 6f6c 6465  f there is folde
+0001aa70: 7220 6e61 6d65 6420 6173 2064 7327 7320  r named as ds's 
+0001aa80: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
+0001aa90: 2020 2020 2020 6966 2073 656c 662e 6466        if self.df
+0001aaa0: 5b22 6e61 6d65 225d 5b69 5f64 735d 206e  ["name"][i_ds] n
+0001aab0: 6f74 2069 6e20 6c69 7374 5f75 6e7a 6970  ot in list_unzip
+0001aac0: 5f66 6f6c 6465 726e 616d 6573 3a0a 2020  _foldernames:.  
+0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aae0: 2020 7761 726e 696e 6773 2e77 6172 6e28    warnings.warn(
+0001aaf0: 2249 6e20 696e 7075 7420 6461 7461 7365  "In input datase
+0001ab00: 7420 2322 202b 2073 7472 2869 5f64 7320  t #" + str(i_ds 
+0001ab10: 2b20 3129 0a20 2020 2020 2020 2020 2020  + 1).           
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab30: 2020 2020 2020 202b 2022 2028 6e61 6d65         + " (name
+0001ab40: 6420 2722 202b 2073 656c 662e 6466 5b22  d '" + self.df["
+0001ab50: 6e61 6d65 225d 5b69 5f64 735d 0a20 2020  name"][i_ds].   
+0001ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab70: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001ab80: 2022 2729 2c20 7468 6572 6520 6973 206e   "'), there is n
+0001ab90: 6f20 666f 6c64 6572 2063 616c 6c65 6420  o folder called 
+0001aba0: 2722 0a20 2020 2020 2020 2020 2020 2020  '".             
+0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abc0: 2020 2020 202b 2073 656c 662e 6466 5b22       + self.df["
+0001abd0: 6e61 6d65 225d 5b69 5f64 735d 202b 2022  name"][i_ds] + "
+0001abe0: 2720 696e 207a 6970 7065 6420 696e 7075  ' in zipped inpu
+0001abf0: 7420 6669 6c65 2027 220a 2020 2020 2020  t file '".      
+0001ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac10: 2020 2020 2020 2020 2020 2020 2b20 7465              + te
+0001ac20: 6d70 5f7a 6970 6669 6c65 6e61 6d65 202b  mp_zipfilename +
+0001ac30: 2022 272e 2054 6869 7320 6d61 7920 6361   "'. This may ca
+0001ac40: 7573 6520 6572 726f 7222 0a20 2020 2020  use error".     
+0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac60: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0001ac70: 2077 6865 6e20 7275 6e6e 696e 6720 4249   when running BI
+0001ac80: 4453 2041 7070 2066 6f72 2074 6869 7320  DS App for this 
+0001ac90: 7375 626a 6563 742f 7365 7373 696f 6e22  subject/session"
+0001aca0: 290a 0a0a 636c 6173 7320 5379 7374 656d  )...class System
+0001acb0: 2829 3a0a 2020 2020 2222 2254 6869 7320  ():.    """This 
+0001acc0: 636c 6173 7320 6973 2066 6f72 2063 6c75  class is for clu
+0001acd0: 7374 6572 206d 616e 6167 656d 656e 7420  ster management 
+0001ace0: 7379 7374 656d 2222 220a 0a20 2020 2064  system"""..    d
+0001acf0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0001ad00: 2c20 7379 7374 656d 5f74 7970 6529 3a0a  , system_type):.
+0001ad10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ad20: 2020 2020 5468 6973 2069 7320 746f 2069      This is to i
+0001ad30: 6e69 7469 616c 697a 6520 5379 7374 656d  nitialize System
+0001ad40: 2063 6c61 7373 2e0a 0a20 2020 2020 2020   class...       
+0001ad50: 2050 6172 616d 6574 6572 733a 0a20 2020   Parameters:.   
+0001ad60: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d       -----------
+0001ad70: 2d2d 0a20 2020 2020 2020 2073 7973 7465  --.        syste
+0001ad80: 6d5f 7479 7065 3a20 7374 720a 2020 2020  m_type: str.    
+0001ad90: 2020 2020 2020 2020 5479 7065 206f 6620          Type of 
+0001ada0: 7468 6520 636c 7573 7465 7220 6d61 6e61  the cluster mana
+0001adb0: 6765 6d65 6e74 2073 7973 7465 6d2e 0a20  gement system.. 
+0001adc0: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
+0001add0: 6e73 2061 7265 3a20 2273 6765 2220 616e  ns are: "sge" an
+0001ade0: 6420 2273 6c75 726d 220a 0a20 2020 2020  d "slurm"..     
+0001adf0: 2020 2041 7474 7269 6275 7465 733a 0a20     Attributes:. 
+0001ae00: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001ae10: 2d2d 2d2d 0a20 2020 2020 2020 2074 7970  ----.        typ
+0001ae20: 653a 2073 7472 0a20 2020 2020 2020 2020  e: str.         
+0001ae30: 2020 2054 7970 6520 6f66 2074 6865 2063     Type of the c
+0001ae40: 6c75 7374 6572 206d 616e 6167 656d 656e  luster managemen
+0001ae50: 7420 7379 7374 656d 2e0a 2020 2020 2020  t system..      
+0001ae60: 2020 2020 2020 4f70 7469 6f6e 7320 6172        Options ar
+0001ae70: 653a 2022 7367 6522 2061 6e64 2022 736c  e: "sge" and "sl
+0001ae80: 7572 6d22 0a20 2020 2020 2020 2064 6963  urm".        dic
+0001ae90: 743a 2064 6963 740a 2020 2020 2020 2020  t: dict.        
+0001aea0: 2020 2020 4775 6964 616e 6365 2064 6963      Guidance dic
+0001aeb0: 7420 286c 6f61 6465 6420 6672 6f6d 2060  t (loaded from `
+0001aec0: 6469 6374 5f63 6c75 7374 6572 5f73 7973  dict_cluster_sys
+0001aed0: 7465 6d73 2e79 616d 6c60 290a 2020 2020  tems.yaml`).    
+0001aee0: 2020 2020 2020 2020 666f 7220 686f 7720          for how 
+0001aef0: 746f 2072 756e 2074 6869 7320 7479 7065  to run this type
+0001af00: 206f 6620 636c 7573 7465 722e 0a20 2020   of cluster..   
+0001af10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001af20: 2023 2076 616c 6964 6174 6520 616e 6420   # validate and 
+0001af30: 6173 7369 676e 2074 6f20 6174 7472 6962  assign to attrib
+0001af40: 7574 6520 6074 7970 6560 3a0a 2020 2020  ute `type`:.    
+0001af50: 2020 2020 7365 6c66 2e74 7970 6520 3d20      self.type = 
+0001af60: 7661 6c69 6461 7465 5f74 7970 655f 7379  validate_type_sy
+0001af70: 7374 656d 2873 7973 7465 6d5f 7479 7065  stem(system_type
+0001af80: 290a 0a20 2020 2020 2020 2023 2067 6574  )..        # get
+0001af90: 2061 7474 7269 6275 7465 2060 6469 6374   attribute `dict
+0001afa0: 6020 2d20 7468 6520 6775 6964 616e 6365  ` - the guidance
+0001afb0: 2064 6963 7420 666f 7220 686f 7720 746f   dict for how to
+0001afc0: 2072 756e 2074 6869 7320 7479 7065 206f   run this type o
+0001afd0: 6620 636c 7573 7465 723a 0a20 2020 2020  f cluster:.     
+0001afe0: 2020 2073 656c 662e 6765 745f 6469 6374     self.get_dict
+0001aff0: 2829 0a0a 2020 2020 6465 6620 6765 745f  ()..    def get_
+0001b000: 6469 6374 2873 656c 6629 3a0a 2020 2020  dict(self):.    
+0001b010: 2020 2020 2320 6c6f 6361 7469 6f6e 206f      # location o
+0001b020: 6620 6375 7272 656e 7420 7079 7468 6f6e  f current python
+0001b030: 2073 6372 6970 743a 0a20 2020 2020 2020   script:.       
+0001b040: 2023 2020 2060 6f70 2e61 6273 7061 7468   #   `op.abspath
+0001b050: 2829 6020 6973 2074 6f20 6d61 6b65 2073  ()` is to make s
+0001b060: 7572 6520 616c 7761 7973 2072 6574 7572  ure always retur
+0001b070: 6e73 2061 6273 2070 6174 682c 2072 6567  ns abs path, reg
+0001b080: 6172 646c 6573 7320 6f66 2070 7974 686f  ardless of pytho
+0001b090: 6e20 7665 7273 696f 6e0a 2020 2020 2020  n version.      
+0001b0a0: 2020 2320 2020 7265 663a 2068 7474 7073    #   ref: https
+0001b0b0: 3a2f 2f6e 6f74 652e 6e6b 6d6b 2e6d 652f  ://note.nkmk.me/
+0001b0c0: 656e 2f70 7974 686f 6e2d 7363 7269 7074  en/python-script
+0001b0d0: 2d66 696c 652d 7061 7468 2f0a 2020 2020  -file-path/.    
+0001b0e0: 2020 2020 5f5f 6c6f 6361 7469 6f6e 5f5f      __location__
+0001b0f0: 203d 206f 702e 7265 616c 7061 7468 286f   = op.realpath(o
+0001b100: 702e 6469 726e 616d 6528 6f70 2e61 6273  p.dirname(op.abs
+0001b110: 7061 7468 285f 5f66 696c 655f 5f29 2929  path(__file__)))
+0001b120: 0a0a 2020 2020 2020 2020 666e 5f64 6963  ..        fn_dic
+0001b130: 745f 636c 7573 7465 725f 7379 7374 656d  t_cluster_system
+0001b140: 735f 7961 6d6c 203d 206f 702e 6a6f 696e  s_yaml = op.join
+0001b150: 285f 5f6c 6f63 6174 696f 6e5f 5f2c 2022  (__location__, "
+0001b160: 6469 6374 5f63 6c75 7374 6572 5f73 7973  dict_cluster_sys
+0001b170: 7465 6d73 2e79 616d 6c22 290a 2020 2020  tems.yaml").    
+0001b180: 2020 2020 7769 7468 206f 7065 6e28 666e      with open(fn
+0001b190: 5f64 6963 745f 636c 7573 7465 725f 7379  _dict_cluster_sy
+0001b1a0: 7374 656d 735f 7961 6d6c 2920 6173 2066  stems_yaml) as f
+0001b1b0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+0001b1c0: 6374 203d 2079 616d 6c2e 6c6f 6164 2866  ct = yaml.load(f
+0001b1d0: 2c20 4c6f 6164 6572 3d79 616d 6c2e 4675  , Loader=yaml.Fu
+0001b1e0: 6c6c 4c6f 6164 6572 290a 2020 2020 2020  llLoader).      
+0001b1f0: 2020 2020 2020 2320 5e5e 2064 6963 7420        # ^^ dict 
+0001b200: 6973 2061 2064 6963 743b 2065 6c65 6d65  is a dict; eleme
+0001b210: 6e74 7320 6361 6e20 6265 2061 6363 6573  nts can be acces
+0001b220: 7365 6420 6279 2060 6469 6374 5b22 6b65  sed by `dict["ke
+0001b230: 7922 5d5b 2273 7562 2d6b 6579 225d 600a  y"]["sub-key"]`.
+0001b240: 0a20 2020 2020 2020 2023 2073 616e 6974  .        # sanit
+0001b250: 7920 6368 6563 6b3a 0a20 2020 2020 2020  y check:.       
+0001b260: 2069 6620 7365 6c66 2e74 7970 6520 6e6f   if self.type no
+0001b270: 7420 696e 2064 6963 743a 0a20 2020 2020  t in dict:.     
+0001b280: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0001b290: 6570 7469 6f6e 2822 5468 6572 6520 6973  eption("There is
+0001b2a0: 206e 6f20 6b65 7920 6361 6c6c 6564 2027   no key called '
+0001b2b0: 2220 2b20 7365 6c66 2e74 7970 6520 2b20  " + self.type + 
+0001b2c0: 2227 2069 6e22 0a20 2020 2020 2020 2020  "' in".         
+0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2e0: 2020 202b 2022 2066 696c 6520 6064 6963     + " file `dic
+0001b2f0: 745f 636c 7573 7465 725f 7379 7374 656d  t_cluster_system
+0001b300: 732e 7961 6d6c 6021 2229 0a0a 2020 2020  s.yaml`!")..    
+0001b310: 2020 2020 7365 6c66 2e64 6963 7420 3d20      self.dict = 
+0001b320: 6469 6374 5b73 656c 662e 7479 7065 5d0a  dict[self.type].
+0001b330: 2020 2020 2020 2020 662e 636c 6f73 6528          f.close(
+0001b340: 290a 0a0a 636c 6173 7320 436f 6e74 6169  )...class Contai
+0001b350: 6e65 7228 293a 0a20 2020 2022 2222 5468  ner():.    """Th
+0001b360: 6973 2063 6c61 7373 2069 7320 666f 7220  is class is for 
+0001b370: 7468 6520 4249 4453 2041 7070 2043 6f6e  the BIDS App Con
+0001b380: 7461 696e 6572 2222 220a 0a20 2020 2064  tainer"""..    d
+0001b390: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0001b3a0: 2c20 636f 6e74 6169 6e65 725f 6473 2c20  , container_ds, 
+0001b3b0: 636f 6e74 6169 6e65 725f 6e61 6d65 2c20  container_name, 
+0001b3c0: 636f 6e66 6967 5f79 616d 6c5f 6669 6c65  config_yaml_file
+0001b3d0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001b3e0: 2020 2020 2020 2054 6869 7320 6973 2074         This is t
+0001b3f0: 6f20 696e 6974 6961 6c69 7a65 2043 6f6e  o initialize Con
+0001b400: 7461 696e 6572 2063 6c61 7373 2e0a 0a20  tainer class... 
+0001b410: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0001b420: 733a 0a20 2020 2020 2020 202d 2d2d 2d2d  s:.        -----
+0001b430: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0001b440: 2020 636f 6e74 6169 6e65 725f 6473 3a20    container_ds: 
+0001b450: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+0001b460: 5468 6520 7061 7468 2074 6f20 7468 6520  The path to the 
+0001b470: 636f 6e74 6169 6e65 7220 6461 7461 6c61  container datala
+0001b480: 6420 6461 7461 7365 7420 6173 2074 6865  d dataset as the
+0001b490: 2069 6e70 7574 206f 6620 6062 6162 732d   input of `babs-
+0001b4a0: 696e 6974 602e 0a20 2020 2020 2020 2020  init`..         
+0001b4b0: 2020 2054 6869 7320 636f 6e74 6169 6e65     This containe
+0001b4c0: 7220 6461 7461 6c61 6420 6473 2069 7320  r datalad ds is 
+0001b4d0: 7072 6570 6172 6564 2062 7920 7468 6520  prepared by the 
+0001b4e0: 7573 6572 2e0a 2020 2020 2020 2020 636f  user..        co
+0001b4f0: 6e74 6169 6e65 725f 6e61 6d65 3a20 7374  ntainer_name: st
+0001b500: 720a 2020 2020 2020 2020 2020 2020 5468  r.            Th
+0001b510: 6520 6e61 6d65 206f 6620 7468 6520 636f  e name of the co
+0001b520: 6e74 6169 6e65 7220 7768 656e 2061 6464  ntainer when add
+0001b530: 696e 6720 746f 2064 6174 616c 6164 2064  ing to datalad d
+0001b540: 6174 6173 6574 2865 2e67 2e2c 2060 4e41  ataset(e.g., `NA
+0001b550: 4d45 6020 696e 0a20 2020 2020 2020 2020  ME` in.         
+0001b560: 2020 2060 6461 7461 6c61 6420 636f 6e74     `datalad cont
+0001b570: 6169 6e65 7273 2d61 6464 204e 414d 4560  ainers-add NAME`
+0001b580: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001b590: 652e 672e 2c20 666d 7269 7072 6570 2d30  e.g., fmriprep-0
+0001b5a0: 2d30 2d30 0a20 2020 2020 2020 2063 6f6e  -0-0.        con
+0001b5b0: 6669 675f 7961 6d6c 5f66 696c 653a 2073  fig_yaml_file: s
+0001b5c0: 7472 0a20 2020 2020 2020 2020 2020 2054  tr.            T
+0001b5d0: 6865 2059 414d 4c20 6669 6c65 2074 6861  he YAML file tha
+0001b5e0: 7420 636f 6e74 6169 6e73 2074 6865 2063  t contains the c
+0001b5f0: 6f6e 6669 6775 7261 7469 6f6e 7320 6f66  onfigurations of
+0001b600: 2068 6f77 2074 6f20 7275 6e20 7468 6520   how to run the 
+0001b610: 636f 6e74 6169 6e65 720a 0a20 2020 2020  container..     
+0001b620: 2020 2041 7474 7269 6275 7465 733a 0a20     Attributes:. 
+0001b630: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0001b640: 2d2d 2d2d 2d0a 2020 2020 2020 2020 636f  -----.        co
+0001b650: 6e74 6169 6e65 725f 6473 3a20 7374 720a  ntainer_ds: str.
+0001b660: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001b670: 7061 7468 2074 6f20 7468 6520 636f 6e74  path to the cont
+0001b680: 6169 6e65 7220 6461 7461 6c61 6420 6461  ainer datalad da
+0001b690: 7461 7365 7420 6173 2074 6865 2069 6e70  taset as the inp
+0001b6a0: 7574 206f 6620 6062 6162 732d 696e 6974  ut of `babs-init
+0001b6b0: 602e 0a20 2020 2020 2020 2020 2020 2054  `..            T
+0001b6c0: 6869 7320 636f 6e74 6169 6e65 7220 6461  his container da
+0001b6d0: 7461 6c61 6420 6473 2069 7320 7072 6570  talad ds is prep
+0001b6e0: 6172 6564 2062 7920 7468 6520 7573 6572  ared by the user
+0001b6f0: 2c20 6e6f 7420 7468 6520 636c 6f6e 6564  , not the cloned
+0001b700: 206f 6e65 2e0a 2020 2020 2020 2020 636f   one..        co
+0001b710: 6e74 6169 6e65 725f 6e61 6d65 3a20 7374  ntainer_name: st
+0001b720: 720a 2020 2020 2020 2020 2020 2020 5468  r.            Th
+0001b730: 6520 6e61 6d65 206f 6620 7468 6520 636f  e name of the co
+0001b740: 6e74 6169 6e65 7220 7768 656e 2061 6464  ntainer when add
+0001b750: 696e 6720 746f 2064 6174 616c 6164 2064  ing to datalad d
+0001b760: 6174 6173 6574 2865 2e67 2e2c 2060 4e41  ataset(e.g., `NA
+0001b770: 4d45 6020 696e 0a20 2020 2020 2020 2020  ME` in.         
+0001b780: 2020 2060 6461 7461 6c61 6420 636f 6e74     `datalad cont
+0001b790: 6169 6e65 7273 2d61 6464 204e 414d 4560  ainers-add NAME`
+0001b7a0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001b7b0: 652e 672e 2c20 666d 7269 7072 6570 2d30  e.g., fmriprep-0
+0001b7c0: 2d30 2d30 0a20 2020 2020 2020 2063 6f6e  -0-0.        con
+0001b7d0: 6669 675f 7961 6d6c 5f66 696c 653a 2073  fig_yaml_file: s
+0001b7e0: 7472 0a20 2020 2020 2020 2020 2020 2054  tr.            T
+0001b7f0: 6865 2059 414d 4c20 6669 6c65 2074 6861  he YAML file tha
+0001b800: 7420 636f 6e74 6169 6e73 2074 6865 2063  t contains the c
+0001b810: 6f6e 6669 6775 7261 7469 6f6e 7320 6f66  onfigurations of
+0001b820: 2068 6f77 2074 6f20 7275 6e20 7468 6520   how to run the 
+0001b830: 636f 6e74 6169 6e65 720a 2020 2020 2020  container.      
+0001b840: 2020 2020 2020 5468 6973 2069 7320 6f70        This is op
+0001b850: 7469 6f6e 616c 2061 7267 756d 656e 7420  tional argument 
+0001b860: 286f 6620 7468 6520 434c 4920 6062 6162  (of the CLI `bab
+0001b870: 732d 696e 6974 6029 0a20 2020 2020 2020  s-init`).       
+0001b880: 2063 6f6e 6669 673a 2064 6963 740a 2020   config: dict.  
+0001b890: 2020 2020 2020 2020 2020 5468 6520 636f            The co
+0001b8a0: 6e66 6967 7572 6174 696f 6e73 2072 6567  nfigurations reg
+0001b8b0: 6172 6469 6e67 2072 756e 6e69 6e67 2074  arding running t
+0001b8c0: 6865 2042 4944 5320 4170 7020 6f6e 2061  he BIDS App on a
+0001b8d0: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
+0001b8e0: 2020 2020 2072 6561 6420 6672 6f6d 2060       read from `
+0001b8f0: 636f 6e66 6967 5f79 616d 6c5f 6669 6c65  config_yaml_file
+0001b900: 602e 0a20 2020 2020 2020 2063 6f6e 7461  `..        conta
+0001b910: 696e 6572 5f70 6174 685f 7265 6c54 6f41  iner_path_relToA
+0001b920: 6e61 6c79 7369 733a 2073 7472 0a20 2020  nalysis: str.   
+0001b930: 2020 2020 2020 2020 2054 6865 2070 6174           The pat
+0001b940: 6820 746f 2074 6865 2063 6f6e 7461 696e  h to the contain
+0001b950: 6572 2069 6d61 6765 2073 6176 6564 2069  er image saved i
+0001b960: 6e20 4241 4253 2070 726f 6a65 6374 3b0a  n BABS project;.
+0001b970: 2020 2020 2020 2020 2020 2020 7468 6973              this
+0001b980: 2070 6174 6820 6973 2072 656c 6174 6976   path is relativ
+0001b990: 6520 746f 2060 616e 616c 7973 6973 6020  e to `analysis` 
+0001b9a0: 666f 6c64 6572 2e0a 2020 2020 2020 2020  folder..        
+0001b9b0: 2020 2020 652e 672e 2c20 6063 6f6e 7461      e.g., `conta
+0001b9c0: 696e 6572 732f 2e64 6174 616c 6164 2f65  iners/.datalad/e
+0001b9d0: 6e76 6972 6f6e 6d65 6e74 732f 666d 7269  nvironments/fmri
+0001b9e0: 7072 6570 2d30 2d30 2d30 2f69 6d61 6765  prep-0-0-0/image
+0001b9f0: 600a 2020 2020 2020 2020 2020 2020 5468  `.            Th
+0001ba00: 6973 2060 696d 6167 6560 2063 6f75 6c64  is `image` could
+0001ba10: 2062 6520 6120 7379 6d6c 696e 6b20 2860   be a symlink (`
+0001ba20: 6f70 2e69 736c 696e 6b28 2960 2c20 6d6f  op.islink()`, mo
+0001ba30: 7265 206c 696b 656c 7920 666f 7220 7369  re likely for si
+0001ba40: 6e67 756c 6172 6974 7920 636f 6e74 6169  ngularity contai
+0001ba50: 6e65 7229 0a20 2020 2020 2020 2020 2020  ner).           
+0001ba60: 206f 7220 6120 666f 6c64 6572 2028 606f   or a folder (`o
+0001ba70: 702e 6973 6469 7228 2960 2c20 6d6f 7265  p.isdir()`, more
+0001ba80: 206c 696b 656c 7920 666f 7220 646f 636b   likely for dock
+0001ba90: 6572 2063 6f6e 7461 696e 6572 290a 2020  er container).  
+0001baa0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0001bab0: 2020 2073 656c 662e 636f 6e74 6169 6e65     self.containe
+0001bac0: 725f 6473 203d 2063 6f6e 7461 696e 6572  r_ds = container
+0001bad0: 5f64 730a 2020 2020 2020 2020 7365 6c66  _ds.        self
+0001bae0: 2e63 6f6e 7461 696e 6572 5f6e 616d 6520  .container_name 
+0001baf0: 3d20 636f 6e74 6169 6e65 725f 6e61 6d65  = container_name
+0001bb00: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0001bb10: 6e66 6967 5f79 616d 6c5f 6669 6c65 203d  nfig_yaml_file =
+0001bb20: 2063 6f6e 6669 675f 7961 6d6c 5f66 696c   config_yaml_fil
+0001bb30: 650a 0a20 2020 2020 2020 2023 2073 616e  e..        # san
+0001bb40: 6974 7920 6368 6563 6b20 6966 2060 636f  ity check if `co
+0001bb50: 6e66 6967 5f79 616d 6c5f 6669 6c65 6020  nfig_yaml_file` 
+0001bb60: 6578 6973 7473 3a0a 2020 2020 2020 2020  exists:.        
+0001bb70: 6966 206f 702e 6578 6973 7473 2873 656c  if op.exists(sel
+0001bb80: 662e 636f 6e66 6967 5f79 616d 6c5f 6669  f.config_yaml_fi
+0001bb90: 6c65 2920 6973 2046 616c 7365 3a0a 2020  le) is False:.  
+0001bba0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001bbb0: 4578 6365 7074 696f 6e28 2254 6865 2079  Exception("The y
+0001bbc0: 616d 6c20 6669 6c65 206f 6620 7468 6520  aml file of the 
+0001bbd0: 636f 6e74 6169 6e65 7227 7320 636f 6e66  container's conf
+0001bbe0: 6967 7572 6174 696f 6e73 2027 220a 2020  igurations '".  
+0001bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc00: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
+0001bc10: 2e63 6f6e 6669 675f 7961 6d6c 5f66 696c  .config_yaml_fil
+0001bc20: 6520 2b20 2227 2064 6f65 7320 6e6f 7420  e + "' does not 
+0001bc30: 6578 6973 7421 2229 0a0a 2020 2020 2020  exist!")..      
+0001bc40: 2020 2320 7265 6164 2074 6865 2063 6f6e    # read the con
+0001bc50: 7461 696e 6572 2773 2063 6f6e 6669 6720  tainer's config 
+0001bc60: 7961 6d6c 2066 696c 6520 616e 6420 6765  yaml file and ge
+0001bc70: 7420 7468 6520 6063 6f6e 6669 6760 3a0a  t the `config`:.
+0001bc80: 2020 2020 2020 2020 7365 6c66 2e72 6561          self.rea
+0001bc90: 645f 636f 6e74 6169 6e65 725f 636f 6e66  d_container_conf
+0001bca0: 6967 5f79 616d 6c28 290a 0a20 2020 2020  ig_yaml()..     
+0001bcb0: 2020 2073 656c 662e 636f 6e74 6169 6e65     self.containe
+0001bcc0: 725f 7061 7468 5f72 656c 546f 416e 616c  r_path_relToAnal
+0001bcd0: 7973 6973 203d 206f 702e 6a6f 696e 2822  ysis = op.join("
+0001bce0: 636f 6e74 6169 6e65 7273 222c 2022 2e64  containers", ".d
+0001bcf0: 6174 616c 6164 222c 2022 656e 7669 726f  atalad", "enviro
+0001bd00: 6e6d 656e 7473 222c 0a20 2020 2020 2020  nments",.       
+0001bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001bd40: 662e 636f 6e74 6169 6e65 725f 6e61 6d65  f.container_name
+0001bd50: 2c20 2269 6d61 6765 2229 0a0a 2020 2020  , "image")..    
+0001bd60: 6465 6620 7361 6e69 7479 5f63 6865 636b  def sanity_check
+0001bd70: 2873 656c 662c 2061 6e61 6c79 7369 735f  (self, analysis_
+0001bd80: 7061 7468 293a 0a20 2020 2020 2020 2022  path):.        "
+0001bd90: 2222 0a20 2020 2020 2020 2054 6869 7320  "".        This 
+0001bda0: 6973 2061 2073 616e 6974 7920 6368 6563  is a sanity chec
+0001bdb0: 6b20 746f 2076 616c 6964 6174 6520 7468  k to validate th
+0001bdc0: 6520 636c 6f6e 6564 2063 6f6e 7461 696e  e cloned contain
+0001bdd0: 6572 2064 732e 0a0a 2020 2020 2020 2020  er ds...        
+0001bde0: 5061 7261 6d65 7465 7273 3a0a 2020 2020  Parameters:.    
+0001bdf0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+0001be00: 0a20 2020 2020 2020 2061 6e61 6c79 7369  .        analysi
+0001be10: 735f 7061 7468 3a20 7374 720a 2020 2020  s_path: str.    
+0001be20: 2020 2020 2020 2020 4162 736f 6c75 7465          Absolute
+0001be30: 2070 6174 6820 746f 2074 6865 2060 616e   path to the `an
+0001be40: 616c 7973 6973 6020 666f 6c64 6572 2069  alysis` folder i
+0001be50: 6e20 6120 4241 4253 2070 726f 6a65 6374  n a BABS project
+0001be60: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001be70: 2020 2020 2020 2320 7061 7468 2074 6f20        # path to 
+0001be80: 7468 6520 7379 6d6c 696e 6b2f 666f 6c64  the symlink/fold
+0001be90: 6572 2060 696d 6167 6560 3a0a 2020 2020  er `image`:.    
+0001bea0: 2020 2020 636f 6e74 6169 6e65 725f 7061      container_pa
+0001beb0: 7468 5f61 6273 203d 206f 702e 6a6f 696e  th_abs = op.join
+0001bec0: 2861 6e61 6c79 7369 735f 7061 7468 2c20  (analysis_path, 
+0001bed0: 7365 6c66 2e63 6f6e 7461 696e 6572 5f70  self.container_p
+0001bee0: 6174 685f 7265 6c54 6f41 6e61 6c79 7369  ath_relToAnalysi
+0001bef0: 7329 0a20 2020 2020 2020 2023 2065 2e67  s).        # e.g
+0001bf00: 2e3a 0a20 2020 2020 2020 2023 2020 2027  .:.        #   '
+0001bf10: 2f70 6174 682f 746f 2f42 4142 535f 7072  /path/to/BABS_pr
+0001bf20: 6f6a 6563 742f 616e 616c 7973 6973 2f63  oject/analysis/c
+0001bf30: 6f6e 7461 696e 6572 732f 2e64 6174 616c  ontainers/.datal
+0001bf40: 6164 2f65 6e76 6972 6f6e 6d65 6e74 732f  ad/environments/
+0001bf50: 636f 6e74 6169 6e65 725f 6e61 6d65 2f69  container_name/i
+0001bf60: 6d61 6765 270a 0a20 2020 2020 2020 2023  mage'..        #
+0001bf70: 2053 616e 6974 7920 6368 6563 6b3a 2074   Sanity check: t
+0001bf80: 6865 2070 6174 6820 746f 2060 636f 6e74  he path to `cont
+0001bf90: 6169 6e65 725f 6e61 6d65 6020 7368 6f75  ainer_name` shou
+0001bfa0: 6c64 2065 7869 7374 2069 6e20 7468 6520  ld exist in the 
+0001bfb0: 636c 6f6e 6564 2060 636f 6e74 6169 6e65  cloned `containe
+0001bfc0: 725f 6473 603a 0a20 2020 2020 2020 2023  r_ds`:.        #
+0001bfd0: 2065 2e67 2e2c 2027 2f70 6174 682f 746f   e.g., '/path/to
+0001bfe0: 2f42 4142 535f 7072 6f6a 6563 742f 616e  /BABS_project/an
+0001bff0: 616c 7973 6973 2f63 6f6e 7461 696e 6572  alysis/container
+0001c000: 732f 2e64 6174 616c 6164 2f65 6e76 6972  s/.datalad/envir
+0001c010: 6f6e 6d65 6e74 732f 636f 6e74 6169 6e65  onments/containe
+0001c020: 725f 6e61 6d65 270a 2020 2020 2020 2020  r_name'.        
+0001c030: 6173 7365 7274 206f 702e 6578 6973 7473  assert op.exists
+0001c040: 286f 702e 6469 726e 616d 6528 636f 6e74  (op.dirname(cont
+0001c050: 6169 6e65 725f 7061 7468 5f61 6273 2929  ainer_path_abs))
+0001c060: 2c20 5c0a 2020 2020 2020 2020 2020 2020  , \.            
+0001c070: 2254 6865 7265 2069 7320 6e6f 2076 616c  "There is no val
+0001c080: 6964 2069 6d61 6765 206e 616d 6564 2027  id image named '
+0001c090: 2220 2b20 7365 6c66 2e63 6f6e 7461 696e  " + self.contain
+0001c0a0: 6572 5f6e 616d 6520 5c0a 2020 2020 2020  er_name \.      
+0001c0b0: 2020 2020 2020 2b20 2227 2069 6e20 7468        + "' in th
+0001c0c0: 6520 7072 6f76 6964 6564 2063 6f6e 7461  e provided conta
+0001c0d0: 696e 6572 2044 6174 614c 6164 2064 6174  iner DataLad dat
+0001c0e0: 6173 6574 2122 0a0a 2020 2020 2020 2020  aset!"..        
+0001c0f0: 2320 7468 6520 2769 6d61 6765 2720 7379  # the 'image' sy
+0001c100: 6d6c 696e 6b20 6f72 2066 6f6c 6465 7220  mlink or folder 
+0001c110: 7368 6f75 6c64 2065 7869 7374 3a0a 2020  should exist:.  
+0001c120: 2020 2020 2020 6173 7365 7274 206f 702e        assert op.
+0001c130: 6578 6973 7473 2863 6f6e 7461 696e 6572  exists(container
+0001c140: 5f70 6174 685f 6162 7329 206f 7220 6f70  _path_abs) or op
+0001c150: 2e69 736c 696e 6b28 636f 6e74 6169 6e65  .islink(containe
+0001c160: 725f 7061 7468 5f61 6273 292c 205c 0a20  r_path_abs), \. 
+0001c170: 2020 2020 2020 2020 2020 2022 7468 6520             "the 
+0001c180: 666f 6c64 6572 2027 696d 6167 6527 206f  folder 'image' o
+0001c190: 6620 636f 6e74 6169 6e65 7220 4461 7461  f container Data
+0001c1a0: 4c61 6420 6461 7461 7365 7420 646f 6573  Lad dataset does
+0001c1b0: 206e 6f74 2065 7869 7374 2c22 205c 0a20   not exist," \. 
+0001c1c0: 2020 2020 2020 2020 2020 202b 2022 2061             + " a
+0001c1d0: 6e64 2074 6865 7265 2069 7320 6e6f 2073  nd there is no s
+0001c1e0: 796d 6c69 6e6b 2063 616c 6c65 6420 2769  ymlink called 'i
+0001c1f0: 6d61 6765 2720 6569 7468 6572 3b22 205c  mage' either;" \
+0001c200: 0a20 2020 2020 2020 2020 2020 202b 2022  .            + "
+0001c210: 2050 6174 6820 746f 2027 696d 6167 6527   Path to 'image'
+0001c220: 2069 6e20 636c 6f6e 6564 2063 6f6e 7461   in cloned conta
+0001c230: 696e 6572 2044 6174 614c 6164 2064 6174  iner DataLad dat
+0001c240: 6173 6574 2073 686f 756c 6420 6265 3a20  aset should be: 
+0001c250: 2722 205c 0a20 2020 2020 2020 2020 2020  '" \.           
+0001c260: 202b 2063 6f6e 7461 696e 6572 5f70 6174   + container_pat
+0001c270: 685f 6162 7320 2b20 2227 2e22 0a0a 2020  h_abs + "'."..  
+0001c280: 2020 6465 6620 7265 6164 5f63 6f6e 7461    def read_conta
+0001c290: 696e 6572 5f63 6f6e 6669 675f 7961 6d6c  iner_config_yaml
+0001c2a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001c2b0: 2222 220a 2020 2020 2020 2020 5468 6973  """.        This
+0001c2c0: 2069 7320 746f 2067 6574 2074 6865 2063   is to get the c
+0001c2d0: 6f6e 6669 6720 6469 6374 2066 726f 6d20  onfig dict from 
+0001c2e0: 6063 6f6e 6669 675f 7961 6d6c 5f66 696c  `config_yaml_fil
+0001c2f0: 6560 0a20 2020 2020 2020 2022 2222 0a20  e`.        """. 
+0001c300: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0001c310: 2873 656c 662e 636f 6e66 6967 5f79 616d  (self.config_yam
+0001c320: 6c5f 6669 6c65 2920 6173 2066 3a0a 2020  l_file) as f:.  
+0001c330: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0001c340: 6f6e 6669 6720 3d20 7961 6d6c 2e6c 6f61  onfig = yaml.loa
+0001c350: 6428 662c 204c 6f61 6465 723d 7961 6d6c  d(f, Loader=yaml
+0001c360: 2e46 756c 6c4c 6f61 6465 7229 0a20 2020  .FullLoader).   
+0001c370: 2020 2020 2020 2020 2023 205e 5e20 636f           # ^^ co
+0001c380: 6e66 6967 2069 7320 6120 6469 6374 3b20  nfig is a dict; 
+0001c390: 656c 656d 656e 7473 2063 616e 2062 6520  elements can be 
+0001c3a0: 6163 6365 7373 6564 2062 7920 6063 6f6e  accessed by `con
+0001c3b0: 6669 675b 226b 6579 225d 5b22 7375 622d  fig["key"]["sub-
+0001c3c0: 6b65 7922 5d60 0a20 2020 2020 2020 2066  key"]`.        f
+0001c3d0: 2e63 6c6f 7365 2829 0a0a 2020 2020 6465  .close()..    de
+0001c3e0: 6620 6765 6e65 7261 7465 5f62 6173 685f  f generate_bash_
+0001c3f0: 7275 6e5f 6269 6473 6170 7028 7365 6c66  run_bidsapp(self
+0001c400: 2c20 6261 7368 5f70 6174 682c 2069 6e70  , bash_path, inp
+0001c410: 7574 5f64 732c 2074 7970 655f 7365 7373  ut_ds, type_sess
+0001c420: 696f 6e29 3a0a 2020 2020 2020 2020 2222  ion):.        ""
+0001c430: 220a 2020 2020 2020 2020 5468 6973 2069  ".        This i
+0001c440: 7320 746f 2067 656e 6572 6174 6520 6120  s to generate a 
+0001c450: 6261 7368 2073 6372 6970 7420 7468 6174  bash script that
+0001c460: 2072 756e 7320 7468 6520 4249 4453 2041   runs the BIDS A
+0001c470: 7070 2073 696e 6775 6c61 7269 7479 2069  pp singularity i
+0001c480: 6d61 6765 2e0a 0a20 2020 2020 2020 2050  mage...        P
+0001c490: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
+0001c4a0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     -------------
+0001c4b0: 0a20 2020 2020 2020 2062 6173 685f 7061  .        bash_pa
+0001c4c0: 7468 3a20 7374 720a 2020 2020 2020 2020  th: str.        
+0001c4d0: 2020 2020 5468 6520 7061 7468 2074 6f20      The path to 
+0001c4e0: 7468 6520 6261 7368 2066 696c 6520 746f  the bash file to
+0001c4f0: 2062 6520 6765 6e65 7261 7465 642e 2049   be generated. I
+0001c500: 7420 7368 6f75 6c64 2062 6520 696e 2074  t should be in t
+0001c510: 6865 2060 616e 616c 7973 6973 2f63 6f64  he `analysis/cod
+0001c520: 6560 2066 6f6c 6465 722e 0a20 2020 2020  e` folder..     
+0001c530: 2020 2069 6e70 7574 5f64 733a 2063 6c61     input_ds: cla
+0001c540: 7373 2060 496e 7075 745f 6473 600a 2020  ss `Input_ds`.  
+0001c550: 2020 2020 2020 2020 2020 696e 7075 7420            input 
+0001c560: 6461 7461 7365 7428 7329 2069 6e66 6f72  dataset(s) infor
+0001c570: 6d61 7469 6f6e 0a20 2020 2020 2020 2074  mation.        t
+0001c580: 7970 655f 7365 7373 696f 6e3a 2073 7472  ype_session: str
+0001c590: 0a20 2020 2020 2020 2020 2020 206d 756c  .            mul
+0001c5a0: 7469 2d73 6573 206f 7220 7369 6e67 6c65  ti-ses or single
+0001c5b0: 2d73 6573 2e0a 0a20 2020 2020 2020 204e  -ses...        N
+0001c5c0: 6f74 6573 3a0a 2020 2020 2020 2020 2d2d  otes:.        --
+0001c5d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020  ------------.   
+0001c5e0: 2020 2020 2057 6865 6e20 7772 6974 696e       When writin
+0001c5f0: 6720 6073 696e 6775 6c61 7269 7479 2072  g `singularity r
+0001c600: 756e 6020 7061 7274 2c20 6561 6368 2063  un` part, each c
+0001c610: 6875 6e6b 2074 6f20 7772 6974 6520 7368  hunk to write sh
+0001c620: 6f75 6c64 2073 7461 7274 2077 6974 6820  ould start with 
+0001c630: 2220 5c5c 2220 2b20 225c 6e5c 7422 2c0a  " \\" + "\n\t",.
+0001c640: 2020 2020 2020 2020 6d65 616e 696e 672c          meaning,
+0001c650: 2073 7461 7274 696e 6720 7769 7468 2073   starting with s
+0001c660: 7061 6365 2c20 6120 6261 636b 7761 7264  pace, a backward
+0001c670: 2073 6c61 7368 2c20 6120 7265 7475 726e   slash, a return
+0001c680: 2c20 616e 6420 6120 7461 622e 0a20 2020  , and a tab..   
+0001c690: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001c6a0: 2066 726f 6d20 2e63 6f6e 7374 616e 7473   from .constants
+0001c6b0: 2069 6d70 6f72 7420 5041 5448 5f46 535f   import PATH_FS_
+0001c6c0: 4c49 4345 4e53 455f 494e 5f43 4f4e 5441  LICENSE_IN_CONTA
+0001c6d0: 494e 4552 2c20 4f55 5450 5554 5f4d 4149  INER, OUTPUT_MAI
+0001c6e0: 4e5f 464f 4c44 4552 4e41 4d45 0a0a 2020  N_FOLDERNAME..  
+0001c6f0: 2020 2020 2020 7479 7065 5f73 6573 7369        type_sessi
+0001c700: 6f6e 203d 2076 616c 6964 6174 655f 7479  on = validate_ty
+0001c710: 7065 5f73 6573 7369 6f6e 2874 7970 655f  pe_session(type_
+0001c720: 7365 7373 696f 6e29 0a0a 2020 2020 2020  session)..      
+0001c730: 2020 2320 4368 6563 6b20 6966 2074 6865    # Check if the
+0001c740: 2066 6f6c 6465 7220 6578 6973 743b 2069   folder exist; i
+0001c750: 6620 6e6f 742c 2063 7265 6174 6520 6974  f not, create it
+0001c760: 3a0a 2020 2020 2020 2020 6261 7368 5f64  :.        bash_d
+0001c770: 6972 203d 206f 702e 6469 726e 616d 6528  ir = op.dirname(
+0001c780: 6261 7368 5f70 6174 6829 0a20 2020 2020  bash_path).     
+0001c790: 2020 2069 6620 6e6f 7420 6f70 2e65 7869     if not op.exi
+0001c7a0: 7374 7328 6261 7368 5f64 6972 293a 0a20  sts(bash_dir):. 
+0001c7b0: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+0001c7c0: 6b65 6469 7273 2862 6173 685f 6469 7229  kedirs(bash_dir)
+0001c7d0: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+0001c7e0: 6b20 6966 2060 7365 6c66 2e63 6f6e 6669  k if `self.confi
+0001c7f0: 6760 2066 726f 6d20 7468 6520 5941 4d4c  g` from the YAML
+0001c800: 2066 696c 6520 636f 6e74 6169 6e73 2069   file contains i
+0001c810: 6e66 6f72 6d61 7469 6f6e 2077 6520 6e65  nformation we ne
+0001c820: 6564 3a0a 2020 2020 2020 2020 2320 312e  ed:.        # 1.
+0001c830: 2063 6865 636b 2060 7369 6e67 756c 6172   check `singular
+0001c840: 6974 795f 7275 6e60 2073 6563 7469 6f6e  ity_run` section
+0001c850: 3a0a 2020 2020 2020 2020 6966 2022 7369  :.        if "si
+0001c860: 6e67 756c 6172 6974 795f 7275 6e22 206e  ngularity_run" n
+0001c870: 6f74 2069 6e20 7365 6c66 2e63 6f6e 6669  ot in self.confi
+0001c880: 673a 0a20 2020 2020 2020 2020 2020 2023  g:.            #
+0001c890: 2073 616e 6974 7920 6368 6563 6b3a 2074   sanity check: t
+0001c8a0: 6865 7265 2073 686f 756c 6420 6265 206f  here should be o
+0001c8b0: 6e6c 7920 6f6e 6520 696e 7075 7420 6473  nly one input ds
+0001c8c0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0001c8d0: 206f 7468 6572 7769 7365 206e 6565 6420   otherwise need 
+0001c8e0: 746f 2073 7065 6369 6679 2069 6e20 7468  to specify in th
+0001c8f0: 6973 2073 6563 7469 6f6e 3a0a 2020 2020  is section:.    
+0001c900: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+0001c910: 6e70 7574 5f64 732e 6e75 6d5f 6473 203d  nput_ds.num_ds =
+0001c920: 3d20 312c 205c 0a20 2020 2020 2020 2020  = 1, \.         
+0001c930: 2020 2020 2020 2022 5365 6374 696f 6e20         "Section 
+0001c940: 2773 696e 6775 6c61 7269 7479 5f72 756e  'singularity_run
+0001c950: 2720 6973 206d 6973 7369 6e67 2069 6e20  ' is missing in 
+0001c960: 7468 6520 7072 6f76 6964 6564 2220 5c0a  the provided" \.
+0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c980: 2b20 2220 6063 6f6e 7461 696e 6572 5f63  + " `container_c
+0001c990: 6f6e 6669 675f 7961 6d6c 5f66 696c 6560  onfig_yaml_file`
+0001c9a0: 2e20 4173 2074 6865 7265 2061 7265 206d  . As there are m
+0001c9b0: 6f72 6520 7468 616e 206f 6e65 2220 5c0a  ore than one" \.
+0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9d0: 2b20 2220 696e 7075 7420 6461 7461 7365  + " input datase
+0001c9e0: 742c 2079 6f75 206d 7573 7420 696e 636c  t, you must incl
+0001c9f0: 7564 6520 7468 6973 2073 6563 7469 6f6e  ude this section
+0001ca00: 2074 6f20 7370 6563 6966 7922 205c 0a20   to specify" \. 
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+0001ca20: 2022 2074 6f20 7768 6963 6820 6172 6775   " to which argu
+0001ca30: 6d65 6e74 2074 6861 7420 6561 6368 2069  ment that each i
+0001ca40: 6e70 7574 2064 6174 6173 6574 2077 696c  nput dataset wil
+0001ca50: 6c20 676f 2e22 0a20 2020 2020 2020 2020  l go.".         
+0001ca60: 2020 2023 2069 6620 7468 6572 6520 6973     # if there is
+0001ca70: 206f 6e6c 7920 6f6e 6520 696e 7075 7420   only one input 
+0001ca80: 6473 2c20 6669 6e65 3a0a 2020 2020 2020  ds, fine:.      
+0001ca90: 2020 2020 2020 7072 696e 7428 2253 6563        print("Sec
+0001caa0: 7469 6f6e 2027 7369 6e67 756c 6172 6974  tion 'singularit
+0001cab0: 795f 7275 6e27 2077 6173 206e 6f74 2069  y_run' was not i
+0001cac0: 6e63 6c75 6465 6420 220a 2020 2020 2020  ncluded ".      
+0001cad0: 2020 2020 2020 2020 2020 2020 2269 6e20              "in 
+0001cae0: 7468 6520 6063 6f6e 7461 696e 6572 5f63  the `container_c
+0001caf0: 6f6e 6669 675f 7961 6d6c 5f66 696c 6560  onfig_yaml_file`
+0001cb00: 2e20 2229 0a20 2020 2020 2020 2020 2020  . ").           
+0001cb10: 2063 6d64 5f73 696e 6775 6c61 7269 7479   cmd_singularity
+0001cb20: 5f66 6c61 6773 203d 2022 2220 2020 2320  _flags = ""   # 
+0001cb30: 7368 6f75 6c64 2062 6520 656d 7074 790a  should be empty.
+0001cb40: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+0001cb50: 6b65 2073 7572 6520 6f74 6865 7220 7265  ke sure other re
+0001cb60: 7475 726e 6564 2076 6172 6961 626c 6573  turned variables
+0001cb70: 2066 726f 6d20 6067 656e 6572 6174 655f   from `generate_
+0001cb80: 636d 645f 7369 6e67 756c 6172 6974 7952  cmd_singularityR
+0001cb90: 756e 5f66 726f 6d5f 636f 6e66 6967 600a  un_from_config`.
+0001cba0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0001cbb0: 616c 736f 2068 6176 6520 7661 6c75 6573  also have values
+0001cbc0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001cbd0: 6173 2022 2d2d 6673 2d6c 6963 656e 7365  as "--fs-license
+0001cbe0: 2d66 696c 6522 2077 6173 206e 6f74 206f  -file" was not o
+0001cbf0: 6e65 206f 6620 7468 6520 7661 6c75 6520  ne of the value 
+0001cc00: 696e 2060 7369 6e67 756c 6172 6974 795f  in `singularity_
+0001cc10: 7275 6e60 2073 6563 7469 6f6e 3a0a 2020  run` section:.  
+0001cc20: 2020 2020 2020 2020 2020 666c 6167 5f66            flag_f
+0001cc30: 735f 6c69 6365 6e73 6520 3d20 4661 6c73  s_license = Fals
+0001cc40: 650a 2020 2020 2020 2020 2020 2020 7061  e.            pa
+0001cc50: 7468 5f66 735f 6c69 6365 6e73 6520 3d20  th_fs_license = 
+0001cc60: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0001cc70: 2023 2063 6f70 6965 6420 6672 6f6d 2060   # copied from `
+0001cc80: 6765 6e65 7261 7465 5f63 6d64 5f73 696e  generate_cmd_sin
+0001cc90: 6775 6c61 7269 7479 5275 6e5f 6672 6f6d  gularityRun_from
+0001cca0: 5f63 6f6e 6669 6760 3a0a 2020 2020 2020  _config`:.      
+0001ccb0: 2020 2020 2020 7369 6e67 7552 756e 5f69        singuRun_i
+0001ccc0: 6e70 7574 5f64 6972 203d 2069 6e70 7574  nput_dir = input
+0001ccd0: 5f64 732e 6466 5b22 7061 7468 5f64 6174  _ds.df["path_dat
+0001cce0: 615f 7265 6c22 5d5b 305d 0a20 2020 2020  a_rel"][0].     
+0001ccf0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001cd00: 2020 2020 2023 2070 7269 6e74 2822 4765       # print("Ge
+0001cd10: 6e65 7261 7465 2073 696e 6775 6c61 7269  nerate singulari
+0001cd20: 7479 2072 756e 2063 6f6d 6d61 6e64 2066  ty run command f
+0001cd30: 726f 6d20 6063 6f6e 7461 696e 6572 5f63  rom `container_c
+0001cd40: 6f6e 6669 675f 7961 6d6c 5f66 696c 6560  onfig_yaml_file`
+0001cd50: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
+0001cd60: 2023 2063 6f6e 7461 696e 205c 2066 6f72   # contain \ for
+0001cd70: 2065 6163 6820 6b65 792d 7661 6c75 650a   each key-value.
+0001cd80: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+0001cd90: 6561 6420 636f 6e66 6967 2066 726f 6d20  ead config from 
+0001cda0: 7468 6520 7961 6d6c 2066 696c 653a 0a20  the yaml file:. 
+0001cdb0: 2020 2020 2020 2020 2020 2063 6d64 5f73             cmd_s
+0001cdc0: 696e 6775 6c61 7269 7479 5f66 6c61 6773  ingularity_flags
+0001cdd0: 2c20 666c 6167 5f66 735f 6c69 6365 6e73  , flag_fs_licens
+0001cde0: 652c 2070 6174 685f 6673 5f6c 6963 656e  e, path_fs_licen
+0001cdf0: 7365 2c20 7369 6e67 7552 756e 5f69 6e70  se, singuRun_inp
+0001ce00: 7574 5f64 6972 203d 205c 0a20 2020 2020  ut_dir = \.     
+0001ce10: 2020 2020 2020 2020 2020 2067 656e 6572             gener
+0001ce20: 6174 655f 636d 645f 7369 6e67 756c 6172  ate_cmd_singular
+0001ce30: 6974 7952 756e 5f66 726f 6d5f 636f 6e66  ityRun_from_conf
+0001ce40: 6967 2873 656c 662e 636f 6e66 6967 2c20  ig(self.config, 
+0001ce50: 696e 7075 745f 6473 290a 0a20 2020 2020  input_ds)..     
+0001ce60: 2020 2023 2054 4f44 4f3a 2061 6c73 6f20     # TODO: also 
+0001ce70: 636f 7270 6f72 6174 6520 7468 6520 6063  corporate the `c
+0001ce80: 616c 6c2d 666d 7460 2069 6e20 6064 6174  all-fmt` in `dat
+0001ce90: 616c 6164 2063 6f6e 7461 696e 6572 732d  alad containers-
+0001cea0: 6164 6460 0a0a 2020 2020 2020 2020 2320  add`..        # 
+0001ceb0: 322e 2063 6865 636b 2060 7a69 705f 666f  2. check `zip_fo
+0001cec0: 6c64 6572 6e61 6d65 7360 2073 6563 7469  ldernames` secti
+0001ced0: 6f6e 3a0a 2020 2020 2020 2020 6469 6374  on:.        dict
+0001cee0: 5f7a 6970 5f66 6f6c 6465 726e 616d 6573  _zip_foldernames
+0001cef0: 2c20 6966 5f6d 6b5f 6f75 7470 7574 5f66  , if_mk_output_f
+0001cf00: 6f6c 6465 722c 2070 6174 685f 6f75 7470  older, path_outp
+0001cf10: 7574 5f66 6f6c 6465 7220 3d20 5c0a 2020  ut_folder = \.  
+0001cf20: 2020 2020 2020 2020 2020 6765 745f 696e            get_in
+0001cf30: 666f 5f7a 6970 5f66 6f6c 6465 726e 616d  fo_zip_foldernam
+0001cf40: 6573 2873 656c 662e 636f 6e66 6967 290a  es(self.config).
+0001cf50: 0a20 2020 2020 2020 2070 7269 6e74 2829  .        print()
+0001cf60: 0a0a 2020 2020 2020 2020 2320 4368 6563  ..        # Chec
+0001cf70: 6b20 6966 2074 6865 2062 6173 6820 6669  k if the bash fi
+0001cf80: 6c65 2061 6c72 6561 6479 2065 7869 7374  le already exist
+0001cf90: 3a0a 2020 2020 2020 2020 6966 206f 702e  :.        if op.
+0001cfa0: 6578 6973 7473 2862 6173 685f 7061 7468  exists(bash_path
+0001cfb0: 293a 0a20 2020 2020 2020 2020 2020 206f  ):.            o
+0001cfc0: 732e 7265 6d6f 7665 2862 6173 685f 7061  s.remove(bash_pa
+0001cfd0: 7468 2920 2023 2072 656d 6f76 6520 6974  th)  # remove it
+0001cfe0: 0a0a 2020 2020 2020 2020 2320 5772 6974  ..        # Writ
+0001cff0: 6520 696e 746f 2074 6865 2062 6173 6820  e into the bash 
+0001d000: 6669 6c65 3a0a 2020 2020 2020 2020 6261  file:.        ba
+0001d010: 7368 5f66 696c 6520 3d20 6f70 656e 2862  sh_file = open(b
+0001d020: 6173 685f 7061 7468 2c20 2261 2229 2020  ash_path, "a")  
+0001d030: 2023 206f 7065 6e20 696e 2061 7070 656e   # open in appen
+0001d040: 6420 6d6f 6465 0a0a 2020 2020 2020 2020  d mode..        
+0001d050: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
+0001d060: 2223 212f 6269 6e2f 6261 7368 5c6e 2229  "#!/bin/bash\n")
+0001d070: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001d080: 6c65 2e77 7269 7465 2822 7365 7420 2d65  le.write("set -e
+0001d090: 202d 7520 2d78 5c6e 2229 0a0a 2020 2020   -u -x\n")..    
+0001d0a0: 2020 2020 636f 756e 745f 696e 7075 7473      count_inputs
+0001d0b0: 5f62 6173 6820 3d20 300a 2020 2020 2020  _bash = 0.      
+0001d0c0: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
+0001d0d0: 6528 275c 6e73 7562 6964 3d22 2431 225c  e('\nsubid="$1"\
+0001d0e0: 6e27 290a 2020 2020 2020 2020 636f 756e  n').        coun
+0001d0f0: 745f 696e 7075 7473 5f62 6173 6820 2b3d  t_inputs_bash +=
+0001d100: 2031 0a0a 2020 2020 2020 2020 6966 2074   1..        if t
+0001d110: 7970 655f 7365 7373 696f 6e20 3d3d 2022  ype_session == "
+0001d120: 6d75 6c74 692d 7365 7322 3a0a 2020 2020  multi-ses":.    
+0001d130: 2020 2020 2020 2020 2320 616c 736f 2068          # also h
+0001d140: 6176 6520 7468 6520 696e 7075 7420 6f66  ave the input of
+0001d150: 2060 7365 7369 6460 3a0a 2020 2020 2020   `sesid`:.      
+0001d160: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
+0001d170: 7772 6974 6528 2773 6573 6964 3d22 2432  write('sesid="$2
+0001d180: 225c 6e27 290a 2020 2020 2020 2020 2020  "\n').          
+0001d190: 2020 636f 756e 745f 696e 7075 7473 5f62    count_inputs_b
+0001d1a0: 6173 6820 2b3d 2031 0a0a 2020 2020 2020  ash += 1..      
+0001d1b0: 2020 2320 7a69 7020 6669 6c65 6e61 6d65    # zip filename
+0001d1c0: 2061 7320 696e 7075 7420 6f66 2062 6173   as input of bas
+0001d1d0: 6820 6669 6c65 3a0a 2020 2020 2020 2020  h file:.        
+0001d1e0: 666f 7220 695f 6473 2069 6e20 7261 6e67  for i_ds in rang
+0001d1f0: 6528 302c 2069 6e70 7574 5f64 732e 6e75  e(0, input_ds.nu
+0001d200: 6d5f 6473 293a 0a20 2020 2020 2020 2020  m_ds):.         
+0001d210: 2020 2069 6620 696e 7075 745f 6473 2e64     if input_ds.d
+0001d220: 665b 2269 735f 7a69 7070 6564 225d 5b69  f["is_zipped"][i
+0001d230: 5f64 735d 2069 7320 5472 7565 3a20 2023  _ds] is True:  #
+0001d240: 2069 7320 7a69 7070 6564 3a0a 2020 2020   is zipped:.    
+0001d250: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+0001d260: 745f 696e 7075 7473 5f62 6173 6820 2b3d  t_inputs_bash +=
+0001d270: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0001d280: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
+0001d290: 7465 2869 6e70 7574 5f64 732e 6466 5b22  te(input_ds.df["
+0001d2a0: 6e61 6d65 225d 5b69 5f64 735d 2e75 7070  name"][i_ds].upp
+0001d2b0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
+0001d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2d0: 2020 2020 202b 2027 5f5a 4950 3d22 2427       + '_ZIP="$'
+0001d2e0: 202b 2073 7472 2863 6f75 6e74 5f69 6e70   + str(count_inp
+0001d2f0: 7574 735f 6261 7368 2920 2b20 2722 5c6e  uts_bash) + '"\n
+0001d300: 2729 0a0a 2020 2020 2020 2020 6261 7368  ')..        bash
+0001d310: 5f66 696c 652e 7772 6974 6528 225c 6e22  _file.write("\n"
+0001d320: 290a 0a20 2020 2020 2020 2023 2043 6865  )..        # Che
+0001d330: 636b 2069 6620 602d 2d62 6964 732d 6669  ck if `--bids-fi
+0001d340: 6c74 6572 2d66 696c 6520 2224 7b66 696c  lter-file "${fil
+0001d350: 7465 7266 696c 657d 2260 2069 7320 6e65  terfile}"` is ne
+0001d360: 6564 6564 3a0a 2020 2020 2020 2020 666c  eded:.        fl
+0001d370: 6167 5f66 696c 7465 7266 696c 6520 3d20  ag_filterfile = 
+0001d380: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+0001d390: 2074 7970 655f 7365 7373 696f 6e20 3d3d   type_session ==
+0001d3a0: 2022 6d75 6c74 692d 7365 7322 3a0a 2020   "multi-ses":.  
+0001d3b0: 2020 2020 2020 2020 2020 6966 2061 6e79            if any
+0001d3c0: 2865 6c65 2069 6e20 7365 6c66 2e63 6f6e  (ele in self.con
+0001d3d0: 7461 696e 6572 5f6e 616d 652e 6c6f 7765  tainer_name.lowe
+0001d3e0: 7228 2920 666f 7220 656c 6520 696e 205b  r() for ele in [
+0001d3f0: 2266 6d72 6970 7265 7022 2c20 2271 7369  "fmriprep", "qsi
+0001d400: 7072 6570 225d 293a 0a20 2020 2020 2020  prep"]):.       
+0001d410: 2020 2020 2020 2020 2023 205e 5e20 6966           # ^^ if
+0001d420: 2074 6865 2063 6f6e 7461 696e 6572 5f6e   the container_n
+0001d430: 616d 6520 636f 6e74 6169 6e73 2060 666d  ame contains `fm
+0001d440: 7269 7072 6570 6020 6f72 2060 7173 6970  riprep` or `qsip
+0001d450: 7265 7060 3a0a 2020 2020 2020 2020 2020  rep`:.          
+0001d460: 2020 2020 2020 2320 5e5e 2063 6173 6520        # ^^ case 
+0001d470: 696e 7365 6e73 6974 6976 6520 2861 7320  insensitive (as 
+0001d480: 6861 7665 2063 6861 6e67 6564 2074 6f20  have changed to 
+0001d490: 6c6f 7765 7220 6361 7365 292c 2061 6363  lower case), acc
+0001d4a0: 6570 7420 2266 4d52 4950 7265 702d 302d  ept "fMRIPrep-0-
+0001d4b0: 302d 3022 0a20 2020 2020 2020 2020 2020  0-0".           
+0001d4c0: 2020 2020 2066 6c61 675f 6669 6c74 6572       flag_filter
+0001d4d0: 6669 6c65 203d 2054 7275 650a 0a20 2020  file = True..   
+0001d4e0: 2020 2020 2020 2020 2020 2020 2023 2067               # g
+0001d4f0: 656e 6572 6174 6520 7468 6520 636f 6d6d  enerate the comm
+0001d500: 616e 6420 6f66 2067 656e 6572 6174 696e  and of generatin
+0001d510: 6720 7468 6520 6024 6669 6c74 6572 6669  g the `$filterfi
+0001d520: 6c65 602c 0a20 2020 2020 2020 2020 2020  le`,.           
+0001d530: 2020 2020 2023 2069 2e65 2e2c 2060 247b       # i.e., `${
+0001d540: 7365 7369 647d 5f66 696c 7465 722e 6a73  sesid}_filter.js
+0001d550: 6f6e 603a 0a20 2020 2020 2020 2020 2020  on`:.           
+0001d560: 2020 2020 2063 6d64 5f66 696c 7465 7266       cmd_filterf
+0001d570: 696c 6520 3d20 6765 6e65 7261 7465 5f63  ile = generate_c
+0001d580: 6d64 5f66 696c 7465 7266 696c 6528 7365  md_filterfile(se
+0001d590: 6c66 2e63 6f6e 7461 696e 6572 5f6e 616d  lf.container_nam
+0001d5a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001d5b0: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
+0001d5c0: 7465 2863 6d64 5f66 696c 7465 7266 696c  te(cmd_filterfil
+0001d5d0: 6529 0a0a 2020 2020 2020 2020 2320 4368  e)..        # Ch
+0001d5e0: 6563 6b20 6966 2061 6e79 2064 6174 6173  eck if any datas
+0001d5f0: 6574 2069 7320 7a69 7070 6564 3b20 6966  et is zipped; if
+0001d600: 2073 6f2c 2061 6464 2063 6f6d 6d61 6e64   so, add command
+0001d610: 7320 6f66 2075 6e7a 6970 7069 6e67 3a0a  s of unzipping:.
+0001d620: 2020 2020 2020 2020 636d 645f 756e 7a69          cmd_unzi
+0001d630: 705f 696e 7075 7464 7320 3d20 6765 6e65  p_inputds = gene
+0001d640: 7261 7465 5f63 6d64 5f75 6e7a 6970 5f69  rate_cmd_unzip_i
+0001d650: 6e70 7574 6473 2869 6e70 7574 5f64 732c  nputds(input_ds,
+0001d660: 2074 7970 655f 7365 7373 696f 6e29 0a20   type_session). 
+0001d670: 2020 2020 2020 2069 6620 6c65 6e28 636d         if len(cm
+0001d680: 645f 756e 7a69 705f 696e 7075 7464 7329  d_unzip_inputds)
+0001d690: 203e 2030 3a20 2020 2320 6e6f 7420 2222   > 0:   # not ""
+0001d6a0: 3a0a 2020 2020 2020 2020 2020 2020 6261  :.            ba
+0001d6b0: 7368 5f66 696c 652e 7772 6974 6528 636d  sh_file.write(cm
+0001d6c0: 645f 756e 7a69 705f 696e 7075 7464 7329  d_unzip_inputds)
+0001d6d0: 0a0a 2020 2020 2020 2020 2320 4f74 6865  ..        # Othe
+0001d6e0: 7220 6e65 6365 7373 6172 7920 636f 6d6d  r necessary comm
+0001d6f0: 616e 6473 2066 6f72 2070 7265 7061 7261  ands for prepara
+0001d700: 7469 6f6e 3a0a 2020 2020 2020 2020 6261  tion:.        ba
+0001d710: 7368 5f66 696c 652e 7772 6974 6528 225c  sh_file.write("\
+0001d720: 6e22 290a 0a20 2020 2020 2020 2023 2045  n")..        # E
+0001d730: 6e76 6972 6f6e 6d65 6e74 2076 6172 6961  nvironment varia
+0001d740: 626c 6573 2069 6e20 636f 6e74 6169 6e65  bles in containe
+0001d750: 723a 0a20 2020 2020 2020 2023 2067 6574  r:.        # get
+0001d760: 2065 6e76 6972 6f6e 6d65 6e74 2076 6172   environment var
+0001d770: 6961 626c 6573 2074 6f20 6265 2069 6e6a  iables to be inj
+0001d780: 6563 7465 6420 696e 746f 2063 6f6e 7461  ected into conta
+0001d790: 696e 6572 2061 6e64 2077 686f 7365 2076  iner and whose v
+0001d7a0: 616c 7565 2074 6f20 6265 2062 6f75 6e64  alue to be bound
+0001d7b0: 3a0a 2020 2020 2020 2020 636d 645f 656e  :.        cmd_en
+0001d7c0: 765f 7465 6d70 6c61 7465 666c 6f77 2c20  v_templateflow, 
+0001d7d0: 7465 6d70 6c61 7465 666c 6f77 5f68 6f6d  templateflow_hom
+0001d7e0: 652c 2074 656d 706c 6174 6566 6c6f 775f  e, templateflow_
+0001d7f0: 696e 5f63 6f6e 7461 696e 6572 203d 205c  in_container = \
+0001d800: 0a20 2020 2020 2020 2020 2020 2067 656e  .            gen
+0001d810: 6572 6174 655f 636d 645f 7365 745f 656e  erate_cmd_set_en
+0001d820: 7676 6172 2822 5445 4d50 4c41 5445 464c  vvar("TEMPLATEFL
+0001d830: 4f57 5f48 4f4d 4522 290a 0a20 2020 2020  OW_HOME")..     
+0001d840: 2020 2023 2057 7269 7465 2074 6865 2068     # Write the h
+0001d850: 6561 6420 6f66 2074 6865 2063 6f6d 6d61  ead of the comma
+0001d860: 6e64 2060 7369 6e67 756c 6172 6974 7920  nd `singularity 
+0001d870: 7275 6e60 3a0a 2020 2020 2020 2020 6261  run`:.        ba
+0001d880: 7368 5f66 696c 652e 7772 6974 6528 226d  sh_file.write("m
+0001d890: 6b64 6972 202d 7020 247b 5057 447d 2f2e  kdir -p ${PWD}/.
+0001d8a0: 6769 742f 746d 702f 776b 6469 725c 6e22  git/tmp/wkdir\n"
+0001d8b0: 290a 2020 2020 2020 2020 636d 645f 6865  ).        cmd_he
+0001d8c0: 6164 5f73 696e 6775 6c61 7269 7479 5275  ad_singularityRu
+0001d8d0: 6e20 3d20 2273 696e 6775 6c61 7269 7479  n = "singularity
+0001d8e0: 2072 756e 202d 2d63 6c65 616e 656e 7622   run --cleanenv"
+0001d8f0: 0a20 2020 2020 2020 2023 2062 696e 6469  .        # bindi
+0001d900: 6e67 3a0a 2020 2020 2020 2020 636d 645f  ng:.        cmd_
+0001d910: 6865 6164 5f73 696e 6775 6c61 7269 7479  head_singularity
+0001d920: 5275 6e20 2b3d 2022 205c 5c22 202b 2022  Run += " \\" + "
+0001d930: 5c6e 5c74 2220 2b20 222d 4220 247b 5057  \n\t" + "-B ${PW
+0001d940: 447d 220a 0a20 2020 2020 2020 2023 2063  D}"..        # c
+0001d950: 6865 636b 2069 6620 6074 656d 706c 6174  heck if `templat
+0001d960: 6566 6c6f 775f 686f 6d65 6020 6e65 6564  eflow_home` need
+0001d970: 7320 746f 2062 6520 626f 756e 643a 0a20  s to be bound:. 
+0001d980: 2020 2020 2020 2069 6620 7465 6d70 6c61         if templa
+0001d990: 7465 666c 6f77 5f68 6f6d 6520 6973 206e  teflow_home is n
+0001d9a0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001d9b0: 2020 2020 2023 2061 6464 2060 2d42 202f       # add `-B /
+0001d9c0: 7061 7468 2f74 6f2f 7465 6d70 6c61 7465  path/to/template
+0001d9d0: 666c 6f77 5f68 6f6d 653a 2f54 454d 504c  flow_home:/TEMPL
+0001d9e0: 4154 4546 4c4f 575f 484f 4d45 603a 0a20  ATEFLOW_HOME`:. 
+0001d9f0: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
+0001da00: 206d 756c 7469 706c 6520 6269 6e64 696e   multiple bindin
+0001da10: 6773 3a20 6d75 6c74 6970 6c65 2060 2d42  gs: multiple `-B
+0001da20: 6020 6f72 2073 6570 6172 6174 6520 7061  ` or separate pa
+0001da30: 7468 2077 6974 6820 636f 6d6d 6120 2874  th with comma (t
+0001da40: 6f6f 206c 6f6e 6729 0a20 2020 2020 2020  oo long).       
+0001da50: 2020 2020 2063 6d64 5f68 6561 645f 7369       cmd_head_si
+0001da60: 6e67 756c 6172 6974 7952 756e 202b 3d20  ngularityRun += 
+0001da70: 2220 5c5c 2220 2b20 225c 6e5c 7422 202b  " \\" + "\n\t" +
+0001da80: 2022 2d42 2022 0a20 2020 2020 2020 2020   "-B ".         
+0001da90: 2020 2063 6d64 5f68 6561 645f 7369 6e67     cmd_head_sing
+0001daa0: 756c 6172 6974 7952 756e 202b 3d20 7465  ularityRun += te
+0001dab0: 6d70 6c61 7465 666c 6f77 5f68 6f6d 6520  mplateflow_home 
+0001dac0: 2b20 223a 220a 2020 2020 2020 2020 2020  + ":".          
+0001dad0: 2020 636d 645f 6865 6164 5f73 696e 6775    cmd_head_singu
+0001dae0: 6c61 7269 7479 5275 6e20 2b3d 2074 656d  larityRun += tem
+0001daf0: 706c 6174 6566 6c6f 775f 696e 5f63 6f6e  plateflow_in_con
+0001db00: 7461 696e 6572 0a20 2020 2020 2020 2020  tainer.         
+0001db10: 2020 2023 205e 5e20 6269 6e64 2074 6f20     # ^^ bind to 
+0001db20: 6469 7220 696e 2063 6f6e 7461 696e 6572  dir in container
+0001db30: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+0001db40: 6b20 6966 2060 6672 6565 7375 7266 6572  k if `freesurfer
+0001db50: 5f68 6f6d 6560 206e 6565 6473 2074 6f20  _home` needs to 
+0001db60: 6265 2062 6f75 6e64 3a0a 2020 2020 2020  be bound:.      
+0001db70: 2020 6966 2066 6c61 675f 6673 5f6c 6963    if flag_fs_lic
+0001db80: 656e 7365 2069 7320 5472 7565 3a0a 2020  ense is True:.  
+0001db90: 2020 2020 2020 2020 2020 2320 6164 6420            # add 
+0001dba0: 602d 4220 2f70 6174 682f 746f 2f6c 6963  `-B /path/to/lic
+0001dbb0: 656e 7365 2e74 7874 3a2f 5347 4c52 2f46  ense.txt:/SGLR/F
+0001dbc0: 5245 4553 5552 4645 525f 484f 4d45 2f6c  REESURFER_HOME/l
+0001dbd0: 6963 656e 7365 2e74 7874 603a 0a20 2020  icense.txt`:.   
+0001dbe0: 2020 2020 2020 2020 2063 6d64 5f68 6561           cmd_hea
+0001dbf0: 645f 7369 6e67 756c 6172 6974 7952 756e  d_singularityRun
+0001dc00: 202b 3d20 2220 5c5c 2220 2b20 225c 6e5c   += " \\" + "\n\
+0001dc10: 7422 202b 2022 2d42 2022 0a20 2020 2020  t" + "-B ".     
+0001dc20: 2020 2020 2020 2063 6d64 5f68 6561 645f         cmd_head_
+0001dc30: 7369 6e67 756c 6172 6974 7952 756e 202b  singularityRun +
+0001dc40: 3d20 7061 7468 5f66 735f 6c69 6365 6e73  = path_fs_licens
+0001dc50: 6520 2b20 223a 220a 2020 2020 2020 2020  e + ":".        
+0001dc60: 2020 2020 636d 645f 6865 6164 5f73 696e      cmd_head_sin
+0001dc70: 6775 6c61 7269 7479 5275 6e20 2b3d 2050  gularityRun += P
+0001dc80: 4154 485f 4653 5f4c 4943 454e 5345 5f49  ATH_FS_LICENSE_I
+0001dc90: 4e5f 434f 4e54 4149 4e45 520a 0a20 2020  N_CONTAINER..   
+0001dca0: 2020 2020 2023 2069 6e6a 6563 7420 656e       # inject en
+0001dcb0: 7620 7661 7269 6162 6c65 2069 6e74 6f20  v variable into 
+0001dcc0: 636f 6e74 6169 6e65 723a 0a20 2020 2020  container:.     
+0001dcd0: 2020 2069 6620 7465 6d70 6c61 7465 666c     if templatefl
+0001dce0: 6f77 5f68 6f6d 6520 6973 206e 6f74 204e  ow_home is not N
+0001dcf0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001dd00: 2023 2061 6464 2060 2d2d 656e 7620 5445   # add `--env TE
+0001dd10: 4d50 4c41 5445 464c 4f57 5f48 4f4d 453d  MPLATEFLOW_HOME=
+0001dd20: 2f54 454d 504c 4154 4546 4c4f 575f 484f  /TEMPLATEFLOW_HO
+0001dd30: 4d45 603a 0a20 2020 2020 2020 2020 2020  ME`:.           
+0001dd40: 2063 6d64 5f68 6561 645f 7369 6e67 756c   cmd_head_singul
+0001dd50: 6172 6974 7952 756e 202b 3d20 2220 5c5c  arityRun += " \\
+0001dd60: 2220 2b20 225c 6e5c 7422 0a20 2020 2020  " + "\n\t".     
+0001dd70: 2020 2020 2020 2063 6d64 5f68 6561 645f         cmd_head_
+0001dd80: 7369 6e67 756c 6172 6974 7952 756e 202b  singularityRun +
+0001dd90: 3d20 636d 645f 656e 765f 7465 6d70 6c61  = cmd_env_templa
+0001dda0: 7465 666c 6f77 0a0a 2020 2020 2020 2020  teflow..        
+0001ddb0: 636d 645f 6865 6164 5f73 696e 6775 6c61  cmd_head_singula
+0001ddc0: 7269 7479 5275 6e20 2b3d 2022 205c 5c22  rityRun += " \\"
+0001ddd0: 202b 2022 5c6e 5c74 220a 2020 2020 2020   + "\n\t".      
+0001dde0: 2020 636d 645f 6865 6164 5f73 696e 6775    cmd_head_singu
+0001ddf0: 6c61 7269 7479 5275 6e20 2b3d 2073 656c  larityRun += sel
+0001de00: 662e 636f 6e74 6169 6e65 725f 7061 7468  f.container_path
+0001de10: 5f72 656c 546f 416e 616c 7973 6973 0a20  _relToAnalysis. 
+0001de20: 2020 2020 2020 2063 6d64 5f68 6561 645f         cmd_head_
+0001de30: 7369 6e67 756c 6172 6974 7952 756e 202b  singularityRun +
+0001de40: 3d20 2220 5c5c 2220 2b20 225c 6e5c 7422  = " \\" + "\n\t"
+0001de50: 0a20 2020 2020 2020 2063 6d64 5f68 6561  .        cmd_hea
+0001de60: 645f 7369 6e67 756c 6172 6974 7952 756e  d_singularityRun
+0001de70: 202b 3d20 7369 6e67 7552 756e 5f69 6e70   += singuRun_inp
+0001de80: 7574 5f64 6972 2020 2320 696e 7075 7473  ut_dir  # inputs
+0001de90: 2f64 6174 612f 3c6e 616d 653e 0a20 2020  /data/<name>.   
+0001dea0: 2020 2020 2063 6d64 5f68 6561 645f 7369       cmd_head_si
+0001deb0: 6e67 756c 6172 6974 7952 756e 202b 3d20  ngularityRun += 
+0001dec0: 2220 5c5c 2220 2b20 225c 6e5c 7422 0a20  " \\" + "\n\t". 
+0001ded0: 2020 2020 2020 2063 6d64 5f68 6561 645f         cmd_head_
+0001dee0: 7369 6e67 756c 6172 6974 7952 756e 202b  singularityRun +
+0001def0: 3d20 7061 7468 5f6f 7574 7075 745f 666f  = path_output_fo
+0001df00: 6c64 6572 2020 2020 2320 6465 6669 6e65  lder    # define
+0001df10: 6420 6162 6f76 650a 0a20 2020 2020 2020  d above..       
+0001df20: 2023 2063 7572 7265 6e74 6c79 2061 6c6c   # currently all
+0001df30: 2042 4944 5320 4170 7020 7375 7070 6f72   BIDS App suppor
+0001df40: 7420 6070 6172 7469 6369 7061 6e74 6020  t `participant` 
+0001df50: 706f 7369 7469 6f6e 616c 2061 7267 753a  positional argu:
+0001df60: 0a20 2020 2020 2020 2063 6d64 5f68 6561  .        cmd_hea
+0001df70: 645f 7369 6e67 756c 6172 6974 7952 756e  d_singularityRun
+0001df80: 202b 3d20 2220 5c5c 2220 2b20 225c 6e5c   += " \\" + "\n\
+0001df90: 7422 0a20 2020 2020 2020 2063 6d64 5f68  t".        cmd_h
+0001dfa0: 6561 645f 7369 6e67 756c 6172 6974 7952  ead_singularityR
+0001dfb0: 756e 202b 3d20 2270 6172 7469 6369 7061  un += "participa
+0001dfc0: 6e74 2220 2023 2061 7420 7061 7274 6963  nt"  # at partic
+0001dfd0: 6970 616e 742d 6c65 7665 6c0a 0a20 2020  ipant-level..   
+0001dfe0: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
+0001dff0: 7269 7465 2863 6d64 5f68 6561 645f 7369  rite(cmd_head_si
+0001e000: 6e67 756c 6172 6974 7952 756e 290a 0a20  ngularityRun).. 
+0001e010: 2020 2020 2020 2023 2057 7269 7465 2074         # Write t
+0001e020: 6865 206e 616d 6564 2061 7267 756d 656e  he named argumen
+0001e030: 7473 202b 2076 616c 7565 733a 0a20 2020  ts + values:.   
+0001e040: 2020 2020 2023 2061 6464 206d 6f72 6520       # add more 
+0001e050: 6172 6775 6d65 6e74 7320 7468 6174 2061  arguments that a
+0001e060: 7265 2063 6f76 6572 6564 2062 7920 4241  re covered by BA
+0001e070: 4253 2028 696e 7374 6561 6420 6f66 2075  BS (instead of u
+0001e080: 7365 7273 293a 0a20 2020 2020 2020 2069  sers):.        i
+0001e090: 6620 666c 6167 5f66 696c 7465 7266 696c  f flag_filterfil
+0001e0a0: 6520 6973 2054 7275 653a 0a20 2020 2020  e is True:.     
+0001e0b0: 2020 2020 2020 2023 2061 6c73 6f20 6e65         # also ne
+0001e0c0: 6564 7320 6120 2466 696c 7465 7266 696c  eds a $filterfil
+0001e0d0: 6520 666c 6167 3a0a 2020 2020 2020 2020  e flag:.        
+0001e0e0: 2020 2020 636d 645f 7369 6e67 756c 6172      cmd_singular
+0001e0f0: 6974 795f 666c 6167 7320 2b3d 2022 205c  ity_flags += " \
+0001e100: 5c22 202b 2022 5c6e 5c74 220a 2020 2020  \" + "\n\t".    
+0001e110: 2020 2020 2020 2020 636d 645f 7369 6e67          cmd_sing
+0001e120: 756c 6172 6974 795f 666c 6167 7320 2b3d  ularity_flags +=
+0001e130: 2027 2d2d 6269 6473 2d66 696c 7465 722d   '--bids-filter-
+0001e140: 6669 6c65 2022 247b 6669 6c74 6572 6669  file "${filterfi
+0001e150: 6c65 7d22 2720 2023 203c 2d20 544f 444f  le}"'  # <- TODO
+0001e160: 3a20 7465 7374 206f 7574 2121 0a0a 2020  : test out!!..  
+0001e170: 2020 2020 2020 636d 645f 7369 6e67 756c        cmd_singul
+0001e180: 6172 6974 795f 666c 6167 7320 2b3d 2022  arity_flags += "
+0001e190: 205c 5c22 202b 2022 5c6e 5c74 220a 2020   \\" + "\n\t".  
+0001e1a0: 2020 2020 2020 636d 645f 7369 6e67 756c        cmd_singul
+0001e1b0: 6172 6974 795f 666c 6167 7320 2b3d 2027  arity_flags += '
+0001e1c0: 2d2d 7061 7274 6963 6970 616e 742d 6c61  --participant-la
+0001e1d0: 6265 6c20 2224 7b73 7562 6964 7d22 2720  bel "${subid}"' 
+0001e1e0: 2020 2320 7374 616e 6461 7264 2061 7267    # standard arg
+0001e1f0: 756d 656e 7420 696e 2042 4944 5320 4170  ument in BIDS Ap
+0001e200: 700a 0a20 2020 2020 2020 2062 6173 685f  p..        bash_
+0001e210: 6669 6c65 2e77 7269 7465 2863 6d64 5f73  file.write(cmd_s
+0001e220: 696e 6775 6c61 7269 7479 5f66 6c61 6773  ingularity_flags
+0001e230: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
+0001e240: 696c 652e 7772 6974 6528 225c 6e5c 6e22  ile.write("\n\n"
+0001e250: 290a 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+0001e260: 2822 4265 6c6f 7720 6973 2074 6865 2067  ("Below is the g
+0001e270: 656e 6572 6174 6564 2060 7369 6e67 756c  enerated `singul
+0001e280: 6172 6974 7920 7275 6e60 2063 6f6d 6d61  arity run` comma
+0001e290: 6e64 3a22 290a 2020 2020 2020 2020 7072  nd:").        pr
+0001e2a0: 696e 7428 636d 645f 6865 6164 5f73 696e  int(cmd_head_sin
+0001e2b0: 6775 6c61 7269 7479 5275 6e20 2b20 636d  gularityRun + cm
+0001e2c0: 645f 7369 6e67 756c 6172 6974 795f 666c  d_singularity_fl
+0001e2d0: 6167 7329 0a0a 2020 2020 2020 2020 2320  ags)..        # 
+0001e2e0: 5a69 703a 0a20 2020 2020 2020 2063 6d64  Zip:.        cmd
+0001e2f0: 5f7a 6970 203d 2067 656e 6572 6174 655f  _zip = generate_
+0001e300: 636d 645f 7a69 7070 696e 675f 6672 6f6d  cmd_zipping_from
+0001e310: 5f63 6f6e 6669 6728 6469 6374 5f7a 6970  _config(dict_zip
+0001e320: 5f66 6f6c 6465 726e 616d 6573 2c20 7479  _foldernames, ty
+0001e330: 7065 5f73 6573 7369 6f6e 290a 2020 2020  pe_session).    
+0001e340: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
+0001e350: 6974 6528 636d 645f 7a69 7029 0a0a 2020  ite(cmd_zip)..  
+0001e360: 2020 2020 2020 2320 4465 6c65 7465 2066        # Delete f
+0001e370: 6f6c 6465 7273 2061 6e64 2066 696c 6573  olders and files
+0001e380: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001e390: 2020 2020 2020 726d 202d 7266 2070 7265        rm -rf pre
+0001e3a0: 7020 2e67 6974 2f74 6d70 2f77 6b64 6972  p .git/tmp/wkdir
+0001e3b0: 0a20 2020 2020 2020 2072 6d20 247b 6669  .        rm ${fi
+0001e3c0: 6c74 6572 6669 6c65 7d0a 2020 2020 2020  lterfile}.      
+0001e3d0: 2020 2222 220a 2020 2020 2020 2020 636d    """.        cm
+0001e3e0: 645f 636c 6561 6e20 3d20 2272 6d20 2d72  d_clean = "rm -r
+0001e3f0: 6620 2220 2b20 4f55 5450 5554 5f4d 4149  f " + OUTPUT_MAI
+0001e400: 4e5f 464f 4c44 4552 4e41 4d45 202b 2022  N_FOLDERNAME + "
+0001e410: 2022 202b 2022 2e67 6974 2f74 6d70 2f77   " + ".git/tmp/w
+0001e420: 6b64 6972 2220 2b20 225c 6e22 0a20 2020  kdir" + "\n".   
+0001e430: 2020 2020 2023 205e 5e20 726d 2074 6865       # ^^ rm the
+0001e440: 2065 6e74 6972 6520 6f75 7470 7574 2066   entire output f
+0001e450: 6f6c 6465 7220 606f 7574 7075 7473 600a  older `outputs`.
+0001e460: 2020 2020 2020 2020 6966 2066 6c61 675f          if flag_
+0001e470: 6669 6c74 6572 6669 6c65 2069 7320 5472  filterfile is Tr
+0001e480: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0001e490: 636d 645f 636c 6561 6e20 2b3d 2022 726d  cmd_clean += "rm
+0001e4a0: 2024 7b66 696c 7465 7266 696c 657d 2220   ${filterfile}" 
+0001e4b0: 2b20 2220 5c6e 220a 0a20 2020 2020 2020  + " \n"..       
+0001e4c0: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
+0001e4d0: 2863 6d64 5f63 6c65 616e 290a 0a20 2020  (cmd_clean)..   
+0001e4e0: 2020 2020 2023 2044 6f6e 6520 6765 6e65       # Done gene
+0001e4f0: 7261 7469 6e67 2060 3c63 6f6e 7461 696e  rating `<contain
+0001e500: 6572 4e61 6d65 3e5f 7a69 702e 7368 603a  erName>_zip.sh`:
+0001e510: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001e520: 6c65 2e77 7269 7465 2822 5c6e 2229 0a20  le.write("\n"). 
+0001e530: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+0001e540: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
+0001e550: 2020 2320 4578 6563 7574 6520 6e65 6365    # Execute nece
+0001e560: 7373 6172 7920 636f 6d6d 616e 6473 3a0a  ssary commands:.
+0001e570: 2020 2020 2020 2020 2320 6368 616e 6765          # change
+0001e580: 2074 6865 2070 6572 6d69 7373 696f 6e20   the permission 
+0001e590: 6f66 2074 6869 7320 6261 7368 2066 696c  of this bash fil
+0001e5a0: 653a 0a20 2020 2020 2020 2070 726f 635f  e:.        proc_
+0001e5b0: 6368 6d6f 645f 6261 7368 6669 6c65 203d  chmod_bashfile =
+0001e5c0: 2073 7562 7072 6f63 6573 732e 7275 6e28   subprocess.run(
+0001e5d0: 0a20 2020 2020 2020 2020 2020 205b 2263  .            ["c
+0001e5e0: 686d 6f64 222c 2022 2b78 222c 2062 6173  hmod", "+x", bas
+0001e5f0: 685f 7061 7468 5d2c 2020 2320 652e 672e  h_path],  # e.g.
+0001e600: 2c20 6368 6d6f 6420 2b78 2063 6f64 652f  , chmod +x code/
+0001e610: 666d 7269 7072 6570 5f7a 6970 2e73 680a  fmriprep_zip.sh.
+0001e620: 2020 2020 2020 2020 2020 2020 7374 646f              stdo
+0001e630: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
+0001e640: 5045 0a20 2020 2020 2020 2020 2020 2029  PE.            )
+0001e650: 0a20 2020 2020 2020 2070 726f 635f 6368  .        proc_ch
+0001e660: 6d6f 645f 6261 7368 6669 6c65 2e63 6865  mod_bashfile.che
+0001e670: 636b 5f72 6574 7572 6e63 6f64 6528 290a  ck_returncode().
+0001e680: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
+0001e690: 655f 6261 7368 5f70 6172 7469 6369 7061  e_bash_participa
+0001e6a0: 6e74 5f6a 6f62 2873 656c 662c 2062 6173  nt_job(self, bas
+0001e6b0: 685f 7061 7468 2c20 696e 7075 745f 6473  h_path, input_ds
+0001e6c0: 2c20 7479 7065 5f73 6573 7369 6f6e 2c0a  , type_session,.
+0001e6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6f0: 2020 2020 2020 7379 7374 656d 293a 0a20        system):. 
+0001e700: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001e710: 2020 2054 6869 7320 6973 2074 6f20 6765     This is to ge
+0001e720: 6e65 7261 7465 2061 2062 6173 6820 7363  nerate a bash sc
+0001e730: 7269 7074 2074 6861 7420 7275 6e73 206a  ript that runs j
+0001e740: 6f62 7320 666f 7220 6561 6368 2070 6172  obs for each par
+0001e750: 7469 6369 7061 6e74 2028 6f72 2073 6573  ticipant (or ses
+0001e760: 7369 6f6e 292e 0a0a 2020 2020 2020 2020  sion)...        
+0001e770: 5061 7261 6d65 7465 7273 3a0a 2020 2020  Parameters:.    
+0001e780: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+0001e790: 2d0a 2020 2020 2020 2020 6261 7368 5f70  -.        bash_p
+0001e7a0: 6174 683a 2073 7472 0a20 2020 2020 2020  ath: str.       
+0001e7b0: 2020 2020 2054 6865 2070 6174 6820 746f       The path to
+0001e7c0: 2074 6865 2062 6173 6820 6669 6c65 2074   the bash file t
+0001e7d0: 6f20 6265 2067 656e 6572 6174 6564 2e20  o be generated. 
+0001e7e0: 4974 2073 686f 756c 6420 6265 2069 6e20  It should be in 
+0001e7f0: 7468 6520 6061 6e61 6c79 7369 732f 636f  the `analysis/co
+0001e800: 6465 6020 666f 6c64 6572 2e0a 2020 2020  de` folder..    
+0001e810: 2020 2020 696e 7075 745f 6473 3a20 636c      input_ds: cl
+0001e820: 6173 7320 6049 6e70 7574 5f64 7360 0a20  ass `Input_ds`. 
+0001e830: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+0001e840: 2064 6174 6173 6574 2873 2920 696e 666f   dataset(s) info
+0001e850: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
+0001e860: 7479 7065 5f73 6573 7369 6f6e 3a20 7374  type_session: st
+0001e870: 720a 2020 2020 2020 2020 2020 2020 226d  r.            "m
+0001e880: 756c 7469 2d73 6573 2220 6f72 2022 7369  ulti-ses" or "si
+0001e890: 6e67 6c65 2d73 6573 222e 0a20 2020 2020  ngle-ses"..     
+0001e8a0: 2020 2073 7973 7465 6d3a 2063 6c61 7373     system: class
+0001e8b0: 2060 5379 7374 656d 600a 2020 2020 2020   `System`.      
+0001e8c0: 2020 2020 2020 696e 666f 726d 6174 696f        informatio
+0001e8d0: 6e20 6f6e 2063 6c75 7374 6572 206d 616e  n on cluster man
+0001e8e0: 6167 656d 656e 7420 7379 7374 656d 0a20  agement system. 
+0001e8f0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0001e900: 2020 2020 2320 5361 6e69 7479 2063 6865      # Sanity che
+0001e910: 636b 3a0a 2020 2020 2020 2020 6966 2074  ck:.        if t
+0001e920: 7970 655f 7365 7373 696f 6e20 6e6f 7420  ype_session not 
+0001e930: 696e 205b 226d 756c 7469 2d73 6573 222c  in ["multi-ses",
+0001e940: 2022 7369 6e67 6c65 2d73 6573 225d 3a0a   "single-ses"]:.
+0001e950: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001e960: 6520 4578 6365 7074 696f 6e28 2249 6e76  e Exception("Inv
+0001e970: 616c 6964 2060 7479 7065 5f73 6573 7369  alid `type_sessi
+0001e980: 6f6e 603a 2022 202b 2074 7970 655f 7365  on`: " + type_se
+0001e990: 7373 696f 6e29 0a0a 2020 2020 2020 2020  ssion)..        
+0001e9a0: 2320 4368 6563 6b20 6966 2074 6865 2062  # Check if the b
+0001e9b0: 6173 6820 6669 6c65 2061 6c72 6561 6479  ash file already
+0001e9c0: 2065 7869 7374 3a0a 2020 2020 2020 2020   exist:.        
+0001e9d0: 6966 206f 702e 6578 6973 7473 2862 6173  if op.exists(bas
+0001e9e0: 685f 7061 7468 293a 0a20 2020 2020 2020  h_path):.       
+0001e9f0: 2020 2020 206f 732e 7265 6d6f 7665 2862       os.remove(b
+0001ea00: 6173 685f 7061 7468 2920 2023 2072 656d  ash_path)  # rem
+0001ea10: 6f76 6520 6974 0a0a 2020 2020 2020 2020  ove it..        
+0001ea20: 2320 5772 6974 6520 696e 746f 2074 6865  # Write into the
+0001ea30: 2062 6173 6820 6669 6c65 3a0a 2020 2020   bash file:.    
+0001ea40: 2020 2020 6261 7368 5f66 696c 6520 3d20      bash_file = 
+0001ea50: 6f70 656e 2862 6173 685f 7061 7468 2c20  open(bash_path, 
+0001ea60: 2261 2229 2020 2023 206f 7065 6e20 696e  "a")   # open in
+0001ea70: 2061 7070 656e 6420 6d6f 6465 0a0a 2020   append mode..  
+0001ea80: 2020 2020 2020 2320 4e4f 5445 3a20 6e6f        # NOTE: no
+0001ea90: 7420 746f 2061 7574 6f6d 6174 6963 616c  t to automatical
+0001eaa0: 6c79 2067 656e 6572 6174 6520 7468 6520  ly generate the 
+0001eab0: 696e 7465 7270 7265 7469 6e67 2073 6865  interpreting she
+0001eac0: 6c6c 3b0a 2020 2020 2020 2020 2320 2020  ll;.        #   
+0001ead0: 696e 7374 6561 642c 206c 6574 2075 7365  instead, let use
+0001eae0: 7273 2073 7065 6369 6679 2069 7420 696e  rs specify it in
+0001eaf0: 2074 6865 2063 6f6e 7461 696e 6572 2063   the container c
+0001eb00: 6f6e 6669 6720 7961 6d6c 2066 696c 650a  onfig yaml file.
+0001eb10: 2020 2020 2020 2020 2320 2020 7573 696e          #   usin
+0001eb20: 6720 6069 6e74 6572 7072 6574 696e 675f  g `interpreting_
+0001eb30: 7368 656c 6c60 0a0a 2020 2020 2020 2020  shell`..        
+0001eb40: 2320 436c 7573 7465 7220 7265 736f 7572  # Cluster resour
+0001eb50: 6365 7320 7265 7175 6573 7469 6e67 3a0a  ces requesting:.
+0001eb60: 2020 2020 2020 2020 636d 645f 6261 7368          cmd_bash
+0001eb70: 6865 6164 5f72 6573 6f75 7263 6573 203d  head_resources =
+0001eb80: 2067 656e 6572 6174 655f 6261 7368 6865   generate_bashhe
+0001eb90: 6164 5f72 6573 6f75 7263 6573 2873 7973  ad_resources(sys
+0001eba0: 7465 6d2c 2073 656c 662e 636f 6e66 6967  tem, self.config
+0001ebb0: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
+0001ebc0: 696c 652e 7772 6974 6528 636d 645f 6261  ile.write(cmd_ba
+0001ebd0: 7368 6865 6164 5f72 6573 6f75 7263 6573  shhead_resources
+0001ebe0: 290a 0a20 2020 2020 2020 2023 2053 6372  )..        # Scr
+0001ebf0: 6970 7420 7072 6561 6d62 6c65 733a 0a20  ipt preambles:. 
+0001ec00: 2020 2020 2020 2063 6d64 5f73 6372 6970         cmd_scrip
+0001ec10: 745f 7072 6561 6d62 6c65 203d 2067 656e  t_preamble = gen
+0001ec20: 6572 6174 655f 636d 645f 7363 7269 7074  erate_cmd_script
+0001ec30: 5f70 7265 616d 626c 6528 7365 6c66 2e63  _preamble(self.c
+0001ec40: 6f6e 6669 6729 0a20 2020 2020 2020 2062  onfig).        b
+0001ec50: 6173 685f 6669 6c65 2e77 7269 7465 2863  ash_file.write(c
+0001ec60: 6d64 5f73 6372 6970 745f 7072 6561 6d62  md_script_preamb
+0001ec70: 6c65 290a 0a20 2020 2020 2020 2023 2043  le)..        # C
+0001ec80: 6861 6e67 6520 686f 7720 7468 6973 2062  hange how this b
+0001ec90: 6173 6820 6669 6c65 2069 7320 7275 6e3a  ash file is run:
+0001eca0: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001ecb0: 6c65 2e77 7269 7465 2822 5c6e 2320 4661  le.write("\n# Fa
+0001ecc0: 696c 2077 6865 6e65 7665 7220 736f 6d65  il whenever some
+0001ecd0: 7468 696e 6720 6973 2066 6973 6879 2c22  thing is fishy,"
+0001ece0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ecf0: 2020 2020 2020 2020 202b 2022 2075 7365           + " use
+0001ed00: 202d 7820 746f 2067 6574 2076 6572 626f   -x to get verbo
+0001ed10: 7365 206c 6f67 6669 6c65 733a 5c6e 2229  se logfiles:\n")
+0001ed20: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001ed30: 6c65 2e77 7269 7465 2822 7365 7420 2d65  le.write("set -e
+0001ed40: 202d 7520 2d78 5c6e 2229 0a0a 2020 2020   -u -x\n")..    
+0001ed50: 2020 2020 2320 496e 7075 7473 206f 6620      # Inputs of 
+0001ed60: 7468 6520 6261 7368 2073 6372 6970 743a  the bash script:
+0001ed70: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001ed80: 6c65 2e77 7269 7465 2822 5c6e 2229 0a20  le.write("\n"). 
+0001ed90: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+0001eda0: 2e77 7269 7465 2827 6473 736f 7572 6365  .write('dssource
+0001edb0: 3d22 2431 225c 7423 2069 2e65 2e2c 2060  ="$1"\t# i.e., `
+0001edc0: 696e 7075 745f 7269 6160 5c6e 2729 0a20  input_ria`\n'). 
+0001edd0: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+0001ede0: 2e77 7269 7465 2827 7075 7368 6769 7472  .write('pushgitr
+0001edf0: 656d 6f74 653d 2224 3222 5c74 2320 692e  emote="$2"\t# i.
+0001ee00: 652e 2c20 606f 7574 7075 745f 7269 6160  e., `output_ria`
+0001ee10: 5c6e 2729 0a20 2020 2020 2020 2062 6173  \n').        bas
+0001ee20: 685f 6669 6c65 2e77 7269 7465 2827 7375  h_file.write('su
+0001ee30: 6269 643d 2224 3322 5c6e 2729 0a0a 2020  bid="$3"\n')..  
+0001ee40: 2020 2020 2020 6966 2074 7970 655f 7365        if type_se
+0001ee50: 7373 696f 6e20 3d3d 2022 6d75 6c74 692d  ssion == "multi-
+0001ee60: 7365 7322 3a0a 2020 2020 2020 2020 2020  ses":.          
+0001ee70: 2020 2320 616c 736f 2068 6176 6520 7468    # also have th
+0001ee80: 6520 696e 7075 7420 6f66 2060 7365 7369  e input of `sesi
+0001ee90: 6460 3a0a 2020 2020 2020 2020 2020 2020  d`:.            
+0001eea0: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
+0001eeb0: 2773 6573 6964 3d22 2434 225c 6e27 290a  'sesid="$4"\n').
+0001eec0: 0a20 2020 2020 2020 2023 2043 6861 6e67  .        # Chang
+0001eed0: 6520 7061 7468 2074 6f20 6120 7465 6d70  e path to a temp
+0001eee0: 6f72 6172 7920 6a6f 6220 636f 6d70 7574  orary job comput
+0001eef0: 6520 776f 726b 7370 6163 653a 0a20 2020  e workspace:.   
+0001ef00: 2020 2020 2023 2020 2074 6865 2070 6174       #   the pat
+0001ef10: 6820 6973 2062 6173 6564 206f 6e20 7768  h is based on wh
+0001ef20: 6174 2075 7365 7273 2070 726f 7669 6465  at users provide
+0001ef30: 2069 6e20 7365 6374 696f 6e20 276a 6f62   in section 'job
+0001ef40: 5f63 6f6d 7075 7465 5f73 7061 6365 2720  _compute_space' 
+0001ef50: 696e 2059 414d 4c20 6669 6c65 3a0a 2020  in YAML file:.  
+0001ef60: 2020 2020 2020 636d 645f 6a6f 625f 636f        cmd_job_co
+0001ef70: 6d70 7574 655f 7370 6163 6520 3d20 6765  mpute_space = ge
+0001ef80: 6e65 7261 7465 5f63 6d64 5f6a 6f62 5f63  nerate_cmd_job_c
+0001ef90: 6f6d 7075 7465 5f73 7061 6365 2873 656c  ompute_space(sel
+0001efa0: 662e 636f 6e66 6967 290a 2020 2020 2020  f.config).      
+0001efb0: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
+0001efc0: 6528 636d 645f 6a6f 625f 636f 6d70 7574  e(cmd_job_comput
+0001efd0: 655f 7370 6163 6529 0a0a 2020 2020 2020  e_space)..      
+0001efe0: 2020 2320 5365 7475 7073 3a20 2d2d 2d2d    # Setups: ----
+0001eff0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f000: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f010: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+0001f020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
+0001f030: 2020 2020 2320 7365 7420 7570 2074 6865      # set up the
+0001f040: 2062 7261 6e63 683a 0a20 2020 2020 2020   branch:.       
+0001f050: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
+0001f060: 2822 5c6e 2320 4272 616e 6368 206e 616d  ("\n# Branch nam
+0001f070: 6520 2861 6c73 6f20 7573 6564 2061 7320  e (also used as 
+0001f080: 7465 6d70 6f72 6172 7920 6469 7265 6374  temporary direct
+0001f090: 6f72 7929 3a5c 6e22 290a 2020 2020 2020  ory):\n").      
+0001f0a0: 2020 6966 2073 7973 7465 6d2e 7479 7065    if system.type
+0001f0b0: 203d 3d20 2273 6765 223a 0a20 2020 2020   == "sge":.     
+0001f0c0: 2020 2020 2020 2076 6172 6e61 6d65 5f6a         varname_j
+0001f0d0: 6f62 6964 203d 2022 4a4f 425f 4944 220a  obid = "JOB_ID".
+0001f0e0: 2020 2020 2020 2020 656c 6966 2073 7973          elif sys
+0001f0f0: 7465 6d2e 7479 7065 203d 3d20 2273 6c75  tem.type == "slu
+0001f100: 726d 223a 0a20 2020 2020 2020 2020 2020  rm":.           
+0001f110: 2076 6172 6e61 6d65 5f6a 6f62 6964 203d   varname_jobid =
+0001f120: 2022 534c 5552 4d5f 4a4f 4249 4422 0a0a   "SLURM_JOBID"..
+0001f130: 2020 2020 2020 2020 6966 2074 7970 655f          if type_
+0001f140: 7365 7373 696f 6e20 3d3d 2022 6d75 6c74  session == "mult
+0001f150: 692d 7365 7322 3a0a 2020 2020 2020 2020  i-ses":.        
 0001f160: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
-0001f170: 6974 6528 2764 6174 616c 6164 2063 6c6f  ite('datalad clo
-0001f180: 6e65 2022 247b 6473 736f 7572 6365 7d22  ne "${dssource}"
-0001f190: 2064 7327 202b 2022 5c6e 2229 0a20 2020   ds' + "\n").   
-0001f1a0: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001f1b0: 7269 7465 2822 6364 2064 7322 290a 0a20  rite("cd ds").. 
-0001f1c0: 2020 2020 2020 2023 2073 6574 2075 7020         # set up 
-0001f1d0: 7468 6520 7265 7375 6c74 2064 6570 6f73  the result depos
-0001f1e0: 6974 696f 6e3a 0a20 2020 2020 2020 2062  ition:.        b
-0001f1f0: 6173 685f 6669 6c65 2e77 7269 7465 2822  ash_file.write("
-0001f200: 5c6e 2320 5265 6769 7374 6572 206f 7574  \n# Register out
-0001f210: 7075 7420 5249 4120 6173 2072 656d 6f74  put RIA as remot
-0001f220: 6520 666f 7220 7265 7375 6c74 2064 6570  e for result dep
-0001f230: 6f73 6974 696f 6e3a 5c6e 2229 0a20 2020  osition:\n").   
-0001f240: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-0001f250: 7269 7465 2827 6769 7420 7265 6d6f 7465  rite('git remote
-0001f260: 2061 6464 206f 7574 7075 7473 746f 7265   add outputstore
-0001f270: 2022 247b 7075 7368 6769 7472 656d 6f74   "${pushgitremot
-0001f280: 657d 2227 202b 2022 5c6e 2229 0a20 2020  e}"' + "\n").   
-0001f290: 2020 2020 2023 205e 5e20 6067 6974 2072       # ^^ `git r
-0001f2a0: 656d 6f74 6520 6164 6420 3c67 6976 6520  emote add <give 
-0001f2b0: 6120 6e61 6d65 3e20 3c66 6f6c 6465 7220  a name> <folder 
-0001f2c0: 7768 6572 6520 7468 6520 7265 6d6f 7465  where the remote
-0001f2d0: 2069 733e 600a 2020 2020 2020 2020 2320   is>`.        # 
-0001f2e0: 2020 6973 2074 6f20 6164 6420 6120 6e65    is to add a ne
-0001f2f0: 7720 7265 6d6f 7465 2074 6f20 796f 7572  w remote to your
-0001f300: 2067 6974 2072 6570 6f0a 0a20 2020 2020   git repo..     
-0001f310: 2020 2023 2073 6574 2075 7020 6120 6e65     # set up a ne
-0001f320: 7720 6272 616e 6368 3a0a 2020 2020 2020  w branch:.      
-0001f330: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
-0001f340: 6528 225c 6e23 2043 7265 6174 6520 6120  e("\n# Create a 
-0001f350: 6e65 7720 6272 616e 6368 2066 6f72 2074  new branch for t
-0001f360: 6869 7320 6a6f 6227 7320 7265 7375 6c74  his job's result
-0001f370: 733a 2220 2b20 225c 6e22 290a 2020 2020  s:" + "\n").    
-0001f380: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
-0001f390: 6974 6528 2767 6974 2063 6865 636b 6f75  ite('git checkou
-0001f3a0: 7420 2d62 2022 247b 4252 414e 4348 7d22  t -b "${BRANCH}"
-0001f3b0: 2720 2b20 225c 6e22 290a 0a20 2020 2020  ' + "\n")..     
-0001f3c0: 2020 2023 2053 7461 7274 206f 6620 7468     # Start of th
-0001f3d0: 6520 6170 706c 6963 6174 696f 6e2d 7370  e application-sp
-0001f3e0: 6563 6966 6963 2063 6f64 653a 202d 2d2d  ecific code: ---
-0001f3f0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-0001f400: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a20 2020  -----------..   
-0001f410: 2020 2020 2023 2070 756c 6c20 646f 776e       # pull down
-0001f420: 2069 6e70 7574 2064 6174 6120 2862 7574   input data (but
-0001f430: 2064 6f6e 2774 2072 6574 7269 6576 6520   don't retrieve 
-0001f440: 7468 6520 6461 7461 2063 6f6e 7465 6e74  the data content
-0001f450: 2920 616e 6420 7265 6d6f 7665 206f 7468  ) and remove oth
-0001f460: 6572 2073 7562 2773 2064 6174 613a 0a20  er sub's data:. 
-0001f470: 2020 2020 2020 2023 2020 2070 7572 706f         #   purpo
-0001f480: 7365 206f 6620 7265 6d6f 7669 6e67 206f  se of removing o
-0001f490: 7468 6572 2073 7562 2773 2064 6174 613a  ther sub's data:
-0001f4a0: 206f 7468 6572 7769 7365 2070 7962 6964   otherwise pybid
-0001f4b0: 7320 776f 756c 6420 7461 6b65 0a20 2020  s would take.   
-0001f4c0: 2020 2020 2023 2020 2065 7874 7265 6d65       #   extreme
-0001f4d0: 6c79 206c 6f6e 6720 7469 6d65 2069 6e20  ly long time in 
-0001f4e0: 6c61 7267 6520 6461 7461 7365 7420 6475  large dataset du
-0001f4f0: 6520 746f 206c 6f74 7320 6f66 2073 7562  e to lots of sub
-0001f500: 6a65 6374 730a 2020 2020 2020 2020 6261  jects.        ba
-0001f510: 7368 5f66 696c 652e 7772 6974 6528 0a20  sh_file.write(. 
-0001f520: 2020 2020 2020 2020 2020 2022 5c6e 2320             "\n# 
-0001f530: 5075 6c6c 2064 6f77 6e20 7468 6520 696e  Pull down the in
-0001f540: 7075 7420 7375 626a 6563 7420 286f 7220  put subject (or 
-0001f550: 6461 7461 7365 7429 2062 7574 2064 6f6e  dataset) but don
-0001f560: 2774 2072 6574 7269 6576 6520 6461 7461  't retrieve data
-0001f570: 2063 6f6e 7465 6e74 733a 5c6e 2229 0a20   contents:\n"). 
-0001f580: 2020 2020 2020 2066 6f72 2069 5f64 7320         for i_ds 
-0001f590: 696e 2072 616e 6765 2830 2c20 696e 7075  in range(0, inpu
-0001f5a0: 745f 6473 2e6e 756d 5f64 7329 3a0a 2020  t_ds.num_ds):.  
-0001f5b0: 2020 2020 2020 2020 2020 6966 2069 6e70            if inp
-0001f5c0: 7574 5f64 732e 6466 5b22 6973 5f7a 6970  ut_ds.df["is_zip
-0001f5d0: 7065 6422 5d5b 695f 6473 5d20 6973 2046  ped"][i_ds] is F
-0001f5e0: 616c 7365 3a20 2020 2320 756e 7a69 7070  alse:   # unzipp
-0001f5f0: 6564 2064 733a 0a20 2020 2020 2020 2020  ed ds:.         
-0001f600: 2020 2020 2020 2023 2073 6565 6d73 2072         # seems r
-0001f610: 6567 6172 646c 6573 7320 6f66 206d 756c  egardless of mul
-0001f620: 7469 2d73 6573 206f 7220 6e6f 740a 2020  ti-ses or not.  
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001f640: 2020 6173 2066 6f72 206d 756c 7469 2d73    as for multi-s
-0001f650: 6573 2c20 6974 206d 6967 6874 2075 7365  es, it might use
-0001f660: 7320 6f74 6865 7220 7365 7327 7320 6461  s other ses's da
-0001f670: 7461 2065 2e67 2e2c 2061 6e61 743f 0a20  ta e.g., anat?. 
-0001f680: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001f690: 6173 685f 6669 6c65 2e77 7269 7465 2827  ash_file.write('
-0001f6a0: 6461 7461 6c61 6420 6765 7420 2d6e 2022  datalad get -n "
-0001f6b0: 2720 2b20 696e 7075 745f 6473 2e64 665b  ' + input_ds.df[
-0001f6c0: 2270 6174 685f 6e6f 775f 7265 6c22 5d5b  "path_now_rel"][
-0001f6d0: 695f 6473 5d0a 2020 2020 2020 2020 2020  i_ds].          
-0001f6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f6f0: 2020 2020 2020 2b20 222f 247b 7375 6269        + "/${subi
-0001f700: 647d 2220 2b20 2722 2720 2b20 225c 6e22  d}" + '"' + "\n"
-0001f710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f720: 2020 2320 5e5e 2060 2d6e 6020 6d65 616e    # ^^ `-n` mean
-0001f730: 7320 2247 6574 2028 636c 6f6e 6529 2061  s "Get (clone) a
-0001f740: 2072 6567 6973 7465 7265 6420 7375 6264   registered subd
-0001f750: 6174 6173 6574 2c20 6275 7420 646f 6ee2  ataset, but don.
-0001f760: 8099 7420 7265 7472 6965 7665 2064 6174  ..t retrieve dat
-0001f770: 6122 0a20 2020 2020 2020 2020 2020 2020  a".             
-0001f780: 2020 2023 2020 2068 6572 6520 696e 7075     #   here inpu
-0001f790: 7420 6473 2069 7320 6120 7375 622d 6461  t ds is a sub-da
-0001f7a0: 7461 7365 7420 6f66 2064 6174 6173 6574  taset of dataset
-0001f7b0: 2060 616e 616c 7973 6973 602e 0a20 2020   `analysis`..   
-0001f7c0: 2020 2020 2020 2020 2020 2020 2023 204e               # N
-0001f7d0: 4f54 453a 206e 6f74 2073 7572 6520 7768  OTE: not sure wh
-0001f7e0: 7920 6062 6f6f 7473 7472 6170 2d66 6d72  y `bootstrap-fmr
-0001f7f0: 6970 7265 702d 696e 6772 6573 7365 642d  iprep-ingressed-
-0001f800: 6673 2e73 6860 2075 7365 733a 0a20 2020  fs.sh` uses:.   
-0001f810: 2020 2020 2020 2020 2020 2020 2023 2060               # `
-0001f820: 6461 7461 6c61 6420 6765 7420 2d6e 202d  datalad get -n -
-0001f830: 7220 2269 6e70 7574 732f 6461 7461 2f42  r "inputs/data/B
-0001f840: 4944 532f 247b 7375 6269 647d 2260 0a20  IDS/${subid}"`. 
-0001f850: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001f860: 2074 6861 7420 6861 7320 602d 7260 3f20   that has `-r`? 
-0001f870: 602d 7260 206d 6561 6e73 2022 7265 6375  `-r` means "recu
-0001f880: 7273 6976 656c 7922 202d 2069 7320 6974  rsively" - is it
-0001f890: 2066 6f72 2063 6173 6573 2074 6861 7420   for cases that 
-0001f8a0: 6561 6368 2073 7562 0a20 2020 2020 2020  each sub.       
-0001f8b0: 2020 2020 2020 2020 2023 2020 2069 7320           #   is 
-0001f8c0: 6120 7375 622d 6461 7461 7365 7420 6f66  a sub-dataset of
-0001f8d0: 2060 696e 7075 7473 2f64 6174 612f 3c6e   `inputs/data/<n
-0001f8e0: 616d 653e 603f 0a20 2020 2020 2020 2020  ame>`?.         
-0001f8f0: 2020 2020 2020 2023 2054 4f44 4f3a 2074         # TODO: t
-0001f900: 7279 206f 7574 2069 6620 6164 6469 6e67  ry out if adding
-0001f910: 2060 2d72 6020 7374 696c 6c20 776f 726b   `-r` still work
-0001f920: 733f 0a0a 2020 2020 2020 2020 2020 2020  s?..            
-0001f930: 2020 2020 2320 7265 6d6f 7665 206f 7468      # remove oth
-0001f940: 6572 2073 7562 2773 2064 6174 613a 0a20  er sub's data:. 
-0001f950: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001f960: 6173 685f 6669 6c65 2e77 7269 7465 2822  ash_file.write("
-0001f970: 2863 6420 2220 2b20 696e 7075 745f 6473  (cd " + input_ds
-0001f980: 2e64 665b 2270 6174 685f 6e6f 775f 7265  .df["path_now_re
-0001f990: 6c22 5d5b 695f 6473 5d0a 2020 2020 2020  l"][i_ds].      
-0001f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9b0: 2020 2020 2020 2020 2020 2b20 2220 2626            + " &&
-0001f9c0: 2072 6d20 2d72 6620 6066 696e 6420 2e20   rm -rf `find . 
-0001f9d0: 2d74 7970 6520 6420 2d6e 616d 6520 2773  -type d -name 's
-0001f9e0: 7562 2a27 220a 2020 2020 2020 2020 2020  ub*'".          
-0001f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa00: 2020 2020 2020 2b20 2220 7c20 6772 6570        + " | grep
-0001fa10: 202d 7620 2473 7562 6964 6022 202b 2022   -v $subid`" + "
-0001fa20: 2922 202b 2022 5c6e 2229 0a20 2020 2020  )" + "\n").     
-0001fa30: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-0001fa40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001fa50: 2e67 2e2c 3a0a 2020 2020 2020 2020 2020  .g.,:.          
-0001fa60: 2020 2020 2020 6461 7461 6c61 6420 6765        datalad ge
-0001fa70: 7420 2d6e 2022 696e 7075 7473 2f64 6174  t -n "inputs/dat
-0001fa80: 612f 3c6e 616d 653e 2f24 7b73 7562 6964  a/<name>/${subid
-0001fa90: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
-0001faa0: 2020 2028 6364 2069 6e70 7574 732f 6461     (cd inputs/da
-0001fab0: 7461 2f3c 6e61 6d65 3e20 2626 2072 6d20  ta/<name> && rm 
-0001fac0: 2d72 6620 6066 696e 6420 2e20 2d74 7970  -rf `find . -typ
-0001fad0: 6520 6420 2d6e 616d 6520 2773 7562 2a27  e d -name 'sub*'
-0001fae0: 207c 2067 7265 7020 2d76 2024 7375 6269   | grep -v $subi
-0001faf0: 6460 290a 2020 2020 2020 2020 2020 2020  d`).            
-0001fb00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001fb10: 2020 2020 656c 7365 3a20 2020 2023 207a      else:    # z
-0001fb20: 6970 7065 6420 6473 3a0a 2020 2020 2020  ipped ds:.      
-0001fb30: 2020 2020 2020 2020 2020 6261 7368 5f66            bash_f
-0001fb40: 696c 652e 7772 6974 6528 2764 6174 616c  ile.write('datal
-0001fb50: 6164 2067 6574 202d 6e20 2227 0a20 2020  ad get -n "'.   
-0001fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb70: 2020 2020 2020 2020 2020 2020 202b 2069               + i
-0001fb80: 6e70 7574 5f64 732e 6466 5b22 7061 7468  nput_ds.df["path
-0001fb90: 5f6e 6f77 5f72 656c 225d 5b69 5f64 735d  _now_rel"][i_ds]
-0001fba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbc0: 202b 2027 2227 202b 2022 5c6e 2229 0a20   + '"' + "\n"). 
-0001fbd0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001fbe0: 2065 2e67 2e2c 2060 6461 7461 6c61 6420   e.g., `datalad 
-0001fbf0: 6765 7420 2d6e 2022 696e 7075 7473 2f64  get -n "inputs/d
-0001fc00: 6174 612f 6672 6565 7375 7266 6572 2260  ata/freesurfer"`
-0001fc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fc20: 2023 205e 5e20 7368 6f75 6c64 204e 4f54   # ^^ should NOT
-0001fc30: 206f 6e6c 7920 6765 7420 7370 6563 6966   only get specif
-0001fc40: 6963 207a 6970 2066 696c 652c 2061 7320  ic zip file, as 
-0001fc50: 7269 6768 7420 6e6f 7720 7765 206e 6565  right now we nee
-0001fc60: 6420 746f 0a20 2020 2020 2020 2020 2020  d to.           
-0001fc70: 2020 2020 2023 2020 2067 6574 2074 6865       #   get the
-0001fc80: 206c 6973 7420 6f66 2061 6c6c 2066 696c   list of all fil
-0001fc90: 6573 2c20 736f 2074 6861 7420 7765 2063  es, so that we c
-0001fca0: 616e 2064 6574 6572 6d69 6e65 207a 6970  an determine zip
-0001fcb0: 6669 6c65 6e61 6d65 206c 6174 6572 2e0a  filename later..
-0001fcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fcd0: 2023 2062 656c 6f77 2069 7320 616e 6f74   # below is anot
-0001fce0: 6865 7220 7665 7273 696f 6e3a 2075 7369  her version: usi
-0001fcf0: 6e67 2060 2a60 2069 6e73 7465 6164 206f  ng `*` instead o
-0001fd00: 6620 6120 7370 6563 6966 6963 2066 696c  f a specific fil
-0001fd10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001fd20: 2020 2023 2062 6173 685f 6669 6c65 2e77     # bash_file.w
-0001fd30: 7269 7465 2827 6461 7461 6c61 6420 6765  rite('datalad ge
-0001fd40: 7420 2d6e 2022 2720 2b20 696e 7075 745f  t -n "' + input_
-0001fd50: 6473 2e64 665b 2270 6174 685f 6e6f 775f  ds.df["path_now_
-0001fd60: 7265 6c22 5d5b 695f 6473 5d0a 2020 2020  rel"][i_ds].    
-0001fd70: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0001fd80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0001fd90: 222f 247b 7375 6269 647d 5f2a 2220 2b20  "/${subid}_*" + 
-0001fda0: 696e 7075 745f 6473 2e64 665b 226e 616d  input_ds.df["nam
-0001fdb0: 6522 5d5b 695f 6473 5d20 2b20 222a 2e7a  e"][i_ds] + "*.z
-0001fdc0: 6970 220a 2020 2020 2020 2020 2020 2020  ip".            
-0001fdd0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0001fde0: 2020 2020 2020 2b20 2722 2720 2b20 225c        + '"' + "\
-0001fdf0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0001fe00: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
-0001fe10: 6974 6528 2228 6364 2022 202b 2069 6e70  ite("(cd " + inp
-0001fe20: 7574 5f64 732e 6466 5b22 7061 7468 5f6e  ut_ds.df["path_n
-0001fe30: 6f77 5f72 656c 225d 5b69 5f64 735d 0a20  ow_rel"][i_ds]. 
-0001fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe50: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001fe60: 2022 2026 2620 726d 202d 6620 606c 7320   " && rm -f `ls 
-0001fe70: 7375 622d 2a2e 7a69 7020 7c20 6772 6570  sub-*.zip | grep
-0001fe80: 202d 7620 247b 7375 6269 647d 6022 0a20   -v ${subid}`". 
-0001fe90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fea0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001feb0: 2022 2922 202b 2022 5c6e 2229 0a20 2020   ")" + "\n").   
-0001fec0: 2020 2020 2020 2020 2020 2020 2022 2222               """
-0001fed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fee0: 2065 2e67 2e2c 3a0a 2020 2020 2020 2020   e.g.,:.        
-0001fef0: 2020 2020 2020 2020 6461 7461 6c61 6420          datalad 
-0001ff00: 6765 7420 2d6e 2022 696e 7075 7473 2f64  get -n "inputs/d
-0001ff10: 6174 612f 6672 6565 7375 7266 6572 2f24  ata/freesurfer/$
-0001ff20: 7b73 7562 6964 7d5f 2a3c 6e61 6d65 3e2a  {subid}_*<name>*
-0001ff30: 2e7a 6970 220a 2020 2020 2020 2020 2020  .zip".          
-0001ff40: 2020 2020 2020 2863 6420 696e 7075 7473        (cd inputs
-0001ff50: 2f64 6174 612f 3c6e 616d 653e 2026 2620  /data/<name> && 
-0001ff60: 726d 202d 6620 606c 7320 7375 622d 2a2e  rm -f `ls sub-*.
-0001ff70: 7a69 7020 7c20 6772 6570 202d 7620 247b  zip | grep -v ${
-0001ff80: 7375 6269 647d 6029 0a20 2020 2020 2020  subid}`).       
-0001ff90: 2020 2020 2020 2020 2022 2222 0a0a 2020           """..  
-0001ffa0: 2020 2020 2020 2320 6465 7465 726d 696e        # determin
-0001ffb0: 6520 7468 6520 7a69 7020 6669 6c65 6e61  e the zip filena
-0001ffc0: 6d65 3a0a 2020 2020 2020 2020 636d 645f  me:.        cmd_
-0001ffd0: 6465 7465 726d 696e 655f 7a69 7066 696c  determine_zipfil
-0001ffe0: 656e 616d 6520 3d20 6765 6e65 7261 7465  ename = generate
-0001fff0: 5f63 6d64 5f64 6574 6572 6d69 6e65 5f7a  _cmd_determine_z
-00020000: 6970 6669 6c65 6e61 6d65 2869 6e70 7574  ipfilename(input
-00020010: 5f64 732c 2074 7970 655f 7365 7373 696f  _ds, type_sessio
-00020020: 6e29 0a20 2020 2020 2020 2062 6173 685f  n).        bash_
-00020030: 6669 6c65 2e77 7269 7465 2863 6d64 5f64  file.write(cmd_d
-00020040: 6574 6572 6d69 6e65 5f7a 6970 6669 6c65  etermine_zipfile
-00020050: 6e61 6d65 290a 0a20 2020 2020 2020 2023  name)..        #
-00020060: 2060 6461 7461 6c61 6420 7275 6e60 3a0a   `datalad run`:.
-00020070: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
-00020080: 652e 7772 6974 6528 225c 6e23 2064 6174  e.write("\n# dat
-00020090: 616c 6164 2072 756e 3a5c 6e22 290a 2020  alad run:\n").  
-000200a0: 2020 2020 2020 636d 645f 6461 7461 6c61        cmd_datala
-000200b0: 645f 7275 6e20 3d20 6765 6e65 7261 7465  d_run = generate
-000200c0: 5f63 6d64 5f64 6174 616c 6164 5f72 756e  _cmd_datalad_run
-000200d0: 2873 656c 662c 2069 6e70 7574 5f64 732c  (self, input_ds,
-000200e0: 2074 7970 655f 7365 7373 696f 6e29 0a20   type_session). 
-000200f0: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
-00020100: 2e77 7269 7465 2863 6d64 5f64 6174 616c  .write(cmd_datal
-00020110: 6164 5f72 756e 290a 0a20 2020 2020 2020  ad_run)..       
-00020120: 2023 2046 696e 6973 6820 7570 3a0a 2020   # Finish up:.  
-00020130: 2020 2020 2020 2320 7075 7368 2072 6573        # push res
-00020140: 756c 7420 6669 6c65 2063 6f6e 7465 6e74  ult file content
-00020150: 2074 6f20 6f75 7470 7574 2052 4941 2073   to output RIA s
-00020160: 746f 7261 6765 3a0a 2020 2020 2020 2020  torage:.        
-00020170: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
-00020180: 225c 6e22 202b 2022 2320 5075 7368 2072  "\n" + "# Push r
-00020190: 6573 756c 7420 6669 6c65 2063 6f6e 7465  esult file conte
-000201a0: 6e74 2074 6f20 6f75 7470 7574 2052 4941  nt to output RIA
-000201b0: 2073 746f 7261 6765 3a5c 6e22 290a 2020   storage:\n").  
-000201c0: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-000201d0: 7772 6974 6528 2264 6174 616c 6164 2070  write("datalad p
-000201e0: 7573 6820 2d2d 746f 206f 7574 7075 742d  ush --to output-
-000201f0: 7374 6f72 6167 6522 202b 2022 5c6e 2229  storage" + "\n")
-00020200: 0a20 2020 2020 2020 2023 205e 5e3a 2023  .        # ^^: #
-00020210: 2060 6f75 7470 7574 2d73 746f 7261 6765   `output-storage
-00020220: 603a 2064 6566 696e 6564 2077 6865 6e20  `: defined when 
-00020230: 7374 6172 7420 6f66 2062 6f6f 7473 7472  start of bootstr
-00020240: 6170 3a20 6064 6174 616c 6164 2063 7265  ap: `datalad cre
-00020250: 6174 652d 7369 626c 696e 672d 7269 6160  ate-sibling-ria`
-00020260: 0a0a 2020 2020 2020 2020 2320 7075 7368  ..        # push
-00020270: 2074 6865 206f 7574 7075 7420 6272 616e   the output bran
-00020280: 6368 3a0a 2020 2020 2020 2020 6261 7368  ch:.        bash
-00020290: 5f66 696c 652e 7772 6974 6528 2223 2050  _file.write("# P
-000202a0: 7573 6820 7468 6520 6272 616e 6368 2077  ush the branch w
-000202b0: 6974 6820 7072 6f76 656e 616e 6365 2072  ith provenance r
-000202c0: 6563 6f72 6473 3a5c 6e22 290a 2020 2020  ecords:\n").    
-000202d0: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
-000202e0: 6974 6528 2266 6c6f 636b 2024 4453 4c4f  ite("flock $DSLO
-000202f0: 434b 4649 4c45 2067 6974 2070 7573 6820  CKFILE git push 
-00020300: 6f75 7470 7574 7374 6f72 6522 202b 2022  outputstore" + "
-00020310: 5c6e 2229 0a20 2020 2020 2020 2023 205e  \n").        # ^
-00020320: 5e3a 2060 6f75 7470 7574 7374 6f72 6560  ^: `outputstore`
-00020330: 2077 6173 2064 6566 696e 6564 2061 7420   was defined at 
-00020340: 7468 6520 6265 6769 6e6e 696e 6720 6f66  the beginning of
-00020350: 2060 7061 7274 6963 6970 616e 745f 6a6f   `participant_jo
-00020360: 622e 7368 600a 2020 2020 2020 2020 2320  b.sh`.        # 
-00020370: 7468 6973 2070 7573 6820 6e65 6564 7320  this push needs 
-00020380: 6120 676c 6f62 616c 206c 6f63 6b20 746f  a global lock to
-00020390: 2070 7265 7665 6e74 2077 7269 7465 2063   prevent write c
-000203a0: 6f6e 666c 6963 7473 202d 2046 4149 526c  onflicts - FAIRl
-000203b0: 7920 6269 6720 7061 7065 720a 0a20 2020  y big paper..   
-000203c0: 2020 2020 2023 2044 656c 6574 653a 0a20       # Delete:. 
-000203d0: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
-000203e0: 2e77 7269 7465 2822 5c6e 6563 686f 2027  .write("\necho '
-000203f0: 4465 6c65 7465 2074 656d 706f 7261 7279  Delete temporary
-00020400: 2064 6972 6563 746f 7279 3a27 2220 2b20   directory:'" + 
-00020410: 225c 6e22 290a 2020 2020 2020 2020 6261  "\n").        ba
-00020420: 7368 5f66 696c 652e 7772 6974 6528 2265  sh_file.write("e
-00020430: 6368 6f20 247b 4252 414e 4348 7d22 202b  cho ${BRANCH}" +
-00020440: 2022 5c6e 2229 0a20 2020 2020 2020 2023   "\n").        #
-00020450: 2065 6163 6820 696e 7075 7420 6461 7461   each input data
-00020460: 7365 743a 0a20 2020 2020 2020 2066 6f72  set:.        for
-00020470: 2069 5f64 7320 696e 2072 616e 6765 2830   i_ds in range(0
-00020480: 2c20 696e 7075 745f 6473 2e6e 756d 5f64  , input_ds.num_d
-00020490: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000204a0: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
-000204b0: 2264 6174 616c 6164 2064 726f 7020 2d64  "datalad drop -d
-000204c0: 2022 202b 2069 6e70 7574 5f64 732e 6466   " + input_ds.df
-000204d0: 5b22 7061 7468 5f6e 6f77 5f72 656c 225d  ["path_now_rel"]
-000204e0: 5b69 5f64 735d 202b 2022 202d 7222 0a20  [i_ds] + " -r". 
-000204f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020500: 2020 2020 2020 2020 2020 202b 2022 202d             + " -
-00020510: 2d72 6563 6b6c 6573 7320 6176 6169 6c61  -reckless availa
-00020520: 6269 6c69 7479 2220 2020 2320 7072 6576  bility"   # prev
-00020530: 696f 7573 2060 2d2d 6e6f 6368 6563 6b60  ious `--nocheck`
-00020540: 2028 6465 7072 6563 6174 6564 290a 2020   (deprecated).  
-00020550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020560: 2020 2020 2020 2020 2020 2b20 2220 2d2d            + " --
-00020570: 7265 636b 6c65 7373 206d 6f64 6966 6963  reckless modific
-00020580: 6174 696f 6e22 0a20 2020 2020 2020 2020  ation".         
-00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205a0: 2020 2023 205e 5e20 7072 6576 696f 7573     # ^^ previous
-000205b0: 2060 2d2d 6966 2d64 6972 7479 2069 676e   `--if-dirty ign
-000205c0: 6f72 6560 2028 6465 7072 6563 6174 6564  ore` (deprecated
-000205d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000205e0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-000205f0: 225c 6e22 290a 2020 2020 2020 2020 2020  "\n").          
-00020600: 2020 2320 652e 672e 2c20 6461 7461 6c61    # e.g., datala
-00020610: 6420 6472 6f70 202d 6420 696e 7075 7473  d drop -d inputs
-00020620: 2f64 6174 612f 3c6e 616d 653e 202d 720a  /data/<name> -r.
-00020630: 2020 2020 2020 2020 2020 2020 2320 4e4f              # NO
-00020640: 5445 3a20 6f75 7220 7363 7269 7074 7320  TE: our scripts 
-00020650: 736f 6d65 7469 6d65 7320 616c 736f 2061  sometimes also a
-00020660: 6464 7320 602d 2d6e 6f63 6865 636b 202d  dds `--nocheck -
-00020670: 2d69 662d 6469 7274 7920 6967 6e6f 7265  -if-dirty ignore
-00020680: 600a 2020 2020 2020 2020 2020 2020 2320  `.            # 
-00020690: 2020 7769 7468 6f75 7420 6974 2c20 6074    without it, `t
-000206a0: 6f79 6269 6473 6170 7060 2077 6974 6820  oybidsapp` with 
-000206b0: 7a69 7070 6564 2064 7320 6173 2069 6e70  zipped ds as inp
-000206c0: 7574 2077 6173 206e 6f74 206f 6b61 7920  ut was not okay 
-000206d0: 2864 726f 7020 696d 706f 7373 6962 6c65  (drop impossible
-000206e0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-000206f0: 2020 7769 7468 6f75 7420 6974 2c20 6074    without it, `t
-00020700: 6f79 6269 6473 6170 7060 2077 6974 6820  oybidsapp` with 
-00020710: 4249 4453 2061 7320 696e 7075 7420 7761  BIDS as input wa
-00020720: 7320 6669 6e65 0a0a 2020 2020 2020 2020  s fine..        
-00020730: 2320 616c 736f 2060 6461 7461 6c61 6420  # also `datalad 
-00020740: 6472 6f70 6020 7468 6520 6375 7272 656e  drop` the curren
-00020750: 7420 6064 7360 2028 636c 6f6e 6520 6f66  t `ds` (clone of
-00020760: 2069 6e70 7574 2052 4941 293f 0a20 2020   input RIA)?.   
-00020770: 2020 2020 2023 2020 2074 6869 7320 696e       #   this in
-00020780: 636c 7564 6573 2064 726f 7070 696e 6720  cludes dropping 
-00020790: 6f66 2069 6d61 6765 7320 696e 2060 636f  of images in `co
-000207a0: 6e74 6169 6e65 7273 6020 6461 7461 7365  ntainers` datase
-000207b0: 742c 2061 6e64 207a 6970 7065 6420 6f75  t, and zipped ou
-000207c0: 7470 7574 0a20 2020 2020 2020 2062 6173  tput.        bas
-000207d0: 685f 6669 6c65 2e77 7269 7465 2822 6461  h_file.write("da
-000207e0: 7461 6c61 6420 6472 6f70 202d 7220 2e22  talad drop -r ."
-000207f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020800: 2020 2020 2020 2020 202b 2022 202d 2d72           + " --r
-00020810: 6563 6b6c 6573 7320 6176 6169 6c61 6269  eckless availabi
-00020820: 6c69 7479 220a 2020 2020 2020 2020 2020  lity".          
-00020830: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00020840: 2220 2d2d 7265 636b 6c65 7373 206d 6f64  " --reckless mod
-00020850: 6966 6963 6174 696f 6e22 2020 2020 2320  ification"    # 
-00020860: 7468 6973 2069 7320 6e65 6564 6564 2066  this is needed f
-00020870: 6f72 207a 6970 7065 6420 696e 7075 7420  or zipped input 
-00020880: 6473 0a20 2020 2020 2020 2020 2020 2020  ds.             
-00020890: 2020 2020 2020 2020 2020 202b 2022 5c6e             + "\n
-000208a0: 2229 0a20 2020 2020 2020 2023 205e 5e20  ").        # ^^ 
-000208b0: 6f6c 6420 7363 7269 7074 733a 2064 6174  old scripts: dat
-000208c0: 616c 6164 2064 726f 7020 2d72 202e 202d  alad drop -r . -
-000208d0: 2d6e 6f63 6865 636b 2020 2023 2060 2d2d  -nocheck   # `--
-000208e0: 6e6f 6368 6563 6b60 2069 7320 6465 7072  nocheck` is depr
-000208f0: 6563 6174 6564 2e2e 2e0a 0a20 2020 2020  ecated.....     
-00020900: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-00020910: 7465 2822 6769 7420 616e 6e65 7820 6465  te("git annex de
-00020920: 6164 2068 6572 6522 202b 2022 5c6e 2229  ad here" + "\n")
-00020930: 0a20 2020 2020 2020 2023 205e 5e3a 2061  .        # ^^: a
-00020940: 7320 7468 6520 6461 7461 2068 6173 2062  s the data has b
-00020950: 6565 6e20 6472 6f70 7065 642c 2077 6520  een dropped, we 
-00020960: 646f 6e27 7420 7761 6e74 2074 6f20 6265  don't want to be
-00020970: 2072 656d 696e 6465 6420 6f66 2074 6869   reminded of thi
-00020980: 730a 0a20 2020 2020 2020 2023 2063 6420  s..        # cd 
-00020990: 6f75 7420 6f66 2024 4252 414e 4348 3a0a  out of $BRANCH:.
-000209a0: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
-000209b0: 652e 7772 6974 6528 2263 6420 2e2e 2f2e  e.write("cd ../.
-000209c0: 2e22 202b 2022 5c6e 2229 0a20 2020 2020  ." + "\n").     
-000209d0: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-000209e0: 7465 2822 726d 202d 7266 2024 4252 414e  te("rm -rf $BRAN
-000209f0: 4348 2220 2b20 225c 6e22 290a 0a20 2020  CH" + "\n")..   
-00020a00: 2020 2020 2023 2044 6f6e 6520 6765 6e65       # Done gene
-00020a10: 7261 7469 6e67 2060 7061 7274 6963 6970  rating `particip
-00020a20: 616e 745f 6a6f 622e 7368 603a 0a20 2020  ant_job.sh`:.   
-00020a30: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-00020a40: 7269 7465 2822 5c6e 6563 686f 2053 5543  rite("\necho SUC
-00020a50: 4345 5353 2220 2b20 225c 6e22 290a 2020  CESS" + "\n").  
-00020a60: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-00020a70: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
-00020a80: 2023 2063 6861 6e67 6520 7468 6520 7065   # change the pe
-00020a90: 726d 6973 7369 6f6e 206f 6620 7468 6973  rmission of this
-00020aa0: 2062 6173 6820 6669 6c65 3a0a 2020 2020   bash file:.    
-00020ab0: 2020 2020 7072 6f63 5f63 686d 6f64 5f62      proc_chmod_b
-00020ac0: 6173 6866 696c 6520 3d20 7375 6270 726f  ashfile = subpro
-00020ad0: 6365 7373 2e72 756e 280a 2020 2020 2020  cess.run(.      
-00020ae0: 2020 2020 2020 5b22 6368 6d6f 6422 2c20        ["chmod", 
-00020af0: 222b 7822 2c20 6261 7368 5f70 6174 685d  "+x", bash_path]
-00020b00: 2c20 2023 2065 2e67 2e2c 2063 686d 6f64  ,  # e.g., chmod
-00020b10: 202b 7820 636f 6465 2f70 6172 7469 6369   +x code/partici
-00020b20: 7061 6e74 5f6a 6f62 2e73 680a 2020 2020  pant_job.sh.    
-00020b30: 2020 2020 2020 2020 7374 646f 7574 3d73          stdout=s
-00020b40: 7562 7072 6f63 6573 732e 5049 5045 0a20  ubprocess.PIPE. 
-00020b50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00020b60: 2020 2020 2070 726f 635f 6368 6d6f 645f       proc_chmod_
-00020b70: 6261 7368 6669 6c65 2e63 6865 636b 5f72  bashfile.check_r
-00020b80: 6574 7572 6e63 6f64 6528 290a 0a20 2020  eturncode()..   
-00020b90: 2064 6566 2067 656e 6572 6174 655f 6261   def generate_ba
-00020ba0: 7368 5f74 6573 745f 6a6f 6228 7365 6c66  sh_test_job(self
-00020bb0: 2c20 666f 6c64 6572 5f63 6865 636b 5f73  , folder_check_s
-00020bc0: 6574 7570 2c0a 2020 2020 2020 2020 2020  etup,.          
-00020bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020be0: 2020 2020 2073 7973 7465 6d29 3a0a 2020       system):.  
-00020bf0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00020c00: 2020 5468 6973 2069 7320 746f 2067 656e    This is to gen
-00020c10: 6572 6174 6520 7477 6f20 7363 7269 7074  erate two script
-00020c20: 7320 7468 6174 2072 756e 2061 202a 7465  s that run a *te
-00020c30: 7374 2a20 6a6f 622c 0a20 2020 2020 2020  st* job,.       
-00020c40: 2077 6869 6368 2077 696c 6c20 6265 2075   which will be u
-00020c50: 7365 6420 6279 2060 6261 6273 2d63 6865  sed by `babs-che
-00020c60: 636b 2d73 6574 7570 602e 0a20 2020 2020  ck-setup`..     
-00020c70: 2020 2053 6372 6970 7473 2074 6f20 6765     Scripts to ge
-00020c80: 6e65 7261 7465 3a0a 2020 2020 2020 2020  nerate:.        
-00020c90: 2a20 6063 616c 6c5f 7465 7374 5f6a 6f62  * `call_test_job
-00020ca0: 2e73 6860 2020 2020 2320 6a75 7374 206c  .sh`    # just l
-00020cb0: 696b 6520 6070 6172 7469 6369 7061 6e74  ike `participant
-00020cc0: 5f6a 6f62 2e73 6860 0a20 2020 2020 2020  _job.sh`.       
-00020cd0: 202a 2060 7465 7374 5f6a 6f62 2e70 7960   * `test_job.py`
-00020ce0: 2020 2020 2320 6a75 7374 206c 696b 6520      # just like 
-00020cf0: 6063 6f6e 7461 696e 6572 5f7a 6970 2e73  `container_zip.s
-00020d00: 6860 0a0a 2020 2020 2020 2020 5061 7261  h`..        Para
-00020d10: 6d65 7465 7273 3a0a 2020 2020 2020 2020  meters:.        
-00020d20: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020  -------------.  
-00020d30: 2020 2020 2020 666f 6c64 6572 5f63 6865        folder_che
-00020d40: 636b 5f73 6574 7570 3a20 7374 720a 2020  ck_setup: str.  
-00020d50: 2020 2020 2020 2020 2020 5468 6520 7061            The pa
-00020d60: 7468 2074 6f20 666f 6c64 6572 2060 6368  th to folder `ch
-00020d70: 6563 6b5f 7365 7475 7060 3b20 6765 6e65  eck_setup`; gene
-00020d80: 7261 7465 6420 7363 7269 7074 7320 7769  rated scripts wi
-00020d90: 6c6c 206c 6f63 6174 6520 696e 2074 6869  ll locate in thi
-00020da0: 7320 666f 6c64 6572 0a20 2020 2020 2020  s folder.       
-00020db0: 2073 7973 7465 6d3a 2063 6c61 7373 2060   system: class `
-00020dc0: 5379 7374 656d 600a 2020 2020 2020 2020  System`.        
-00020dd0: 2020 2020 696e 666f 726d 6174 696f 6e20      information 
-00020de0: 6f6e 2063 6c75 7374 6572 206d 616e 6167  on cluster manag
-00020df0: 656d 656e 7420 7379 7374 656d 0a20 2020  ement system.   
-00020e00: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00020e10: 2020 666e 5f63 616c 6c5f 7465 7374 5f6a    fn_call_test_j
-00020e20: 6f62 203d 206f 702e 6a6f 696e 2866 6f6c  ob = op.join(fol
-00020e30: 6465 725f 6368 6563 6b5f 7365 7475 702c  der_check_setup,
-00020e40: 2022 6361 6c6c 5f74 6573 745f 6a6f 622e   "call_test_job.
-00020e50: 7368 2229 0a20 2020 2020 2020 2066 6e5f  sh").        fn_
-00020e60: 7465 7374 5f6a 6f62 203d 206f 702e 6a6f  test_job = op.jo
-00020e70: 696e 2866 6f6c 6465 725f 6368 6563 6b5f  in(folder_check_
-00020e80: 7365 7475 702c 2022 7465 7374 5f6a 6f62  setup, "test_job
-00020e90: 2e70 7922 290a 2020 2020 2020 2020 2320  .py").        # 
-00020ea0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020eb0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020ec0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020ed0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20  ==============. 
-00020ee0: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
-00020ef0: 6520 6063 616c 6c5f 7465 7374 5f6a 6f62  e `call_test_job
-00020f00: 2e73 6860 2c20 7369 6d69 6c61 7220 746f  .sh`, similar to
-00020f10: 2060 7061 7274 6963 6970 616e 745f 6a6f   `participant_jo
-00020f20: 622e 7368 600a 2020 2020 2020 2020 2320  b.sh`.        # 
-00020f30: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020f40: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020f50: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00020f60: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20  ==============. 
-00020f70: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00020f80: 6620 7468 6520 6261 7368 2066 696c 6520  f the bash file 
-00020f90: 616c 7265 6164 7920 6578 6973 743a 0a20  already exist:. 
-00020fa0: 2020 2020 2020 2069 6620 6f70 2e65 7869         if op.exi
-00020fb0: 7374 7328 666e 5f63 616c 6c5f 7465 7374  sts(fn_call_test
-00020fc0: 5f6a 6f62 293a 0a20 2020 2020 2020 2020  _job):.         
-00020fd0: 2020 206f 732e 7265 6d6f 7665 2866 6e5f     os.remove(fn_
-00020fe0: 6361 6c6c 5f74 6573 745f 6a6f 6229 2020  call_test_job)  
-00020ff0: 2320 7265 6d6f 7665 2069 740a 0a20 2020  # remove it..   
-00021000: 2020 2020 2023 2057 7269 7465 2069 6e74       # Write int
-00021010: 6f20 7468 6520 6261 7368 2066 696c 653a  o the bash file:
-00021020: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
-00021030: 6c65 203d 206f 7065 6e28 666e 5f63 616c  le = open(fn_cal
-00021040: 6c5f 7465 7374 5f6a 6f62 2c20 2261 2229  l_test_job, "a")
-00021050: 2020 2023 206f 7065 6e20 696e 2061 7070     # open in app
-00021060: 656e 6420 6d6f 6465 0a0a 2020 2020 2020  end mode..      
-00021070: 2020 2320 4e4f 5445 3a20 6e6f 7420 746f    # NOTE: not to
-00021080: 2061 7574 6f6d 6174 6963 616c 6c79 2067   automatically g
-00021090: 656e 6572 6174 6520 7468 6520 696e 7465  enerate the inte
-000210a0: 7270 7265 7469 6e67 2073 6865 6c6c 3b0a  rpreting shell;.
-000210b0: 2020 2020 2020 2020 2320 2020 696e 7374          #   inst
-000210c0: 6561 642c 206c 6574 2075 7365 7273 2073  ead, let users s
-000210d0: 7065 6369 6679 2069 7420 696e 2074 6865  pecify it in the
-000210e0: 2063 6f6e 7461 696e 6572 2063 6f6e 6669   container confi
-000210f0: 6720 7961 6d6c 2066 696c 650a 2020 2020  g yaml file.    
-00021100: 2020 2020 2320 2020 7573 696e 6720 6069      #   using `i
-00021110: 6e74 6572 7072 6574 696e 675f 7368 656c  nterpreting_shel
-00021120: 6c60 0a0a 2020 2020 2020 2020 2320 436c  l`..        # Cl
-00021130: 7573 7465 7220 7265 736f 7572 6365 7320  uster resources 
-00021140: 7265 7175 6573 7469 6e67 3a0a 2020 2020  requesting:.    
-00021150: 2020 2020 636d 645f 6261 7368 6865 6164      cmd_bashhead
-00021160: 5f72 6573 6f75 7263 6573 203d 2067 656e  _resources = gen
-00021170: 6572 6174 655f 6261 7368 6865 6164 5f72  erate_bashhead_r
-00021180: 6573 6f75 7263 6573 2873 7973 7465 6d2c  esources(system,
-00021190: 2073 656c 662e 636f 6e66 6967 290a 2020   self.config).  
-000211a0: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-000211b0: 7772 6974 6528 636d 645f 6261 7368 6865  write(cmd_bashhe
-000211c0: 6164 5f72 6573 6f75 7263 6573 290a 0a20  ad_resources).. 
-000211d0: 2020 2020 2020 2023 2053 6372 6970 7420         # Script 
-000211e0: 7072 6561 6d62 6c65 733a 0a20 2020 2020  preambles:.     
-000211f0: 2020 2063 6d64 5f73 6372 6970 745f 7072     cmd_script_pr
-00021200: 6561 6d62 6c65 203d 2067 656e 6572 6174  eamble = generat
-00021210: 655f 636d 645f 7363 7269 7074 5f70 7265  e_cmd_script_pre
-00021220: 616d 626c 6528 7365 6c66 2e63 6f6e 6669  amble(self.confi
-00021230: 6729 0a20 2020 2020 2020 2062 6173 685f  g).        bash_
-00021240: 6669 6c65 2e77 7269 7465 2863 6d64 5f73  file.write(cmd_s
-00021250: 6372 6970 745f 7072 6561 6d62 6c65 290a  cript_preamble).
-00021260: 0a20 2020 2020 2020 2023 2057 6865 7265  .        # Where
-00021270: 2074 6865 2061 6e61 6c79 7369 7320 666f   the analysis fo
-00021280: 6c64 6572 2069 733a 0a20 2020 2020 2020  lder is:.       
-00021290: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
-000212a0: 2822 7061 7468 5f63 6865 636b 5f73 6574  ("path_check_set
-000212b0: 7570 3d22 202b 2066 6f6c 6465 725f 6368  up=" + folder_ch
-000212c0: 6563 6b5f 7365 7475 7020 2b20 225c 6e22  eck_setup + "\n"
-000212d0: 290a 0a20 2020 2020 2020 2023 2043 6861  )..        # Cha
-000212e0: 6e67 6520 686f 7720 7468 6973 2062 6173  nge how this bas
-000212f0: 6820 6669 6c65 2069 7320 7275 6e3a 0a20  h file is run:. 
-00021300: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
-00021310: 2e77 7269 7465 2822 5c6e 2320 4661 696c  .write("\n# Fail
-00021320: 2077 6865 6e65 7665 7220 736f 6d65 7468   whenever someth
-00021330: 696e 6720 6973 2066 6973 6879 2c22 0a20  ing is fishy,". 
-00021340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021350: 2020 2020 2020 202b 2022 2075 7365 202d         + " use -
-00021360: 7820 746f 2067 6574 2076 6572 626f 7365  x to get verbose
-00021370: 206c 6f67 6669 6c65 733a 5c6e 2229 0a20   logfiles:\n"). 
-00021380: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
-00021390: 2e77 7269 7465 2822 7365 7420 2d65 202d  .write("set -e -
-000213a0: 7520 2d78 5c6e 2229 0a0a 2020 2020 2020  u -x\n")..      
-000213b0: 2020 2320 4e4f 5445 3a20 5468 6572 6520    # NOTE: There 
-000213c0: 6973 206e 6f20 696e 7075 7420 6172 6775  is no input argu
-000213d0: 6d65 6e74 2066 6f72 2074 6869 7320 6261  ment for this ba
-000213e0: 7368 2066 696c 652e 0a0a 2020 2020 2020  sh file...      
-000213f0: 2020 2320 4368 616e 6765 2070 6174 6820    # Change path 
-00021400: 746f 2061 2074 656d 706f 7261 7279 206a  to a temporary j
-00021410: 6f62 2063 6f6d 7075 7465 2077 6f72 6b73  ob compute works
-00021420: 7061 6365 3a0a 2020 2020 2020 2020 2320  pace:.        # 
-00021430: 2020 7468 6520 7061 7468 2069 7320 6261    the path is ba
-00021440: 7365 6420 6f6e 2077 6861 7420 7573 6572  sed on what user
-00021450: 7320 7072 6f76 6964 6520 696e 2073 6563  s provide in sec
-00021460: 7469 6f6e 2027 6a6f 625f 636f 6d70 7574  tion 'job_comput
-00021470: 655f 7370 6163 6527 2069 6e20 5941 4d4c  e_space' in YAML
-00021480: 2066 696c 653a 0a20 2020 2020 2020 2063   file:.        c
-00021490: 6d64 5f6a 6f62 5f63 6f6d 7075 7465 5f73  md_job_compute_s
-000214a0: 7061 6365 203d 2067 656e 6572 6174 655f  pace = generate_
-000214b0: 636d 645f 6a6f 625f 636f 6d70 7574 655f  cmd_job_compute_
-000214c0: 7370 6163 6528 7365 6c66 2e63 6f6e 6669  space(self.confi
-000214d0: 6729 0a20 2020 2020 2020 2062 6173 685f  g).        bash_
-000214e0: 6669 6c65 2e77 7269 7465 2863 6d64 5f6a  file.write(cmd_j
-000214f0: 6f62 5f63 6f6d 7075 7465 5f73 7061 6365  ob_compute_space
-00021500: 290a 0a20 2020 2020 2020 2023 2043 616c  )..        # Cal
-00021510: 6c20 6074 6573 745f 6a6f 622e 7079 603a  l `test_job.py`:
-00021520: 0a20 2020 2020 2020 2023 2067 6574 2077  .        # get w
-00021530: 6869 6368 2070 7974 686f 6e3a 0a20 2020  hich python:.   
-00021540: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
-00021550: 7269 7465 2822 5c6e 2320 4361 6c6c 2060  rite("\n# Call `
-00021560: 7465 7374 5f6a 6f62 2e70 7960 3a5c 6e22  test_job.py`:\n"
-00021570: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
-00021580: 696c 652e 7772 6974 6528 2277 6869 6368  ile.write("which
-00021590: 5f70 7974 686f 6e3d 6077 6869 6368 2070  _python=`which p
-000215a0: 7974 686f 6e60 5c6e 2229 0a20 2020 2020  ython`\n").     
-000215b0: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-000215c0: 7465 2822 6375 7272 656e 745f 7077 643d  te("current_pwd=
-000215d0: 247b 5057 447d 2220 2b20 225c 6e22 290a  ${PWD}" + "\n").
-000215e0: 2020 2020 2020 2020 2320 6361 6c6c 2060          # call `
-000215f0: 7465 7374 5f6a 6f62 2e70 7960 3a0a 2020  test_job.py`:.  
-00021600: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
-00021610: 7772 6974 6528 2265 6368 6f20 2743 616c  write("echo 'Cal
-00021620: 6c69 6e67 2060 7465 7374 5f6a 6f62 2e70  ling `test_job.p
-00021630: 7960 2e2e 2e27 5c6e 2229 0a20 2020 2020  y`...'\n").     
-00021640: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
-00021650: 7465 2822 247b 7768 6963 685f 7079 7468  te("${which_pyth
-00021660: 6f6e 7d20 2220 2b20 666e 5f74 6573 745f  on} " + fn_test_
-00021670: 6a6f 620a 2020 2020 2020 2020 2020 2020  job.            
-00021680: 2020 2020 2020 2020 2020 2020 2b20 2220              + " 
-00021690: 2d2d 7061 7468 2d77 6f72 6b73 7061 6365  --path-workspace
-000216a0: 2024 7b63 7572 7265 6e74 5f70 7764 7d22   ${current_pwd}"
-000216b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000216c0: 2020 2020 2020 2020 202b 2022 202d 2d70           + " --p
-000216d0: 6174 682d 6368 6563 6b2d 7365 7475 7020  ath-check-setup 
-000216e0: 2220 2b20 666f 6c64 6572 5f63 6865 636b  " + folder_check
-000216f0: 5f73 6574 7570 202b 2022 5c6e 2229 0a0a  _setup + "\n")..
-00021700: 2020 2020 2020 2020 2320 4563 686f 2073          # Echo s
-00021710: 7563 6365 7373 3a0a 2020 2020 2020 2020  uccess:.        
-00021720: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
-00021730: 225c 6e65 6368 6f20 5355 4343 4553 535c  "\necho SUCCESS\
-00021740: 6e22 290a 0a20 2020 2020 2020 2070 726f  n")..        pro
-00021750: 635f 6368 6d6f 645f 6261 7368 6669 6c65  c_chmod_bashfile
-00021760: 203d 2073 7562 7072 6f63 6573 732e 7275   = subprocess.ru
-00021770: 6e28 0a20 2020 2020 2020 2020 2020 205b  n(.            [
-00021780: 2263 686d 6f64 222c 2022 2b78 222c 2066  "chmod", "+x", f
-00021790: 6e5f 6361 6c6c 5f74 6573 745f 6a6f 625d  n_call_test_job]
-000217a0: 2c20 2023 2065 2e67 2e2c 2063 686d 6f64  ,  # e.g., chmod
-000217b0: 202b 7820 636f 6465 2f70 6172 7469 6369   +x code/partici
-000217c0: 7061 6e74 5f6a 6f62 2e73 680a 2020 2020  pant_job.sh.    
-000217d0: 2020 2020 2020 2020 7374 646f 7574 3d73          stdout=s
-000217e0: 7562 7072 6f63 6573 732e 5049 5045 0a20  ubprocess.PIPE. 
-000217f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00021800: 2020 2020 2070 726f 635f 6368 6d6f 645f       proc_chmod_
-00021810: 6261 7368 6669 6c65 2e63 6865 636b 5f72  bashfile.check_r
-00021820: 6574 7572 6e63 6f64 6528 290a 0a20 2020  eturncode()..   
-00021830: 2020 2020 2023 203d 3d3d 3d3d 3d3d 3d3d       # =========
-00021840: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00021850: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00021860: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-00021870: 3d3d 3d3d 3d0a 2020 2020 2020 2020 2320  =====.        # 
-00021880: 4765 6e65 7261 7465 2060 7465 7374 5f6a  Generate `test_j
-00021890: 6f62 2e70 7960 2c20 7369 6d69 6c61 7220  ob.py`, similar 
-000218a0: 746f 2060 636f 6e74 6169 6e65 725f 7a69  to `container_zi
-000218b0: 702e 7368 600a 2020 2020 2020 2020 2320  p.sh`.        # 
-000218c0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000218d0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000218e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
-000218f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 0a20  ==============. 
-00021900: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00021910: 6620 7468 6520 6261 7368 2066 696c 6520  f the bash file 
-00021920: 616c 7265 6164 7920 6578 6973 743a 0a20  already exist:. 
-00021930: 2020 2020 2020 2069 6620 6f70 2e65 7869         if op.exi
-00021940: 7374 7328 666e 5f74 6573 745f 6a6f 6229  sts(fn_test_job)
-00021950: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
-00021960: 2e72 656d 6f76 6528 666e 5f74 6573 745f  .remove(fn_test_
-00021970: 6a6f 6229 2020 2320 7265 6d6f 7665 2069  job)  # remove i
-00021980: 740a 0a20 2020 2020 2020 2023 2043 6f70  t..        # Cop
-00021990: 7920 7468 6520 6578 6973 7469 6e67 2070  y the existing p
-000219a0: 7974 686f 6e20 7363 7269 7074 2074 6f20  ython script to 
-000219b0: 7468 6973 2042 4142 5320 7072 6f6a 6563  this BABS projec
-000219c0: 743a 0a20 2020 2020 2020 2023 206c 6f63  t:.        # loc
-000219d0: 6174 696f 6e20 6f66 2063 7572 7265 6e74  ation of current
-000219e0: 2070 7974 686f 6e20 7363 7269 7074 3a0a   python script:.
-000219f0: 2020 2020 2020 2020 2320 2020 606f 702e          #   `op.
-00021a00: 6162 7370 6174 6828 2960 2069 7320 746f  abspath()` is to
-00021a10: 206d 616b 6520 7375 7265 2061 6c77 6179   make sure alway
-00021a20: 7320 7265 7475 726e 7320 6162 7320 7061  s returns abs pa
-00021a30: 7468 2c20 7265 6761 7264 6c65 7373 206f  th, regardless o
-00021a40: 6620 7079 7468 6f6e 2076 6572 7369 6f6e  f python version
-00021a50: 0a20 2020 2020 2020 2023 2020 2072 6566  .        #   ref
-00021a60: 3a20 6874 7470 733a 2f2f 6e6f 7465 2e6e  : https://note.n
-00021a70: 6b6d 6b2e 6d65 2f65 6e2f 7079 7468 6f6e  kmk.me/en/python
-00021a80: 2d73 6372 6970 742d 6669 6c65 2d70 6174  -script-file-pat
-00021a90: 682f 0a20 2020 2020 2020 205f 5f6c 6f63  h/.        __loc
-00021aa0: 6174 696f 6e5f 5f20 3d20 6f70 2e72 6561  ation__ = op.rea
-00021ab0: 6c70 6174 6828 6f70 2e64 6972 6e61 6d65  lpath(op.dirname
-00021ac0: 286f 702e 6162 7370 6174 6828 5f5f 6669  (op.abspath(__fi
-00021ad0: 6c65 5f5f 2929 290a 2020 2020 2020 2020  le__))).        
-00021ae0: 666e 5f66 726f 6d20 3d20 6f70 2e6a 6f69  fn_from = op.joi
-00021af0: 6e28 5f5f 6c6f 6361 7469 6f6e 5f5f 2c20  n(__location__, 
-00021b00: 2274 656d 706c 6174 655f 7465 7374 5f6a  "template_test_j
-00021b10: 6f62 2e70 7922 290a 2020 2020 2020 2020  ob.py").        
-00021b20: 2320 636f 7079 3a0a 2020 2020 2020 2020  # copy:.        
-00021b30: 7368 7574 696c 2e63 6f70 7928 666e 5f66  shutil.copy(fn_f
-00021b40: 726f 6d2c 2066 6e5f 7465 7374 5f6a 6f62  rom, fn_test_job
-00021b50: 290a 0a20 2020 2020 2020 2023 2063 6861  )..        # cha
-00021b60: 6e67 6520 7468 6520 7065 726d 6973 7369  nge the permissi
-00021b70: 6f6e 206f 6620 7468 6973 2062 6173 6820  on of this bash 
-00021b80: 6669 6c65 3a0a 2020 2020 2020 2020 7072  file:.        pr
-00021b90: 6f63 5f63 686d 6f64 5f70 7966 696c 6520  oc_chmod_pyfile 
-00021ba0: 3d20 7375 6270 726f 6365 7373 2e72 756e  = subprocess.run
-00021bb0: 280a 2020 2020 2020 2020 2020 2020 5b22  (.            ["
-00021bc0: 6368 6d6f 6422 2c20 222b 7822 2c20 666e  chmod", "+x", fn
-00021bd0: 5f74 6573 745f 6a6f 625d 2c20 2023 2065  _test_job],  # e
-00021be0: 2e67 2e2c 2063 686d 6f64 202b 7820 636f  .g., chmod +x co
-00021bf0: 6465 2f70 6172 7469 6369 7061 6e74 5f6a  de/participant_j
-00021c00: 6f62 2e73 680a 2020 2020 2020 2020 2020  ob.sh.          
-00021c10: 2020 7374 646f 7574 3d73 7562 7072 6f63    stdout=subproc
-00021c20: 6573 732e 5049 5045 0a20 2020 2020 2020  ess.PIPE.       
-00021c30: 2020 2020 2029 0a20 2020 2020 2020 2070       ).        p
-00021c40: 726f 635f 6368 6d6f 645f 7079 6669 6c65  roc_chmod_pyfile
-00021c50: 2e63 6865 636b 5f72 6574 7572 6e63 6f64  .check_returncod
-00021c60: 6528 290a 0a20 2020 2064 6566 2067 656e  e()..    def gen
-00021c70: 6572 6174 655f 6a6f 625f 7375 626d 6974  erate_job_submit
-00021c80: 5f74 656d 706c 6174 6528 7365 6c66 2c20  _template(self, 
-00021c90: 7961 6d6c 5f70 6174 682c 2062 6162 732c  yaml_path, babs,
-00021ca0: 2073 7973 7465 6d2c 2074 6573 743d 4661   system, test=Fa
-00021cb0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-00021cc0: 220a 2020 2020 2020 2020 5468 6973 2069  ".        This i
-00021cd0: 7320 746f 2067 656e 6572 6174 6520 6120  s to generate a 
-00021ce0: 5941 4d4c 2066 696c 6520 7468 6174 2073  YAML file that s
-00021cf0: 6572 7665 7320 6173 2061 2074 656d 706c  erves as a templ
-00021d00: 6174 650a 2020 2020 2020 2020 6f66 206a  ate.        of j
-00021d10: 6f62 2073 7562 6d69 7373 696f 6e20 6f66  ob submission of
-00021d20: 206f 6e65 2070 6172 7469 6369 7061 6e74   one participant
-00021d30: 2028 6f72 2073 6573 7369 6f6e 292c 0a20   (or session),. 
-00021d40: 2020 2020 2020 206f 7220 7465 7374 206a         or test j
-00021d50: 6f62 2073 7562 6d69 7373 696f 6e20 696e  ob submission in
-00021d60: 2060 6261 6273 2d63 6865 636b 2d73 6574   `babs-check-set
-00021d70: 7570 602e 0a0a 2020 2020 2020 2020 5061  up`...        Pa
-00021d80: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
-00021d90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a    -------------.
-00021da0: 2020 2020 2020 2020 7961 6d6c 5f70 6174          yaml_pat
-00021db0: 683a 2073 7472 0a20 2020 2020 2020 2020  h: str.         
-00021dc0: 2020 2054 6865 2070 6174 6820 746f 2074     The path to t
-00021dd0: 6865 2079 616d 6c20 6669 6c65 2074 6f20  he yaml file to 
-00021de0: 6265 2067 656e 6572 6174 6564 2e20 4974  be generated. It
-00021df0: 2073 686f 756c 6420 6265 2069 6e20 7468   should be in th
-00021e00: 6520 6061 6e61 6c79 7369 732f 636f 6465  e `analysis/code
-00021e10: 6020 666f 6c64 6572 2e0a 2020 2020 2020  ` folder..      
-00021e20: 2020 2020 2020 4974 2068 6173 2073 6576        It has sev
-00021e30: 6572 616c 2066 6965 6c64 733a 2031 2920  eral fields: 1) 
-00021e40: 636d 645f 7465 6d70 6c61 7465 3b20 3229  cmd_template; 2)
-00021e50: 206a 6f62 5f6e 616d 655f 7465 6d70 6c61   job_name_templa
-00021e60: 7465 0a20 2020 2020 2020 2062 6162 733a  te.        babs:
-00021e70: 2063 6c61 7373 2060 4241 4253 600a 2020   class `BABS`.  
-00021e80: 2020 2020 2020 2020 2020 696e 666f 726d            inform
-00021e90: 6174 696f 6e20 6162 6f75 7420 7468 6520  ation about the 
-00021ea0: 4241 4253 2070 726f 6a65 6374 0a20 2020  BABS project.   
-00021eb0: 2020 2020 2073 7973 7465 6d3a 2063 6c61       system: cla
-00021ec0: 7373 2060 5379 7374 656d 600a 2020 2020  ss `System`.    
-00021ed0: 2020 2020 2020 2020 696e 666f 726d 6174          informat
-00021ee0: 696f 6e20 6f6e 2063 6c75 7374 6572 206d  ion on cluster m
-00021ef0: 616e 6167 656d 656e 7420 7379 7374 656d  anagement system
-00021f00: 0a20 2020 2020 2020 2074 6573 743a 2062  .        test: b
-00021f10: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
-00021f20: 666c 6167 2074 6f20 7365 7420 746f 2054  flag to set to T
-00021f30: 7275 6520 6966 2067 656e 6572 6174 696e  rue if generatin
-00021f40: 6720 7468 6520 7465 7374 206a 6f62 2073  g the test job s
-00021f50: 7562 6d69 7420 7465 6d70 6c61 7465 0a20  ubmit template. 
-00021f60: 2020 2020 2020 2020 2020 2066 6f72 2060             for `
-00021f70: 6261 6273 2d63 6865 636b 2d73 6574 7570  babs-check-setup
-00021f80: 602e 0a20 2020 2020 2020 2022 2222 0a0a  `..        """..
-00021f90: 2020 2020 2020 2020 2320 5365 6374 696f          # Sectio
-00021fa0: 6e20 313a 2043 6f6d 6d61 6e64 2066 6f72  n 1: Command for
-00021fb0: 2073 7562 6d69 7474 696e 6720 7468 6520   submitting the 
-00021fc0: 6a6f 623a 202d 2d2d 2d2d 2d2d 2d2d 2d2d  job: -----------
-00021fd0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00021fe0: 0a20 2020 2020 2020 2023 2046 6c61 6773  .        # Flags
-00021ff0: 2077 6865 6e20 7375 626d 6974 7469 6e67   when submitting
-00022000: 2074 6865 206a 6f62 3a0a 2020 2020 2020   the job:.      
-00022010: 2020 6966 2073 7973 7465 6d2e 7479 7065    if system.type
-00022020: 203d 3d20 2273 6765 223a 0a20 2020 2020   == "sge":.     
-00022030: 2020 2020 2020 2073 7562 6d69 745f 6865         submit_he
-00022040: 6164 203d 2022 7173 7562 202d 6377 6422  ad = "qsub -cwd"
-00022050: 0a20 2020 2020 2020 2020 2020 2065 6e76  .            env
-00022060: 5f66 6c61 6773 203d 2022 2d76 2044 534c  _flags = "-v DSL
-00022070: 4f43 4b46 494c 453d 2220 2b20 6261 6273  OCKFILE=" + babs
-00022080: 2e61 6e61 6c79 7369 735f 7061 7468 202b  .analysis_path +
-00022090: 2022 2f2e 5347 455f 6461 7461 6c61 645f   "/.SGE_datalad_
-000220a0: 6c6f 636b 220a 2020 2020 2020 2020 656c  lock".        el
-000220b0: 6966 2073 7973 7465 6d2e 7479 7065 203d  if system.type =
-000220c0: 3d20 2273 6c75 726d 223a 0a20 2020 2020  = "slurm":.     
-000220d0: 2020 2020 2020 2073 7562 6d69 745f 6865         submit_he
-000220e0: 6164 203d 2022 7362 6174 6368 220a 2020  ad = "sbatch".  
-000220f0: 2020 2020 2020 2020 2020 656e 765f 666c            env_fl
-00022100: 6167 7320 3d20 222d 2d65 7870 6f72 743d  ags = "--export=
-00022110: 4453 4c4f 434b 4649 4c45 3d22 202b 2062  DSLOCKFILE=" + b
-00022120: 6162 732e 616e 616c 7973 6973 5f70 6174  abs.analysis_pat
-00022130: 6820 2b20 222f 2e53 4c55 524d 5f64 6174  h + "/.SLURM_dat
-00022140: 616c 6164 5f6c 6f63 6b22 0a20 2020 2020  alad_lock".     
-00022150: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00022160: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
-00022170: 726e 2822 6e6f 7420 7375 7070 6f72 7469  rn("not supporti
-00022180: 6e67 2073 7973 7465 6d73 206f 7468 6572  ng systems other
-00022190: 2074 6861 6e20 7367 652e 2e2e 2229 0a0a   than sge...")..
-000221a0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000221b0: 6966 2074 6865 2062 6173 6820 6669 6c65  if the bash file
-000221c0: 2061 6c72 6561 6479 2065 7869 7374 3a0a   already exist:.
-000221d0: 2020 2020 2020 2020 6966 206f 702e 6578          if op.ex
-000221e0: 6973 7473 2879 616d 6c5f 7061 7468 293a  ists(yaml_path):
-000221f0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00022200: 7265 6d6f 7665 2879 616d 6c5f 7061 7468  remove(yaml_path
-00022210: 2920 2023 2072 656d 6f76 6520 6974 0a0a  )  # remove it..
-00022220: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00022230: 696e 746f 2074 6865 2062 6173 6820 6669  into the bash fi
-00022240: 6c65 3a0a 2020 2020 2020 2020 7961 6d6c  le:.        yaml
-00022250: 5f66 696c 6520 3d20 6f70 656e 2879 616d  _file = open(yam
-00022260: 6c5f 7061 7468 2c20 2261 2229 2020 2023  l_path, "a")   #
-00022270: 206f 7065 6e20 696e 2061 7070 656e 6420   open in append 
-00022280: 6d6f 6465 0a20 2020 2020 2020 2069 6620  mode.        if 
-00022290: 6e6f 7420 7465 7374 3a0a 2020 2020 2020  not test:.      
-000222a0: 2020 2020 2020 7961 6d6c 5f66 696c 652e        yaml_file.
-000222b0: 7772 6974 6528 2223 2027 247b 7375 625f  write("# '${sub_
-000222c0: 6964 7d27 2061 6e64 2027 247b 7365 735f  id}' and '${ses_
-000222d0: 6964 7d27 2061 7265 2070 6c61 6365 686f  id}' are placeho
-000222e0: 6c64 6572 732e 2220 2b20 225c 6e22 290a  lders." + "\n").
-000222f0: 2020 2020 2020 2020 2020 2020 2320 5661              # Va
-00022300: 7269 6162 6c65 7320 746f 2075 7365 3a0a  riables to use:.
-00022310: 2020 2020 2020 2020 2020 2020 2320 6064              # `d
-00022320: 7373 6f75 7263 6560 3a20 496e 7075 7420  ssource`: Input 
-00022330: 5249 413a 0a20 2020 2020 2020 2020 2020  RIA:.           
-00022340: 2064 7373 6f75 7263 6520 3d20 6261 6273   dssource = babs
-00022350: 2e69 6e70 7574 5f72 6961 5f75 726c 202b  .input_ria_url +
-00022360: 2022 2322 202b 2062 6162 732e 616e 616c   "#" + babs.anal
-00022370: 7973 6973 5f64 6174 6173 6574 5f69 640a  ysis_dataset_id.
-00022380: 2020 2020 2020 2020 2020 2020 2320 6070              # `p
-00022390: 7573 6867 6974 7265 6d6f 7465 603a 204f  ushgitremote`: O
-000223a0: 7574 7075 7420 5249 413a 0a20 2020 2020  utput RIA:.     
-000223b0: 2020 2020 2020 2070 7573 6867 6974 7265         pushgitre
-000223c0: 6d6f 7465 203d 2062 6162 732e 6f75 7470  mote = babs.outp
-000223d0: 7574 5f72 6961 5f64 6174 615f 6469 720a  ut_ria_data_dir.
-000223e0: 0a20 2020 2020 2020 2023 2047 656e 6572  .        # Gener
-000223f0: 6174 6520 7468 6520 636f 6d6d 616e 643a  ate the command:
-00022400: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
-00022410: 2054 4244 3a20 6164 6469 6e67 2062 656c   TBD: adding bel
-00022420: 6f77 2074 6f20 6064 6963 745f 636c 7573  ow to `dict_clus
-00022430: 7465 725f 7379 7374 656d 732e 7961 6d6c  ter_systems.yaml
-00022440: 6020 6f72 2061 6e6f 7468 6572 2059 414d  ` or another YAM
-00022450: 4c20 6669 6c65 3f0a 2020 2020 2020 2020  L file?.        
-00022460: 6966 2073 7973 7465 6d2e 7479 7065 203d  if system.type =
-00022470: 3d20 2273 6765 223a 0a20 2020 2020 2020  = "sge":.       
-00022480: 2020 2020 206e 616d 655f 666c 6167 5f73       name_flag_s
-00022490: 7472 203d 2022 202d 4e20 220a 2020 2020  tr = " -N ".    
-000224a0: 2020 2020 6966 2073 7973 7465 6d2e 7479      if system.ty
-000224b0: 7065 203d 3d20 2273 6c75 726d 223a 0a20  pe == "slurm":. 
-000224c0: 2020 2020 2020 2020 2020 206e 616d 655f             name_
-000224d0: 666c 6167 5f73 7472 203d 2022 202d 2d6a  flag_str = " --j
-000224e0: 6f62 2d6e 616d 6520 220a 0a20 2020 2020  ob-name "..     
-000224f0: 2020 2023 2053 6563 7469 6f6e 2032 3a20     # Section 2: 
-00022500: 4a6f 6220 6e61 6d65 3a20 2d2d 2d2d 2d2d  Job name: ------
-00022510: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00022520: 2d2d 2d2d 2d0a 2020 2020 2020 2020 2320  -----.        # 
-00022530: 4a6f 6220 6e61 6d65 3a0a 2020 2020 2020  Job name:.      
-00022540: 2020 6966 2074 6573 743a 0a20 2020 2020    if test:.     
-00022550: 2020 2020 2020 206a 6f62 5f6e 616d 6520         job_name 
-00022560: 3d20 7365 6c66 2e63 6f6e 7461 696e 6572  = self.container
-00022570: 5f6e 616d 655b 303a 335d 202b 2022 5f22  _name[0:3] + "_"
-00022580: 202b 2022 7465 7374 5f6a 6f62 220a 2020   + "test_job".  
-00022590: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000225a0: 2020 2020 2020 2020 6a6f 625f 6e61 6d65          job_name
-000225b0: 203d 2073 656c 662e 636f 6e74 6169 6e65   = self.containe
-000225c0: 725f 6e61 6d65 5b30 3a33 5d20 2b20 225f  r_name[0:3] + "_
-000225d0: 2220 2b20 2224 7b73 7562 5f69 647d 220a  " + "${sub_id}".
-000225e0: 2020 2020 2020 2020 2020 2020 6966 2062              if b
-000225f0: 6162 732e 7479 7065 5f73 6573 7369 6f6e  abs.type_session
-00022600: 203d 3d20 226d 756c 7469 2d73 6573 223a   == "multi-ses":
-00022610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022620: 206a 6f62 5f6e 616d 6520 2b3d 2022 5f24   job_name += "_$
-00022630: 7b73 6573 5f69 647d 220a 0a20 2020 2020  {ses_id}"..     
-00022640: 2020 2023 204e 6f77 2c20 7765 2063 616e     # Now, we can
-00022650: 2064 6566 696e 6520 7374 646f 7574 2061   define stdout a
-00022660: 6e64 2073 7464 6572 7220 6669 6c65 206e  nd stderr file n
-00022670: 616d 6573 2f70 6174 6873 3a0a 2020 2020  ames/paths:.    
-00022680: 2020 2020 6966 2073 7973 7465 6d2e 7479      if system.ty
-00022690: 7065 203d 3d20 2273 6765 223a 0a20 2020  pe == "sge":.   
-000226a0: 2020 2020 2020 2020 2023 2073 6765 2063           # sge c
-000226b0: 6c75 7374 6572 7320 6f6e 6c79 206e 6565  lusters only nee
-000226c0: 6420 6c6f 6773 2066 6f6c 6465 7220 7061  d logs folder pa
-000226d0: 7468 3b20 6669 6c65 6e61 6d65 2069 7320  th; filename is 
-000226e0: 6e6f 7420 6e65 6564 6564 3a0a 2020 2020  not needed:.    
-000226f0: 2020 2020 2020 2020 656f 5f61 7267 7320          eo_args 
-00022700: 3d20 222d 6520 2220 2b20 6261 6273 2e61  = "-e " + babs.a
-00022710: 6e61 6c79 7369 735f 7061 7468 202b 2022  nalysis_path + "
-00022720: 2f6c 6f67 7320 2220 5c0a 2020 2020 2020  /logs " \.      
-00022730: 2020 2020 2020 2020 2020 2b20 222d 6f20            + "-o 
-00022740: 2220 2b20 6261 6273 2e61 6e61 6c79 7369  " + babs.analysi
-00022750: 735f 7061 7468 202b 2022 2f6c 6f67 7322  s_path + "/logs"
-00022760: 0a20 2020 2020 2020 2065 6c69 6620 7379  .        elif sy
-00022770: 7374 656d 2e74 7970 6520 3d3d 2022 736c  stem.type == "sl
-00022780: 7572 6d22 3a0a 2020 2020 2020 2020 2020  urm":.          
-00022790: 2020 2320 736c 7572 6d20 636c 7573 7465    # slurm cluste
-000227a0: 7273 2061 6c73 6f20 6e65 6564 2065 7861  rs also need exa
-000227b0: 6374 2066 696c 656e 616d 6573 3a0a 2020  ct filenames:.  
-000227c0: 2020 2020 2020 2020 2020 656f 5f61 7267            eo_arg
-000227d0: 7320 3d20 222d 6520 2220 2b20 6261 6273  s = "-e " + babs
-000227e0: 2e61 6e61 6c79 7369 735f 7061 7468 202b  .analysis_path +
-000227f0: 2066 222f 6c6f 6773 2f7b 6a6f 625f 6e61   f"/logs/{job_na
-00022800: 6d65 7d2e 6525 4120 2220 5c0a 2020 2020  me}.e%A " \.    
-00022810: 2020 2020 2020 2020 2020 2020 2b20 222d              + "-
-00022820: 6f20 2220 2b20 6261 6273 2e61 6e61 6c79  o " + babs.analy
-00022830: 7369 735f 7061 7468 202b 2066 222f 6c6f  sis_path + f"/lo
-00022840: 6773 2f7b 6a6f 625f 6e61 6d65 7d2e 6f25  gs/{job_name}.o%
-00022850: 4122 0a0a 2020 2020 2020 2020 2320 4765  A"..        # Ge
-00022860: 6e65 7261 7465 2074 6865 206a 6f62 2073  nerate the job s
-00022870: 7562 6d69 7373 696f 6e20 636f 6d6d 616e  ubmission comman
-00022880: 642c 2077 6974 6820 7375 6220 4944 2061  d, with sub ID a
-00022890: 6e64 2073 6573 2049 4420 6173 2070 6c61  nd ses ID as pla
-000228a0: 6365 686f 6c64 6572 733a 0a20 2020 2020  ceholders:.     
-000228b0: 2020 2063 6d64 203d 2073 7562 6d69 745f     cmd = submit_
-000228c0: 6865 6164 202b 2022 2022 202b 2065 6e76  head + " " + env
-000228d0: 5f66 6c61 6773 202b 206e 616d 655f 666c  _flags + name_fl
-000228e0: 6167 5f73 7472 202b 206a 6f62 5f6e 616d  ag_str + job_nam
-000228f0: 6520 2b20 2220 2220 2b20 656f 5f61 7267  e + " " + eo_arg
-00022900: 7320 2b20 2220 220a 2020 2020 2020 2020  s + " ".        
-00022910: 6966 2074 6573 743a 0a20 2020 2020 2020  if test:.       
-00022920: 2020 2020 2063 6d64 202b 3d20 6261 6273       cmd += babs
-00022930: 2e61 6e61 6c79 7369 735f 7061 7468 202b  .analysis_path +
-00022940: 2022 2f63 6f64 652f 6368 6563 6b5f 7365   "/code/check_se
-00022950: 7475 702f 6361 6c6c 5f74 6573 745f 6a6f  tup/call_test_jo
-00022960: 622e 7368 220a 2020 2020 2020 2020 656c  b.sh".        el
-00022970: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00022980: 2320 6966 2074 6573 7420 6973 2046 616c  # if test is Fal
-00022990: 7365 2c20 7468 6520 7479 7065 206f 6620  se, the type of 
-000229a0: 7365 7373 696f 6e20 7769 6c6c 2062 6520  session will be 
-000229b0: 6368 6563 6b65 640a 2020 2020 2020 2020  checked.        
-000229c0: 2020 2020 6966 2062 6162 732e 7479 7065      if babs.type
-000229d0: 5f73 6573 7369 6f6e 203d 3d20 2273 696e  _session == "sin
-000229e0: 676c 652d 7365 7322 3a0a 2020 2020 2020  gle-ses":.      
-000229f0: 2020 2020 2020 2020 2020 636d 6420 2b3d            cmd +=
-00022a00: 2062 6162 732e 616e 616c 7973 6973 5f70   babs.analysis_p
-00022a10: 6174 6820 2b20 222f 636f 6465 2f70 6172  ath + "/code/par
-00022a20: 7469 6369 7061 6e74 5f6a 6f62 2e73 6822  ticipant_job.sh"
-00022a30: 202b 2022 2022 205c 0a20 2020 2020 2020   + " " \.       
-00022a40: 2020 2020 2020 2020 2020 2020 202b 2064               + d
-00022a50: 7373 6f75 7263 6520 2b20 2220 2220 5c0a  ssource + " " \.
-00022a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022a70: 2020 2020 2b20 7075 7368 6769 7472 656d      + pushgitrem
-00022a80: 6f74 6520 2b20 2220 2220 2b20 2224 7b73  ote + " " + "${s
-00022a90: 7562 5f69 647d 220a 2020 2020 2020 2020  ub_id}".        
-00022aa0: 2020 2020 656c 6966 2062 6162 732e 7479      elif babs.ty
-00022ab0: 7065 5f73 6573 7369 6f6e 203d 3d20 226d  pe_session == "m
-00022ac0: 756c 7469 2d73 6573 223a 0a20 2020 2020  ulti-ses":.     
-00022ad0: 2020 2020 2020 2020 2020 2063 6d64 202b             cmd +
-00022ae0: 3d20 6261 6273 2e61 6e61 6c79 7369 735f  = babs.analysis_
-00022af0: 7061 7468 202b 2022 2f63 6f64 652f 7061  path + "/code/pa
-00022b00: 7274 6963 6970 616e 745f 6a6f 622e 7368  rticipant_job.sh
-00022b10: 2220 2b20 2220 2220 5c0a 2020 2020 2020  " + " " \.      
-00022b20: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00022b30: 6473 736f 7572 6365 202b 2022 2022 205c  dssource + " " \
-00022b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00022b50: 2020 2020 202b 2070 7573 6867 6974 7265       + pushgitre
-00022b60: 6d6f 7465 202b 2022 2022 202b 2022 247b  mote + " " + "${
-00022b70: 7375 625f 6964 7d20 247b 7365 735f 6964  sub_id} ${ses_id
-00022b80: 7d22 0a0a 2020 2020 2020 2020 7961 6d6c  }"..        yaml
-00022b90: 5f66 696c 652e 7772 6974 6528 2263 6d64  _file.write("cmd
-00022ba0: 5f74 656d 706c 6174 653a 2027 2220 2b20  _template: '" + 
-00022bb0: 636d 6420 2b20 2227 2220 2b20 225c 6e22  cmd + "'" + "\n"
-00022bc0: 290a 2020 2020 2020 2020 7961 6d6c 5f66  ).        yaml_f
-00022bd0: 696c 652e 7772 6974 6528 226a 6f62 5f6e  ile.write("job_n
-00022be0: 616d 655f 7465 6d70 6c61 7465 3a20 2722  ame_template: '"
-00022bf0: 202b 206a 6f62 5f6e 616d 6520 2b20 2227   + job_name + "'
-00022c00: 5c6e 2229 0a20 2020 2020 2020 2079 616d  \n").        yam
-00022c10: 6c5f 6669 6c65 2e63 6c6f 7365 2829 0a    l_file.close().
+0001f170: 6974 6528 2742 5241 4e43 483d 226a 6f62  ite('BRANCH="job
+0001f180: 2d24 7b27 202b 2076 6172 6e61 6d65 5f6a  -${' + varname_j
+0001f190: 6f62 6964 202b 2027 7d2d 247b 7375 6269  obid + '}-${subi
+0001f1a0: 647d 2d24 7b73 6573 6964 7d22 2720 2b20  d}-${sesid}"' + 
+0001f1b0: 275c 6e27 290a 2020 2020 2020 2020 656c  '\n').        el
+0001f1c0: 6966 2074 7970 655f 7365 7373 696f 6e20  if type_session 
+0001f1d0: 3d3d 2022 7369 6e67 6c65 2d73 6573 223a  == "single-ses":
+0001f1e0: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
+0001f1f0: 685f 6669 6c65 2e77 7269 7465 2827 4252  h_file.write('BR
+0001f200: 414e 4348 3d22 6a6f 622d 247b 2720 2b20  ANCH="job-${' + 
+0001f210: 7661 726e 616d 655f 6a6f 6269 6420 2b20  varname_jobid + 
+0001f220: 277d 2d24 7b73 7562 6964 7d22 2720 2b20  '}-${subid}"' + 
+0001f230: 275c 6e27 290a 0a20 2020 2020 2020 2062  '\n')..        b
+0001f240: 6173 685f 6669 6c65 2e77 7269 7465 2827  ash_file.write('
+0001f250: 6d6b 6469 7220 247b 4252 414e 4348 7d27  mkdir ${BRANCH}'
+0001f260: 202b 2027 5c6e 2729 0a20 2020 2020 2020   + '\n').       
+0001f270: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
+0001f280: 2827 6364 2024 7b42 5241 4e43 487d 2720  ('cd ${BRANCH}' 
+0001f290: 2b20 275c 6e27 290a 0a20 2020 2020 2020  + '\n')..       
+0001f2a0: 2023 2064 6174 616c 6164 2063 6c6f 6e65   # datalad clone
+0001f2b0: 2074 6865 2069 6e70 7574 2072 6961 3a0a   the input ria:.
+0001f2c0: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
+0001f2d0: 652e 7772 6974 6528 225c 6e23 2043 6c6f  e.write("\n# Clo
+0001f2e0: 6e65 2074 6865 2064 6174 6120 6672 6f6d  ne the data from
+0001f2f0: 2069 6e70 7574 2052 4941 3a5c 6e22 290a   input RIA:\n").
+0001f300: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
+0001f310: 652e 7772 6974 6528 2764 6174 616c 6164  e.write('datalad
+0001f320: 2063 6c6f 6e65 2022 247b 6473 736f 7572   clone "${dssour
+0001f330: 6365 7d22 2064 7327 202b 2022 5c6e 2229  ce}" ds' + "\n")
+0001f340: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001f350: 6c65 2e77 7269 7465 2822 6364 2064 7322  le.write("cd ds"
+0001f360: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
+0001f370: 2075 7020 7468 6520 7265 7375 6c74 2064   up the result d
+0001f380: 6570 6f73 6974 696f 6e3a 0a20 2020 2020  eposition:.     
+0001f390: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
+0001f3a0: 7465 2822 5c6e 2320 5265 6769 7374 6572  te("\n# Register
+0001f3b0: 206f 7574 7075 7420 5249 4120 6173 2072   output RIA as r
+0001f3c0: 656d 6f74 6520 666f 7220 7265 7375 6c74  emote for result
+0001f3d0: 2064 6570 6f73 6974 696f 6e3a 5c6e 2229   deposition:\n")
+0001f3e0: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+0001f3f0: 6c65 2e77 7269 7465 2827 6769 7420 7265  le.write('git re
+0001f400: 6d6f 7465 2061 6464 206f 7574 7075 7473  mote add outputs
+0001f410: 746f 7265 2022 247b 7075 7368 6769 7472  tore "${pushgitr
+0001f420: 656d 6f74 657d 2227 202b 2022 5c6e 2229  emote}"' + "\n")
+0001f430: 0a20 2020 2020 2020 2023 205e 5e20 6067  .        # ^^ `g
+0001f440: 6974 2072 656d 6f74 6520 6164 6420 3c67  it remote add <g
+0001f450: 6976 6520 6120 6e61 6d65 3e20 3c66 6f6c  ive a name> <fol
+0001f460: 6465 7220 7768 6572 6520 7468 6520 7265  der where the re
+0001f470: 6d6f 7465 2069 733e 600a 2020 2020 2020  mote is>`.      
+0001f480: 2020 2320 2020 6973 2074 6f20 6164 6420    #   is to add 
+0001f490: 6120 6e65 7720 7265 6d6f 7465 2074 6f20  a new remote to 
+0001f4a0: 796f 7572 2067 6974 2072 6570 6f0a 0a20  your git repo.. 
+0001f4b0: 2020 2020 2020 2023 2073 6574 2075 7020         # set up 
+0001f4c0: 6120 6e65 7720 6272 616e 6368 3a0a 2020  a new branch:.  
+0001f4d0: 2020 2020 2020 6261 7368 5f66 696c 652e        bash_file.
+0001f4e0: 7772 6974 6528 225c 6e23 2043 7265 6174  write("\n# Creat
+0001f4f0: 6520 6120 6e65 7720 6272 616e 6368 2066  e a new branch f
+0001f500: 6f72 2074 6869 7320 6a6f 6227 7320 7265  or this job's re
+0001f510: 7375 6c74 733a 2220 2b20 225c 6e22 290a  sults:" + "\n").
+0001f520: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
+0001f530: 652e 7772 6974 6528 2767 6974 2063 6865  e.write('git che
+0001f540: 636b 6f75 7420 2d62 2022 247b 4252 414e  ckout -b "${BRAN
+0001f550: 4348 7d22 2720 2b20 225c 6e22 290a 0a20  CH}"' + "\n").. 
+0001f560: 2020 2020 2020 2023 2053 7461 7274 206f         # Start o
+0001f570: 6620 7468 6520 6170 706c 6963 6174 696f  f the applicatio
+0001f580: 6e2d 7370 6563 6966 6963 2063 6f64 653a  n-specific code:
+0001f590: 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   ---------------
+0001f5a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+0001f5b0: 0a20 2020 2020 2020 2023 2070 756c 6c20  .        # pull 
+0001f5c0: 646f 776e 2069 6e70 7574 2064 6174 6120  down input data 
+0001f5d0: 2862 7574 2064 6f6e 2774 2072 6574 7269  (but don't retri
+0001f5e0: 6576 6520 7468 6520 6461 7461 2063 6f6e  eve the data con
+0001f5f0: 7465 6e74 2920 616e 6420 7265 6d6f 7665  tent) and remove
+0001f600: 206f 7468 6572 2073 7562 2773 2064 6174   other sub's dat
+0001f610: 613a 0a20 2020 2020 2020 2023 2020 2070  a:.        #   p
+0001f620: 7572 706f 7365 206f 6620 7265 6d6f 7669  urpose of removi
+0001f630: 6e67 206f 7468 6572 2073 7562 2773 2064  ng other sub's d
+0001f640: 6174 613a 206f 7468 6572 7769 7365 2070  ata: otherwise p
+0001f650: 7962 6964 7320 776f 756c 6420 7461 6b65  ybids would take
+0001f660: 0a20 2020 2020 2020 2023 2020 2065 7874  .        #   ext
+0001f670: 7265 6d65 6c79 206c 6f6e 6720 7469 6d65  remely long time
+0001f680: 2069 6e20 6c61 7267 6520 6461 7461 7365   in large datase
+0001f690: 7420 6475 6520 746f 206c 6f74 7320 6f66  t due to lots of
+0001f6a0: 2073 7562 6a65 6374 730a 2020 2020 2020   subjects.      
+0001f6b0: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
+0001f6c0: 6528 0a20 2020 2020 2020 2020 2020 2022  e(.            "
+0001f6d0: 5c6e 2320 5075 6c6c 2064 6f77 6e20 7468  \n# Pull down th
+0001f6e0: 6520 696e 7075 7420 7375 626a 6563 7420  e input subject 
+0001f6f0: 286f 7220 6461 7461 7365 7429 2062 7574  (or dataset) but
+0001f700: 2064 6f6e 2774 2072 6574 7269 6576 6520   don't retrieve 
+0001f710: 6461 7461 2063 6f6e 7465 6e74 733a 5c6e  data contents:\n
+0001f720: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
+0001f730: 5f64 7320 696e 2072 616e 6765 2830 2c20  _ds in range(0, 
+0001f740: 696e 7075 745f 6473 2e6e 756d 5f64 7329  input_ds.num_ds)
+0001f750: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001f760: 2069 6e70 7574 5f64 732e 6466 5b22 6973   input_ds.df["is
+0001f770: 5f7a 6970 7065 6422 5d5b 695f 6473 5d20  _zipped"][i_ds] 
+0001f780: 6973 2046 616c 7365 3a20 2020 2320 756e  is False:   # un
+0001f790: 7a69 7070 6564 2064 733a 0a20 2020 2020  zipped ds:.     
+0001f7a0: 2020 2020 2020 2020 2020 2023 2073 6565             # see
+0001f7b0: 6d73 2072 6567 6172 646c 6573 7320 6f66  ms regardless of
+0001f7c0: 206d 756c 7469 2d73 6573 206f 7220 6e6f   multi-ses or no
+0001f7d0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001f7e0: 2020 2320 2020 6173 2066 6f72 206d 756c    #   as for mul
+0001f7f0: 7469 2d73 6573 2c20 6974 206d 6967 6874  ti-ses, it might
+0001f800: 2075 7365 7320 6f74 6865 7220 7365 7327   uses other ses'
+0001f810: 7320 6461 7461 2065 2e67 2e2c 2061 6e61  s data e.g., ana
+0001f820: 743f 0a20 2020 2020 2020 2020 2020 2020  t?.             
+0001f830: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
+0001f840: 7465 2827 6461 7461 6c61 6420 6765 7420  te('datalad get 
+0001f850: 2d6e 2022 2720 2b20 696e 7075 745f 6473  -n "' + input_ds
+0001f860: 2e64 665b 2270 6174 685f 6e6f 775f 7265  .df["path_now_re
+0001f870: 6c22 5d5b 695f 6473 5d0a 2020 2020 2020  l"][i_ds].      
+0001f880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f890: 2020 2020 2020 2020 2020 2b20 222f 247b            + "/${
+0001f8a0: 7375 6269 647d 2220 2b20 2722 2720 2b20  subid}" + '"' + 
+0001f8b0: 225c 6e22 290a 2020 2020 2020 2020 2020  "\n").          
+0001f8c0: 2020 2020 2020 2320 5e5e 2060 2d6e 6020        # ^^ `-n` 
+0001f8d0: 6d65 616e 7320 2247 6574 2028 636c 6f6e  means "Get (clon
+0001f8e0: 6529 2061 2072 6567 6973 7465 7265 6420  e) a registered 
+0001f8f0: 7375 6264 6174 6173 6574 2c20 6275 7420  subdataset, but 
+0001f900: 646f 6ee2 8099 7420 7265 7472 6965 7665  don...t retrieve
+0001f910: 2064 6174 6122 0a20 2020 2020 2020 2020   data".         
+0001f920: 2020 2020 2020 2023 2020 2068 6572 6520         #   here 
+0001f930: 696e 7075 7420 6473 2069 7320 6120 7375  input ds is a su
+0001f940: 622d 6461 7461 7365 7420 6f66 2064 6174  b-dataset of dat
+0001f950: 6173 6574 2060 616e 616c 7973 6973 602e  aset `analysis`.
+0001f960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f970: 2023 204e 4f54 453a 206e 6f74 2073 7572   # NOTE: not sur
+0001f980: 6520 7768 7920 6062 6f6f 7473 7472 6170  e why `bootstrap
+0001f990: 2d66 6d72 6970 7265 702d 696e 6772 6573  -fmriprep-ingres
+0001f9a0: 7365 642d 6673 2e73 6860 2075 7365 733a  sed-fs.sh` uses:
+0001f9b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f9c0: 2023 2060 6461 7461 6c61 6420 6765 7420   # `datalad get 
+0001f9d0: 2d6e 202d 7220 2269 6e70 7574 732f 6461  -n -r "inputs/da
+0001f9e0: 7461 2f42 4944 532f 247b 7375 6269 647d  ta/BIDS/${subid}
+0001f9f0: 2260 0a20 2020 2020 2020 2020 2020 2020  "`.             
+0001fa00: 2020 2023 2074 6861 7420 6861 7320 602d     # that has `-
+0001fa10: 7260 3f20 602d 7260 206d 6561 6e73 2022  r`? `-r` means "
+0001fa20: 7265 6375 7273 6976 656c 7922 202d 2069  recursively" - i
+0001fa30: 7320 6974 2066 6f72 2063 6173 6573 2074  s it for cases t
+0001fa40: 6861 7420 6561 6368 2073 7562 0a20 2020  hat each sub.   
+0001fa50: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+0001fa60: 2069 7320 6120 7375 622d 6461 7461 7365   is a sub-datase
+0001fa70: 7420 6f66 2060 696e 7075 7473 2f64 6174  t of `inputs/dat
+0001fa80: 612f 3c6e 616d 653e 603f 0a20 2020 2020  a/<name>`?.     
+0001fa90: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
+0001faa0: 4f3a 2074 7279 206f 7574 2069 6620 6164  O: try out if ad
+0001fab0: 6469 6e67 2060 2d72 6020 7374 696c 6c20  ding `-r` still 
+0001fac0: 776f 726b 733f 0a0a 2020 2020 2020 2020  works?..        
+0001fad0: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+0001fae0: 206f 7468 6572 2073 7562 2773 2064 6174   other sub's dat
+0001faf0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+0001fb00: 2020 2062 6173 685f 6669 6c65 2e77 7269     bash_file.wri
+0001fb10: 7465 2822 2863 6420 2220 2b20 696e 7075  te("(cd " + inpu
+0001fb20: 745f 6473 2e64 665b 2270 6174 685f 6e6f  t_ds.df["path_no
+0001fb30: 775f 7265 6c22 5d5b 695f 6473 5d0a 2020  w_rel"][i_ds].  
+0001fb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb50: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+0001fb60: 2220 2626 2072 6d20 2d72 6620 6066 696e  " && rm -rf `fin
+0001fb70: 6420 2e20 2d74 7970 6520 6420 2d6e 616d  d . -type d -nam
+0001fb80: 6520 2773 7562 2a27 220a 2020 2020 2020  e 'sub*'".      
+0001fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fba0: 2020 2020 2020 2020 2020 2b20 2220 7c20            + " | 
+0001fbb0: 6772 6570 202d 7620 2473 7562 6964 6022  grep -v $subid`"
+0001fbc0: 202b 2022 2922 202b 2022 5c6e 2229 0a20   + ")" + "\n"). 
+0001fbd0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001fbe0: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
+0001fbf0: 2020 2065 2e67 2e2c 3a0a 2020 2020 2020     e.g.,:.      
+0001fc00: 2020 2020 2020 2020 2020 6461 7461 6c61            datala
+0001fc10: 6420 6765 7420 2d6e 2022 696e 7075 7473  d get -n "inputs
+0001fc20: 2f64 6174 612f 3c6e 616d 653e 2f24 7b73  /data/<name>/${s
+0001fc30: 7562 6964 7d22 0a20 2020 2020 2020 2020  ubid}".         
+0001fc40: 2020 2020 2020 2028 6364 2069 6e70 7574         (cd input
+0001fc50: 732f 6461 7461 2f3c 6e61 6d65 3e20 2626  s/data/<name> &&
+0001fc60: 2072 6d20 2d72 6620 6066 696e 6420 2e20   rm -rf `find . 
+0001fc70: 2d74 7970 6520 6420 2d6e 616d 6520 2773  -type d -name 's
+0001fc80: 7562 2a27 207c 2067 7265 7020 2d76 2024  ub*' | grep -v $
+0001fc90: 7375 6269 6460 290a 2020 2020 2020 2020  subid`).        
+0001fca0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001fcb0: 2020 2020 2020 2020 656c 7365 3a20 2020          else:   
+0001fcc0: 2023 207a 6970 7065 6420 6473 3a0a 2020   # zipped ds:.  
+0001fcd0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001fce0: 7368 5f66 696c 652e 7772 6974 6528 2764  sh_file.write('d
+0001fcf0: 6174 616c 6164 2067 6574 202d 6e20 2227  atalad get -n "'
+0001fd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd20: 202b 2069 6e70 7574 5f64 732e 6466 5b22   + input_ds.df["
+0001fd30: 7061 7468 5f6e 6f77 5f72 656c 225d 5b69  path_now_rel"][i
+0001fd40: 5f64 735d 0a20 2020 2020 2020 2020 2020  _ds].           
+0001fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd60: 2020 2020 202b 2027 2227 202b 2022 5c6e       + '"' + "\n
+0001fd70: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001fd80: 2020 2023 2065 2e67 2e2c 2060 6461 7461     # e.g., `data
+0001fd90: 6c61 6420 6765 7420 2d6e 2022 696e 7075  lad get -n "inpu
+0001fda0: 7473 2f64 6174 612f 6672 6565 7375 7266  ts/data/freesurf
+0001fdb0: 6572 2260 0a20 2020 2020 2020 2020 2020  er"`.           
+0001fdc0: 2020 2020 2023 205e 5e20 7368 6f75 6c64       # ^^ should
+0001fdd0: 204e 4f54 206f 6e6c 7920 6765 7420 7370   NOT only get sp
+0001fde0: 6563 6966 6963 207a 6970 2066 696c 652c  ecific zip file,
+0001fdf0: 2061 7320 7269 6768 7420 6e6f 7720 7765   as right now we
+0001fe00: 206e 6565 6420 746f 0a20 2020 2020 2020   need to.       
+0001fe10: 2020 2020 2020 2020 2023 2020 2067 6574           #   get
+0001fe20: 2074 6865 206c 6973 7420 6f66 2061 6c6c   the list of all
+0001fe30: 2066 696c 6573 2c20 736f 2074 6861 7420   files, so that 
+0001fe40: 7765 2063 616e 2064 6574 6572 6d69 6e65  we can determine
+0001fe50: 207a 6970 6669 6c65 6e61 6d65 206c 6174   zipfilename lat
+0001fe60: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
+0001fe70: 2020 2020 2023 2062 656c 6f77 2069 7320       # below is 
+0001fe80: 616e 6f74 6865 7220 7665 7273 696f 6e3a  another version:
+0001fe90: 2075 7369 6e67 2060 2a60 2069 6e73 7465   using `*` inste
+0001fea0: 6164 206f 6620 6120 7370 6563 6966 6963  ad of a specific
+0001feb0: 2066 696c 653a 0a20 2020 2020 2020 2020   file:.         
+0001fec0: 2020 2020 2020 2023 2062 6173 685f 6669         # bash_fi
+0001fed0: 6c65 2e77 7269 7465 2827 6461 7461 6c61  le.write('datala
+0001fee0: 6420 6765 7420 2d6e 2022 2720 2b20 696e  d get -n "' + in
+0001fef0: 7075 745f 6473 2e64 665b 2270 6174 685f  put_ds.df["path_
+0001ff00: 6e6f 775f 7265 6c22 5d5b 695f 6473 5d0a  now_rel"][i_ds].
+0001ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff20: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001ff30: 2020 2b20 222f 247b 7375 6269 647d 5f2a    + "/${subid}_*
+0001ff40: 2220 2b20 696e 7075 745f 6473 2e64 665b  " + input_ds.df[
+0001ff50: 226e 616d 6522 5d5b 695f 6473 5d20 2b20  "name"][i_ds] + 
+0001ff60: 222a 2e7a 6970 220a 2020 2020 2020 2020  "*.zip".        
+0001ff70: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0001ff80: 2020 2020 2020 2020 2020 2b20 2722 2720            + '"' 
+0001ff90: 2b20 225c 6e22 290a 2020 2020 2020 2020  + "\n").        
+0001ffa0: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
+0001ffb0: 652e 7772 6974 6528 2228 6364 2022 202b  e.write("(cd " +
+0001ffc0: 2069 6e70 7574 5f64 732e 6466 5b22 7061   input_ds.df["pa
+0001ffd0: 7468 5f6e 6f77 5f72 656c 225d 5b69 5f64  th_now_rel"][i_d
+0001ffe0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+0001fff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020000: 2020 202b 2022 2026 2620 726d 202d 6620     + " && rm -f 
+00020010: 606c 7320 7375 622d 2a2e 7a69 7020 7c20  `ls sub-*.zip | 
+00020020: 6772 6570 202d 7620 247b 7375 6269 647d  grep -v ${subid}
+00020030: 6022 0a20 2020 2020 2020 2020 2020 2020  `".             
+00020040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020050: 2020 202b 2022 2922 202b 2022 5c6e 2229     + ")" + "\n")
+00020060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020070: 2022 2222 0a20 2020 2020 2020 2020 2020   """.           
+00020080: 2020 2020 2065 2e67 2e2c 3a0a 2020 2020       e.g.,:.    
+00020090: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000200a0: 6c61 6420 6765 7420 2d6e 2022 696e 7075  lad get -n "inpu
+000200b0: 7473 2f64 6174 612f 6672 6565 7375 7266  ts/data/freesurf
+000200c0: 6572 2f24 7b73 7562 6964 7d5f 2a3c 6e61  er/${subid}_*<na
+000200d0: 6d65 3e2a 2e7a 6970 220a 2020 2020 2020  me>*.zip".      
+000200e0: 2020 2020 2020 2020 2020 2863 6420 696e            (cd in
+000200f0: 7075 7473 2f64 6174 612f 3c6e 616d 653e  puts/data/<name>
+00020100: 2026 2620 726d 202d 6620 606c 7320 7375   && rm -f `ls su
+00020110: 622d 2a2e 7a69 7020 7c20 6772 6570 202d  b-*.zip | grep -
+00020120: 7620 247b 7375 6269 647d 6029 0a20 2020  v ${subid}`).   
+00020130: 2020 2020 2020 2020 2020 2020 2022 2222               """
+00020140: 0a0a 2020 2020 2020 2020 2320 6465 7465  ..        # dete
+00020150: 726d 696e 6520 7468 6520 7a69 7020 6669  rmine the zip fi
+00020160: 6c65 6e61 6d65 3a0a 2020 2020 2020 2020  lename:.        
+00020170: 636d 645f 6465 7465 726d 696e 655f 7a69  cmd_determine_zi
+00020180: 7066 696c 656e 616d 6520 3d20 6765 6e65  pfilename = gene
+00020190: 7261 7465 5f63 6d64 5f64 6574 6572 6d69  rate_cmd_determi
+000201a0: 6e65 5f7a 6970 6669 6c65 6e61 6d65 2869  ne_zipfilename(i
+000201b0: 6e70 7574 5f64 732c 2074 7970 655f 7365  nput_ds, type_se
+000201c0: 7373 696f 6e29 0a20 2020 2020 2020 2062  ssion).        b
+000201d0: 6173 685f 6669 6c65 2e77 7269 7465 2863  ash_file.write(c
+000201e0: 6d64 5f64 6574 6572 6d69 6e65 5f7a 6970  md_determine_zip
+000201f0: 6669 6c65 6e61 6d65 290a 0a20 2020 2020  filename)..     
+00020200: 2020 2023 2060 6461 7461 6c61 6420 7275     # `datalad ru
+00020210: 6e60 3a0a 2020 2020 2020 2020 6261 7368  n`:.        bash
+00020220: 5f66 696c 652e 7772 6974 6528 225c 6e23  _file.write("\n#
+00020230: 2064 6174 616c 6164 2072 756e 3a5c 6e22   datalad run:\n"
+00020240: 290a 2020 2020 2020 2020 636d 645f 6461  ).        cmd_da
+00020250: 7461 6c61 645f 7275 6e20 3d20 6765 6e65  talad_run = gene
+00020260: 7261 7465 5f63 6d64 5f64 6174 616c 6164  rate_cmd_datalad
+00020270: 5f72 756e 2873 656c 662c 2069 6e70 7574  _run(self, input
+00020280: 5f64 732c 2074 7970 655f 7365 7373 696f  _ds, type_sessio
+00020290: 6e29 0a20 2020 2020 2020 2062 6173 685f  n).        bash_
+000202a0: 6669 6c65 2e77 7269 7465 2863 6d64 5f64  file.write(cmd_d
+000202b0: 6174 616c 6164 5f72 756e 290a 0a20 2020  atalad_run)..   
+000202c0: 2020 2020 2023 2046 696e 6973 6820 7570       # Finish up
+000202d0: 3a0a 2020 2020 2020 2020 2320 7075 7368  :.        # push
+000202e0: 2072 6573 756c 7420 6669 6c65 2063 6f6e   result file con
+000202f0: 7465 6e74 2074 6f20 6f75 7470 7574 2052  tent to output R
+00020300: 4941 2073 746f 7261 6765 3a0a 2020 2020  IA storage:.    
+00020310: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
+00020320: 6974 6528 225c 6e22 202b 2022 2320 5075  ite("\n" + "# Pu
+00020330: 7368 2072 6573 756c 7420 6669 6c65 2063  sh result file c
+00020340: 6f6e 7465 6e74 2074 6f20 6f75 7470 7574  ontent to output
+00020350: 2052 4941 2073 746f 7261 6765 3a5c 6e22   RIA storage:\n"
+00020360: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
+00020370: 696c 652e 7772 6974 6528 2264 6174 616c  ile.write("datal
+00020380: 6164 2070 7573 6820 2d2d 746f 206f 7574  ad push --to out
+00020390: 7075 742d 7374 6f72 6167 6522 202b 2022  put-storage" + "
+000203a0: 5c6e 2229 0a20 2020 2020 2020 2023 205e  \n").        # ^
+000203b0: 5e3a 2023 2060 6f75 7470 7574 2d73 746f  ^: # `output-sto
+000203c0: 7261 6765 603a 2064 6566 696e 6564 2077  rage`: defined w
+000203d0: 6865 6e20 7374 6172 7420 6f66 2062 6f6f  hen start of boo
+000203e0: 7473 7472 6170 3a20 6064 6174 616c 6164  tstrap: `datalad
+000203f0: 2063 7265 6174 652d 7369 626c 696e 672d   create-sibling-
+00020400: 7269 6160 0a0a 2020 2020 2020 2020 2320  ria`..        # 
+00020410: 7075 7368 2074 6865 206f 7574 7075 7420  push the output 
+00020420: 6272 616e 6368 3a0a 2020 2020 2020 2020  branch:.        
+00020430: 6261 7368 5f66 696c 652e 7772 6974 6528  bash_file.write(
+00020440: 2223 2050 7573 6820 7468 6520 6272 616e  "# Push the bran
+00020450: 6368 2077 6974 6820 7072 6f76 656e 616e  ch with provenan
+00020460: 6365 2072 6563 6f72 6473 3a5c 6e22 290a  ce records:\n").
+00020470: 2020 2020 2020 2020 6261 7368 5f66 696c          bash_fil
+00020480: 652e 7772 6974 6528 2266 6c6f 636b 2024  e.write("flock $
+00020490: 4453 4c4f 434b 4649 4c45 2067 6974 2070  DSLOCKFILE git p
+000204a0: 7573 6820 6f75 7470 7574 7374 6f72 6522  ush outputstore"
+000204b0: 202b 2022 5c6e 2229 0a20 2020 2020 2020   + "\n").       
+000204c0: 2023 205e 5e3a 2060 6f75 7470 7574 7374   # ^^: `outputst
+000204d0: 6f72 6560 2077 6173 2064 6566 696e 6564  ore` was defined
+000204e0: 2061 7420 7468 6520 6265 6769 6e6e 696e   at the beginnin
+000204f0: 6720 6f66 2060 7061 7274 6963 6970 616e  g of `participan
+00020500: 745f 6a6f 622e 7368 600a 2020 2020 2020  t_job.sh`.      
+00020510: 2020 2320 7468 6973 2070 7573 6820 6e65    # this push ne
+00020520: 6564 7320 6120 676c 6f62 616c 206c 6f63  eds a global loc
+00020530: 6b20 746f 2070 7265 7665 6e74 2077 7269  k to prevent wri
+00020540: 7465 2063 6f6e 666c 6963 7473 202d 2046  te conflicts - F
+00020550: 4149 526c 7920 6269 6720 7061 7065 720a  AIRly big paper.
+00020560: 0a20 2020 2020 2020 2023 2044 656c 6574  .        # Delet
+00020570: 653a 0a20 2020 2020 2020 2062 6173 685f  e:.        bash_
+00020580: 6669 6c65 2e77 7269 7465 2822 5c6e 6563  file.write("\nec
+00020590: 686f 2027 4465 6c65 7465 2074 656d 706f  ho 'Delete tempo
+000205a0: 7261 7279 2064 6972 6563 746f 7279 3a27  rary directory:'
+000205b0: 2220 2b20 225c 6e22 290a 2020 2020 2020  " + "\n").      
+000205c0: 2020 6261 7368 5f66 696c 652e 7772 6974    bash_file.writ
+000205d0: 6528 2265 6368 6f20 247b 4252 414e 4348  e("echo ${BRANCH
+000205e0: 7d22 202b 2022 5c6e 2229 0a20 2020 2020  }" + "\n").     
+000205f0: 2020 2023 2065 6163 6820 696e 7075 7420     # each input 
+00020600: 6461 7461 7365 743a 0a20 2020 2020 2020  dataset:.       
+00020610: 2066 6f72 2069 5f64 7320 696e 2072 616e   for i_ds in ran
+00020620: 6765 2830 2c20 696e 7075 745f 6473 2e6e  ge(0, input_ds.n
+00020630: 756d 5f64 7329 3a0a 2020 2020 2020 2020  um_ds):.        
+00020640: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
+00020650: 6974 6528 2264 6174 616c 6164 2064 726f  ite("datalad dro
+00020660: 7020 2d64 2022 202b 2069 6e70 7574 5f64  p -d " + input_d
+00020670: 732e 6466 5b22 7061 7468 5f6e 6f77 5f72  s.df["path_now_r
+00020680: 656c 225d 5b69 5f64 735d 202b 2022 202d  el"][i_ds] + " -
+00020690: 7222 0a20 2020 2020 2020 2020 2020 2020  r".             
+000206a0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+000206b0: 2022 202d 2d72 6563 6b6c 6573 7320 6176   " --reckless av
+000206c0: 6169 6c61 6269 6c69 7479 2220 2020 2320  ailability"   # 
+000206d0: 7072 6576 696f 7573 2060 2d2d 6e6f 6368  previous `--noch
+000206e0: 6563 6b60 2028 6465 7072 6563 6174 6564  eck` (deprecated
+000206f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020700: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00020710: 2220 2d2d 7265 636b 6c65 7373 206d 6f64  " --reckless mod
+00020720: 6966 6963 6174 696f 6e22 0a20 2020 2020  ification".     
+00020730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020740: 2020 2020 2020 2023 205e 5e20 7072 6576         # ^^ prev
+00020750: 696f 7573 2060 2d2d 6966 2d64 6972 7479  ious `--if-dirty
+00020760: 2069 676e 6f72 6560 2028 6465 7072 6563   ignore` (deprec
+00020770: 6174 6564 290a 2020 2020 2020 2020 2020  ated).          
+00020780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020790: 2020 2b20 225c 6e22 290a 2020 2020 2020    + "\n").      
+000207a0: 2020 2020 2020 2320 652e 672e 2c20 6461        # e.g., da
+000207b0: 7461 6c61 6420 6472 6f70 202d 6420 696e  talad drop -d in
+000207c0: 7075 7473 2f64 6174 612f 3c6e 616d 653e  puts/data/<name>
+000207d0: 202d 720a 2020 2020 2020 2020 2020 2020   -r.            
+000207e0: 2320 4e4f 5445 3a20 6f75 7220 7363 7269  # NOTE: our scri
+000207f0: 7074 7320 736f 6d65 7469 6d65 7320 616c  pts sometimes al
+00020800: 736f 2061 6464 7320 602d 2d6e 6f63 6865  so adds `--noche
+00020810: 636b 202d 2d69 662d 6469 7274 7920 6967  ck --if-dirty ig
+00020820: 6e6f 7265 600a 2020 2020 2020 2020 2020  nore`.          
+00020830: 2020 2320 2020 7769 7468 6f75 7420 6974    #   without it
+00020840: 2c20 6074 6f79 6269 6473 6170 7060 2077  , `toybidsapp` w
+00020850: 6974 6820 7a69 7070 6564 2064 7320 6173  ith zipped ds as
+00020860: 2069 6e70 7574 2077 6173 206e 6f74 206f   input was not o
+00020870: 6b61 7920 2864 726f 7020 696d 706f 7373  kay (drop imposs
+00020880: 6962 6c65 290a 2020 2020 2020 2020 2020  ible).          
+00020890: 2020 2320 2020 7769 7468 6f75 7420 6974    #   without it
+000208a0: 2c20 6074 6f79 6269 6473 6170 7060 2077  , `toybidsapp` w
+000208b0: 6974 6820 4249 4453 2061 7320 696e 7075  ith BIDS as inpu
+000208c0: 7420 7761 7320 6669 6e65 0a0a 2020 2020  t was fine..    
+000208d0: 2020 2020 2320 616c 736f 2060 6461 7461      # also `data
+000208e0: 6c61 6420 6472 6f70 6020 7468 6520 6375  lad drop` the cu
+000208f0: 7272 656e 7420 6064 7360 2028 636c 6f6e  rrent `ds` (clon
+00020900: 6520 6f66 2069 6e70 7574 2052 4941 293f  e of input RIA)?
+00020910: 0a20 2020 2020 2020 2023 2020 2074 6869  .        #   thi
+00020920: 7320 696e 636c 7564 6573 2064 726f 7070  s includes dropp
+00020930: 696e 6720 6f66 2069 6d61 6765 7320 696e  ing of images in
+00020940: 2060 636f 6e74 6169 6e65 7273 6020 6461   `containers` da
+00020950: 7461 7365 742c 2061 6e64 207a 6970 7065  taset, and zippe
+00020960: 6420 6f75 7470 7574 0a20 2020 2020 2020  d output.       
+00020970: 2062 6173 685f 6669 6c65 2e77 7269 7465   bash_file.write
+00020980: 2822 6461 7461 6c61 6420 6472 6f70 202d  ("datalad drop -
+00020990: 7220 2e22 0a20 2020 2020 2020 2020 2020  r .".           
+000209a0: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+000209b0: 202d 2d72 6563 6b6c 6573 7320 6176 6169   --reckless avai
+000209c0: 6c61 6269 6c69 7479 220a 2020 2020 2020  lability".      
+000209d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000209e0: 2020 2b20 2220 2d2d 7265 636b 6c65 7373    + " --reckless
+000209f0: 206d 6f64 6966 6963 6174 696f 6e22 2020   modification"  
+00020a00: 2020 2320 7468 6973 2069 7320 6e65 6564    # this is need
+00020a10: 6564 2066 6f72 207a 6970 7065 6420 696e  ed for zipped in
+00020a20: 7075 7420 6473 0a20 2020 2020 2020 2020  put ds.         
+00020a30: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00020a40: 2022 5c6e 2229 0a20 2020 2020 2020 2023   "\n").        #
+00020a50: 205e 5e20 6f6c 6420 7363 7269 7074 733a   ^^ old scripts:
+00020a60: 2064 6174 616c 6164 2064 726f 7020 2d72   datalad drop -r
+00020a70: 202e 202d 2d6e 6f63 6865 636b 2020 2023   . --nocheck   #
+00020a80: 2060 2d2d 6e6f 6368 6563 6b60 2069 7320   `--nocheck` is 
+00020a90: 6465 7072 6563 6174 6564 2e2e 2e0a 0a20  deprecated..... 
+00020aa0: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+00020ab0: 2e77 7269 7465 2822 6769 7420 616e 6e65  .write("git anne
+00020ac0: 7820 6465 6164 2068 6572 6522 202b 2022  x dead here" + "
+00020ad0: 5c6e 2229 0a20 2020 2020 2020 2023 205e  \n").        # ^
+00020ae0: 5e3a 2061 7320 7468 6520 6461 7461 2068  ^: as the data h
+00020af0: 6173 2062 6565 6e20 6472 6f70 7065 642c  as been dropped,
+00020b00: 2077 6520 646f 6e27 7420 7761 6e74 2074   we don't want t
+00020b10: 6f20 6265 2072 656d 696e 6465 6420 6f66  o be reminded of
+00020b20: 2074 6869 730a 0a20 2020 2020 2020 2023   this..        #
+00020b30: 2063 6420 6f75 7420 6f66 2024 4252 414e   cd out of $BRAN
+00020b40: 4348 3a0a 2020 2020 2020 2020 6261 7368  CH:.        bash
+00020b50: 5f66 696c 652e 7772 6974 6528 2263 6420  _file.write("cd 
+00020b60: 2e2e 2f2e 2e22 202b 2022 5c6e 2229 0a20  ../.." + "\n"). 
+00020b70: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+00020b80: 2e77 7269 7465 2822 726d 202d 7266 2024  .write("rm -rf $
+00020b90: 4252 414e 4348 2220 2b20 225c 6e22 290a  BRANCH" + "\n").
+00020ba0: 0a20 2020 2020 2020 2023 2044 6f6e 6520  .        # Done 
+00020bb0: 6765 6e65 7261 7469 6e67 2060 7061 7274  generating `part
+00020bc0: 6963 6970 616e 745f 6a6f 622e 7368 603a  icipant_job.sh`:
+00020bd0: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+00020be0: 6c65 2e77 7269 7465 2822 5c6e 6563 686f  le.write("\necho
+00020bf0: 2053 5543 4345 5353 2220 2b20 225c 6e22   SUCCESS" + "\n"
+00020c00: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
+00020c10: 696c 652e 636c 6f73 6528 290a 0a20 2020  ile.close()..   
+00020c20: 2020 2020 2023 2063 6861 6e67 6520 7468       # change th
+00020c30: 6520 7065 726d 6973 7369 6f6e 206f 6620  e permission of 
+00020c40: 7468 6973 2062 6173 6820 6669 6c65 3a0a  this bash file:.
+00020c50: 2020 2020 2020 2020 7072 6f63 5f63 686d          proc_chm
+00020c60: 6f64 5f62 6173 6866 696c 6520 3d20 7375  od_bashfile = su
+00020c70: 6270 726f 6365 7373 2e72 756e 280a 2020  bprocess.run(.  
+00020c80: 2020 2020 2020 2020 2020 5b22 6368 6d6f            ["chmo
+00020c90: 6422 2c20 222b 7822 2c20 6261 7368 5f70  d", "+x", bash_p
+00020ca0: 6174 685d 2c20 2023 2065 2e67 2e2c 2063  ath],  # e.g., c
+00020cb0: 686d 6f64 202b 7820 636f 6465 2f70 6172  hmod +x code/par
+00020cc0: 7469 6369 7061 6e74 5f6a 6f62 2e73 680a  ticipant_job.sh.
+00020cd0: 2020 2020 2020 2020 2020 2020 7374 646f              stdo
+00020ce0: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
+00020cf0: 5045 0a20 2020 2020 2020 2020 2020 2029  PE.            )
+00020d00: 0a20 2020 2020 2020 2070 726f 635f 6368  .        proc_ch
+00020d10: 6d6f 645f 6261 7368 6669 6c65 2e63 6865  mod_bashfile.che
+00020d20: 636b 5f72 6574 7572 6e63 6f64 6528 290a  ck_returncode().
+00020d30: 0a20 2020 2064 6566 2067 656e 6572 6174  .    def generat
+00020d40: 655f 6261 7368 5f74 6573 745f 6a6f 6228  e_bash_test_job(
+00020d50: 7365 6c66 2c20 666f 6c64 6572 5f63 6865  self, folder_che
+00020d60: 636b 5f73 6574 7570 2c0a 2020 2020 2020  ck_setup,.      
+00020d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020d80: 2020 2020 2020 2020 2073 7973 7465 6d29           system)
+00020d90: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00020da0: 2020 2020 2020 5468 6973 2069 7320 746f        This is to
+00020db0: 2067 656e 6572 6174 6520 7477 6f20 7363   generate two sc
+00020dc0: 7269 7074 7320 7468 6174 2072 756e 2061  ripts that run a
+00020dd0: 202a 7465 7374 2a20 6a6f 622c 0a20 2020   *test* job,.   
+00020de0: 2020 2020 2077 6869 6368 2077 696c 6c20       which will 
+00020df0: 6265 2075 7365 6420 6279 2060 6261 6273  be used by `babs
+00020e00: 2d63 6865 636b 2d73 6574 7570 602e 0a20  -check-setup`.. 
+00020e10: 2020 2020 2020 2053 6372 6970 7473 2074         Scripts t
+00020e20: 6f20 6765 6e65 7261 7465 3a0a 2020 2020  o generate:.    
+00020e30: 2020 2020 2a20 6063 616c 6c5f 7465 7374      * `call_test
+00020e40: 5f6a 6f62 2e73 6860 2020 2020 2320 6a75  _job.sh`    # ju
+00020e50: 7374 206c 696b 6520 6070 6172 7469 6369  st like `partici
+00020e60: 7061 6e74 5f6a 6f62 2e73 6860 0a20 2020  pant_job.sh`.   
+00020e70: 2020 2020 202a 2060 7465 7374 5f6a 6f62       * `test_job
+00020e80: 2e70 7960 2020 2020 2320 6a75 7374 206c  .py`    # just l
+00020e90: 696b 6520 6063 6f6e 7461 696e 6572 5f7a  ike `container_z
+00020ea0: 6970 2e73 6860 0a0a 2020 2020 2020 2020  ip.sh`..        
+00020eb0: 5061 7261 6d65 7465 7273 3a0a 2020 2020  Parameters:.    
+00020ec0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
+00020ed0: 2d0a 2020 2020 2020 2020 666f 6c64 6572  -.        folder
+00020ee0: 5f63 6865 636b 5f73 6574 7570 3a20 7374  _check_setup: st
+00020ef0: 720a 2020 2020 2020 2020 2020 2020 5468  r.            Th
+00020f00: 6520 7061 7468 2074 6f20 666f 6c64 6572  e path to folder
+00020f10: 2060 6368 6563 6b5f 7365 7475 7060 3b20   `check_setup`; 
+00020f20: 6765 6e65 7261 7465 6420 7363 7269 7074  generated script
+00020f30: 7320 7769 6c6c 206c 6f63 6174 6520 696e  s will locate in
+00020f40: 2074 6869 7320 666f 6c64 6572 0a20 2020   this folder.   
+00020f50: 2020 2020 2073 7973 7465 6d3a 2063 6c61       system: cla
+00020f60: 7373 2060 5379 7374 656d 600a 2020 2020  ss `System`.    
+00020f70: 2020 2020 2020 2020 696e 666f 726d 6174          informat
+00020f80: 696f 6e20 6f6e 2063 6c75 7374 6572 206d  ion on cluster m
+00020f90: 616e 6167 656d 656e 7420 7379 7374 656d  anagement system
+00020fa0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00020fb0: 2020 2020 2020 666e 5f63 616c 6c5f 7465        fn_call_te
+00020fc0: 7374 5f6a 6f62 203d 206f 702e 6a6f 696e  st_job = op.join
+00020fd0: 2866 6f6c 6465 725f 6368 6563 6b5f 7365  (folder_check_se
+00020fe0: 7475 702c 2022 6361 6c6c 5f74 6573 745f  tup, "call_test_
+00020ff0: 6a6f 622e 7368 2229 0a20 2020 2020 2020  job.sh").       
+00021000: 2066 6e5f 7465 7374 5f6a 6f62 203d 206f   fn_test_job = o
+00021010: 702e 6a6f 696e 2866 6f6c 6465 725f 6368  p.join(folder_ch
+00021020: 6563 6b5f 7365 7475 702c 2022 7465 7374  eck_setup, "test
+00021030: 5f6a 6f62 2e70 7922 290a 2020 2020 2020  _job.py").      
+00021040: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
+00021050: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021060: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021070: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021080: 3d3d 0a20 2020 2020 2020 2023 2047 656e  ==.        # Gen
+00021090: 6572 6174 6520 6063 616c 6c5f 7465 7374  erate `call_test
+000210a0: 5f6a 6f62 2e73 6860 2c20 7369 6d69 6c61  _job.sh`, simila
+000210b0: 7220 746f 2060 7061 7274 6963 6970 616e  r to `participan
+000210c0: 745f 6a6f 622e 7368 600a 2020 2020 2020  t_job.sh`.      
+000210d0: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
+000210e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000210f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021100: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021110: 3d3d 0a20 2020 2020 2020 2023 2043 6865  ==.        # Che
+00021120: 636b 2069 6620 7468 6520 6261 7368 2066  ck if the bash f
+00021130: 696c 6520 616c 7265 6164 7920 6578 6973  ile already exis
+00021140: 743a 0a20 2020 2020 2020 2069 6620 6f70  t:.        if op
+00021150: 2e65 7869 7374 7328 666e 5f63 616c 6c5f  .exists(fn_call_
+00021160: 7465 7374 5f6a 6f62 293a 0a20 2020 2020  test_job):.     
+00021170: 2020 2020 2020 206f 732e 7265 6d6f 7665         os.remove
+00021180: 2866 6e5f 6361 6c6c 5f74 6573 745f 6a6f  (fn_call_test_jo
+00021190: 6229 2020 2320 7265 6d6f 7665 2069 740a  b)  # remove it.
+000211a0: 0a20 2020 2020 2020 2023 2057 7269 7465  .        # Write
+000211b0: 2069 6e74 6f20 7468 6520 6261 7368 2066   into the bash f
+000211c0: 696c 653a 0a20 2020 2020 2020 2062 6173  ile:.        bas
+000211d0: 685f 6669 6c65 203d 206f 7065 6e28 666e  h_file = open(fn
+000211e0: 5f63 616c 6c5f 7465 7374 5f6a 6f62 2c20  _call_test_job, 
+000211f0: 2261 2229 2020 2023 206f 7065 6e20 696e  "a")   # open in
+00021200: 2061 7070 656e 6420 6d6f 6465 0a0a 2020   append mode..  
+00021210: 2020 2020 2020 2320 4e4f 5445 3a20 6e6f        # NOTE: no
+00021220: 7420 746f 2061 7574 6f6d 6174 6963 616c  t to automatical
+00021230: 6c79 2067 656e 6572 6174 6520 7468 6520  ly generate the 
+00021240: 696e 7465 7270 7265 7469 6e67 2073 6865  interpreting she
+00021250: 6c6c 3b0a 2020 2020 2020 2020 2320 2020  ll;.        #   
+00021260: 696e 7374 6561 642c 206c 6574 2075 7365  instead, let use
+00021270: 7273 2073 7065 6369 6679 2069 7420 696e  rs specify it in
+00021280: 2074 6865 2063 6f6e 7461 696e 6572 2063   the container c
+00021290: 6f6e 6669 6720 7961 6d6c 2066 696c 650a  onfig yaml file.
+000212a0: 2020 2020 2020 2020 2320 2020 7573 696e          #   usin
+000212b0: 6720 6069 6e74 6572 7072 6574 696e 675f  g `interpreting_
+000212c0: 7368 656c 6c60 0a0a 2020 2020 2020 2020  shell`..        
+000212d0: 2320 436c 7573 7465 7220 7265 736f 7572  # Cluster resour
+000212e0: 6365 7320 7265 7175 6573 7469 6e67 3a0a  ces requesting:.
+000212f0: 2020 2020 2020 2020 636d 645f 6261 7368          cmd_bash
+00021300: 6865 6164 5f72 6573 6f75 7263 6573 203d  head_resources =
+00021310: 2067 656e 6572 6174 655f 6261 7368 6865   generate_bashhe
+00021320: 6164 5f72 6573 6f75 7263 6573 2873 7973  ad_resources(sys
+00021330: 7465 6d2c 2073 656c 662e 636f 6e66 6967  tem, self.config
+00021340: 290a 2020 2020 2020 2020 6261 7368 5f66  ).        bash_f
+00021350: 696c 652e 7772 6974 6528 636d 645f 6261  ile.write(cmd_ba
+00021360: 7368 6865 6164 5f72 6573 6f75 7263 6573  shhead_resources
+00021370: 290a 0a20 2020 2020 2020 2023 2053 6372  )..        # Scr
+00021380: 6970 7420 7072 6561 6d62 6c65 733a 0a20  ipt preambles:. 
+00021390: 2020 2020 2020 2063 6d64 5f73 6372 6970         cmd_scrip
+000213a0: 745f 7072 6561 6d62 6c65 203d 2067 656e  t_preamble = gen
+000213b0: 6572 6174 655f 636d 645f 7363 7269 7074  erate_cmd_script
+000213c0: 5f70 7265 616d 626c 6528 7365 6c66 2e63  _preamble(self.c
+000213d0: 6f6e 6669 6729 0a20 2020 2020 2020 2062  onfig).        b
+000213e0: 6173 685f 6669 6c65 2e77 7269 7465 2863  ash_file.write(c
+000213f0: 6d64 5f73 6372 6970 745f 7072 6561 6d62  md_script_preamb
+00021400: 6c65 290a 0a20 2020 2020 2020 2023 2057  le)..        # W
+00021410: 6865 7265 2074 6865 2061 6e61 6c79 7369  here the analysi
+00021420: 7320 666f 6c64 6572 2069 733a 0a20 2020  s folder is:.   
+00021430: 2020 2020 2062 6173 685f 6669 6c65 2e77       bash_file.w
+00021440: 7269 7465 2822 7061 7468 5f63 6865 636b  rite("path_check
+00021450: 5f73 6574 7570 3d22 202b 2066 6f6c 6465  _setup=" + folde
+00021460: 725f 6368 6563 6b5f 7365 7475 7020 2b20  r_check_setup + 
+00021470: 225c 6e22 290a 0a20 2020 2020 2020 2023  "\n")..        #
+00021480: 2043 6861 6e67 6520 686f 7720 7468 6973   Change how this
+00021490: 2062 6173 6820 6669 6c65 2069 7320 7275   bash file is ru
+000214a0: 6e3a 0a20 2020 2020 2020 2062 6173 685f  n:.        bash_
+000214b0: 6669 6c65 2e77 7269 7465 2822 5c6e 2320  file.write("\n# 
+000214c0: 4661 696c 2077 6865 6e65 7665 7220 736f  Fail whenever so
+000214d0: 6d65 7468 696e 6720 6973 2066 6973 6879  mething is fishy
+000214e0: 2c22 0a20 2020 2020 2020 2020 2020 2020  ,".             
+000214f0: 2020 2020 2020 2020 2020 202b 2022 2075             + " u
+00021500: 7365 202d 7820 746f 2067 6574 2076 6572  se -x to get ver
+00021510: 626f 7365 206c 6f67 6669 6c65 733a 5c6e  bose logfiles:\n
+00021520: 2229 0a20 2020 2020 2020 2062 6173 685f  ").        bash_
+00021530: 6669 6c65 2e77 7269 7465 2822 7365 7420  file.write("set 
+00021540: 2d65 202d 7520 2d78 5c6e 2229 0a0a 2020  -e -u -x\n")..  
+00021550: 2020 2020 2020 2320 4e4f 5445 3a20 5468        # NOTE: Th
+00021560: 6572 6520 6973 206e 6f20 696e 7075 7420  ere is no input 
+00021570: 6172 6775 6d65 6e74 2066 6f72 2074 6869  argument for thi
+00021580: 7320 6261 7368 2066 696c 652e 0a0a 2020  s bash file...  
+00021590: 2020 2020 2020 2320 4368 616e 6765 2070        # Change p
+000215a0: 6174 6820 746f 2061 2074 656d 706f 7261  ath to a tempora
+000215b0: 7279 206a 6f62 2063 6f6d 7075 7465 2077  ry job compute w
+000215c0: 6f72 6b73 7061 6365 3a0a 2020 2020 2020  orkspace:.      
+000215d0: 2020 2320 2020 7468 6520 7061 7468 2069    #   the path i
+000215e0: 7320 6261 7365 6420 6f6e 2077 6861 7420  s based on what 
+000215f0: 7573 6572 7320 7072 6f76 6964 6520 696e  users provide in
+00021600: 2073 6563 7469 6f6e 2027 6a6f 625f 636f   section 'job_co
+00021610: 6d70 7574 655f 7370 6163 6527 2069 6e20  mpute_space' in 
+00021620: 5941 4d4c 2066 696c 653a 0a20 2020 2020  YAML file:.     
+00021630: 2020 2063 6d64 5f6a 6f62 5f63 6f6d 7075     cmd_job_compu
+00021640: 7465 5f73 7061 6365 203d 2067 656e 6572  te_space = gener
+00021650: 6174 655f 636d 645f 6a6f 625f 636f 6d70  ate_cmd_job_comp
+00021660: 7574 655f 7370 6163 6528 7365 6c66 2e63  ute_space(self.c
+00021670: 6f6e 6669 6729 0a20 2020 2020 2020 2062  onfig).        b
+00021680: 6173 685f 6669 6c65 2e77 7269 7465 2863  ash_file.write(c
+00021690: 6d64 5f6a 6f62 5f63 6f6d 7075 7465 5f73  md_job_compute_s
+000216a0: 7061 6365 290a 0a20 2020 2020 2020 2023  pace)..        #
+000216b0: 2043 616c 6c20 6074 6573 745f 6a6f 622e   Call `test_job.
+000216c0: 7079 603a 0a20 2020 2020 2020 2023 2067  py`:.        # g
+000216d0: 6574 2077 6869 6368 2070 7974 686f 6e3a  et which python:
+000216e0: 0a20 2020 2020 2020 2062 6173 685f 6669  .        bash_fi
+000216f0: 6c65 2e77 7269 7465 2822 5c6e 2320 4361  le.write("\n# Ca
+00021700: 6c6c 2060 7465 7374 5f6a 6f62 2e70 7960  ll `test_job.py`
+00021710: 3a5c 6e22 290a 2020 2020 2020 2020 6261  :\n").        ba
+00021720: 7368 5f66 696c 652e 7772 6974 6528 2277  sh_file.write("w
+00021730: 6869 6368 5f70 7974 686f 6e3d 6077 6869  hich_python=`whi
+00021740: 6368 2070 7974 686f 6e60 5c6e 2229 0a20  ch python`\n"). 
+00021750: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+00021760: 2e77 7269 7465 2822 6375 7272 656e 745f  .write("current_
+00021770: 7077 643d 247b 5057 447d 2220 2b20 225c  pwd=${PWD}" + "\
+00021780: 6e22 290a 2020 2020 2020 2020 2320 6361  n").        # ca
+00021790: 6c6c 2060 7465 7374 5f6a 6f62 2e70 7960  ll `test_job.py`
+000217a0: 3a0a 2020 2020 2020 2020 6261 7368 5f66  :.        bash_f
+000217b0: 696c 652e 7772 6974 6528 2265 6368 6f20  ile.write("echo 
+000217c0: 2743 616c 6c69 6e67 2060 7465 7374 5f6a  'Calling `test_j
+000217d0: 6f62 2e70 7960 2e2e 2e27 5c6e 2229 0a20  ob.py`...'\n"). 
+000217e0: 2020 2020 2020 2062 6173 685f 6669 6c65         bash_file
+000217f0: 2e77 7269 7465 2822 247b 7768 6963 685f  .write("${which_
+00021800: 7079 7468 6f6e 7d20 2220 2b20 666e 5f74  python} " + fn_t
+00021810: 6573 745f 6a6f 620a 2020 2020 2020 2020  est_job.        
+00021820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021830: 2b20 2220 2d2d 7061 7468 2d77 6f72 6b73  + " --path-works
+00021840: 7061 6365 2024 7b63 7572 7265 6e74 5f70  pace ${current_p
+00021850: 7764 7d22 0a20 2020 2020 2020 2020 2020  wd}".           
+00021860: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00021870: 202d 2d70 6174 682d 6368 6563 6b2d 7365   --path-check-se
+00021880: 7475 7020 2220 2b20 666f 6c64 6572 5f63  tup " + folder_c
+00021890: 6865 636b 5f73 6574 7570 202b 2022 5c6e  heck_setup + "\n
+000218a0: 2229 0a0a 2020 2020 2020 2020 2320 4563  ")..        # Ec
+000218b0: 686f 2073 7563 6365 7373 3a0a 2020 2020  ho success:.    
+000218c0: 2020 2020 6261 7368 5f66 696c 652e 7772      bash_file.wr
+000218d0: 6974 6528 225c 6e65 6368 6f20 5355 4343  ite("\necho SUCC
+000218e0: 4553 535c 6e22 290a 0a20 2020 2020 2020  ESS\n")..       
+000218f0: 2070 726f 635f 6368 6d6f 645f 6261 7368   proc_chmod_bash
+00021900: 6669 6c65 203d 2073 7562 7072 6f63 6573  file = subproces
+00021910: 732e 7275 6e28 0a20 2020 2020 2020 2020  s.run(.         
+00021920: 2020 205b 2263 686d 6f64 222c 2022 2b78     ["chmod", "+x
+00021930: 222c 2066 6e5f 6361 6c6c 5f74 6573 745f  ", fn_call_test_
+00021940: 6a6f 625d 2c20 2023 2065 2e67 2e2c 2063  job],  # e.g., c
+00021950: 686d 6f64 202b 7820 636f 6465 2f70 6172  hmod +x code/par
+00021960: 7469 6369 7061 6e74 5f6a 6f62 2e73 680a  ticipant_job.sh.
+00021970: 2020 2020 2020 2020 2020 2020 7374 646f              stdo
+00021980: 7574 3d73 7562 7072 6f63 6573 732e 5049  ut=subprocess.PI
+00021990: 5045 0a20 2020 2020 2020 2020 2020 2029  PE.            )
+000219a0: 0a20 2020 2020 2020 2070 726f 635f 6368  .        proc_ch
+000219b0: 6d6f 645f 6261 7368 6669 6c65 2e63 6865  mod_bashfile.che
+000219c0: 636b 5f72 6574 7572 6e63 6f64 6528 290a  ck_returncode().
+000219d0: 0a20 2020 2020 2020 2023 203d 3d3d 3d3d  .        # =====
+000219e0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+000219f0: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021a00: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021a10: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2020  =========.      
+00021a20: 2020 2320 4765 6e65 7261 7465 2060 7465    # Generate `te
+00021a30: 7374 5f6a 6f62 2e70 7960 2c20 7369 6d69  st_job.py`, simi
+00021a40: 6c61 7220 746f 2060 636f 6e74 6169 6e65  lar to `containe
+00021a50: 725f 7a69 702e 7368 600a 2020 2020 2020  r_zip.sh`.      
+00021a60: 2020 2320 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d    # ============
+00021a70: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021a80: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021a90: 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d 3d3d  ================
+00021aa0: 3d3d 0a20 2020 2020 2020 2023 2043 6865  ==.        # Che
+00021ab0: 636b 2069 6620 7468 6520 6261 7368 2066  ck if the bash f
+00021ac0: 696c 6520 616c 7265 6164 7920 6578 6973  ile already exis
+00021ad0: 743a 0a20 2020 2020 2020 2069 6620 6f70  t:.        if op
+00021ae0: 2e65 7869 7374 7328 666e 5f74 6573 745f  .exists(fn_test_
+00021af0: 6a6f 6229 3a0a 2020 2020 2020 2020 2020  job):.          
+00021b00: 2020 6f73 2e72 656d 6f76 6528 666e 5f74    os.remove(fn_t
+00021b10: 6573 745f 6a6f 6229 2020 2320 7265 6d6f  est_job)  # remo
+00021b20: 7665 2069 740a 0a20 2020 2020 2020 2023  ve it..        #
+00021b30: 2043 6f70 7920 7468 6520 6578 6973 7469   Copy the existi
+00021b40: 6e67 2070 7974 686f 6e20 7363 7269 7074  ng python script
+00021b50: 2074 6f20 7468 6973 2042 4142 5320 7072   to this BABS pr
+00021b60: 6f6a 6563 743a 0a20 2020 2020 2020 2023  oject:.        #
+00021b70: 206c 6f63 6174 696f 6e20 6f66 2063 7572   location of cur
+00021b80: 7265 6e74 2070 7974 686f 6e20 7363 7269  rent python scri
+00021b90: 7074 3a0a 2020 2020 2020 2020 2320 2020  pt:.        #   
+00021ba0: 606f 702e 6162 7370 6174 6828 2960 2069  `op.abspath()` i
+00021bb0: 7320 746f 206d 616b 6520 7375 7265 2061  s to make sure a
+00021bc0: 6c77 6179 7320 7265 7475 726e 7320 6162  lways returns ab
+00021bd0: 7320 7061 7468 2c20 7265 6761 7264 6c65  s path, regardle
+00021be0: 7373 206f 6620 7079 7468 6f6e 2076 6572  ss of python ver
+00021bf0: 7369 6f6e 0a20 2020 2020 2020 2023 2020  sion.        #  
+00021c00: 2072 6566 3a20 6874 7470 733a 2f2f 6e6f   ref: https://no
+00021c10: 7465 2e6e 6b6d 6b2e 6d65 2f65 6e2f 7079  te.nkmk.me/en/py
+00021c20: 7468 6f6e 2d73 6372 6970 742d 6669 6c65  thon-script-file
+00021c30: 2d70 6174 682f 0a20 2020 2020 2020 205f  -path/.        _
+00021c40: 5f6c 6f63 6174 696f 6e5f 5f20 3d20 6f70  _location__ = op
+00021c50: 2e72 6561 6c70 6174 6828 6f70 2e64 6972  .realpath(op.dir
+00021c60: 6e61 6d65 286f 702e 6162 7370 6174 6828  name(op.abspath(
+00021c70: 5f5f 6669 6c65 5f5f 2929 290a 2020 2020  __file__))).    
+00021c80: 2020 2020 666e 5f66 726f 6d20 3d20 6f70      fn_from = op
+00021c90: 2e6a 6f69 6e28 5f5f 6c6f 6361 7469 6f6e  .join(__location
+00021ca0: 5f5f 2c20 2274 656d 706c 6174 655f 7465  __, "template_te
+00021cb0: 7374 5f6a 6f62 2e70 7922 290a 2020 2020  st_job.py").    
+00021cc0: 2020 2020 2320 636f 7079 3a0a 2020 2020      # copy:.    
+00021cd0: 2020 2020 7368 7574 696c 2e63 6f70 7928      shutil.copy(
+00021ce0: 666e 5f66 726f 6d2c 2066 6e5f 7465 7374  fn_from, fn_test
+00021cf0: 5f6a 6f62 290a 0a20 2020 2020 2020 2023  _job)..        #
+00021d00: 2063 6861 6e67 6520 7468 6520 7065 726d   change the perm
+00021d10: 6973 7369 6f6e 206f 6620 7468 6973 2062  ission of this b
+00021d20: 6173 6820 6669 6c65 3a0a 2020 2020 2020  ash file:.      
+00021d30: 2020 7072 6f63 5f63 686d 6f64 5f70 7966    proc_chmod_pyf
+00021d40: 696c 6520 3d20 7375 6270 726f 6365 7373  ile = subprocess
+00021d50: 2e72 756e 280a 2020 2020 2020 2020 2020  .run(.          
+00021d60: 2020 5b22 6368 6d6f 6422 2c20 222b 7822    ["chmod", "+x"
+00021d70: 2c20 666e 5f74 6573 745f 6a6f 625d 2c20  , fn_test_job], 
+00021d80: 2023 2065 2e67 2e2c 2063 686d 6f64 202b   # e.g., chmod +
+00021d90: 7820 636f 6465 2f70 6172 7469 6369 7061  x code/participa
+00021da0: 6e74 5f6a 6f62 2e73 680a 2020 2020 2020  nt_job.sh.      
+00021db0: 2020 2020 2020 7374 646f 7574 3d73 7562        stdout=sub
+00021dc0: 7072 6f63 6573 732e 5049 5045 0a20 2020  process.PIPE.   
+00021dd0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00021de0: 2020 2070 726f 635f 6368 6d6f 645f 7079     proc_chmod_py
+00021df0: 6669 6c65 2e63 6865 636b 5f72 6574 7572  file.check_retur
+00021e00: 6e63 6f64 6528 290a 0a20 2020 2064 6566  ncode()..    def
+00021e10: 2067 656e 6572 6174 655f 6a6f 625f 7375   generate_job_su
+00021e20: 626d 6974 5f74 656d 706c 6174 6528 7365  bmit_template(se
+00021e30: 6c66 2c20 7961 6d6c 5f70 6174 682c 2062  lf, yaml_path, b
+00021e40: 6162 732c 2073 7973 7465 6d2c 2074 6573  abs, system, tes
+00021e50: 743d 4661 6c73 6529 3a0a 2020 2020 2020  t=False):.      
+00021e60: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+00021e70: 6973 2069 7320 746f 2067 656e 6572 6174  is is to generat
+00021e80: 6520 6120 5941 4d4c 2066 696c 6520 7468  e a YAML file th
+00021e90: 6174 2073 6572 7665 7320 6173 2061 2074  at serves as a t
+00021ea0: 656d 706c 6174 650a 2020 2020 2020 2020  emplate.        
+00021eb0: 6f66 206a 6f62 2073 7562 6d69 7373 696f  of job submissio
+00021ec0: 6e20 6f66 206f 6e65 2070 6172 7469 6369  n of one partici
+00021ed0: 7061 6e74 2028 6f72 2073 6573 7369 6f6e  pant (or session
+00021ee0: 292c 0a20 2020 2020 2020 206f 7220 7465  ),.        or te
+00021ef0: 7374 206a 6f62 2073 7562 6d69 7373 696f  st job submissio
+00021f00: 6e20 696e 2060 6261 6273 2d63 6865 636b  n in `babs-check
+00021f10: 2d73 6574 7570 602e 0a0a 2020 2020 2020  -setup`...      
+00021f20: 2020 5061 7261 6d65 7465 7273 3a0a 2020    Parameters:.  
+00021f30: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00021f40: 2d2d 2d0a 2020 2020 2020 2020 7961 6d6c  ---.        yaml
+00021f50: 5f70 6174 683a 2073 7472 0a20 2020 2020  _path: str.     
+00021f60: 2020 2020 2020 2054 6865 2070 6174 6820         The path 
+00021f70: 746f 2074 6865 2079 616d 6c20 6669 6c65  to the yaml file
+00021f80: 2074 6f20 6265 2067 656e 6572 6174 6564   to be generated
+00021f90: 2e20 4974 2073 686f 756c 6420 6265 2069  . It should be i
+00021fa0: 6e20 7468 6520 6061 6e61 6c79 7369 732f  n the `analysis/
+00021fb0: 636f 6465 6020 666f 6c64 6572 2e0a 2020  code` folder..  
+00021fc0: 2020 2020 2020 2020 2020 4974 2068 6173            It has
+00021fd0: 2073 6576 6572 616c 2066 6965 6c64 733a   several fields:
+00021fe0: 2031 2920 636d 645f 7465 6d70 6c61 7465   1) cmd_template
+00021ff0: 3b20 3229 206a 6f62 5f6e 616d 655f 7465  ; 2) job_name_te
+00022000: 6d70 6c61 7465 0a20 2020 2020 2020 2062  mplate.        b
+00022010: 6162 733a 2063 6c61 7373 2060 4241 4253  abs: class `BABS
+00022020: 600a 2020 2020 2020 2020 2020 2020 696e  `.            in
+00022030: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
+00022040: 7468 6520 4241 4253 2070 726f 6a65 6374  the BABS project
+00022050: 0a20 2020 2020 2020 2073 7973 7465 6d3a  .        system:
+00022060: 2063 6c61 7373 2060 5379 7374 656d 600a   class `System`.
+00022070: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00022080: 726d 6174 696f 6e20 6f6e 2063 6c75 7374  rmation on clust
+00022090: 6572 206d 616e 6167 656d 656e 7420 7379  er management sy
+000220a0: 7374 656d 0a20 2020 2020 2020 2074 6573  stem.        tes
+000220b0: 743a 2062 6f6f 6c0a 2020 2020 2020 2020  t: bool.        
+000220c0: 2020 2020 666c 6167 2074 6f20 7365 7420      flag to set 
+000220d0: 746f 2054 7275 6520 6966 2067 656e 6572  to True if gener
+000220e0: 6174 696e 6720 7468 6520 7465 7374 206a  ating the test j
+000220f0: 6f62 2073 7562 6d69 7420 7465 6d70 6c61  ob submit templa
+00022100: 7465 0a20 2020 2020 2020 2020 2020 2066  te.            f
+00022110: 6f72 2060 6261 6273 2d63 6865 636b 2d73  or `babs-check-s
+00022120: 6574 7570 602e 0a20 2020 2020 2020 2022  etup`..        "
+00022130: 2222 0a0a 2020 2020 2020 2020 2320 5365  ""..        # Se
+00022140: 6374 696f 6e20 313a 2043 6f6d 6d61 6e64  ction 1: Command
+00022150: 2066 6f72 2073 7562 6d69 7474 696e 6720   for submitting 
+00022160: 7468 6520 6a6f 623a 202d 2d2d 2d2d 2d2d  the job: -------
+00022170: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00022180: 2d2d 2d2d 0a20 2020 2020 2020 2023 2046  ----.        # F
+00022190: 6c61 6773 2077 6865 6e20 7375 626d 6974  lags when submit
+000221a0: 7469 6e67 2074 6865 206a 6f62 3a0a 2020  ting the job:.  
+000221b0: 2020 2020 2020 6966 2073 7973 7465 6d2e        if system.
+000221c0: 7479 7065 203d 3d20 2273 6765 223a 0a20  type == "sge":. 
+000221d0: 2020 2020 2020 2020 2020 2073 7562 6d69             submi
+000221e0: 745f 6865 6164 203d 2022 7173 7562 202d  t_head = "qsub -
+000221f0: 6377 6422 0a20 2020 2020 2020 2020 2020  cwd".           
+00022200: 2065 6e76 5f66 6c61 6773 203d 2022 2d76   env_flags = "-v
+00022210: 2044 534c 4f43 4b46 494c 453d 2220 2b20   DSLOCKFILE=" + 
+00022220: 6261 6273 2e61 6e61 6c79 7369 735f 7061  babs.analysis_pa
+00022230: 7468 202b 2022 2f2e 5347 455f 6461 7461  th + "/.SGE_data
+00022240: 6c61 645f 6c6f 636b 220a 2020 2020 2020  lad_lock".      
+00022250: 2020 656c 6966 2073 7973 7465 6d2e 7479    elif system.ty
+00022260: 7065 203d 3d20 2273 6c75 726d 223a 0a20  pe == "slurm":. 
+00022270: 2020 2020 2020 2020 2020 2073 7562 6d69             submi
+00022280: 745f 6865 6164 203d 2022 7362 6174 6368  t_head = "sbatch
+00022290: 220a 2020 2020 2020 2020 2020 2020 656e  ".            en
+000222a0: 765f 666c 6167 7320 3d20 222d 2d65 7870  v_flags = "--exp
+000222b0: 6f72 743d 4453 4c4f 434b 4649 4c45 3d22  ort=DSLOCKFILE="
+000222c0: 202b 2062 6162 732e 616e 616c 7973 6973   + babs.analysis
+000222d0: 5f70 6174 6820 2b20 222f 2e53 4c55 524d  _path + "/.SLURM
+000222e0: 5f64 6174 616c 6164 5f6c 6f63 6b22 0a20  _datalad_lock". 
+000222f0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00022300: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00022310: 732e 7761 726e 2822 6e6f 7420 7375 7070  s.warn("not supp
+00022320: 6f72 7469 6e67 2073 7973 7465 6d73 206f  orting systems o
+00022330: 7468 6572 2074 6861 6e20 7367 652e 2e2e  ther than sge...
+00022340: 2229 0a0a 2020 2020 2020 2020 2320 4368  ")..        # Ch
+00022350: 6563 6b20 6966 2074 6865 2062 6173 6820  eck if the bash 
+00022360: 6669 6c65 2061 6c72 6561 6479 2065 7869  file already exi
+00022370: 7374 3a0a 2020 2020 2020 2020 6966 206f  st:.        if o
+00022380: 702e 6578 6973 7473 2879 616d 6c5f 7061  p.exists(yaml_pa
+00022390: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+000223a0: 206f 732e 7265 6d6f 7665 2879 616d 6c5f   os.remove(yaml_
+000223b0: 7061 7468 2920 2023 2072 656d 6f76 6520  path)  # remove 
+000223c0: 6974 0a0a 2020 2020 2020 2020 2320 5772  it..        # Wr
+000223d0: 6974 6520 696e 746f 2074 6865 2062 6173  ite into the bas
+000223e0: 6820 6669 6c65 3a0a 2020 2020 2020 2020  h file:.        
+000223f0: 7961 6d6c 5f66 696c 6520 3d20 6f70 656e  yaml_file = open
+00022400: 2879 616d 6c5f 7061 7468 2c20 2261 2229  (yaml_path, "a")
+00022410: 2020 2023 206f 7065 6e20 696e 2061 7070     # open in app
+00022420: 656e 6420 6d6f 6465 0a20 2020 2020 2020  end mode.       
+00022430: 2069 6620 6e6f 7420 7465 7374 3a0a 2020   if not test:.  
+00022440: 2020 2020 2020 2020 2020 7961 6d6c 5f66            yaml_f
+00022450: 696c 652e 7772 6974 6528 2223 2027 247b  ile.write("# '${
+00022460: 7375 625f 6964 7d27 2061 6e64 2027 247b  sub_id}' and '${
+00022470: 7365 735f 6964 7d27 2061 7265 2070 6c61  ses_id}' are pla
+00022480: 6365 686f 6c64 6572 732e 2220 2b20 225c  ceholders." + "\
+00022490: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+000224a0: 2320 5661 7269 6162 6c65 7320 746f 2075  # Variables to u
+000224b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000224c0: 2320 6064 7373 6f75 7263 6560 3a20 496e  # `dssource`: In
+000224d0: 7075 7420 5249 413a 0a20 2020 2020 2020  put RIA:.       
+000224e0: 2020 2020 2064 7373 6f75 7263 6520 3d20       dssource = 
+000224f0: 6261 6273 2e69 6e70 7574 5f72 6961 5f75  babs.input_ria_u
+00022500: 726c 202b 2022 2322 202b 2062 6162 732e  rl + "#" + babs.
+00022510: 616e 616c 7973 6973 5f64 6174 6173 6574  analysis_dataset
+00022520: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
+00022530: 2320 6070 7573 6867 6974 7265 6d6f 7465  # `pushgitremote
+00022540: 603a 204f 7574 7075 7420 5249 413a 0a20  `: Output RIA:. 
+00022550: 2020 2020 2020 2020 2020 2070 7573 6867             pushg
+00022560: 6974 7265 6d6f 7465 203d 2062 6162 732e  itremote = babs.
+00022570: 6f75 7470 7574 5f72 6961 5f64 6174 615f  output_ria_data_
+00022580: 6469 720a 0a20 2020 2020 2020 2023 2047  dir..        # G
+00022590: 656e 6572 6174 6520 7468 6520 636f 6d6d  enerate the comm
+000225a0: 616e 643a 0a20 2020 2020 2020 2023 2054  and:.        # T
+000225b0: 4f44 4f3a 2054 4244 3a20 6164 6469 6e67  ODO: TBD: adding
+000225c0: 2062 656c 6f77 2074 6f20 6064 6963 745f   below to `dict_
+000225d0: 636c 7573 7465 725f 7379 7374 656d 732e  cluster_systems.
+000225e0: 7961 6d6c 6020 6f72 2061 6e6f 7468 6572  yaml` or another
+000225f0: 2059 414d 4c20 6669 6c65 3f0a 2020 2020   YAML file?.    
+00022600: 2020 2020 6966 2073 7973 7465 6d2e 7479      if system.ty
+00022610: 7065 203d 3d20 2273 6765 223a 0a20 2020  pe == "sge":.   
+00022620: 2020 2020 2020 2020 206e 616d 655f 666c           name_fl
+00022630: 6167 5f73 7472 203d 2022 202d 4e20 220a  ag_str = " -N ".
+00022640: 2020 2020 2020 2020 6966 2073 7973 7465          if syste
+00022650: 6d2e 7479 7065 203d 3d20 2273 6c75 726d  m.type == "slurm
+00022660: 223a 0a20 2020 2020 2020 2020 2020 206e  ":.            n
+00022670: 616d 655f 666c 6167 5f73 7472 203d 2022  ame_flag_str = "
+00022680: 202d 2d6a 6f62 2d6e 616d 6520 220a 0a20   --job-name ".. 
+00022690: 2020 2020 2020 2023 2053 6563 7469 6f6e         # Section
+000226a0: 2032 3a20 4a6f 6220 6e61 6d65 3a20 2d2d   2: Job name: --
+000226b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000226c0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000226d0: 2020 2320 4a6f 6220 6e61 6d65 3a0a 2020    # Job name:.  
+000226e0: 2020 2020 2020 6966 2074 6573 743a 0a20        if test:. 
+000226f0: 2020 2020 2020 2020 2020 206a 6f62 5f6e             job_n
+00022700: 616d 6520 3d20 7365 6c66 2e63 6f6e 7461  ame = self.conta
+00022710: 696e 6572 5f6e 616d 655b 303a 335d 202b  iner_name[0:3] +
+00022720: 2022 5f22 202b 2022 7465 7374 5f6a 6f62   "_" + "test_job
+00022730: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
+00022740: 2020 2020 2020 2020 2020 2020 6a6f 625f              job_
+00022750: 6e61 6d65 203d 2073 656c 662e 636f 6e74  name = self.cont
+00022760: 6169 6e65 725f 6e61 6d65 5b30 3a33 5d20  ainer_name[0:3] 
+00022770: 2b20 225f 2220 2b20 2224 7b73 7562 5f69  + "_" + "${sub_i
+00022780: 647d 220a 2020 2020 2020 2020 2020 2020  d}".            
+00022790: 6966 2062 6162 732e 7479 7065 5f73 6573  if babs.type_ses
+000227a0: 7369 6f6e 203d 3d20 226d 756c 7469 2d73  sion == "multi-s
+000227b0: 6573 223a 0a20 2020 2020 2020 2020 2020  es":.           
+000227c0: 2020 2020 206a 6f62 5f6e 616d 6520 2b3d       job_name +=
+000227d0: 2022 5f24 7b73 6573 5f69 647d 220a 0a20   "_${ses_id}".. 
+000227e0: 2020 2020 2020 2023 204e 6f77 2c20 7765         # Now, we
+000227f0: 2063 616e 2064 6566 696e 6520 7374 646f   can define stdo
+00022800: 7574 2061 6e64 2073 7464 6572 7220 6669  ut and stderr fi
+00022810: 6c65 206e 616d 6573 2f70 6174 6873 3a0a  le names/paths:.
+00022820: 2020 2020 2020 2020 6966 2073 7973 7465          if syste
+00022830: 6d2e 7479 7065 203d 3d20 2273 6765 223a  m.type == "sge":
+00022840: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+00022850: 6765 2063 6c75 7374 6572 7320 6f6e 6c79  ge clusters only
+00022860: 206e 6565 6420 6c6f 6773 2066 6f6c 6465   need logs folde
+00022870: 7220 7061 7468 3b20 6669 6c65 6e61 6d65  r path; filename
+00022880: 2069 7320 6e6f 7420 6e65 6564 6564 3a0a   is not needed:.
+00022890: 2020 2020 2020 2020 2020 2020 656f 5f61              eo_a
+000228a0: 7267 7320 3d20 222d 6520 2220 2b20 6261  rgs = "-e " + ba
+000228b0: 6273 2e61 6e61 6c79 7369 735f 7061 7468  bs.analysis_path
+000228c0: 202b 2022 2f6c 6f67 7320 2220 5c0a 2020   + "/logs " \.  
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+000228e0: 222d 6f20 2220 2b20 6261 6273 2e61 6e61  "-o " + babs.ana
+000228f0: 6c79 7369 735f 7061 7468 202b 2022 2f6c  lysis_path + "/l
+00022900: 6f67 7322 0a20 2020 2020 2020 2065 6c69  ogs".        eli
+00022910: 6620 7379 7374 656d 2e74 7970 6520 3d3d  f system.type ==
+00022920: 2022 736c 7572 6d22 3a0a 2020 2020 2020   "slurm":.      
+00022930: 2020 2020 2020 2320 736c 7572 6d20 636c        # slurm cl
+00022940: 7573 7465 7273 2061 6c73 6f20 6e65 6564  usters also need
+00022950: 2065 7861 6374 2066 696c 656e 616d 6573   exact filenames
+00022960: 3a0a 2020 2020 2020 2020 2020 2020 656f  :.            eo
+00022970: 5f61 7267 7320 3d20 222d 6520 2220 2b20  _args = "-e " + 
+00022980: 6261 6273 2e61 6e61 6c79 7369 735f 7061  babs.analysis_pa
+00022990: 7468 202b 2066 222f 6c6f 6773 2f7b 6a6f  th + f"/logs/{jo
+000229a0: 625f 6e61 6d65 7d2e 6525 4120 2220 5c0a  b_name}.e%A " \.
+000229b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000229c0: 2b20 222d 6f20 2220 2b20 6261 6273 2e61  + "-o " + babs.a
+000229d0: 6e61 6c79 7369 735f 7061 7468 202b 2066  nalysis_path + f
+000229e0: 222f 6c6f 6773 2f7b 6a6f 625f 6e61 6d65  "/logs/{job_name
+000229f0: 7d2e 6f25 4122 0a0a 2020 2020 2020 2020  }.o%A"..        
+00022a00: 2320 4765 6e65 7261 7465 2074 6865 206a  # Generate the j
+00022a10: 6f62 2073 7562 6d69 7373 696f 6e20 636f  ob submission co
+00022a20: 6d6d 616e 642c 2077 6974 6820 7375 6220  mmand, with sub 
+00022a30: 4944 2061 6e64 2073 6573 2049 4420 6173  ID and ses ID as
+00022a40: 2070 6c61 6365 686f 6c64 6572 733a 0a20   placeholders:. 
+00022a50: 2020 2020 2020 2063 6d64 203d 2073 7562         cmd = sub
+00022a60: 6d69 745f 6865 6164 202b 2022 2022 202b  mit_head + " " +
+00022a70: 2065 6e76 5f66 6c61 6773 202b 206e 616d   env_flags + nam
+00022a80: 655f 666c 6167 5f73 7472 202b 206a 6f62  e_flag_str + job
+00022a90: 5f6e 616d 6520 2b20 2220 2220 2b20 656f  _name + " " + eo
+00022aa0: 5f61 7267 7320 2b20 2220 220a 2020 2020  _args + " ".    
+00022ab0: 2020 2020 6966 2074 6573 743a 0a20 2020      if test:.   
+00022ac0: 2020 2020 2020 2020 2063 6d64 202b 3d20           cmd += 
+00022ad0: 6261 6273 2e61 6e61 6c79 7369 735f 7061  babs.analysis_pa
+00022ae0: 7468 202b 2022 2f63 6f64 652f 6368 6563  th + "/code/chec
+00022af0: 6b5f 7365 7475 702f 6361 6c6c 5f74 6573  k_setup/call_tes
+00022b00: 745f 6a6f 622e 7368 220a 2020 2020 2020  t_job.sh".      
+00022b10: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00022b20: 2020 2020 2320 6966 2074 6573 7420 6973      # if test is
+00022b30: 2046 616c 7365 2c20 7468 6520 7479 7065   False, the type
+00022b40: 206f 6620 7365 7373 696f 6e20 7769 6c6c   of session will
+00022b50: 2062 6520 6368 6563 6b65 640a 2020 2020   be checked.    
+00022b60: 2020 2020 2020 2020 6966 2062 6162 732e          if babs.
+00022b70: 7479 7065 5f73 6573 7369 6f6e 203d 3d20  type_session == 
+00022b80: 2273 696e 676c 652d 7365 7322 3a0a 2020  "single-ses":.  
+00022b90: 2020 2020 2020 2020 2020 2020 2020 636d                cm
+00022ba0: 6420 2b3d 2062 6162 732e 616e 616c 7973  d += babs.analys
+00022bb0: 6973 5f70 6174 6820 2b20 222f 636f 6465  is_path + "/code
+00022bc0: 2f70 6172 7469 6369 7061 6e74 5f6a 6f62  /participant_job
+00022bd0: 2e73 6822 202b 2022 2022 205c 0a20 2020  .sh" + " " \.   
+00022be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022bf0: 202b 2064 7373 6f75 7263 6520 2b20 2220   + dssource + " 
+00022c00: 2220 5c0a 2020 2020 2020 2020 2020 2020  " \.            
+00022c10: 2020 2020 2020 2020 2b20 7075 7368 6769          + pushgi
+00022c20: 7472 656d 6f74 6520 2b20 2220 2220 2b20  tremote + " " + 
+00022c30: 2224 7b73 7562 5f69 647d 220a 2020 2020  "${sub_id}".    
+00022c40: 2020 2020 2020 2020 656c 6966 2062 6162          elif bab
+00022c50: 732e 7479 7065 5f73 6573 7369 6f6e 203d  s.type_session =
+00022c60: 3d20 226d 756c 7469 2d73 6573 223a 0a20  = "multi-ses":. 
+00022c70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022c80: 6d64 202b 3d20 6261 6273 2e61 6e61 6c79  md += babs.analy
+00022c90: 7369 735f 7061 7468 202b 2022 2f63 6f64  sis_path + "/cod
+00022ca0: 652f 7061 7274 6963 6970 616e 745f 6a6f  e/participant_jo
+00022cb0: 622e 7368 2220 2b20 2220 2220 5c0a 2020  b.sh" + " " \.  
+00022cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022cd0: 2020 2b20 6473 736f 7572 6365 202b 2022    + dssource + "
+00022ce0: 2022 205c 0a20 2020 2020 2020 2020 2020   " \.           
+00022cf0: 2020 2020 2020 2020 202b 2070 7573 6867           + pushg
+00022d00: 6974 7265 6d6f 7465 202b 2022 2022 202b  itremote + " " +
+00022d10: 2022 247b 7375 625f 6964 7d20 247b 7365   "${sub_id} ${se
+00022d20: 735f 6964 7d22 0a0a 2020 2020 2020 2020  s_id}"..        
+00022d30: 7961 6d6c 5f66 696c 652e 7772 6974 6528  yaml_file.write(
+00022d40: 2263 6d64 5f74 656d 706c 6174 653a 2027  "cmd_template: '
+00022d50: 2220 2b20 636d 6420 2b20 2227 2220 2b20  " + cmd + "'" + 
+00022d60: 225c 6e22 290a 2020 2020 2020 2020 7961  "\n").        ya
+00022d70: 6d6c 5f66 696c 652e 7772 6974 6528 226a  ml_file.write("j
+00022d80: 6f62 5f6e 616d 655f 7465 6d70 6c61 7465  ob_name_template
+00022d90: 3a20 2722 202b 206a 6f62 5f6e 616d 6520  : '" + job_name 
+00022da0: 2b20 2227 5c6e 2229 0a20 2020 2020 2020  + "'\n").       
+00022db0: 2079 616d 6c5f 6669 6c65 2e63 6c6f 7365   yaml_file.close
+00022dc0: 2829 0a                                  ().
```

### Comparing `babs-0.0.5/babs/cli.py` & `babs-0.0.6/babs/cli.py`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/babs/dict_cluster_systems.yaml` & `babs-0.0.6/babs/dict_cluster_systems.yaml`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/babs/template_test_job.py` & `babs-0.0.6/babs/template_test_job.py`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/babs/utils.py` & `babs-0.0.6/babs/utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -2438,14 +2438,48 @@
         print("Hint: check if the job was killed during pending state")
         # ^^ for SGE cluster: job manually killed during pending: `qacct` will fail:
         #   "error: job id xxx not found"
         msg_toreturn = msg_failed_to_call_qacct
 
     return msg_toreturn
 
+
+def get_cmd_cancel_job(type_system):
+    """
+    This is to get the command used for canceling a job
+    (i.e., deleting a job from the queue).
+    This is dependent on cluster system.
+
+    Parameters:
+    ------------
+    type_system: str
+        the type of job scheduling system, "sge" or "slurm"
+
+    Returns:
+    --------------
+    cmd: str
+        the command for canceling a job
+
+    Notes:
+    ----------------
+    On SGE clusters, we use `qdel <job_id>` to cancel a job;
+    On Slurm clusters, we use `scancel <job_id>` to cancel a job.
+    """
+
+    if type_system == "sge":
+        cmd = "qdel"
+    elif type_system == "slurm":
+        cmd = "scancel"
+    else:
+        raise Exception("Invalid job scheduler system type `type_system`: " + type_system)
+
+    # print("the command for cancelling the job: " + cmd)   # NOTE: for testing only
+    return cmd
+
+
 def print_versions_from_yaml(fn_yaml):
     """
     This is to go thru information in `code/check_setup/check_env.yaml` saved by `test_job.py`.
     1. check if there is anything required but not installed
     2. print out the versions for user to visually check
     This is used by `babs-check-setup`.
```

### Comparing `babs-0.0.5/babs.egg-info/PKG-INFO` & `babs-0.0.6/babs.egg-info/PKG-INFO`

 * *Files 14% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: babs
-Version: 0.0.5
+Version: 0.0.6
 Summary: BIDS App Bootstrap (BABS) is a reproducible, generalizable, and scalable Python package for BIDS App analysis of large datasets. It uses DataLad and adopts FAIRly big framework.
 Home-page: https://github.com/PennLINC/babs
 Author: The PennLINC developers
 Author-email: chenyzh@seas.upenn.edu
 Maintainer: Chenying Zhao, Sydney Covitz, Matt Cieslak
 Maintainer-email: chenyzh@seas.upenn.edu
 License: MIT
```

### Comparing `babs-0.0.5/setup.cfg` & `babs-0.0.6/setup.cfg`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/setup.py` & `babs-0.0.6/setup.py`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/tests/test_babs_check_setup.py` & `babs-0.0.6/tests/test_babs_check_setup.py`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/tests/test_babs_init.py` & `babs-0.0.6/tests/test_babs_init.py`

 * *Files identical despite different names*

### Comparing `babs-0.0.5/versioneer.py` & `babs-0.0.6/versioneer.py`

 * *Files identical despite different names*

