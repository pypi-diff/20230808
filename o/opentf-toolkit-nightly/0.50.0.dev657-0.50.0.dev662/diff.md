# Comparing `tmp/opentf_toolkit_nightly-0.50.0.dev657-py3-none-any.whl.zip` & `tmp/opentf_toolkit_nightly-0.50.0.dev662-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,54 +1,54 @@
-Zip file size: 78879 bytes, number of entries: 52
--rw-r--r--  2.0 unx    20257 b- defN 23-Aug-04 10:04 opentf/commons/__init__.py
--rw-r--r--  2.0 unx    14481 b- defN 23-Aug-04 10:04 opentf/commons/auth.py
--rw-r--r--  2.0 unx     3510 b- defN 23-Aug-04 10:04 opentf/commons/config.py
--rw-r--r--  2.0 unx    18982 b- defN 23-Aug-04 10:04 opentf/commons/expressions.py
--rw-r--r--  2.0 unx     5675 b- defN 23-Aug-04 10:04 opentf/commons/pubsub.py
--rw-r--r--  2.0 unx     3909 b- defN 23-Aug-04 10:04 opentf/commons/schemas.py
--rw-r--r--  2.0 unx     5521 b- defN 23-Aug-04 10:04 opentf/commons/selectors.py
--rw-r--r--  2.0 unx        0 b- defN 23-Aug-04 10:04 opentf/schemas/__init__.py
--rw-rw-rw-  2.0 unx     2105 b- defN 23-Aug-04 10:04 opentf/schemas/abac.opentestfactory.org/v1alpha1/Policy.json
--rw-rw-rw-  2.0 unx     1230 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/AgentRegistration.json
--rw-rw-rw-  2.0 unx     1366 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/AllureCollectorOutput.json
--rw-rw-rw-  2.0 unx     1239 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ChannelHandlerHooks.json
--rw-rw-rw-  2.0 unx     2174 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/EventBusConfig.json
--rw-rw-rw-  2.0 unx     2702 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionCommand.json
--rw-rw-rw-  2.0 unx     1347 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionError.json
--rw-rw-rw-  2.0 unx     3050 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionResult.json
--rw-rw-rw-  2.0 unx     1754 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/GeneratorCommand.json
--rw-rw-rw-  2.0 unx     6633 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/GeneratorResult.json
--rw-rw-rw-  2.0 unx     3790 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/Notification.json
--rw-rw-rw-  2.0 unx     2803 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/PluginMetadata.json
--rw-rw-rw-  2.0 unx     2875 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ProviderCommand.json
--rw-rw-rw-  2.0 unx     3878 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ProviderConfig.json
--rw-rw-rw-  2.0 unx     4259 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ProviderResult.json
--rw-rw-rw-  2.0 unx     2910 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/QualityGate.json
--rw-rw-rw-  2.0 unx     1182 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/RetentionPolicy.json
--rw-rw-rw-  2.0 unx     6301 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/SSHServiceConfig.json
--rw-rw-rw-  2.0 unx     2835 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/ServiceConfig.json
--rw-rw-rw-  2.0 unx     2810 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/Subscription.json
--rw-rw-rw-  2.0 unx     9899 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/Workflow.json
--rw-rw-rw-  2.0 unx     1351 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowCanceled.json
--rw-rw-rw-  2.0 unx     1292 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowCompleted.json
--rw-rw-rw-  2.0 unx     1577 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowResult.json
--rw-rw-rw-  2.0 unx     2232 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha2/Notification.json
--rw-rw-rw-  2.0 unx     6612 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1alpha2/SSHServiceConfig.json
--rw-rw-rw-  2.0 unx     4273 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/ExecutionCommand.json
--rw-rw-rw-  2.0 unx    10205 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/GeneratorResult.json
--rw-rw-rw-  2.0 unx     4581 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/ProviderCommand.json
--rw-rw-rw-  2.0 unx     4563 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/ProviderConfig.json
--rw-rw-rw-  2.0 unx     7494 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/ProviderResult.json
--rw-rw-rw-  2.0 unx     2850 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/ServiceConfig.json
--rw-rw-rw-  2.0 unx    15424 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta1/Workflow.json
--rw-rw-rw-  2.0 unx     3517 b- defN 23-Aug-04 10:04 opentf/schemas/opentestfactory.org/v1beta2/ServiceConfig.json
--rw-rw-rw-  2.0 unx     1579 b- defN 23-Aug-04 10:04 opentf/scripts/launch_java_service.sh
--rw-r--r--  2.0 unx    18719 b- defN 23-Aug-04 10:04 opentf/scripts/startup.py
--rw-r--r--  2.0 unx    19088 b- defN 23-Aug-04 10:04 opentf/toolkit/__init__.py
--rw-r--r--  2.0 unx    16121 b- defN 23-Aug-04 10:04 opentf/toolkit/channels.py
--rw-r--r--  2.0 unx     7312 b- defN 23-Aug-04 10:04 opentf/toolkit/core.py
--rw-rw-rw-  2.0 unx    11357 b- defN 23-Aug-04 10:04 opentf_toolkit_nightly-0.50.0.dev657.dist-info/LICENSE
--rw-r--r--  2.0 unx     1981 b- defN 23-Aug-04 10:04 opentf_toolkit_nightly-0.50.0.dev657.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Aug-04 10:04 opentf_toolkit_nightly-0.50.0.dev657.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Aug-04 10:04 opentf_toolkit_nightly-0.50.0.dev657.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     5667 b- defN 23-Aug-04 10:04 opentf_toolkit_nightly-0.50.0.dev657.dist-info/RECORD
-52 files, 287371 bytes uncompressed, 69393 bytes compressed:  75.9%
+Zip file size: 79351 bytes, number of entries: 52
+-rw-r--r--  2.0 unx    20257 b- defN 23-Aug-08 13:21 opentf/commons/__init__.py
+-rw-r--r--  2.0 unx    14481 b- defN 23-Aug-08 13:21 opentf/commons/auth.py
+-rw-r--r--  2.0 unx     3510 b- defN 23-Aug-08 13:21 opentf/commons/config.py
+-rw-r--r--  2.0 unx    18982 b- defN 23-Aug-08 13:21 opentf/commons/expressions.py
+-rw-r--r--  2.0 unx     5675 b- defN 23-Aug-08 13:21 opentf/commons/pubsub.py
+-rw-r--r--  2.0 unx     3909 b- defN 23-Aug-08 13:21 opentf/commons/schemas.py
+-rw-r--r--  2.0 unx     7392 b- defN 23-Aug-08 13:21 opentf/commons/selectors.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Aug-08 13:21 opentf/schemas/__init__.py
+-rw-rw-rw-  2.0 unx     2105 b- defN 23-Aug-08 13:21 opentf/schemas/abac.opentestfactory.org/v1alpha1/Policy.json
+-rw-rw-rw-  2.0 unx     1230 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/AgentRegistration.json
+-rw-rw-rw-  2.0 unx     1366 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/AllureCollectorOutput.json
+-rw-rw-rw-  2.0 unx     1239 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ChannelHandlerHooks.json
+-rw-rw-rw-  2.0 unx     2174 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/EventBusConfig.json
+-rw-rw-rw-  2.0 unx     2702 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionCommand.json
+-rw-rw-rw-  2.0 unx     1347 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionError.json
+-rw-rw-rw-  2.0 unx     3050 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionResult.json
+-rw-rw-rw-  2.0 unx     1754 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/GeneratorCommand.json
+-rw-rw-rw-  2.0 unx     6633 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/GeneratorResult.json
+-rw-rw-rw-  2.0 unx     3790 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/Notification.json
+-rw-rw-rw-  2.0 unx     2803 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/PluginMetadata.json
+-rw-rw-rw-  2.0 unx     2875 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ProviderCommand.json
+-rw-rw-rw-  2.0 unx     3878 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ProviderConfig.json
+-rw-rw-rw-  2.0 unx     4259 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ProviderResult.json
+-rw-rw-rw-  2.0 unx     2910 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/QualityGate.json
+-rw-rw-rw-  2.0 unx     1182 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/RetentionPolicy.json
+-rw-rw-rw-  2.0 unx     6301 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/SSHServiceConfig.json
+-rw-rw-rw-  2.0 unx     2835 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/ServiceConfig.json
+-rw-rw-rw-  2.0 unx     2810 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/Subscription.json
+-rw-rw-rw-  2.0 unx     9899 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/Workflow.json
+-rw-rw-rw-  2.0 unx     1351 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowCanceled.json
+-rw-rw-rw-  2.0 unx     1292 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowCompleted.json
+-rw-rw-rw-  2.0 unx     1577 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha1/WorkflowResult.json
+-rw-rw-rw-  2.0 unx     2232 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha2/Notification.json
+-rw-rw-rw-  2.0 unx     6612 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1alpha2/SSHServiceConfig.json
+-rw-rw-rw-  2.0 unx     4273 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/ExecutionCommand.json
+-rw-rw-rw-  2.0 unx    10205 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/GeneratorResult.json
+-rw-rw-rw-  2.0 unx     4581 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/ProviderCommand.json
+-rw-rw-rw-  2.0 unx     4563 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/ProviderConfig.json
+-rw-rw-rw-  2.0 unx     7494 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/ProviderResult.json
+-rw-rw-rw-  2.0 unx     2850 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/ServiceConfig.json
+-rw-rw-rw-  2.0 unx    15424 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta1/Workflow.json
+-rw-rw-rw-  2.0 unx     3517 b- defN 23-Aug-08 13:21 opentf/schemas/opentestfactory.org/v1beta2/ServiceConfig.json
+-rw-rw-rw-  2.0 unx     1579 b- defN 23-Aug-08 13:21 opentf/scripts/launch_java_service.sh
+-rw-r--r--  2.0 unx    18719 b- defN 23-Aug-08 13:21 opentf/scripts/startup.py
+-rw-r--r--  2.0 unx    19088 b- defN 23-Aug-08 13:21 opentf/toolkit/__init__.py
+-rw-r--r--  2.0 unx    16121 b- defN 23-Aug-08 13:21 opentf/toolkit/channels.py
+-rw-r--r--  2.0 unx     7312 b- defN 23-Aug-08 13:21 opentf/toolkit/core.py
+-rw-rw-rw-  2.0 unx    11357 b- defN 23-Aug-08 13:21 opentf_toolkit_nightly-0.50.0.dev662.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1981 b- defN 23-Aug-08 13:21 opentf_toolkit_nightly-0.50.0.dev662.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Aug-08 13:21 opentf_toolkit_nightly-0.50.0.dev662.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Aug-08 13:21 opentf_toolkit_nightly-0.50.0.dev662.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     5667 b- defN 23-Aug-08 13:21 opentf_toolkit_nightly-0.50.0.dev662.dist-info/RECORD
+52 files, 289242 bytes uncompressed, 69865 bytes compressed:  75.8%
```

## zipnote {}

```diff
@@ -135,23 +135,23 @@
 
 Filename: opentf/toolkit/channels.py
 Comment: 
 
 Filename: opentf/toolkit/core.py
 Comment: 
 
-Filename: opentf_toolkit_nightly-0.50.0.dev657.dist-info/LICENSE
+Filename: opentf_toolkit_nightly-0.50.0.dev662.dist-info/LICENSE
 Comment: 
 
-Filename: opentf_toolkit_nightly-0.50.0.dev657.dist-info/METADATA
+Filename: opentf_toolkit_nightly-0.50.0.dev662.dist-info/METADATA
 Comment: 
 
-Filename: opentf_toolkit_nightly-0.50.0.dev657.dist-info/WHEEL
+Filename: opentf_toolkit_nightly-0.50.0.dev662.dist-info/WHEEL
 Comment: 
 
-Filename: opentf_toolkit_nightly-0.50.0.dev657.dist-info/top_level.txt
+Filename: opentf_toolkit_nightly-0.50.0.dev662.dist-info/top_level.txt
 Comment: 
 
-Filename: opentf_toolkit_nightly-0.50.0.dev657.dist-info/RECORD
+Filename: opentf_toolkit_nightly-0.50.0.dev662.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## opentf/commons/selectors.py

```diff
@@ -10,38 +10,54 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 """Selectors helpers"""
 
-from typing import Any, Dict, List, Mapping, Optional, Tuple
+from typing import Any, Dict, List, Optional, Tuple, Union
 
 import re
 
 ########################################################################
 ## Constants
 
 Object = Dict[str, Any]
+Selector = Tuple[
+    int,
+    Optional[Union[str, List[str]]],
+    Optional[bool],
+    Optional[Union[str, List[str]]],
+]
 
 NAME_PATTERN = r'^[0-9a-zA-Z]+([0-9A-Za-z-_.]*[0-9a-zA-Z])?$'
 LABEL_PATTERN = r'^([^/]+/)?([0-9A-Za-z-_.]{1,63})$'
 DNS_LABEL_PATTERN = r'^(?![0-9]+$)(?!-)[a-z0-9-]{1,63}(?<!-)$'
 
 KEY = r'[a-z0-9A-Z-_./]+'
 VALUE = r'[a-z0-9A-Z-_./@]+'
-EQUAL_EXPR = rf'^({KEY})\s*([=!]?=)\s*({VALUE})(?:,|$)'
-SET_EXPR = rf'^({KEY})\s+(in|notin)\s+\(({VALUE}(\s*,\s*{VALUE})*)\)(?:,|$)'
-EXISTS_EXPR = rf'^{KEY}(?:,|$)'
-NEXISTS_EXPR = rf'^!{KEY}(?:,|$)'
+EQUAL_EXPR = re.compile(rf'^({KEY})\s*([=!]?=)\s*({VALUE})(?:,|$)')
+SET_EXPR = re.compile(rf'^({KEY})\s+(in|notin)\s+\(({VALUE}(\s*,\s*{VALUE})*)\)(?:,|$)')
+EXISTS_EXPR = re.compile(rf'^{KEY}(?:,|$)')
+NEXISTS_EXPR = re.compile(rf'^!{KEY}(?:,|$)')
 
 
 ########################################################################
 ## Selectors helpers
 
+OP_RESOLV = 0x01
+OP_EQUAL = 0x10
+OP_EQUAL_RESOLV = 0x11
+OP_EXIST = 0x20
+OP_EXIST_RESOLV = 0x21
+OP_NEXIST = 0x40
+OP_NEXIST_RESOLV = 0x41
+OP_SET = 0x80
+OP_SET_RESOLV = 0x81
+
 
 def _split_exprs(exprs: str) -> List[str]:
     """Split a comma-separated list of expressions.
 
     # Required parameters
 
     - exprs: a string
@@ -49,118 +65,190 @@
     # Returned value
 
     A (possibly empty) list of _expressions_.  An expression is a
     string, stripped.
     """
     result = []
     while exprs:
-        match = re.match(SET_EXPR, exprs)
+        match = SET_EXPR.match(exprs)
         if not match:
-            match = re.match(EQUAL_EXPR, exprs)
+            match = EQUAL_EXPR.match(exprs)
         if not match:
-            match = re.match(EXISTS_EXPR, exprs)
+            match = EXISTS_EXPR.match(exprs)
         if not match:
-            match = re.match(NEXISTS_EXPR, exprs)
+            match = NEXISTS_EXPR.match(exprs)
         if not match:
             raise ValueError(f'Invalid expression {exprs}')
         result.append(exprs[: match.end()].strip(', '))
         exprs = exprs[match.end() :].strip(', ')
 
     return result
 
 
-def _resolve_path(path: str, obj: Object) -> Tuple[bool, Optional[str]]:
-    def inner(items, obj) -> Tuple[bool, Optional[str]]:
-        head, rest = items[0], items[1:]
-        if head in obj:
-            return (True, obj[head]) if not rest else inner(rest, obj[head])
-        return False, None
-
-    return inner(path.split('.'), obj)
-
-
-def _evaluate_fields(req: str, obj: Object) -> bool:
-    if req == '':
-        return True
-    if re.match(EXISTS_EXPR, req):
-        return _resolve_path(req, obj)[0]
-    if re.match(NEXISTS_EXPR, req):
-        return not _resolve_path(req[1:], obj)[0]
-    expr = re.match(SET_EXPR, req)
-    if expr:
-        key, ope, list_, _ = expr.groups()
-        found, value = _resolve_path(key, obj)
-        if found:
-            values = [v.strip() for v in list_.split(',')]
-            if ope == 'in':
-                return value in values
-            return value not in values
-        return ope == 'notin'
-    expr = re.match(EQUAL_EXPR, req)
-    if expr is None:
-        raise ValueError(f'Invalid expression {req}.')
-    key, ope, expected = expr.groups()
+def compile_selector(selector: str, resolve_path: bool = True) -> List[Selector]:
+    """Compile selector.
+
+    # Required parameters
+
+    - selector: a string, a comma-separated list of expressions
+
+    # Optional parameters
+
+    - resolve_path: a boolean, default True
+
+    # Returned value
+
+    A list of tuples, the 'compiled' selectors.
+
+    # Raised exceptions
+
+    A _ValueError_ exception is raised if at least one expression is
+    invalid.
+    """
+
+    def _maybe_resolve(opcode, item):
+        if resolve_path and '.' in item:
+            return opcode | OP_RESOLV, item.split('.')
+        return opcode, item
+
+    compiled = []
+    for expr in _split_exprs(selector):
+        match = EQUAL_EXPR.match(expr)
+        if match:
+            key, ope, value = match.groups()
+            code, key = _maybe_resolve(OP_EQUAL, key)
+            compiled.append((code, key, ope in ('==', '='), value))
+            continue
+        if EXISTS_EXPR.match(expr):
+            code, expr = _maybe_resolve(OP_EXIST, expr)
+            compiled.append((code, expr, None, None))
+            continue
+        if NEXISTS_EXPR.match(expr):
+            expr = expr[1:]
+            code, expr = _maybe_resolve(OP_NEXIST, expr)
+            compiled.append((code, expr, None, None))
+            continue
+        match = SET_EXPR.match(expr)
+        if match is None:
+            raise ValueError(f'Invalid expression {expr}.')
+        key, ope, list_, _ = match.groups()
+        code, key = _maybe_resolve(OP_SET, key)
+        compiled.append((code, key, ope == 'in', [v.strip() for v in list_.split(',')]))
+
+    return compiled
+
+
+def _resolve_path(items: List[str], obj) -> Tuple[bool, Optional[Any]]:
+    head, rest = items[0], items[1:]
+    if head in obj:
+        return (True, obj[head]) if not rest else _resolve_path(rest, obj[head])
+    return False, None
+
+
+def _op_equal_resolv(req, obj):
+    key, ope, arg = req[1:]
+    found, value = _resolve_path(key, obj)
+    if found:
+        return (value == arg) if ope else (value != arg)
+    return not ope
+
+
+def _op_exist(req, obj):
+    key = req[1]
+    return key in obj
+
+
+def _op_exist_resolv(req, obj):
+    key = req[1]
+    return _resolve_path(key, obj)[0]
+
+
+def _op_nexist(req, obj):
+    key = req[1]
+    return key not in obj
+
+
+def _op_nexist_resolv(req, obj):
+    key = req[1]
+    return not _resolve_path(key, obj)[0]
+
+
+def _op_set(req, obj):
+    key, ope, arg = req[1:]
+    if key in obj:
+        return (obj[key] in arg) if ope else (obj[key] not in arg)
+    return not ope
+
+
+def _op_set_resolv(req, obj):
+    key, ope, arg = req[1:]
     found, value = _resolve_path(key, obj)
     if found:
-        if ope in ('=', '=='):
-            return value == expected
-        return value != expected
-    return ope == '!='
+        return (value in arg) if ope else (value not in arg)
+    return not ope
+
+
+OP_HANDLERS = {
+    OP_EQUAL_RESOLV: _op_equal_resolv,
+    OP_EXIST: _op_exist,
+    OP_EXIST_RESOLV: _op_exist_resolv,
+    OP_NEXIST: _op_nexist,
+    OP_NEXIST_RESOLV: _op_nexist_resolv,
+    OP_SET: _op_set,
+    OP_SET_RESOLV: _op_set_resolv,
+}
 
 
-def _evaluate(req: str, labels: Mapping[str, str]) -> bool:
+def _evaluate(req, obj):
     """Evaluate whether req matches labels.
 
     # Required parameters
 
-    - req: a string
+    - req: a tuple (a 'compiled' selector)
     - labels: a dictionary
 
     # Returned value
 
     A boolean.  True if `req` is satisfied by `labels`, False otherwise.
 
     # Raised exceptions
 
     A _ValueError_ exception is raised if `req` is not a valid
     expression.
     """
-    if req == '':
-        return True
-    if re.match(EXISTS_EXPR, req):
-        return req in labels
-    if re.match(NEXISTS_EXPR, req):
-        return req[1:] not in labels
-    expr = re.match(SET_EXPR, req)
-    if expr:
-        key, ope, list_, _ = expr.groups()
-        if key in labels:
-            values = [v.strip() for v in list_.split(',')]
-            if ope == 'in':
-                return labels[key] in values
-            return labels[key] not in values
-        return ope == 'notin'
-    expr = re.match(EQUAL_EXPR, req)
-    if expr is None:
-        raise ValueError(f'Invalid expression {req}.')
-    key, ope, value = expr.groups()
-    if key in labels:
-        if ope in ('=', '=='):
-            return labels[key] == value
-        return labels[key] != value
-    return ope == '!='
+    opcode, key, ope, arg = req
+    if opcode == OP_EQUAL:  # fast path
+        if key in obj:
+            if ope:
+                return obj[key] == arg
+            return obj[key] != arg
+        return not ope
+
+    handler = OP_HANDLERS.get(opcode)
+    if not handler:
+        raise ValueError(f'Invalid opcode {opcode}.')
+    return handler(req, obj)
+
+
+def match_field_compiledselector(obj: Object, selectors: List[Selector]) -> bool:
+    return all(_evaluate(sel, obj) for sel in selectors)
 
 
 def match_field_selector(obj: Object, selector: str) -> bool:
     """Return True if the object matches the selector."""
-    return all(_evaluate_fields(sel, obj) for sel in _split_exprs(selector))
+    return match_field_compiledselector(obj, compile_selector(selector))
+
+
+def match_label_compiledselector(obj: Object, selectors: List[Selector]) -> bool:
+    labels = obj.get('metadata', {}).get('labels', {})
+    return all(_evaluate(sel, labels) for sel in selectors)
 
 
 def match_label_selector(obj: Object, selector: str) -> bool:
-    """Return True if the service matches the selector.
+    """Return True if the message's labels matches the selector.
 
     An empty selector always matches.
 
     The complete selector feature has been implemented.  `selector` is
     of form:
 
         expr[,expr]*
@@ -168,16 +256,17 @@
     where `expr` is one of `key`, `!key`, or `key op value`, with
     `op` being one of `=`, `==`, or `!=`.  The
     `key in (value[, value...])` and `key notin (value[, value...])`
     set-based requirements are also implemented.
 
     # Required parameters
 
-    - obj: a Definition (a dictionary)
+    - obj: a message (a dictionary)
     - selector: a string
 
     # Returned value
 
     A boolean.
     """
-    metadata = obj.get('metadata', {}).get('labels', {})
-    return all(_evaluate(sel, metadata) for sel in _split_exprs(selector))
+    return match_label_compiledselector(
+        obj, compile_selector(selector, resolve_path=False)
+    )
```

## Comparing `opentf_toolkit_nightly-0.50.0.dev657.dist-info/LICENSE` & `opentf_toolkit_nightly-0.50.0.dev662.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `opentf_toolkit_nightly-0.50.0.dev657.dist-info/METADATA` & `opentf_toolkit_nightly-0.50.0.dev662.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: opentf-toolkit-nightly
-Version: 0.50.0.dev657
+Version: 0.50.0.dev662
 Summary: OpenTestFactory Orchestrator Toolkit
 Home-page: https://gitlab.com/henixdevelopment/open-source/opentestfactory/python-toolkit
 Author: Martin Lafaix
 Author-email: mlafaix@henix.com
 Maintainer: Henix
 Maintainer-email: opentestfactory@henix.com
 License: Apache Software License (https://www.apache.org/licenses/LICENSE-2.0)
```

## Comparing `opentf_toolkit_nightly-0.50.0.dev657.dist-info/RECORD` & `opentf_toolkit_nightly-0.50.0.dev662.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 opentf/commons/__init__.py,sha256=M3qZ6W47FNb3fV8PTOQL0wyPkFZcMvQuhFTzj6vBqh0,20257
 opentf/commons/auth.py,sha256=ADMygTSGy6voOQUAD9EtusPR_hgJ6jUK_uJE8CCpBoE,14481
 opentf/commons/config.py,sha256=lvxacmFxxQ8Va0qepx-ld7taCpjOr4l-NjDBOTrzrE4,3510
 opentf/commons/expressions.py,sha256=F8oJgLB0LjqIJOfDHhw2MXY5CQuX7GksJZijY7K-TLc,18982
 opentf/commons/pubsub.py,sha256=_Psa3wdE_OB6wDHhUwr9zdxHpu5rSz19qtpM1Qo2WsY,5675
 opentf/commons/schemas.py,sha256=kMhZH47dpBk_HDMZk-1AlTb1dIYF-N6SPiEUmkEtWX0,3909
-opentf/commons/selectors.py,sha256=yj7Os7_8osvOssKUxi8d4tpKSMKBAa5hM81TWKjIADI,5521
+opentf/commons/selectors.py,sha256=OGgwBbWxmojVtK4scJ14frd9z8uWSlQyk3y4z7rA84g,7392
 opentf/schemas/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 opentf/schemas/abac.opentestfactory.org/v1alpha1/Policy.json,sha256=JXsfNAPSEYggeyaDutSQBeG38o4Bmcr70dPLWWeqIh8,2105
 opentf/schemas/opentestfactory.org/v1alpha1/AgentRegistration.json,sha256=NQykqU-lKE8LtBhBiFUcpVJq00MRG6dZsoM1xedx6uQ,1230
 opentf/schemas/opentestfactory.org/v1alpha1/AllureCollectorOutput.json,sha256=-L9DDWA0A4x54bPMn4m6Qwi2tf2nHvzIPFOElTjaVck,1366
 opentf/schemas/opentestfactory.org/v1alpha1/ChannelHandlerHooks.json,sha256=6K6m9praw_f2biCMHfTsHPYia5z2jq10dciRLqf3ogI,1239
 opentf/schemas/opentestfactory.org/v1alpha1/EventBusConfig.json,sha256=2aIYtA07qRoauKNy-MH25Kzg1l1Q1fjY9_4YIvlyYgw,2174
 opentf/schemas/opentestfactory.org/v1alpha1/ExecutionCommand.json,sha256=Tsqy0imNqO6Qg6B_Yw-4OeNer3xpURv-ZDaYUoZ-l1c,2702
@@ -41,12 +41,12 @@
 opentf/schemas/opentestfactory.org/v1beta1/Workflow.json,sha256=QZ8mM9PhzsI9gTmwmKTWYNoRn--rtcM3L0PzgnPBfMU,15424
 opentf/schemas/opentestfactory.org/v1beta2/ServiceConfig.json,sha256=rEvK2YWL5lG94_qYgR_GnLWNsaQhaQ-2kuZdWJr5NnY,3517
 opentf/scripts/launch_java_service.sh,sha256=FRYrQD704VWLGXQ3QI-M3m77olXexB0vVEwzyiKLkxc,1579
 opentf/scripts/startup.py,sha256=CjKrFqbLyDKdUca-fWB-QkDURjdypkbrBUpEFNy3qQo,18719
 opentf/toolkit/__init__.py,sha256=J8lC8gH952aspCnroErgaoqxsDBaNNAgiorfP8c5e3c,19088
 opentf/toolkit/channels.py,sha256=caUaZIRHp9D4BoJRtFug-M6tsjxrp3TDPaBxPlPghos,16121
 opentf/toolkit/core.py,sha256=40S-pUKXWidbI4JwkmQjGq46WlxJshj6d-wEl4e5TxU,7312
-opentf_toolkit_nightly-0.50.0.dev657.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-opentf_toolkit_nightly-0.50.0.dev657.dist-info/METADATA,sha256=nrtFcAqW1VFG7h_33bOSlg_aviJMYWsD0T9e9VehS3s,1981
-opentf_toolkit_nightly-0.50.0.dev657.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
-opentf_toolkit_nightly-0.50.0.dev657.dist-info/top_level.txt,sha256=_gPuE6GTT6UNXy1DjtmQSfCcZb_qYA2vWmjg7a30AGk,7
-opentf_toolkit_nightly-0.50.0.dev657.dist-info/RECORD,,
+opentf_toolkit_nightly-0.50.0.dev662.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+opentf_toolkit_nightly-0.50.0.dev662.dist-info/METADATA,sha256=v7HtIbJnpYqvqW2ODPnGZFMHUKdghEgPeiixucgc4Ms,1981
+opentf_toolkit_nightly-0.50.0.dev662.dist-info/WHEEL,sha256=AtBG6SXL3KF_v0NxLf0ehyVOh0cold-JbJYXNGorC6Q,92
+opentf_toolkit_nightly-0.50.0.dev662.dist-info/top_level.txt,sha256=_gPuE6GTT6UNXy1DjtmQSfCcZb_qYA2vWmjg7a30AGk,7
+opentf_toolkit_nightly-0.50.0.dev662.dist-info/RECORD,,
```

